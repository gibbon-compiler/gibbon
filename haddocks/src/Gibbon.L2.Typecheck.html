<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-name-shadowing #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -fdefer-typed-holes #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-unused-do-bind #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.L2.Typecheck</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier">tcExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcProg"><span class="hs-identifier">tcProg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TCError"><span class="hs-identifier">TCError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier">RegionSet</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier">LocationTypeState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier">ConstraintSet</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocConstraint"><span class="hs-identifier">LocConstraint</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Aliased"><span class="hs-identifier">Aliased</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier">TcM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/deepseq-1.4.8.0/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Except.html"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldlM"><span class="hs-identifier">foldlM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html"><span class="hs-identifier">Text.PrettyPrint.GenericPretty</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.L2.Syntax.html"><span class="hs-identifier">Gibbon.L2.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L2</span></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- import qualified Gibbon.L1.Syntax as L1</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="annot"><span class="hs-comment">-- | Constraints on locations.  Used during typechecking.  Roughly analogous to LocExp.</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">data</span><span> </span><span id="LocConstraint"><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocConstraint"><span class="hs-identifier hs-var">LocConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StartOfC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#StartOfC"><span class="hs-identifier hs-var">StartOfC</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-comment">-- ^ Location is equal to start of this region.</span><span>
</span><span id="line-36"></span><span>                   </span><span class="hs-comment">-- Can't attach haddocks to data constructor arguments with &lt; GHC 8.4.2</span><span>
</span><span id="line-37"></span><span>                   </span><span class="hs-comment">-- See https://github.com/haskell/haddock/pull/709.</span><span>
</span><span id="line-38"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span id="AfterConstantC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#AfterConstantC"><span class="hs-identifier hs-var">AfterConstantC</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>     </span><span class="hs-comment">-- Number of bytes after.</span><span>
</span><span id="line-39"></span><span>                                    </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>  </span><span class="hs-comment">-- Location which is before</span><span>
</span><span id="line-40"></span><span>                                    </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>  </span><span class="hs-comment">-- Location which is after</span><span>
</span><span id="line-41"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span id="AfterVariableC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#AfterVariableC"><span class="hs-identifier hs-var">AfterVariableC</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>     </span><span class="hs-comment">-- Name of variable v. This loc is size(v) bytes after.</span><span>
</span><span id="line-42"></span><span>                                    </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>  </span><span class="hs-comment">-- Location which is before</span><span>
</span><span id="line-43"></span><span>                                    </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>  </span><span class="hs-comment">-- Location which is after</span><span>
</span><span id="line-44"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span id="InRegionC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-comment">-- Location is somewher within this region.</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680918490"><span id="local-6989586621680918494"><span id="local-6989586621680918497"><span id="local-6989586621680918531"><span class="annot"><span class="annottext">ReadPrec [LocConstraint]
ReadPrec LocConstraint
Int -&gt; ReadS LocConstraint
ReadS [LocConstraint]
(Int -&gt; ReadS LocConstraint)
-&gt; ReadS [LocConstraint]
-&gt; ReadPrec LocConstraint
-&gt; ReadPrec [LocConstraint]
-&gt; Read LocConstraint
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
$creadsPrec :: Int -&gt; ReadS LocConstraint
readsPrec :: Int -&gt; ReadS LocConstraint
$creadList :: ReadS [LocConstraint]
readList :: ReadS [LocConstraint]
$creadPrec :: ReadPrec LocConstraint
readPrec :: ReadPrec LocConstraint
$creadListPrec :: ReadPrec [LocConstraint]
readListPrec :: ReadPrec [LocConstraint]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918535"><span id="local-6989586621680918555"><span id="local-6989586621680918559"><span class="annot"><span class="annottext">Int -&gt; LocConstraint -&gt; ShowS
[LocConstraint] -&gt; ShowS
LocConstraint -&gt; String
(Int -&gt; LocConstraint -&gt; ShowS)
-&gt; (LocConstraint -&gt; String)
-&gt; ([LocConstraint] -&gt; ShowS)
-&gt; Show LocConstraint
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; LocConstraint -&gt; ShowS
showsPrec :: Int -&gt; LocConstraint -&gt; ShowS
$cshow :: LocConstraint -&gt; String
show :: LocConstraint -&gt; String
$cshowList :: [LocConstraint] -&gt; ShowS
showList :: [LocConstraint] -&gt; ShowS
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918563"><span id="local-6989586621680918578"><span class="annot"><span class="annottext">LocConstraint -&gt; LocConstraint -&gt; Bool
(LocConstraint -&gt; LocConstraint -&gt; Bool)
-&gt; (LocConstraint -&gt; LocConstraint -&gt; Bool) -&gt; Eq LocConstraint
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: LocConstraint -&gt; LocConstraint -&gt; Bool
== :: LocConstraint -&gt; LocConstraint -&gt; Bool
$c/= :: LocConstraint -&gt; LocConstraint -&gt; Bool
/= :: LocConstraint -&gt; LocConstraint -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918585"><span id="local-6989586621680918599"><span id="local-6989586621680918603"><span id="local-6989586621680918606"><span id="local-6989586621680918609"><span id="local-6989586621680918612"><span id="local-6989586621680918615"><span class="annot"><span class="annottext">Eq LocConstraint
Eq LocConstraint
-&gt; (LocConstraint -&gt; LocConstraint -&gt; Ordering)
-&gt; (LocConstraint -&gt; LocConstraint -&gt; Bool)
-&gt; (LocConstraint -&gt; LocConstraint -&gt; Bool)
-&gt; (LocConstraint -&gt; LocConstraint -&gt; Bool)
-&gt; (LocConstraint -&gt; LocConstraint -&gt; Bool)
-&gt; (LocConstraint -&gt; LocConstraint -&gt; LocConstraint)
-&gt; (LocConstraint -&gt; LocConstraint -&gt; LocConstraint)
-&gt; Ord LocConstraint
LocConstraint -&gt; LocConstraint -&gt; Bool
LocConstraint -&gt; LocConstraint -&gt; Ordering
LocConstraint -&gt; LocConstraint -&gt; LocConstraint
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: LocConstraint -&gt; LocConstraint -&gt; Ordering
compare :: LocConstraint -&gt; LocConstraint -&gt; Ordering
$c&lt; :: LocConstraint -&gt; LocConstraint -&gt; Bool
&lt; :: LocConstraint -&gt; LocConstraint -&gt; Bool
$c&lt;= :: LocConstraint -&gt; LocConstraint -&gt; Bool
&lt;= :: LocConstraint -&gt; LocConstraint -&gt; Bool
$c&gt; :: LocConstraint -&gt; LocConstraint -&gt; Bool
&gt; :: LocConstraint -&gt; LocConstraint -&gt; Bool
$c&gt;= :: LocConstraint -&gt; LocConstraint -&gt; Bool
&gt;= :: LocConstraint -&gt; LocConstraint -&gt; Bool
$cmax :: LocConstraint -&gt; LocConstraint -&gt; LocConstraint
max :: LocConstraint -&gt; LocConstraint -&gt; LocConstraint
$cmin :: LocConstraint -&gt; LocConstraint -&gt; LocConstraint
min :: LocConstraint -&gt; LocConstraint -&gt; LocConstraint
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918619"><span id="local-6989586621680918621"><span class="annot"><span class="annottext">(forall x. LocConstraint -&gt; Rep LocConstraint x)
-&gt; (forall x. Rep LocConstraint x -&gt; LocConstraint)
-&gt; Generic LocConstraint
forall x. Rep LocConstraint x -&gt; LocConstraint
forall x. LocConstraint -&gt; Rep LocConstraint x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. LocConstraint -&gt; Rep LocConstraint x
from :: forall x. LocConstraint -&gt; Rep LocConstraint x
$cto :: forall x. Rep LocConstraint x -&gt; LocConstraint
to :: forall x. Rep LocConstraint x -&gt; LocConstraint
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918625"><span class="annot"><span class="annottext">LocConstraint -&gt; ()
(LocConstraint -&gt; ()) -&gt; NFData LocConstraint
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: LocConstraint -&gt; ()
rnf :: LocConstraint -&gt; ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/deepseq-1.4.8.0/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918660"><span id="local-6989586621680918667"><span id="local-6989586621680918673"><span class="annot"><span class="annottext">Int -&gt; LocConstraint -&gt; Doc
[LocConstraint] -&gt; Doc
LocConstraint -&gt; Doc
(Int -&gt; LocConstraint -&gt; Doc)
-&gt; (LocConstraint -&gt; Doc)
-&gt; ([LocConstraint] -&gt; Doc)
-&gt; Out LocConstraint
forall a. (Int -&gt; a -&gt; Doc) -&gt; (a -&gt; Doc) -&gt; ([a] -&gt; Doc) -&gt; Out a
$cdocPrec :: Int -&gt; LocConstraint -&gt; Doc
docPrec :: Int -&gt; LocConstraint -&gt; Doc
$cdoc :: LocConstraint -&gt; Doc
doc :: LocConstraint -&gt; Doc
$cdocList :: [LocConstraint] -&gt; Doc
docList :: [LocConstraint] -&gt; Doc
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Out</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | A set of constraints (which are re-used location expressions)</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- which encode relationships between locations. These are used by the</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- type checker to verify that locations are used correctly.</span><span>
</span><span id="line-51"></span><span class="hs-comment">--</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- The following are valid constraints:</span><span>
</span><span id="line-53"></span><span class="hs-comment">--  * StartOfC LocVar Region</span><span>
</span><span id="line-54"></span><span class="hs-comment">--  * AfterConstantC Int LocVar LocVar</span><span>
</span><span id="line-55"></span><span class="hs-comment">--  * AfterVariableC Var LocVar LocVar</span><span>
</span><span id="line-56"></span><span class="hs-comment">--  * InRegionC LocVar Region</span><span>
</span><span id="line-57"></span><span class="hs-comment">--  * FromEndC</span><span>
</span><span id="line-58"></span><span class="hs-comment">--</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- While the first four can appear in syntax before RouteEnds, the fifth</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- (fromEnd) should only be introduced by the RouteEnds pass.</span><span>
</span><span id="line-61"></span><span class="hs-keyword">newtype</span><span> </span><span id="ConstraintSet"><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-var">ConstraintSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ConstraintSet"><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-var">ConstraintSet</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="constraintSet"><span class="annot"><span class="annottext">ConstraintSet -&gt; Set LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#constraintSet"><span class="hs-identifier hs-var hs-var">constraintSet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocConstraint"><span class="hs-identifier hs-type">LocConstraint</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680918775"><span id="local-6989586621680918779"><span id="local-6989586621680918782"><span id="local-6989586621680918793"><span class="annot"><span class="annottext">ReadPrec [ConstraintSet]
ReadPrec ConstraintSet
Int -&gt; ReadS ConstraintSet
ReadS [ConstraintSet]
(Int -&gt; ReadS ConstraintSet)
-&gt; ReadS [ConstraintSet]
-&gt; ReadPrec ConstraintSet
-&gt; ReadPrec [ConstraintSet]
-&gt; Read ConstraintSet
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
$creadsPrec :: Int -&gt; ReadS ConstraintSet
readsPrec :: Int -&gt; ReadS ConstraintSet
$creadList :: ReadS [ConstraintSet]
readList :: ReadS [ConstraintSet]
$creadPrec :: ReadPrec ConstraintSet
readPrec :: ReadPrec ConstraintSet
$creadListPrec :: ReadPrec [ConstraintSet]
readListPrec :: ReadPrec [ConstraintSet]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918796"><span id="local-6989586621680918802"><span id="local-6989586621680918806"><span class="annot"><span class="annottext">Int -&gt; ConstraintSet -&gt; ShowS
[ConstraintSet] -&gt; ShowS
ConstraintSet -&gt; String
(Int -&gt; ConstraintSet -&gt; ShowS)
-&gt; (ConstraintSet -&gt; String)
-&gt; ([ConstraintSet] -&gt; ShowS)
-&gt; Show ConstraintSet
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ConstraintSet -&gt; ShowS
showsPrec :: Int -&gt; ConstraintSet -&gt; ShowS
$cshow :: ConstraintSet -&gt; String
show :: ConstraintSet -&gt; String
$cshowList :: [ConstraintSet] -&gt; ShowS
showList :: [ConstraintSet] -&gt; ShowS
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918809"><span id="local-6989586621680918815"><span class="annot"><span class="annottext">ConstraintSet -&gt; ConstraintSet -&gt; Bool
(ConstraintSet -&gt; ConstraintSet -&gt; Bool)
-&gt; (ConstraintSet -&gt; ConstraintSet -&gt; Bool) -&gt; Eq ConstraintSet
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
== :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
$c/= :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
/= :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918823"><span id="local-6989586621680918829"><span id="local-6989586621680918834"><span id="local-6989586621680918839"><span id="local-6989586621680918844"><span id="local-6989586621680918849"><span id="local-6989586621680918854"><span class="annot"><span class="annottext">Eq ConstraintSet
Eq ConstraintSet
-&gt; (ConstraintSet -&gt; ConstraintSet -&gt; Ordering)
-&gt; (ConstraintSet -&gt; ConstraintSet -&gt; Bool)
-&gt; (ConstraintSet -&gt; ConstraintSet -&gt; Bool)
-&gt; (ConstraintSet -&gt; ConstraintSet -&gt; Bool)
-&gt; (ConstraintSet -&gt; ConstraintSet -&gt; Bool)
-&gt; (ConstraintSet -&gt; ConstraintSet -&gt; ConstraintSet)
-&gt; (ConstraintSet -&gt; ConstraintSet -&gt; ConstraintSet)
-&gt; Ord ConstraintSet
ConstraintSet -&gt; ConstraintSet -&gt; Bool
ConstraintSet -&gt; ConstraintSet -&gt; Ordering
ConstraintSet -&gt; ConstraintSet -&gt; ConstraintSet
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: ConstraintSet -&gt; ConstraintSet -&gt; Ordering
compare :: ConstraintSet -&gt; ConstraintSet -&gt; Ordering
$c&lt; :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
&lt; :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
$c&lt;= :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
&lt;= :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
$c&gt; :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
&gt; :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
$c&gt;= :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
&gt;= :: ConstraintSet -&gt; ConstraintSet -&gt; Bool
$cmax :: ConstraintSet -&gt; ConstraintSet -&gt; ConstraintSet
max :: ConstraintSet -&gt; ConstraintSet -&gt; ConstraintSet
$cmin :: ConstraintSet -&gt; ConstraintSet -&gt; ConstraintSet
min :: ConstraintSet -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918860"><span id="local-6989586621680918862"><span class="annot"><span class="annottext">(forall x. ConstraintSet -&gt; Rep ConstraintSet x)
-&gt; (forall x. Rep ConstraintSet x -&gt; ConstraintSet)
-&gt; Generic ConstraintSet
forall x. Rep ConstraintSet x -&gt; ConstraintSet
forall x. ConstraintSet -&gt; Rep ConstraintSet x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. ConstraintSet -&gt; Rep ConstraintSet x
from :: forall x. ConstraintSet -&gt; Rep ConstraintSet x
$cto :: forall x. Rep ConstraintSet x -&gt; ConstraintSet
to :: forall x. Rep ConstraintSet x -&gt; ConstraintSet
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918865"><span class="annot"><span class="annottext">ConstraintSet -&gt; ()
(ConstraintSet -&gt; ()) -&gt; NFData ConstraintSet
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: ConstraintSet -&gt; ()
rnf :: ConstraintSet -&gt; ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/deepseq-1.4.8.0/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680918878"><span id="local-6989586621680918885"><span id="local-6989586621680918891"><span class="annot"><span class="annottext">Int -&gt; ConstraintSet -&gt; Doc
[ConstraintSet] -&gt; Doc
ConstraintSet -&gt; Doc
(Int -&gt; ConstraintSet -&gt; Doc)
-&gt; (ConstraintSet -&gt; Doc)
-&gt; ([ConstraintSet] -&gt; Doc)
-&gt; Out ConstraintSet
forall a. (Int -&gt; a -&gt; Doc) -&gt; (a -&gt; Doc) -&gt; ([a] -&gt; Doc) -&gt; Out a
$cdocPrec :: Int -&gt; ConstraintSet -&gt; Doc
docPrec :: Int -&gt; ConstraintSet -&gt; Doc
$cdoc :: ConstraintSet -&gt; Doc
doc :: ConstraintSet -&gt; Doc
$cdocList :: [ConstraintSet] -&gt; Doc
docList :: [ConstraintSet] -&gt; Doc
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Out</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | A location has been aliased if we have taken an offset of it while introducing a new</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- location. These show up in the LocationTypeState below.</span><span>
</span><span id="line-66"></span><span class="hs-keyword">type</span><span> </span><span id="Aliased"><span class="annot"><a href="Gibbon.L2.Typecheck.html#Aliased"><span class="hs-identifier hs-var">Aliased</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | A map from locations to their type state. This tracks the current state of a location</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- at a certain point in a program. The type checker threads this through by taking an</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- input map that represents the location states before checking a particular expression,</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- and returns an output map that represents the location states after checking that</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- particular expression.</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- All we need to know in this map is whether each location is an input or output location,</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- and whether we've taken an offset of the location in a letloc form.</span><span>
</span><span id="line-75"></span><span class="hs-keyword">newtype</span><span> </span><span id="LocationTypeState"><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LocationTypeState"><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">{</span><span>
</span><span id="line-77"></span><span>      </span><span id="tsmap"><span class="annot"><span class="annottext">LocationTypeState -&gt; Map LocVar (Modality, Bool)
</span><a href="Gibbon.L2.Typecheck.html#tsmap"><span class="hs-identifier hs-var hs-var">tsmap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Aliased"><span class="hs-identifier hs-type">Aliased</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Each location has a modality and may have had an offset taken.</span></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680918938"><span id="local-6989586621680918942"><span id="local-6989586621680918945"><span id="local-6989586621680918957"><span class="annot"><span class="annottext">ReadPrec [LocationTypeState]
ReadPrec LocationTypeState
Int -&gt; ReadS LocationTypeState
ReadS [LocationTypeState]
(Int -&gt; ReadS LocationTypeState)
-&gt; ReadS [LocationTypeState]
-&gt; ReadPrec LocationTypeState
-&gt; ReadPrec [LocationTypeState]
-&gt; Read LocationTypeState
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
$creadsPrec :: Int -&gt; ReadS LocationTypeState
readsPrec :: Int -&gt; ReadS LocationTypeState
$creadList :: ReadS [LocationTypeState]
readList :: ReadS [LocationTypeState]
$creadPrec :: ReadPrec LocationTypeState
readPrec :: ReadPrec LocationTypeState
$creadListPrec :: ReadPrec [LocationTypeState]
readListPrec :: ReadPrec [LocationTypeState]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></a></span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680918965"><span id="local-6989586621680918972"><span id="local-6989586621680918976"><span class="annot"><span class="annottext">Int -&gt; LocationTypeState -&gt; ShowS
[LocationTypeState] -&gt; ShowS
LocationTypeState -&gt; String
(Int -&gt; LocationTypeState -&gt; ShowS)
-&gt; (LocationTypeState -&gt; String)
-&gt; ([LocationTypeState] -&gt; ShowS)
-&gt; Show LocationTypeState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; LocationTypeState -&gt; ShowS
showsPrec :: Int -&gt; LocationTypeState -&gt; ShowS
$cshow :: LocationTypeState -&gt; String
show :: LocationTypeState -&gt; String
$cshowList :: [LocationTypeState] -&gt; ShowS
showList :: [LocationTypeState] -&gt; ShowS
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680918984"><span id="local-6989586621680918991"><span class="annot"><span class="annottext">LocationTypeState -&gt; LocationTypeState -&gt; Bool
(LocationTypeState -&gt; LocationTypeState -&gt; Bool)
-&gt; (LocationTypeState -&gt; LocationTypeState -&gt; Bool)
-&gt; Eq LocationTypeState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
== :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
$c/= :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
/= :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span id="local-6989586621680919007"><span id="local-6989586621680919014"><span id="local-6989586621680919020"><span id="local-6989586621680919026"><span id="local-6989586621680919032"><span id="local-6989586621680919038"><span id="local-6989586621680919044"><span class="annot"><span class="annottext">Eq LocationTypeState
Eq LocationTypeState
-&gt; (LocationTypeState -&gt; LocationTypeState -&gt; Ordering)
-&gt; (LocationTypeState -&gt; LocationTypeState -&gt; Bool)
-&gt; (LocationTypeState -&gt; LocationTypeState -&gt; Bool)
-&gt; (LocationTypeState -&gt; LocationTypeState -&gt; Bool)
-&gt; (LocationTypeState -&gt; LocationTypeState -&gt; Bool)
-&gt; (LocationTypeState -&gt; LocationTypeState -&gt; LocationTypeState)
-&gt; (LocationTypeState -&gt; LocationTypeState -&gt; LocationTypeState)
-&gt; Ord LocationTypeState
LocationTypeState -&gt; LocationTypeState -&gt; Bool
LocationTypeState -&gt; LocationTypeState -&gt; Ordering
LocationTypeState -&gt; LocationTypeState -&gt; LocationTypeState
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: LocationTypeState -&gt; LocationTypeState -&gt; Ordering
compare :: LocationTypeState -&gt; LocationTypeState -&gt; Ordering
$c&lt; :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
&lt; :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
$c&lt;= :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
&lt;= :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
$c&gt; :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
&gt; :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
$c&gt;= :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
&gt;= :: LocationTypeState -&gt; LocationTypeState -&gt; Bool
$cmax :: LocationTypeState -&gt; LocationTypeState -&gt; LocationTypeState
max :: LocationTypeState -&gt; LocationTypeState -&gt; LocationTypeState
$cmin :: LocationTypeState -&gt; LocationTypeState -&gt; LocationTypeState
min :: LocationTypeState -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919068"><span id="local-6989586621680919070"><span class="annot"><span class="annottext">(forall x. LocationTypeState -&gt; Rep LocationTypeState x)
-&gt; (forall x. Rep LocationTypeState x -&gt; LocationTypeState)
-&gt; Generic LocationTypeState
forall x. Rep LocationTypeState x -&gt; LocationTypeState
forall x. LocationTypeState -&gt; Rep LocationTypeState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. LocationTypeState -&gt; Rep LocationTypeState x
from :: forall x. LocationTypeState -&gt; Rep LocationTypeState x
$cto :: forall x. Rep LocationTypeState x -&gt; LocationTypeState
to :: forall x. Rep LocationTypeState x -&gt; LocationTypeState
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919073"><span class="annot"><span class="annottext">LocationTypeState -&gt; ()
(LocationTypeState -&gt; ()) -&gt; NFData LocationTypeState
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: LocationTypeState -&gt; ()
rnf :: LocationTypeState -&gt; ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/deepseq-1.4.8.0/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919092"><span id="local-6989586621680919099"><span id="local-6989586621680919105"><span class="annot"><span class="annottext">Int -&gt; LocationTypeState -&gt; Doc
[LocationTypeState] -&gt; Doc
LocationTypeState -&gt; Doc
(Int -&gt; LocationTypeState -&gt; Doc)
-&gt; (LocationTypeState -&gt; Doc)
-&gt; ([LocationTypeState] -&gt; Doc)
-&gt; Out LocationTypeState
forall a. (Int -&gt; a -&gt; Doc) -&gt; (a -&gt; Doc) -&gt; ([a] -&gt; Doc) -&gt; Out a
$cdocPrec :: Int -&gt; LocationTypeState -&gt; Doc
docPrec :: Int -&gt; LocationTypeState -&gt; Doc
$cdoc :: LocationTypeState -&gt; Doc
doc :: LocationTypeState -&gt; Doc
$cdocList :: [LocationTypeState] -&gt; Doc
docList :: [LocationTypeState] -&gt; Doc
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Out</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | A region set is (as you would expect) a set of regions. They are the</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- regions that are currently live while checking a particular expression.</span><span>
</span><span id="line-84"></span><span class="hs-keyword">newtype</span><span> </span><span id="RegionSet"><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-var">RegionSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RegionSet"><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-var">RegionSet</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="regSet"><span class="annot"><span class="annottext">RegionSet -&gt; Set LocVar
</span><a href="Gibbon.L2.Typecheck.html#regSet"><span class="hs-identifier hs-var hs-var">regSet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680919158"><span id="local-6989586621680919162"><span id="local-6989586621680919165"><span id="local-6989586621680919175"><span class="annot"><span class="annottext">ReadPrec [RegionSet]
ReadPrec RegionSet
Int -&gt; ReadS RegionSet
ReadS [RegionSet]
(Int -&gt; ReadS RegionSet)
-&gt; ReadS [RegionSet]
-&gt; ReadPrec RegionSet
-&gt; ReadPrec [RegionSet]
-&gt; Read RegionSet
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
$creadsPrec :: Int -&gt; ReadS RegionSet
readsPrec :: Int -&gt; ReadS RegionSet
$creadList :: ReadS [RegionSet]
readList :: ReadS [RegionSet]
$creadPrec :: ReadPrec RegionSet
readPrec :: ReadPrec RegionSet
$creadListPrec :: ReadPrec [RegionSet]
readListPrec :: ReadPrec [RegionSet]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919178"><span id="local-6989586621680919183"><span id="local-6989586621680919187"><span class="annot"><span class="annottext">Int -&gt; RegionSet -&gt; ShowS
[RegionSet] -&gt; ShowS
RegionSet -&gt; String
(Int -&gt; RegionSet -&gt; ShowS)
-&gt; (RegionSet -&gt; String)
-&gt; ([RegionSet] -&gt; ShowS)
-&gt; Show RegionSet
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; RegionSet -&gt; ShowS
showsPrec :: Int -&gt; RegionSet -&gt; ShowS
$cshow :: RegionSet -&gt; String
show :: RegionSet -&gt; String
$cshowList :: [RegionSet] -&gt; ShowS
showList :: [RegionSet] -&gt; ShowS
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919190"><span id="local-6989586621680919195"><span class="annot"><span class="annottext">RegionSet -&gt; RegionSet -&gt; Bool
(RegionSet -&gt; RegionSet -&gt; Bool)
-&gt; (RegionSet -&gt; RegionSet -&gt; Bool) -&gt; Eq RegionSet
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: RegionSet -&gt; RegionSet -&gt; Bool
== :: RegionSet -&gt; RegionSet -&gt; Bool
$c/= :: RegionSet -&gt; RegionSet -&gt; Bool
/= :: RegionSet -&gt; RegionSet -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919203"><span id="local-6989586621680919208"><span id="local-6989586621680919213"><span id="local-6989586621680919218"><span id="local-6989586621680919223"><span id="local-6989586621680919228"><span id="local-6989586621680919233"><span class="annot"><span class="annottext">Eq RegionSet
Eq RegionSet
-&gt; (RegionSet -&gt; RegionSet -&gt; Ordering)
-&gt; (RegionSet -&gt; RegionSet -&gt; Bool)
-&gt; (RegionSet -&gt; RegionSet -&gt; Bool)
-&gt; (RegionSet -&gt; RegionSet -&gt; Bool)
-&gt; (RegionSet -&gt; RegionSet -&gt; Bool)
-&gt; (RegionSet -&gt; RegionSet -&gt; RegionSet)
-&gt; (RegionSet -&gt; RegionSet -&gt; RegionSet)
-&gt; Ord RegionSet
RegionSet -&gt; RegionSet -&gt; Bool
RegionSet -&gt; RegionSet -&gt; Ordering
RegionSet -&gt; RegionSet -&gt; RegionSet
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: RegionSet -&gt; RegionSet -&gt; Ordering
compare :: RegionSet -&gt; RegionSet -&gt; Ordering
$c&lt; :: RegionSet -&gt; RegionSet -&gt; Bool
&lt; :: RegionSet -&gt; RegionSet -&gt; Bool
$c&lt;= :: RegionSet -&gt; RegionSet -&gt; Bool
&lt;= :: RegionSet -&gt; RegionSet -&gt; Bool
$c&gt; :: RegionSet -&gt; RegionSet -&gt; Bool
&gt; :: RegionSet -&gt; RegionSet -&gt; Bool
$c&gt;= :: RegionSet -&gt; RegionSet -&gt; Bool
&gt;= :: RegionSet -&gt; RegionSet -&gt; Bool
$cmax :: RegionSet -&gt; RegionSet -&gt; RegionSet
max :: RegionSet -&gt; RegionSet -&gt; RegionSet
$cmin :: RegionSet -&gt; RegionSet -&gt; RegionSet
min :: RegionSet -&gt; RegionSet -&gt; RegionSet
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919239"><span id="local-6989586621680919241"><span class="annot"><span class="annottext">(forall x. RegionSet -&gt; Rep RegionSet x)
-&gt; (forall x. Rep RegionSet x -&gt; RegionSet) -&gt; Generic RegionSet
forall x. Rep RegionSet x -&gt; RegionSet
forall x. RegionSet -&gt; Rep RegionSet x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. RegionSet -&gt; Rep RegionSet x
from :: forall x. RegionSet -&gt; Rep RegionSet x
$cto :: forall x. Rep RegionSet x -&gt; RegionSet
to :: forall x. Rep RegionSet x -&gt; RegionSet
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919244"><span class="annot"><span class="annottext">RegionSet -&gt; ()
(RegionSet -&gt; ()) -&gt; NFData RegionSet
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: RegionSet -&gt; ()
rnf :: RegionSet -&gt; ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/deepseq-1.4.8.0/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">-- | Shorthand for located expressions</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">type</span><span> </span><span id="Exp"><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | These are the kinds of errors that the type checker may throw. There are a</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- few named errors that I thought would be common, like variables not being</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- found, locations being used incorrectly, etc. For other errors, there's a</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- GenericTC form that takes some expression and string</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- (containing an error message).</span><span>
</span><span id="line-96"></span><span class="hs-keyword">data</span><span> </span><span id="TCError"><span class="annot"><a href="Gibbon.L2.Typecheck.html#TCError"><span class="hs-identifier hs-var">TCError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="GenericTC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-97"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="VarNotFoundTC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#VarNotFoundTC"><span class="hs-identifier hs-var">VarNotFoundTC</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-98"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="UnsupportedExpTC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#UnsupportedExpTC"><span class="hs-identifier hs-var">UnsupportedExpTC</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-99"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="LocationTC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTC"><span class="hs-identifier hs-var">LocationTC</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>
</span><span id="line-100"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="ModalityTC"><span class="annot"><a href="Gibbon.L2.Typecheck.html#ModalityTC"><span class="hs-identifier hs-var">ModalityTC</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span>
</span><span id="line-101"></span><span>               </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680919262"><span id="local-6989586621680919266"><span id="local-6989586621680919269"><span id="local-6989586621680919313"><span class="annot"><span class="annottext">ReadPrec [TCError]
ReadPrec TCError
Int -&gt; ReadS TCError
ReadS [TCError]
(Int -&gt; ReadS TCError)
-&gt; ReadS [TCError]
-&gt; ReadPrec TCError
-&gt; ReadPrec [TCError]
-&gt; Read TCError
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
$creadsPrec :: Int -&gt; ReadS TCError
readsPrec :: Int -&gt; ReadS TCError
$creadList :: ReadS [TCError]
readList :: ReadS [TCError]
$creadPrec :: ReadPrec TCError
readPrec :: ReadPrec TCError
$creadListPrec :: ReadPrec [TCError]
readListPrec :: ReadPrec [TCError]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></a></span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680919319"><span id="local-6989586621680919340"><span class="annot"><span class="annottext">TCError -&gt; TCError -&gt; Bool
(TCError -&gt; TCError -&gt; Bool)
-&gt; (TCError -&gt; TCError -&gt; Bool) -&gt; Eq TCError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: TCError -&gt; TCError -&gt; Bool
== :: TCError -&gt; TCError -&gt; Bool
$c/= :: TCError -&gt; TCError -&gt; Bool
/= :: TCError -&gt; TCError -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span id="local-6989586621680919349"><span id="local-6989586621680919370"><span id="local-6989586621680919374"><span id="local-6989586621680919377"><span id="local-6989586621680919380"><span id="local-6989586621680919383"><span id="local-6989586621680919386"><span class="annot"><span class="annottext">Eq TCError
Eq TCError
-&gt; (TCError -&gt; TCError -&gt; Ordering)
-&gt; (TCError -&gt; TCError -&gt; Bool)
-&gt; (TCError -&gt; TCError -&gt; Bool)
-&gt; (TCError -&gt; TCError -&gt; Bool)
-&gt; (TCError -&gt; TCError -&gt; Bool)
-&gt; (TCError -&gt; TCError -&gt; TCError)
-&gt; (TCError -&gt; TCError -&gt; TCError)
-&gt; Ord TCError
TCError -&gt; TCError -&gt; Bool
TCError -&gt; TCError -&gt; Ordering
TCError -&gt; TCError -&gt; TCError
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: TCError -&gt; TCError -&gt; Ordering
compare :: TCError -&gt; TCError -&gt; Ordering
$c&lt; :: TCError -&gt; TCError -&gt; Bool
&lt; :: TCError -&gt; TCError -&gt; Bool
$c&lt;= :: TCError -&gt; TCError -&gt; Bool
&lt;= :: TCError -&gt; TCError -&gt; Bool
$c&gt; :: TCError -&gt; TCError -&gt; Bool
&gt; :: TCError -&gt; TCError -&gt; Bool
$c&gt;= :: TCError -&gt; TCError -&gt; Bool
&gt;= :: TCError -&gt; TCError -&gt; Bool
$cmax :: TCError -&gt; TCError -&gt; TCError
max :: TCError -&gt; TCError -&gt; TCError
$cmin :: TCError -&gt; TCError -&gt; TCError
min :: TCError -&gt; TCError -&gt; TCError
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680919392"><span id="local-6989586621680919394"><span class="annot"><span class="annottext">(forall x. TCError -&gt; Rep TCError x)
-&gt; (forall x. Rep TCError x -&gt; TCError) -&gt; Generic TCError
forall x. Rep TCError x -&gt; TCError
forall x. TCError -&gt; Rep TCError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. TCError -&gt; Rep TCError x
from :: forall x. TCError -&gt; Rep TCError x
$cto :: forall x. Rep TCError x -&gt; TCError
to :: forall x. Rep TCError x -&gt; TCError
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span id="local-6989586621680919397"><span class="annot"><span class="annottext">TCError -&gt; ()
(TCError -&gt; ()) -&gt; NFData TCError
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: TCError -&gt; ()
rnf :: TCError -&gt; ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/deepseq-1.4.8.0/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680919439"><span id="local-6989586621680919444"><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TCError"><span class="hs-identifier hs-type">TCError</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621680919482"><span class="annot"><span class="annottext">show :: TCError -&gt; String
</span><a href="#local-6989586621680919482"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-type">GenericTC</span></a></span><span> </span><span id="local-6989586621680919484"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680919484"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621680919485"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919485"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error typechecking L2 Program\nIn the expression:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919485"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680919484"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#VarNotFoundTC"><span class="hs-identifier hs-type">VarNotFoundTC</span></a></span><span> </span><span id="local-6989586621680919487"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680919487"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680919488"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919488"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Variable not found: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680919487"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nIn the expression:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919488"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#UnsupportedExpTC"><span class="hs-identifier hs-type">UnsupportedExpTC</span></a></span><span> </span><span id="local-6989586621680919489"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919489"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsupported expression:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919489"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTC"><span class="hs-identifier hs-type">LocationTC</span></a></span><span> </span><span id="local-6989586621680919490"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680919490"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621680919491"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919491"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680919492"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680919492"><span class="hs-identifier hs-var">lv1</span></a></span></span><span> </span><span id="local-6989586621680919493"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680919493"><span class="hs-identifier hs-var">lv2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Location typechecking error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680919490"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nIn the expression:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919491"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>                                      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nLocations: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680919492"><span class="hs-identifier hs-var">lv1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680919493"><span class="hs-identifier hs-var">lv2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ModalityTC"><span class="hs-identifier hs-type">ModalityTC</span></a></span><span> </span><span id="local-6989586621680919494"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680919494"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621680919495"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919495"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680919496"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680919496"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621680919497"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680919497"><span class="hs-identifier hs-var">lts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Modality typechecking error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680919494"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nIn the expression:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680919495"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>                                     </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nLocation: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680919496"><span class="hs-identifier hs-var">lv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nLocation type state: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocationTypeState -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680919497"><span class="hs-identifier hs-var">lts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | The type checking monad. Just for throwing errors, but could in the future be parameterized</span><span>
</span><span id="line-113"></span><span class="hs-comment">--   by whatever other logging, etc, monad we want the compiler to use.</span><span>
</span><span id="line-114"></span><span class="hs-keyword">type</span><span> </span><span id="TcM"><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-var">TcM</span></a></span></span><span> </span><span id="local-6989586621680919498"><span class="annot"><a href="#local-6989586621680919498"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/transformers-0.5.6.2/src/Control.Monad.Trans.Except.html#Except"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TCError"><span class="hs-identifier hs-type">TCError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680919498"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- | Check an expression. Given the data definitions, an general type environment, a function map,</span><span>
</span><span id="line-119"></span><span class="hs-comment">--   a constraint set, a region set, an (input) location state map, and the expression, this function</span><span>
</span><span id="line-120"></span><span class="hs-comment">--   will either throw an error, or return a pair of expression type and new location state map.</span><span>
</span><span id="line-121"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-type">tcExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span id="tcExp"><span class="annot"><span class="annottext">tcExp :: DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var hs-var">tcExp</span></a></span></span><span> </span><span id="local-6989586621680920212"><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680920213"><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680920214"><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span></span><span> </span><span id="local-6989586621680920215"><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span></span><span> </span><span id="local-6989586621680920216"><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span></span><span> </span><span id="local-6989586621680920217"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span></span><span> </span><span id="local-6989586621680920218"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680920220"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920220"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>          </span><span class="hs-comment">-- Look up a variable in the environment</span><span>
</span><span id="line-130"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680920221"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920221"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar) -&gt; LocVar -&gt; Exp -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920220"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-131"></span><span>             </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920221"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span> </span><span id="local-6989586621680920224"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920224"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span> </span><span id="local-6989586621680920227"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680920227"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CharTy"><span class="hs-identifier hs-var">CharTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span> </span><span id="local-6989586621680920230"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680920230"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span> </span><span id="local-6989586621680920233"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920233"><span class="hs-identifier hs-var">_v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680920236"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920236"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680920237"><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920237"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680920238"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920238"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>          </span><span class="hs-comment">-- Checking function application involves a few steps:</span><span>
</span><span id="line-143"></span><span>          </span><span class="hs-comment">--  (1) We need to make sure the inputs/ouptuts line up with the expected</span><span>
</span><span id="line-144"></span><span>          </span><span class="hs-comment">--      types for the function.</span><span>
</span><span id="line-145"></span><span>          </span><span class="hs-comment">--  (2) We need to update the location state map with information about what output</span><span>
</span><span id="line-146"></span><span>          </span><span class="hs-comment">--      locations have been written to by the called function and must now be input</span><span>
</span><span id="line-147"></span><span>          </span><span class="hs-comment">--      locations.</span><span>
</span><span id="line-148"></span><span>          </span><span class="hs-comment">--  (3) We need to make sure that if we pass a packed structure as an argument, its</span><span>
</span><span id="line-149"></span><span>          </span><span class="hs-comment">--      location is among the passed-in locations.</span><span>
</span><span id="line-150"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#ArrowTy2"><span class="hs-identifier hs-type">ArrowTy2</span></a></span><span> </span><span id="local-6989586621680920240"><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920240"><span class="hs-identifier hs-var">locVars</span></a></span></span><span> </span><span id="local-6989586621680920241"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920241"><span class="hs-identifier hs-var">arrIns</span></a></span></span><span> </span><span id="local-6989586621680920242"><span class="annot"><span class="annottext">Set Effect
</span><a href="#local-6989586621680920242"><span class="hs-identifier hs-var">_arrEffs</span></a></span></span><span> </span><span id="local-6989586621680920243"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920243"><span class="hs-identifier hs-var">arrOut</span></a></span></span><span> </span><span id="local-6989586621680920244"><span class="annot"><span class="annottext">[LocRet]
</span><a href="#local-6989586621680920244"><span class="hs-identifier hs-var">_locRets</span></a></span></span><span> </span><span id="local-6989586621680920245"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680920245"><span class="hs-identifier hs-var">_isPar</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>                     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; FunDefs2 -&gt; Maybe (FunDef Exp)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920236"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-152"></span><span>                       </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680920247"><span class="annot"><span class="annottext">FunDef Exp
</span><a href="#local-6989586621680920247"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunDef Exp -&gt; ArrowTy (TyOf Exp)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef Exp
</span><a href="#local-6989586621680920247"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-153"></span><span>                       </span><span class="annot"><span class="annottext">Maybe (FunDef Exp)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ArrowTy2 (UrTy LocVar)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ArrowTy2 (UrTy LocVar))
-&gt; String -&gt; ArrowTy2 (UrTy LocVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExp: Unbound function: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920236"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>             </span><span class="hs-comment">-- Get types of arguments</span><span>
</span><span id="line-156"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621680920250"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920250"><span class="hs-identifier hs-var">in_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920251"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920251"><span class="hs-identifier hs-var">tstate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(([UrTy LocVar], LocationTypeState)
 -&gt; Exp
 -&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState))
-&gt; ([UrTy LocVar], LocationTypeState)
-&gt; [Exp]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span>
</span><span id="line-157"></span><span>                                   </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680920252"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920252"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920253"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920253"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680920254"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920254"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>                                         </span><span class="hs-special">(</span><span id="local-6989586621680920255"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920255"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920256"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920256"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920253"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920254"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-159"></span><span>                                         </span><span class="annot"><span class="annottext">([UrTy LocVar], LocationTypeState)
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920252"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; [UrTy LocVar] -&gt; [UrTy LocVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920255"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920256"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>                                   </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920238"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>             </span><span class="hs-comment">-- Check arity</span><span>
</span><span id="line-163"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920238"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920250"><span class="hs-identifier hs-var">in_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Arity mismatch. Expected:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920250"><span class="hs-identifier hs-var">in_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Got:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920238"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-165"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>             </span><span class="hs-comment">-- (1)</span><span>
</span><span id="line-168"></span><span>             </span><span class="annot"><span class="annottext">((UrTy LocVar, UrTy LocVar) -&gt; TcM (UrTy LocVar))
-&gt; [(UrTy LocVar, UrTy LocVar)]
-&gt; ExceptT TCError Identity [UrTy LocVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar))
-&gt; (UrTy LocVar, UrTy LocVar) -&gt; TcM (UrTy LocVar)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">((UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar))
 -&gt; (UrTy LocVar, UrTy LocVar) -&gt; TcM (UrTy LocVar))
-&gt; (UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar))
-&gt; (UrTy LocVar, UrTy LocVar)
-&gt; TcM (UrTy LocVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyNoLoc"><span class="hs-identifier hs-var">ensureEqualTyNoLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; [UrTy LocVar] -&gt; [(UrTy LocVar, UrTy LocVar)]
forall a b.
(Show a, Show b, HasCallStack) =&gt;
[a] -&gt; [b] -&gt; [(a, b)]
</span><a href="Gibbon.Common.html#fragileZip"><span class="hs-identifier hs-var">fragileZip</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920250"><span class="hs-identifier hs-var">in_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920241"><span class="hs-identifier hs-var">arrIns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>             </span><span class="hs-comment">-- (3) Check location of argument</span><span>
</span><span id="line-171"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920265"><span class="annot"><span class="annottext">tyls :: [LocVar]
</span><a href="#local-6989586621680920265"><span class="hs-identifier hs-var hs-var">tyls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar -&gt; [LocVar]) -&gt; [UrTy LocVar] -&gt; [LocVar]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; [LocVar]
</span><a href="Gibbon.L2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920250"><span class="hs-identifier hs-var">in_tys</span></a></span><span>
</span><span id="line-172"></span><span>             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(LocVar -&gt; Bool) -&gt; [LocVar] -&gt; Maybe LocVar
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">L.find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680920269"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920269"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Set LocVar -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920269"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocVar] -&gt; Set LocVar
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920237"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920265"><span class="hs-identifier hs-var">tyls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-173"></span><span>               </span><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>               </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680920273"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920273"><span class="hs-identifier hs-var">not_in_ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Packed argument location expected: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920273"><span class="hs-identifier hs-var">not_in_ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-175"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920274"><span class="annot"><span class="annottext">handleTS :: LocationTypeState -&gt; (LocVar, Modality) -&gt; TcM LocationTypeState
</span><a href="#local-6989586621680920274"><span class="hs-identifier hs-var hs-var">handleTS</span></a></span></span><span> </span><span id="local-6989586621680920275"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920275"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920276"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920276"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Exp -&gt; LocationTypeState -&gt; LocVar -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#switchOutLoc"><span class="hs-identifier hs-var">switchOutLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920275"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920276"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-176"></span><span>                 </span><span class="annot"><a href="#local-6989586621680920274"><span class="hs-identifier hs-var">handleTS</span></a></span><span> </span><span id="local-6989586621680920279"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920279"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="annot"><span class="annottext">(LocVar, Modality)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; TcM LocationTypeState
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920279"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-177"></span><span>             </span><span class="hs-comment">-- (2)</span><span>
</span><span id="line-178"></span><span>             </span><span id="local-6989586621680920280"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920280"><span class="hs-identifier hs-var">tstate'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LocationTypeState -&gt; (LocVar, Modality) -&gt; TcM LocationTypeState)
-&gt; LocationTypeState
-&gt; [(LocVar, Modality)]
-&gt; TcM LocationTypeState
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; (LocVar, Modality) -&gt; TcM LocationTypeState
</span><a href="#local-6989586621680920274"><span class="hs-identifier hs-var">handleTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920251"><span class="hs-identifier hs-var">tstate</span></a></span><span> </span><span class="annot"><span class="annottext">([(LocVar, Modality)] -&gt; TcM LocationTypeState)
-&gt; [(LocVar, Modality)] -&gt; TcM LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[LocVar] -&gt; [Modality] -&gt; [(LocVar, Modality)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920237"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">([Modality] -&gt; [(LocVar, Modality)])
-&gt; [Modality] -&gt; [(LocVar, Modality)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; Modality) -&gt; [LRM] -&gt; [Modality]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920283"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680920283"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680920283"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920240"><span class="hs-identifier hs-var">locVars</span></a></span><span>
</span><span id="line-179"></span><span>             </span><span class="hs-comment">-- Use locVars used at call-site in the returned type</span><span>
</span><span id="line-180"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920284"><span class="annot"><span class="annottext">arrOutMp :: Map LocVar LocVar
</span><a href="#local-6989586621680920284"><span class="hs-identifier hs-var hs-var">arrOutMp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(LocVar, LocVar)] -&gt; Map LocVar LocVar
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(LocVar, LocVar)] -&gt; Map LocVar LocVar)
-&gt; [(LocVar, LocVar)] -&gt; Map LocVar LocVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[LocVar] -&gt; [LocVar] -&gt; [(LocVar, LocVar)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LRM -&gt; LocVar) -&gt; [LRM] -&gt; [LocVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span id="local-6989586621680920286"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920286"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Modality
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920286"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920240"><span class="hs-identifier hs-var">locVars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920237"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-181"></span><span>                 </span><span id="local-6989586621680920287"><span class="annot"><span class="annottext">arrOut' :: UrTy LocVar
</span><a href="#local-6989586621680920287"><span class="hs-identifier hs-var hs-var">arrOut'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map LocVar LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
</span><a href="Gibbon.L2.Syntax.html#substLoc"><span class="hs-identifier hs-var">substLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar LocVar
</span><a href="#local-6989586621680920284"><span class="hs-identifier hs-var">arrOutMp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920243"><span class="hs-identifier hs-var">arrOut</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>             </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920287"><span class="hs-identifier hs-var">arrOut'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920280"><span class="hs-identifier hs-var">tstate'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680920290"><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="#local-6989586621680920290"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span id="local-6989586621680920291"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>               </span><span class="hs-comment">-- Special case because we can't lookup the type of the function pointer</span><span>
</span><span id="line-187"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920292"><span class="annot"><span class="annottext">es' :: [Exp]
</span><a href="#local-6989586621680920292"><span class="hs-identifier hs-var hs-var">es'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="#local-6989586621680920290"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-188"></span><span>                           </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VSortP"><span class="hs-identifier hs-type">VSortP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; [Exp]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-189"></span><span>                           </span><span class="annot"><a href="Gibbon.Language.Syntax.html#InplaceVSortP"><span class="hs-identifier hs-type">InplaceVSortP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; [Exp]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-190"></span><span>                           </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-191"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920296"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920297"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; [Exp]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExps"><span class="hs-identifier hs-var">tcExps</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920292"><span class="hs-identifier hs-var">es'</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>               </span><span class="hs-comment">-- Pattern matches would be one way to check length safely, but then the</span><span>
</span><span id="line-194"></span><span>               </span><span class="hs-comment">-- error would not go through our monad:</span><span>
</span><span id="line-195"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920299"><span class="annot"><span class="annottext">len2 :: ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var hs-var">len2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; Prim (UrTy LocVar)
-&gt; Int
-&gt; [Exp]
-&gt; ExceptT TCError Identity ()
forall op arg.
(Show op, Show arg) =&gt;
Exp -&gt; op -&gt; Int -&gt; [arg] -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#checkLen"><span class="hs-identifier hs-var">checkLen</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="#local-6989586621680920290"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-196"></span><span>                   </span><span id="local-6989586621680920301"><span class="annot"><span class="annottext">len1 :: ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var hs-var">len1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; Prim (UrTy LocVar)
-&gt; Int
-&gt; [Exp]
-&gt; ExceptT TCError Identity ()
forall op arg.
(Show op, Show arg) =&gt;
Exp -&gt; op -&gt; Int -&gt; [arg] -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#checkLen"><span class="hs-identifier hs-var">checkLen</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="#local-6989586621680920290"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-197"></span><span>                   </span><span id="local-6989586621680920302"><span class="annot"><span class="annottext">len0 :: ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var hs-var">len0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; Prim (UrTy LocVar)
-&gt; Int
-&gt; [Exp]
-&gt; ExceptT TCError Identity ()
forall op arg.
(Show op, Show arg) =&gt;
Exp -&gt; op -&gt; Int -&gt; [arg] -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#checkLen"><span class="hs-identifier hs-var">checkLen</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="#local-6989586621680920290"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-198"></span><span>                   </span><span id="local-6989586621680920303"><span class="annot"><span class="annottext">len3 :: ExceptT TCError Identity ()
</span><a href="#local-6989586621680920303"><span class="hs-identifier hs-var hs-var">len3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; Prim (UrTy LocVar)
-&gt; Int
-&gt; [Exp]
-&gt; ExceptT TCError Identity ()
forall op arg.
(Show op, Show arg) =&gt;
Exp -&gt; op -&gt; Int -&gt; [arg] -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#checkLen"><span class="hs-identifier hs-var">checkLen</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="#local-6989586621680920290"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-199"></span><span>                   </span><span id="local-6989586621680920304"><span class="annot"><span class="annottext">len4 :: ExceptT TCError Identity ()
</span><a href="#local-6989586621680920304"><span class="hs-identifier hs-var hs-var">len4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; Prim (UrTy LocVar)
-&gt; Int
-&gt; [Exp]
-&gt; ExceptT TCError Identity ()
forall op arg.
(Show op, Show arg) =&gt;
Exp -&gt; op -&gt; Int -&gt; [arg] -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#checkLen"><span class="hs-identifier hs-var">checkLen</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="#local-6989586621680920290"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>                   </span><span id="local-6989586621680920305"><span class="annot"><span class="annottext">mk_bools :: TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920305"><span class="hs-identifier hs-var hs-var">mk_bools</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>                     </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-203"></span><span>                     </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>                   </span><span id="local-6989586621680920307"><span class="annot"><span class="annottext">bool_ops :: TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920307"><span class="hs-identifier hs-var hs-var">bool_ops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>                     </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-207"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>                     </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>                   </span><span id="local-6989586621680920310"><span class="annot"><span class="annottext">int_ops :: TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920310"><span class="hs-identifier hs-var hs-var">int_ops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>                     </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-213"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>                     </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>                   </span><span id="local-6989586621680920311"><span class="annot"><span class="annottext">float_ops :: TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920311"><span class="hs-identifier hs-var hs-var">float_ops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-218"></span><span>                     </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-219"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>                     </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>                   </span><span id="local-6989586621680920312"><span class="annot"><span class="annottext">int_cmps :: TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920312"><span class="hs-identifier hs-var hs-var">int_cmps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>                     </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-225"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>                     </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>                   </span><span id="local-6989586621680920313"><span class="annot"><span class="annottext">float_cmps :: TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920313"><span class="hs-identifier hs-var hs-var">float_cmps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>                     </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-231"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>                     </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>                   </span><span id="local-6989586621680920314"><span class="annot"><span class="annottext">char_cmps :: TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920314"><span class="hs-identifier hs-var hs-var">char_cmps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>                     </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-237"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CharTy"><span class="hs-identifier hs-var">CharTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CharTy"><span class="hs-identifier hs-var">CharTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>                     </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="#local-6989586621680920290"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-242"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#MkTrue"><span class="hs-identifier hs-var">MkTrue</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920305"><span class="hs-identifier hs-var">mk_bools</span></a></span><span>
</span><span id="line-243"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#MkFalse"><span class="hs-identifier hs-var">MkFalse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920305"><span class="hs-identifier hs-var">mk_bools</span></a></span><span>
</span><span id="line-244"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#AddP"><span class="hs-identifier hs-var">AddP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920310"><span class="hs-identifier hs-var">int_ops</span></a></span><span>
</span><span id="line-245"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SubP"><span class="hs-identifier hs-var">SubP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920310"><span class="hs-identifier hs-var">int_ops</span></a></span><span>
</span><span id="line-246"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#MulP"><span class="hs-identifier hs-var">MulP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920310"><span class="hs-identifier hs-var">int_ops</span></a></span><span>
</span><span id="line-247"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#DivP"><span class="hs-identifier hs-var">DivP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920310"><span class="hs-identifier hs-var">int_ops</span></a></span><span>
</span><span id="line-248"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#ModP"><span class="hs-identifier hs-var">ModP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920310"><span class="hs-identifier hs-var">int_ops</span></a></span><span>
</span><span id="line-249"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#ExpP"><span class="hs-identifier hs-var">ExpP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920310"><span class="hs-identifier hs-var">int_ops</span></a></span><span>
</span><span id="line-250"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FAddP"><span class="hs-identifier hs-var">FAddP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920311"><span class="hs-identifier hs-var">float_ops</span></a></span><span>
</span><span id="line-251"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FSubP"><span class="hs-identifier hs-var">FSubP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920311"><span class="hs-identifier hs-var">float_ops</span></a></span><span>
</span><span id="line-252"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FMulP"><span class="hs-identifier hs-var">FMulP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920311"><span class="hs-identifier hs-var">float_ops</span></a></span><span>
</span><span id="line-253"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FDivP"><span class="hs-identifier hs-var">FDivP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920311"><span class="hs-identifier hs-var">float_ops</span></a></span><span>
</span><span id="line-254"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FExpP"><span class="hs-identifier hs-var">FExpP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920311"><span class="hs-identifier hs-var">float_ops</span></a></span><span>
</span><span id="line-255"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#EqIntP"><span class="hs-identifier hs-var">EqIntP</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920312"><span class="hs-identifier hs-var">int_cmps</span></a></span><span>
</span><span id="line-256"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#LtP"><span class="hs-identifier hs-var">LtP</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920312"><span class="hs-identifier hs-var">int_cmps</span></a></span><span>
</span><span id="line-257"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#GtP"><span class="hs-identifier hs-var">GtP</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920312"><span class="hs-identifier hs-var">int_cmps</span></a></span><span>
</span><span id="line-258"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#LtEqP"><span class="hs-identifier hs-var">LtEqP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920312"><span class="hs-identifier hs-var">int_cmps</span></a></span><span>
</span><span id="line-259"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#GtEqP"><span class="hs-identifier hs-var">GtEqP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920312"><span class="hs-identifier hs-var">int_cmps</span></a></span><span>
</span><span id="line-260"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#EqFloatP"><span class="hs-identifier hs-var">EqFloatP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920313"><span class="hs-identifier hs-var">float_cmps</span></a></span><span>
</span><span id="line-261"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#EqCharP"><span class="hs-identifier hs-var">EqCharP</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920314"><span class="hs-identifier hs-var">char_cmps</span></a></span><span>
</span><span id="line-262"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FLtP"><span class="hs-identifier hs-var">FLtP</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920313"><span class="hs-identifier hs-var">float_cmps</span></a></span><span>
</span><span id="line-263"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FGtP"><span class="hs-identifier hs-var">FGtP</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920313"><span class="hs-identifier hs-var">float_cmps</span></a></span><span>
</span><span id="line-264"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FLtEqP"><span class="hs-identifier hs-var">FLtEqP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920313"><span class="hs-identifier hs-var">float_cmps</span></a></span><span>
</span><span id="line-265"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FGtEqP"><span class="hs-identifier hs-var">FGtEqP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920313"><span class="hs-identifier hs-var">float_cmps</span></a></span><span>
</span><span id="line-266"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#OrP"><span class="hs-identifier hs-var">OrP</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920307"><span class="hs-identifier hs-var">bool_ops</span></a></span><span>
</span><span id="line-267"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#AndP"><span class="hs-identifier hs-var">AndP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920307"><span class="hs-identifier hs-var">bool_ops</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#RandP"><span class="hs-identifier hs-var">RandP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FRandP"><span class="hs-identifier hs-var">FRandP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FloatToIntP"><span class="hs-identifier hs-var">FloatToIntP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-273"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-274"></span><span>                   </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#IntToFloatP"><span class="hs-identifier hs-var">IntToFloatP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-279"></span><span>                   </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FSqrtP"><span class="hs-identifier hs-var">FSqrtP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-284"></span><span>                   </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#FTanP"><span class="hs-identifier hs-var">FTanP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-289"></span><span>                   </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#Gensym"><span class="hs-identifier hs-var">Gensym</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
-&gt; (() -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b.
ExceptT TCError Identity a
-&gt; (a -&gt; ExceptT TCError Identity b) -&gt; ExceptT TCError Identity b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#EqSymP"><span class="hs-identifier hs-var">EqSymP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-296"></span><span>                   </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                   </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#EqBenchProgP"><span class="hs-identifier hs-type">EqBenchProgP</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-302"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictEmptyP"><span class="hs-identifier hs-type">DictEmptyP</span></a></span><span> </span><span id="local-6989586621680920351"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920351"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-305"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-306"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920352"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920352"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-307"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920352"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-308"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-309"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680920354"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920354"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-310"></span><span>                         </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; Env2 (UrTy LocVar)
-&gt; Maybe LocVar
-&gt; ExceptT TCError Identity ()
forall (m :: * -&gt; *) a.
MonadError TCError m =&gt;
Exp -&gt; Env2 a -&gt; Maybe LocVar -&gt; m ()
</span><a href="Gibbon.L2.Typecheck.html#ensureArenaScope"><span class="hs-identifier hs-var">ensureArenaScope</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Maybe LocVar
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920354"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>                            </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe LocVar -&gt; UrTy () -&gt; UrTy LocVar
forall loc. Maybe LocVar -&gt; UrTy () -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-var">SymDictTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Maybe LocVar
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920354"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy ()
forall a. UrTy a -&gt; UrTy ()
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920351"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>                     </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected arena variable argument&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictInsertP"><span class="hs-identifier hs-type">DictInsertP</span></a></span><span> </span><span id="local-6989586621680920359"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920359"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920304"><span class="hs-identifier hs-var">len4</span></a></span><span>
</span><span id="line-316"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920360"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920360"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920361"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920361"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920362"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920362"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920363"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920363"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-317"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920360"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-318"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920362"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-319"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyNoLoc"><span class="hs-identifier hs-var">ensureEqualTyNoLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920359"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920363"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-320"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920361"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-321"></span><span>                     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span id="local-6989586621680920364"><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680920364"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span id="local-6989586621680920365"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680920365"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>                         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-323"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680920366"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920366"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-324"></span><span>                               </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; Env2 (UrTy LocVar)
-&gt; Maybe LocVar
-&gt; ExceptT TCError Identity ()
forall (m :: * -&gt; *) a.
MonadError TCError m =&gt;
Exp -&gt; Env2 a -&gt; Maybe LocVar -&gt; m ()
</span><a href="Gibbon.L2.Typecheck.html#ensureArenaScope"><span class="hs-identifier hs-var">ensureArenaScope</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680920364"><span class="hs-identifier hs-var">ar</span></a></span><span>
</span><span id="line-325"></span><span>                                  </span><span class="annot"><span class="annottext">Exp
-&gt; Env2 (UrTy LocVar)
-&gt; Maybe LocVar
-&gt; ExceptT TCError Identity ()
forall (m :: * -&gt; *) a.
MonadError TCError m =&gt;
Exp -&gt; Env2 a -&gt; Maybe LocVar -&gt; m ()
</span><a href="Gibbon.L2.Typecheck.html#ensureArenaScope"><span class="hs-identifier hs-var">ensureArenaScope</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Maybe LocVar
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920366"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>                                  </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe LocVar -&gt; UrTy () -&gt; UrTy LocVar
forall loc. Maybe LocVar -&gt; UrTy () -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-var">SymDictTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Maybe LocVar
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920366"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy ()
forall a. UrTy a -&gt; UrTy ()
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920359"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>                           </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected arena variable argument&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-328"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected SymDictTy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictLookupP"><span class="hs-identifier hs-type">DictLookupP</span></a></span><span> </span><span id="local-6989586621680920368"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920368"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-332"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920369"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920369"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920370"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920370"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-333"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920369"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-334"></span><span>                     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span id="local-6989586621680920371"><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680920371"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span id="local-6989586621680920372"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680920372"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>                         </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920370"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-336"></span><span>                            </span><span class="annot"><span class="annottext">Exp
-&gt; Env2 (UrTy LocVar)
-&gt; Maybe LocVar
-&gt; ExceptT TCError Identity ()
forall (m :: * -&gt; *) a.
MonadError TCError m =&gt;
Exp -&gt; Env2 a -&gt; Maybe LocVar -&gt; m ()
</span><a href="Gibbon.L2.Typecheck.html#ensureArenaScope"><span class="hs-identifier hs-var">ensureArenaScope</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680920371"><span class="hs-identifier hs-var">ar</span></a></span><span>
</span><span id="line-337"></span><span>                            </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920368"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected SymDictTy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictHasKeyP"><span class="hs-identifier hs-type">DictHasKeyP</span></a></span><span> </span><span id="local-6989586621680920374"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920374"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-342"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920375"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920375"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920376"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920376"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-343"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920375"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-344"></span><span>                     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span id="local-6989586621680920377"><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680920377"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span id="local-6989586621680920378"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680920378"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920376"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-345"></span><span>                                            </span><span class="annot"><span class="annottext">Exp
-&gt; Env2 (UrTy LocVar)
-&gt; Maybe LocVar
-&gt; ExceptT TCError Identity ()
forall (m :: * -&gt; *) a.
MonadError TCError m =&gt;
Exp -&gt; Env2 a -&gt; Maybe LocVar -&gt; m ()
</span><a href="Gibbon.L2.Typecheck.html#ensureArenaScope"><span class="hs-identifier hs-var">ensureArenaScope</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680920377"><span class="hs-identifier hs-var">ar</span></a></span><span>
</span><span id="line-346"></span><span>                                            </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected SymDictTy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SizeParam"><span class="hs-identifier hs-var">SizeParam</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-350"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-351"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#IsBig"><span class="hs-identifier hs-var">IsBig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-354"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-355"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920381"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920381"><span class="hs-identifier hs-var">ity</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920382"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920382"><span class="hs-identifier hs-var">ety</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-356"></span><span>                   </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920381"><span class="hs-identifier hs-var">ity</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span>
</span><span id="line-357"></span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920382"><span class="hs-identifier hs-var">ety</span></a></span><span>
</span><span id="line-358"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;L1.Typecheck: IsBig expects a Packed value.&quot;</span></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ErrorP"><span class="hs-identifier hs-type">ErrorP</span></a></span><span> </span><span id="local-6989586621680920385"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920385"><span class="hs-identifier hs-var">_str</span></a></span></span><span> </span><span id="local-6989586621680920386"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920386"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-363"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920386"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ReadPackedFile"><span class="hs-identifier hs-type">ReadPackedFile</span></a></span><span> </span><span id="local-6989586621680920388"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621680920388"><span class="hs-identifier hs-var">_fp</span></a></span></span><span> </span><span id="local-6989586621680920389"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920389"><span class="hs-identifier hs-var">_tycon</span></a></span></span><span> </span><span id="local-6989586621680920390"><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680920390"><span class="hs-identifier hs-var">_reg</span></a></span></span><span> </span><span id="local-6989586621680920391"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920391"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-367"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920391"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WritePackedFile"><span class="hs-identifier hs-type">WritePackedFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920393"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920393"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-370"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920393"><span class="hs-identifier hs-var">ty</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>                     </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-372"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920395"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920395"><span class="hs-identifier hs-var">packed_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-373"></span><span>                     </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920395"><span class="hs-identifier hs-var">packed_ty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920393"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-374"></span><span>                     </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; String -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;writePackedFile expects a packed type. Given&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920393"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ReadArrayFile"><span class="hs-identifier hs-type">ReadArrayFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (String, Int)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920398"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920398"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-378"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-379"></span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isValidListElemTy"><span class="hs-identifier hs-var">isValidListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920398"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-380"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920398"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not a valid list type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#RequestSizeOf"><span class="hs-identifier hs-var">RequestSizeOf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-385"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-386"></span><span>                     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>                               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-389"></span><span>                                      </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>                                      </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>                                      </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected PackedTy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-392"></span><span>                     </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected a variable argument&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VAllocP"><span class="hs-identifier hs-type">VAllocP</span></a></span><span> </span><span id="local-6989586621680920403"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920403"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-396"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920403"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-397"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920405"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920405"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-398"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920405"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-399"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920403"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VFreeP"><span class="hs-identifier hs-type">VFreeP</span></a></span><span> </span><span id="local-6989586621680920407"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920407"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-402"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-403"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920407"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-404"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920408"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920408"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-405"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920407"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920408"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-406"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VFree2P"><span class="hs-identifier hs-type">VFree2P</span></a></span><span> </span><span id="local-6989586621680920410"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920410"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-410"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920410"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-411"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920411"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920411"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-412"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920410"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920411"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-413"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VLengthP"><span class="hs-identifier hs-type">VLengthP</span></a></span><span> </span><span id="local-6989586621680920413"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920413"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-416"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920414"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920414"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-417"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920413"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920414"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-418"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VNthP"><span class="hs-identifier hs-type">VNthP</span></a></span><span> </span><span id="local-6989586621680920416"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920416"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-421"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920417"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920417"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920418"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920418"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-422"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920416"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920417"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-423"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920418"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-424"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920416"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VSliceP"><span class="hs-identifier hs-type">VSliceP</span></a></span><span> </span><span id="local-6989586621680920420"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920420"><span class="hs-identifier hs-var">elty</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920421"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920421"><span class="hs-identifier hs-var">from</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920422"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920422"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920423"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920423"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-428"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920421"><span class="hs-identifier hs-var">from</span></a></span><span>
</span><span id="line-429"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920422"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-430"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920420"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920423"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-431"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920420"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#InplaceVUpdateP"><span class="hs-identifier hs-type">InplaceVUpdateP</span></a></span><span> </span><span id="local-6989586621680920425"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920425"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920426"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920426"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920427"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920427"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920428"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920428"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-435"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920425"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920426"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-436"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920427"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-437"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920425"><span class="hs-identifier hs-var">elty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920428"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-438"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920425"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VConcatP"><span class="hs-identifier hs-type">VConcatP</span></a></span><span> </span><span id="local-6989586621680920430"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920430"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-441"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-442"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920431"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920431"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-443"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920430"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920431"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-444"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920430"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>                 </span><span class="hs-comment">-- Given that the first argument is a list of type (VectorTy t),</span><span>
</span><span id="line-448"></span><span>                 </span><span class="hs-comment">-- ensure that the 2nd argument is function reference of type:</span><span>
</span><span id="line-449"></span><span>                 </span><span class="hs-comment">-- ty -&gt; ty -&gt; Bool</span><span>
</span><span id="line-450"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VSortP"><span class="hs-identifier hs-type">VSortP</span></a></span><span> </span><span id="local-6989586621680920432"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920432"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-452"></span><span>                     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680920433"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920433"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-453"></span><span>                       </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-454"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920434"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920434"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-455"></span><span>                           </span><span id="local-6989586621680920435"><span class="annot"><span class="annottext">fn_ty :: ArrowTy (UrTy LocVar)
</span><a href="#local-6989586621680920435"><span class="hs-identifier hs-var hs-var">fn_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Env2 (UrTy LocVar) -&gt; ArrowTy (UrTy LocVar)
forall a. Out (ArrowTy a) =&gt; LocVar -&gt; Env2 a -&gt; ArrowTy a
</span><a href="Gibbon.Language.Syntax.html#lookupFEnv"><span class="hs-identifier hs-var">lookupFEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920433"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-456"></span><span>                           </span><span id="local-6989586621680920437"><span class="annot"><span class="annottext">in_tys :: [UrTy LocVar]
</span><a href="#local-6989586621680920437"><span class="hs-identifier hs-var hs-var">in_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy (UrTy LocVar) -&gt; [UrTy LocVar]
forall ty. FunctionTy ty =&gt; ArrowTy ty -&gt; [ty]
</span><a href="Gibbon.Language.Syntax.html#inTys"><span class="hs-identifier hs-var">inTys</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (UrTy LocVar)
</span><a href="#local-6989586621680920435"><span class="hs-identifier hs-var">fn_ty</span></a></span><span>
</span><span id="line-457"></span><span>                           </span><span id="local-6989586621680920439"><span class="annot"><span class="annottext">ret_ty :: UrTy LocVar
</span><a href="#local-6989586621680920439"><span class="hs-identifier hs-var hs-var">ret_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy (UrTy LocVar) -&gt; UrTy LocVar
forall ty. FunctionTy ty =&gt; ArrowTy ty -&gt; ty
</span><a href="Gibbon.Language.Syntax.html#outTy"><span class="hs-identifier hs-var">outTy</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (UrTy LocVar)
</span><a href="#local-6989586621680920435"><span class="hs-identifier hs-var">fn_ty</span></a></span><span>
</span><span id="line-458"></span><span>                           </span><span id="local-6989586621680920441"><span class="annot"><span class="annottext">err :: ArrowTy2 (UrTy LocVar) -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920441"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span id="local-6989586621680920442"><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920442"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;vsort: Expected a sort function of type (ty -&gt; ty -&gt; Bool). Got&quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar) -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920442"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-459"></span><span>                       </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920432"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920434"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-460"></span><span>                       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920437"><span class="hs-identifier hs-var">in_tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-461"></span><span>                         </span><span class="hs-special">[</span><span id="local-6989586621680920443"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920443"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920444"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920444"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-462"></span><span>                            </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920443"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920432"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-463"></span><span>                            </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920444"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920432"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-464"></span><span>                            </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920439"><span class="hs-identifier hs-var">ret_ty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span>
</span><span id="line-465"></span><span>                            </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920432"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                         </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar) -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920441"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (UrTy LocVar)
ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920435"><span class="hs-identifier hs-var">fn_ty</span></a></span><span>
</span><span id="line-467"></span><span>                     </span><span id="local-6989586621680920445"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920445"><span class="hs-identifier hs-var">oth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;vsort: function pointer has to be a variable reference. Got&quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920445"><span class="hs-identifier hs-var">oth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#InplaceVSortP"><span class="hs-identifier hs-type">InplaceVSortP</span></a></span><span> </span><span id="local-6989586621680920446"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920446"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prim (UrTy LocVar) -&gt; [Exp] -&gt; Exp
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; Prim (UrTy LocVar)
forall ty. ty -&gt; Prim ty
</span><a href="Gibbon.Language.Syntax.html#VSortP"><span class="hs-identifier hs-var">VSortP</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920446"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VMergeP"><span class="hs-identifier hs-type">VMergeP</span></a></span><span> </span><span id="local-6989586621680920448"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920448"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-472"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-473"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920448"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-474"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920449"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920449"><span class="hs-identifier hs-var">ls1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920450"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920450"><span class="hs-identifier hs-var">ls2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-475"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920448"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920449"><span class="hs-identifier hs-var">ls1</span></a></span><span>
</span><span id="line-476"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920448"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920450"><span class="hs-identifier hs-var">ls2</span></a></span><span>
</span><span id="line-477"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920448"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictInsertP"><span class="hs-identifier hs-type">PDictInsertP</span></a></span><span> </span><span id="local-6989586621680920452"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920452"><span class="hs-identifier hs-var">kty</span></a></span></span><span> </span><span id="local-6989586621680920453"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920453"><span class="hs-identifier hs-var">vty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920303"><span class="hs-identifier hs-var">len3</span></a></span><span>
</span><span id="line-481"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920452"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-482"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920453"><span class="hs-identifier hs-var">vty</span></a></span><span>
</span><span id="line-483"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920454"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920454"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920455"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920455"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920456"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920456"><span class="hs-identifier hs-var">dict</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-484"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920454"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920452"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-485"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920455"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920453"><span class="hs-identifier hs-var">vty</span></a></span><span>
</span><span id="line-486"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920456"><span class="hs-identifier hs-var">dict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920452"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920453"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920452"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920453"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictLookupP"><span class="hs-identifier hs-type">PDictLookupP</span></a></span><span> </span><span id="local-6989586621680920459"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920459"><span class="hs-identifier hs-var">kty</span></a></span></span><span> </span><span id="local-6989586621680920460"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920460"><span class="hs-identifier hs-var">vty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-490"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-491"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920459"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-492"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920460"><span class="hs-identifier hs-var">vty</span></a></span><span>
</span><span id="line-493"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920461"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920461"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920462"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920462"><span class="hs-identifier hs-var">dict</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-494"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920461"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920459"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-495"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920462"><span class="hs-identifier hs-var">dict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920459"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920460"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920460"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictAllocP"><span class="hs-identifier hs-type">PDictAllocP</span></a></span><span> </span><span id="local-6989586621680920464"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920464"><span class="hs-identifier hs-var">kty</span></a></span></span><span> </span><span id="local-6989586621680920465"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920465"><span class="hs-identifier hs-var">vty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-500"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920464"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-501"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920465"><span class="hs-identifier hs-var">vty</span></a></span><span>
</span><span id="line-502"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920464"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920465"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictHasKeyP"><span class="hs-identifier hs-type">PDictHasKeyP</span></a></span><span> </span><span id="local-6989586621680920467"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920467"><span class="hs-identifier hs-var">kty</span></a></span></span><span> </span><span id="local-6989586621680920468"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920468"><span class="hs-identifier hs-var">vty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-505"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-506"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920467"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-507"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920468"><span class="hs-identifier hs-var">vty</span></a></span><span>
</span><span id="line-508"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920469"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920469"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920470"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920470"><span class="hs-identifier hs-var">dict</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-509"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920469"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920467"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-510"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920470"><span class="hs-identifier hs-var">dict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920467"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920468"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictForkP"><span class="hs-identifier hs-type">PDictForkP</span></a></span><span> </span><span id="local-6989586621680920472"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920472"><span class="hs-identifier hs-var">kty</span></a></span></span><span> </span><span id="local-6989586621680920473"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920473"><span class="hs-identifier hs-var">vty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-515"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920472"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-516"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920473"><span class="hs-identifier hs-var">vty</span></a></span><span>
</span><span id="line-517"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920474"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920474"><span class="hs-identifier hs-var">dict</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-518"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920474"><span class="hs-identifier hs-var">dict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920472"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920473"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920472"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920473"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920472"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920473"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictJoinP"><span class="hs-identifier hs-type">PDictJoinP</span></a></span><span> </span><span id="local-6989586621680920476"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920476"><span class="hs-identifier hs-var">kty</span></a></span></span><span> </span><span id="local-6989586621680920477"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920477"><span class="hs-identifier hs-var">vty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-522"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-523"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920476"><span class="hs-identifier hs-var">kty</span></a></span><span>
</span><span id="line-524"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920477"><span class="hs-identifier hs-var">vty</span></a></span><span>
</span><span id="line-525"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920478"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920478"><span class="hs-identifier hs-var">dict1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920479"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920479"><span class="hs-identifier hs-var">dict2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-526"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920478"><span class="hs-identifier hs-var">dict1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920476"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920477"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920479"><span class="hs-identifier hs-var">dict2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920476"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920477"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920476"><span class="hs-identifier hs-var">kty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920477"><span class="hs-identifier hs-var">vty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLAllocP"><span class="hs-identifier hs-type">LLAllocP</span></a></span><span> </span><span id="local-6989586621680920481"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920481"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-531"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-532"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920481"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-533"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920481"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLIsEmptyP"><span class="hs-identifier hs-type">LLIsEmptyP</span></a></span><span> </span><span id="local-6989586621680920484"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920484"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-536"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-537"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920484"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-538"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920485"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920485"><span class="hs-identifier hs-var">ll</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-539"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920485"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920484"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLConsP"><span class="hs-identifier hs-type">LLConsP</span></a></span><span> </span><span id="local-6989586621680920487"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920487"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-544"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920487"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-545"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920488"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920488"><span class="hs-identifier hs-var">elt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920489"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920489"><span class="hs-identifier hs-var">ll</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-546"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920488"><span class="hs-identifier hs-var">elt</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920487"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-547"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920489"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920487"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920487"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLHeadP"><span class="hs-identifier hs-type">LLHeadP</span></a></span><span> </span><span id="local-6989586621680920491"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920491"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-551"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-552"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920491"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-553"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920492"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920492"><span class="hs-identifier hs-var">ll</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-554"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920492"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920491"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920491"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLTailP"><span class="hs-identifier hs-type">LLTailP</span></a></span><span> </span><span id="local-6989586621680920494"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920494"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-558"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-559"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920494"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-560"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920495"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920495"><span class="hs-identifier hs-var">ll</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-561"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920495"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920494"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920494"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLFreeP"><span class="hs-identifier hs-type">LLFreeP</span></a></span><span> </span><span id="local-6989586621680920497"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920497"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-565"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-566"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920497"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-567"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920498"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920498"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-568"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920497"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920498"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-569"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLFree2P"><span class="hs-identifier hs-type">LLFree2P</span></a></span><span> </span><span id="local-6989586621680920500"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920500"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-573"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920500"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-574"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920501"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920501"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-575"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920500"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920501"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-576"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLCopyP"><span class="hs-identifier hs-type">LLCopyP</span></a></span><span> </span><span id="local-6989586621680920503"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920503"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-579"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-580"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var">checkListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920503"><span class="hs-identifier hs-var">elty</span></a></span><span>
</span><span id="line-581"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680920504"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920504"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-582"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920503"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920504"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-583"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920503"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#GetNumProcessors"><span class="hs-identifier hs-var">GetNumProcessors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-586"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-587"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#PrintInt"><span class="hs-identifier hs-var">PrintInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-591"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#PrintChar"><span class="hs-identifier hs-var">PrintChar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-595"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-596"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CharTy"><span class="hs-identifier hs-var">CharTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#PrintFloat"><span class="hs-identifier hs-var">PrintFloat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-600"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-601"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#PrintBool"><span class="hs-identifier hs-var">PrintBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-605"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-606"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#PrintSym"><span class="hs-identifier hs-var">PrintSym</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-610"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var">len1</span></a></span><span>
</span><span id="line-611"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#ReadInt"><span class="hs-identifier hs-var">ReadInt</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ReadInt not handled&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SymSetEmpty"><span class="hs-identifier hs-var">SymSetEmpty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-617"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-618"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymSetTy"><span class="hs-identifier hs-var">SymSetTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SymSetInsert"><span class="hs-identifier hs-var">SymSetInsert</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-622"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymSetTy"><span class="hs-identifier hs-var">SymSetTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymSetTy"><span class="hs-identifier hs-var">SymSetTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SymSetContains"><span class="hs-identifier hs-var">SymSetContains</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-627"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-628"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymSetTy"><span class="hs-identifier hs-var">SymSetTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SymHashEmpty"><span class="hs-identifier hs-var">SymHashEmpty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-634"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">SymHashTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SymHashInsert"><span class="hs-identifier hs-var">SymHashInsert</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-637"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920303"><span class="hs-identifier hs-var">len3</span></a></span><span>
</span><span id="line-638"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">SymHashTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">SymHashTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SymHashLookup"><span class="hs-identifier hs-var">SymHashLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-645"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">SymHashTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#SymHashContains"><span class="hs-identifier hs-var">SymHashContains</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-650"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-651"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">SymHashTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#IntHashEmpty"><span class="hs-identifier hs-var">IntHashEmpty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-656"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920302"><span class="hs-identifier hs-var">len0</span></a></span><span>
</span><span id="line-657"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntHashTy"><span class="hs-identifier hs-var">IntHashTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#IntHashInsert"><span class="hs-identifier hs-var">IntHashInsert</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-660"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920303"><span class="hs-identifier hs-var">len3</span></a></span><span>
</span><span id="line-661"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntHashTy"><span class="hs-identifier hs-var">IntHashTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntHashTy"><span class="hs-identifier hs-var">IntHashTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span>                 </span><span class="annot"><span class="annottext">Prim (UrTy LocVar)
</span><a href="Gibbon.Language.Syntax.html#IntHashLookup"><span class="hs-identifier hs-var">IntHashLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-667"></span><span>                   </span><span class="annot"><span class="annottext">ExceptT TCError Identity ()
</span><a href="#local-6989586621680920299"><span class="hs-identifier hs-var">len2</span></a></span><span>
</span><span id="line-668"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntHashTy"><span class="hs-identifier hs-var">IntHashTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>                   </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920291"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int -&gt; Exp
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920296"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. (Out a, HasCallStack) =&gt; [a] -&gt; Int -&gt; a
</span><a href="Gibbon.Common.html#%21%21%21"><span class="hs-operator hs-var">!!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>                   </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Write3dPpmFile"><span class="hs-identifier hs-type">Write3dPpmFile</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Write3dPpmFile not handled yet&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#RequestEndOf"><span class="hs-identifier hs-type">RequestEndOf</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExp of PrimAppE: RequestEndOf not handled yet&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920529"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920529"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920530"><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920530"><span class="hs-identifier hs-var">_ls</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920531"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920531"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920532"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920532"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680920533"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920533"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>               </span><span class="hs-comment">-- We get the type and new location state from e1</span><span>
</span><span id="line-680"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920534"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920534"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920535"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920535"><span class="hs-identifier hs-var">tstate1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920532"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-681"></span><span>               </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyNoLoc"><span class="hs-identifier hs-var">ensureEqualTyNoLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920534"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920531"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-682"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920536"><span class="annot"><span class="annottext">env' :: Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920536"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; UrTy LocVar -&gt; Env2 (UrTy LocVar) -&gt; Env2 (UrTy LocVar)
forall a. LocVar -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920529"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920531"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>               </span><span class="hs-comment">-- Then we check e1 with that location state</span><span>
</span><span id="line-685"></span><span>               </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920536"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920535"><span class="hs-identifier hs-var">tstate1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920533"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680920539"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920539"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680920540"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920540"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680920541"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920541"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>               </span><span class="hs-comment">-- Handle condition</span><span>
</span><span id="line-690"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920542"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920542"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920543"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920543"><span class="hs-identifier hs-var">tstate1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920539"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-691"></span><span>               </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyModCursor"><span class="hs-identifier hs-var">ensureEqualTyModCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920542"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>               </span><span class="hs-comment">-- Check both branches</span><span>
</span><span id="line-694"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920545"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920545"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920546"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920546"><span class="hs-identifier hs-var">tstate2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920543"><span class="hs-identifier hs-var">tstate1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920540"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-695"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920547"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920547"><span class="hs-identifier hs-var">ty3</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920548"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920548"><span class="hs-identifier hs-var">tstate3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920543"><span class="hs-identifier hs-var">tstate1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920541"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span>               </span><span class="hs-comment">-- Combine the type states somehow (TODO: audit this)</span><span>
</span><span id="line-698"></span><span>               </span><span id="local-6989586621680920549"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920549"><span class="hs-identifier hs-var">tstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; LocationTypeState -&gt; LocationTypeState -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#combineTStates"><span class="hs-identifier hs-var">combineTStates</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920546"><span class="hs-identifier hs-var">tstate2</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920548"><span class="hs-identifier hs-var">tstate3</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span>               </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyModCursor"><span class="hs-identifier hs-var">ensureEqualTyModCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920545"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920547"><span class="hs-identifier hs-var">ty3</span></a></span><span>
</span><span id="line-701"></span><span>               </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920545"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920549"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680920552"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920552"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-704"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920553"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920553"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920554"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920554"><span class="hs-identifier hs-var">tstate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; [Exp]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExps"><span class="hs-identifier hs-var">tcExps</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920552"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-705"></span><span>               </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920553"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920554"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680920556"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920556"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680920557"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920557"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920558"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920558"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920559"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920559"><span class="hs-identifier hs-var">tstate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920557"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-710"></span><span>               </span><span id="local-6989586621680920560"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920560"><span class="hs-identifier hs-var">tyi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Int -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#tcProj"><span class="hs-identifier hs-var">tcProj</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920556"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920558"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-711"></span><span>               </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920560"><span class="hs-identifier hs-var">tyi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920559"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680920563"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920563"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680920564"><span class="annot"><span class="annottext">[(String, [(LocVar, LocVar)], Exp)]
</span><a href="#local-6989586621680920564"><span class="hs-identifier hs-var">brs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920565"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920565"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920566"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920566"><span class="hs-identifier hs-var">tstate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920563"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-716"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920565"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-717"></span><span>                 </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680920567"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920567"><span class="hs-identifier hs-var">_dc</span></a></span></span><span> </span><span id="local-6989586621680920568"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920568"><span class="hs-identifier hs-var">lin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-718"></span><span>                         </span><span class="hs-comment">-- We need to know the &quot;region&quot; of all the vars (and locations) pattern matched by this case expresssion.</span><span>
</span><span id="line-719"></span><span>                         </span><span class="hs-comment">-- The &quot;region&quot; is the same as that of the case scrutinee.</span><span>
</span><span id="line-720"></span><span>                         </span><span id="local-6989586621680920569"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920569"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; ConstraintSet -&gt; LocVar -&gt; TcM Region
</span><a href="Gibbon.L2.Typecheck.html#getRegion"><span class="hs-identifier hs-var">getRegion</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920563"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920568"><span class="hs-identifier hs-var">lin</span></a></span><span>
</span><span id="line-721"></span><span>                         </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Exp
-&gt; UrTy LocVar
-&gt; [(String, [(LocVar, LocVar)], Exp)]
-&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureMatchCases"><span class="hs-identifier hs-var">ensureMatchCases</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920565"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(LocVar, LocVar)], Exp)]
</span><a href="#local-6989586621680920564"><span class="hs-identifier hs-var">brs</span></a></span><span>
</span><span id="line-722"></span><span>                         </span><span class="hs-special">(</span><span id="local-6989586621680920572"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920572"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920573"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920573"><span class="hs-identifier hs-var">tstate'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; LocVar
-&gt; Region
-&gt; [(String, [(LocVar, LocVar)], Exp)]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcCases"><span class="hs-identifier hs-var">tcCases</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920566"><span class="hs-identifier hs-var">tstate</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920568"><span class="hs-identifier hs-var">lin</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920569"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(LocVar, LocVar)], Exp)]
</span><a href="#local-6989586621680920564"><span class="hs-identifier hs-var">brs</span></a></span><span>
</span><span id="line-723"></span><span>                         </span><span class="annot"><span class="annottext">(UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar))
-&gt; UrTy LocVar -&gt; [UrTy LocVar] -&gt; ExceptT TCError Identity ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html#foldM_"><span class="hs-identifier hs-var">foldM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyModCursor"><span class="hs-identifier hs-var">ensureEqualTyModCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920572"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; [UrTy LocVar]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920572"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>                         </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920572"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920573"><span class="hs-identifier hs-var">tstate'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>                 </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected packed type, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920565"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680920578"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920578"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680920579"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920579"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621680920580"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920580"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-728"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920581"><span class="annot"><span class="annottext">dcty :: String
</span><a href="#local-6989586621680920581"><span class="hs-identifier hs-var hs-var">dcty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar) -&gt; ShowS
forall a. Out a =&gt; DDefs a -&gt; ShowS
</span><a href="Gibbon.Language.Syntax.html#getTyOfDataCon"><span class="hs-identifier hs-var">getTyOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920579"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-729"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920583"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920583"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920584"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920584"><span class="hs-identifier hs-var">tstate1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; [Exp]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExps"><span class="hs-identifier hs-var">tcExps</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920580"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-730"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920585"><span class="annot"><span class="annottext">args :: [UrTy LocVar]
</span><a href="#local-6989586621680920585"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar) -&gt; String -&gt; [UrTy LocVar]
forall a. Out a =&gt; DDefs a -&gt; String -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920579"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920585"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920580"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-733"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid argument length&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-734"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-735"></span><span>                 </span><span class="annot"><span class="annottext">[TcM (UrTy LocVar)] -&gt; ExceptT TCError Identity ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyNoLoc"><span class="hs-identifier hs-var">ensureEqualTyNoLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920588"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920589"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-736"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920588"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920588"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920589"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920589"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; [UrTy LocVar] -&gt; [(UrTy LocVar, UrTy LocVar)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920585"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920583"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-737"></span><span>                 </span><span class="hs-comment">-- -- TODO: need to fix this check</span><span>
</span><span id="line-738"></span><span>                 </span><span class="annot"><span class="annottext">Exp
-&gt; LocVar
-&gt; [UrTy LocVar]
-&gt; ConstraintSet
-&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureDataCon"><span class="hs-identifier hs-var">ensureDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920578"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920583"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-739"></span><span>                 </span><span id="local-6989586621680920591"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920591"><span class="hs-identifier hs-var">tstate2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; LocationTypeState -&gt; LocVar -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#switchOutLoc"><span class="hs-identifier hs-var">switchOutLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920584"><span class="hs-identifier hs-var">tstate1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920578"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-740"></span><span>                 </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; LocVar -&gt; UrTy LocVar
forall loc. String -&gt; loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-var">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920581"><span class="hs-identifier hs-var">dcty</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920578"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920591"><span class="hs-identifier hs-var">tstate2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680920593"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920593"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680920594"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920594"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span id="local-6989586621680920595"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680920595"><span class="hs-identifier hs-var">_b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920596"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920596"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920597"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920597"><span class="hs-identifier hs-var">tstate1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920593"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-745"></span><span>               </span><span class="hs-comment">-- ensureEqualTy exp ty ty1</span><span>
</span><span id="line-746"></span><span>               </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920596"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920597"><span class="hs-identifier hs-var">tstate1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span id="local-6989586621680920599"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920599"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680920600"><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920600"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680920601"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920601"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-749"></span><span>        </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; [LocVar] -&gt; [Exp] -&gt; Exp
forall (ext :: * -&gt; * -&gt; *) loc dec.
LocVar -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920599"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920600"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920601"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span>      </span><span class="annot"><span class="annottext">Exp
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680920604"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920604"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680920605"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920605"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-754"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920606"><span class="annot"><span class="annottext">env' :: Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920606"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; UrTy LocVar -&gt; Env2 (UrTy LocVar) -&gt; Env2 (UrTy LocVar)
forall a. LocVar -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920604"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-755"></span><span>              </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920606"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920605"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span> </span><span class="annot"><span class="annottext">(LocVar, UrTy LocVar, Exp)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#UnsupportedExpTC"><span class="hs-identifier hs-var">UnsupportedExpTC</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span> </span><span class="annot"><span class="annottext">(LocVar, UrTy LocVar, Exp)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(LocVar, UrTy LocVar, Exp)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#UnsupportedExpTC"><span class="hs-identifier hs-var">UnsupportedExpTC</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680920611"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920611"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920612"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920612"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-762"></span><span>               </span><span id="local-6989586621680920613"><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920613"><span class="hs-identifier hs-var">regs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Region -&gt; RegionSet -&gt; TcM RegionSet
</span><a href="Gibbon.L2.Typecheck.html#regionInsert"><span class="hs-identifier hs-var">regionInsert</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920611"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span>
</span><span id="line-763"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920615"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920615"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920616"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920616"><span class="hs-identifier hs-var">tstate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920613"><span class="hs-identifier hs-var">regs'</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920612"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-764"></span><span>               </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920615"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920616"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680920618"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920618"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920619"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920619"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-767"></span><span>               </span><span id="local-6989586621680920620"><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920620"><span class="hs-identifier hs-var">regs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Region -&gt; RegionSet -&gt; TcM RegionSet
</span><a href="Gibbon.L2.Typecheck.html#regionInsert"><span class="hs-identifier hs-var">regionInsert</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920618"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span>
</span><span id="line-768"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621680920621"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920621"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920622"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920622"><span class="hs-identifier hs-var">tstate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920620"><span class="hs-identifier hs-var">regs'</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920619"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-769"></span><span>               </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920621"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920622"><span class="hs-identifier hs-var">tstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680920624"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680920625"><span class="annot"><span class="annottext">PreLocExp LocVar
</span><a href="#local-6989586621680920625"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680920626"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920626"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-772"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920627"><span class="annot"><span class="annottext">env' :: Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920627"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; UrTy LocVar -&gt; Env2 (UrTy LocVar) -&gt; Env2 (UrTy LocVar)
forall a. LocVar -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-773"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp LocVar
</span><a href="#local-6989586621680920625"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-774"></span><span>                </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfRegionLE"><span class="hs-identifier hs-type">StartOfRegionLE</span></a></span><span> </span><span id="local-6989586621680920630"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920630"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-775"></span><span>                    </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Region -&gt; RegionSet -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureRegion"><span class="hs-identifier hs-var">ensureRegion</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920630"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span>
</span><span id="line-776"></span><span>                       </span><span class="annot"><span class="annottext">Exp -&gt; ConstraintSet -&gt; Region -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#absentStart"><span class="hs-identifier hs-var">absentStart</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920630"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-777"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920633"><span class="annot"><span class="annottext">tstate1 :: LocationTypeState
</span><a href="#local-6989586621680920633"><span class="hs-identifier hs-var hs-var">tstate1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar
-&gt; (Modality, Bool) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#extendTS"><span class="hs-identifier hs-var">extendTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span>
</span><span id="line-778"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920635"><span class="annot"><span class="annottext">constrs1 :: ConstraintSet
</span><a href="#local-6989586621680920635"><span class="hs-identifier hs-var hs-var">constrs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#StartOfC"><span class="hs-identifier hs-var">StartOfC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920630"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ConstraintSet -&gt; ConstraintSet) -&gt; ConstraintSet -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920630"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-779"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621680920637"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920637"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920638"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920638"><span class="hs-identifier hs-var">tstate2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920627"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920635"><span class="hs-identifier hs-var">constrs1</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920633"><span class="hs-identifier hs-var">tstate1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920626"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-780"></span><span>                       </span><span id="local-6989586621680920639"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920639"><span class="hs-identifier hs-var">tstate3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; LocationTypeState -&gt; LocVar -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#removeLoc"><span class="hs-identifier hs-var">removeLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920638"><span class="hs-identifier hs-var">tstate2</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-781"></span><span>                       </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920637"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920639"><span class="hs-identifier hs-var">tstate3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>                </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterConstantLE"><span class="hs-identifier hs-type">AfterConstantLE</span></a></span><span> </span><span id="local-6989586621680920642"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920642"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680920643"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920643"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-783"></span><span>                     </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680920644"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920644"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; ConstraintSet -&gt; LocVar -&gt; TcM Region
</span><a href="Gibbon.L2.Typecheck.html#getRegion"><span class="hs-identifier hs-var">getRegion</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920643"><span class="hs-identifier hs-var">l1</span></a></span><span>
</span><span id="line-784"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920645"><span class="annot"><span class="annottext">tstate1 :: LocationTypeState
</span><a href="#local-6989586621680920645"><span class="hs-identifier hs-var hs-var">tstate1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar
-&gt; (Modality, Bool) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#extendTS"><span class="hs-identifier hs-var">extendTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LocationTypeState -&gt; LocationTypeState)
-&gt; LocationTypeState -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#setAfter"><span class="hs-identifier hs-var">setAfter</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920643"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span>
</span><span id="line-785"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920647"><span class="annot"><span class="annottext">constrs1 :: ConstraintSet
</span><a href="#local-6989586621680920647"><span class="hs-identifier hs-var hs-var">constrs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920644"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ConstraintSet -&gt; ConstraintSet) -&gt; ConstraintSet -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; LocVar -&gt; LocVar -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#AfterConstantC"><span class="hs-identifier hs-var">AfterConstantC</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920642"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920643"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-786"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621680920648"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920648"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920649"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920649"><span class="hs-identifier hs-var">tstate2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920627"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920647"><span class="hs-identifier hs-var">constrs1</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920645"><span class="hs-identifier hs-var">tstate1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920626"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-787"></span><span>                        </span><span id="local-6989586621680920650"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920650"><span class="hs-identifier hs-var">tstate3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; LocationTypeState -&gt; LocVar -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#removeLoc"><span class="hs-identifier hs-var">removeLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920649"><span class="hs-identifier hs-var">tstate2</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-788"></span><span>                        </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920648"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920650"><span class="hs-identifier hs-var">tstate3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>                </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterVariableLE"><span class="hs-identifier hs-type">AfterVariableLE</span></a></span><span> </span><span id="local-6989586621680920652"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920652"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680920653"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920653"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-790"></span><span>                    </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680920654"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920654"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; ConstraintSet -&gt; LocVar -&gt; TcM Region
</span><a href="Gibbon.L2.Typecheck.html#getRegion"><span class="hs-identifier hs-var">getRegion</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920653"><span class="hs-identifier hs-var">l1</span></a></span><span>
</span><span id="line-791"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621680920655"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920655"><span class="hs-identifier hs-var">_xty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920656"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920656"><span class="hs-identifier hs-var">tstate1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Exp
forall (ext :: * -&gt; * -&gt; *) loc dec. LocVar -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920652"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-792"></span><span>                       </span><span class="hs-comment">-- NOTE: We now allow aliases (offsets) from scalar vars too. So we can leave out this check</span><span>
</span><span id="line-793"></span><span>                       </span><span class="hs-comment">-- ensurePackedLoc exp xty l1</span><span>
</span><span id="line-794"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920657"><span class="annot"><span class="annottext">tstate2 :: LocationTypeState
</span><a href="#local-6989586621680920657"><span class="hs-identifier hs-var hs-var">tstate2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar
-&gt; (Modality, Bool) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#extendTS"><span class="hs-identifier hs-var">extendTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LocationTypeState -&gt; LocationTypeState)
-&gt; LocationTypeState -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#setAfter"><span class="hs-identifier hs-var">setAfter</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920653"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920656"><span class="hs-identifier hs-var">tstate1</span></a></span><span>
</span><span id="line-795"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920658"><span class="annot"><span class="annottext">constrs1 :: ConstraintSet
</span><a href="#local-6989586621680920658"><span class="hs-identifier hs-var hs-var">constrs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920654"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ConstraintSet -&gt; ConstraintSet) -&gt; ConstraintSet -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; LocVar -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#AfterVariableC"><span class="hs-identifier hs-var">AfterVariableC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920652"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920653"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-796"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621680920659"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920659"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920660"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920660"><span class="hs-identifier hs-var">tstate3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920627"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920658"><span class="hs-identifier hs-var">constrs1</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920657"><span class="hs-identifier hs-var">tstate2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920626"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-797"></span><span>                       </span><span id="local-6989586621680920661"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920661"><span class="hs-identifier hs-var">tstate4</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; LocationTypeState -&gt; LocVar -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#removeLoc"><span class="hs-identifier hs-var">removeLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920660"><span class="hs-identifier hs-var">tstate3</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-798"></span><span>                       </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920659"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920661"><span class="hs-identifier hs-var">tstate4</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>                </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndLE"><span class="hs-identifier hs-type">FromEndLE</span></a></span><span> </span><span id="local-6989586621680920663"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920663"><span class="hs-identifier hs-var">_l1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-800"></span><span>                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- TODO: This is the bare minimum which gets the examples typechecking again.</span><span>
</span><span id="line-801"></span><span>                       </span><span class="hs-comment">-- Need to figure out if we need to check more things here</span><span>
</span><span id="line-802"></span><span>                      </span><span class="hs-special">(</span><span id="local-6989586621680920664"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920664"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920665"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920665"><span class="hs-identifier hs-var">tstate1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920627"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920626"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-803"></span><span>                      </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920664"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920665"><span class="hs-identifier hs-var">tstate1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-804"></span><span>                </span><span class="annot"><span class="annottext">PreLocExp LocVar
</span><a href="Gibbon.L2.Syntax.html#FreeLE"><span class="hs-identifier hs-var">FreeLE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-805"></span><span>                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920667"><span class="annot"><span class="annottext">constrs1 :: ConstraintSet
</span><a href="#local-6989586621680920667"><span class="hs-identifier hs-var hs-var">constrs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="Gibbon.L2.Typecheck.html#globalReg"><span class="hs-identifier hs-var">globalReg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ConstraintSet -&gt; ConstraintSet) -&gt; ConstraintSet -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-806"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621680920669"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920669"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920670"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920670"><span class="hs-identifier hs-var">tstate1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920627"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920667"><span class="hs-identifier hs-var">constrs1</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920626"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-807"></span><span>                       </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920669"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920670"><span class="hs-identifier hs-var">tstate1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span>                </span><span class="annot"><a href="Gibbon.L2.Syntax.html#InRegionLE"><span class="hs-identifier hs-type">InRegionLE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;InRegionLE not handled.&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">StartOfPkdCursor</span></a></span><span> </span><span id="local-6989586621680920673"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920673"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-812"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Map LocVar (UrTy LocVar) -&gt; Maybe (UrTy LocVar)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920673"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 (UrTy LocVar) -&gt; Map LocVar (UrTy LocVar)
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-813"></span><span>          </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>          </span><span id="local-6989586621680920675"><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><a href="#local-6989586621680920675"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected PackedTy, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar) -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><a href="#local-6989586621680920675"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span> </span><span id="local-6989586621680920677"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920677"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680920678"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920678"><span class="hs-identifier hs-var">_b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-817"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Map LocVar (UrTy LocVar) -&gt; Maybe (UrTy LocVar)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920677"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 (UrTy LocVar) -&gt; Map LocVar (UrTy LocVar)
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-818"></span><span>          </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-819"></span><span>          </span><span id="local-6989586621680920679"><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><a href="#local-6989586621680920679"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected PackedTy, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar) -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><a href="#local-6989586621680920679"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-type">FromEndE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; TCError -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FromEndE not handled&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-823"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#AddFixed"><span class="hs-identifier hs-type">AddFixed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span> </span><span id="local-6989586621680920683"><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920683"><span class="hs-identifier hs-var">_ls</span></a></span></span><span> </span><span id="local-6989586621680920684"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920684"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span>               </span><span class="hs-comment">-- skip returned locations for now</span><span>
</span><span id="line-828"></span><span>               </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp -&gt; TcM (UrTy LocVar, LocationTypeState))
-&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Exp
forall (ext :: * -&gt; * -&gt; *) loc dec. LocVar -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920684"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-comment">-- The IntTy is just a placeholder. BoundsCheck is a side-effect</span><span>
</span><span id="line-831"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span> </span><span id="local-6989586621680920687"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920687"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920688"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920688"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LocVar, LocVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; LocVar -&gt; UrTy LocVar
forall loc. String -&gt; loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-var">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920687"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920688"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocVar (UrTy LocVar)
</span><a href="Gibbon.L2.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[LocVar]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920691"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920691"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920691"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-840"></span><span>        </span><span class="hs-comment">-- (ty,tstate1) &lt;- recur tstatein (VarE v)</span><span>
</span><span id="line-841"></span><span>        </span><span class="hs-comment">-- ensureEqualTy (VarE v) ty CursorTy</span><span>
</span><span id="line-842"></span><span>        </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-845"></span><span>        </span><span class="hs-comment">-- (ty,tstate1) &lt;- recur tstatein (VarE v)</span><span>
</span><span id="line-846"></span><span>        </span><span class="hs-comment">-- ensureEqualTy (VarE v) ty CursorTy</span><span>
</span><span id="line-847"></span><span>        </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-850"></span><span>        </span><span class="hs-comment">-- (ty,tstate1) &lt;- recur tstatein (VarE v)</span><span>
</span><span id="line-851"></span><span>        </span><span class="hs-comment">-- ensureEqualTy (VarE v) ty CursorTy</span><span>
</span><span id="line-852"></span><span>        </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-855"></span><span>        </span><span class="hs-comment">-- (ty,tstate1) &lt;- recur tstatein (VarE v)</span><span>
</span><span id="line-856"></span><span>        </span><span class="hs-comment">-- ensureEqualTy (VarE v) ty CursorTy</span><span>
</span><span id="line-857"></span><span>        </span><span class="annot"><span class="annottext">(UrTy LocVar, LocationTypeState)
-&gt; TcM (UrTy LocVar, LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; UrTy LocVar
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920217"><span class="hs-identifier hs-var">tstatein</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680920257"><span class="annot"><span class="annottext">recur :: LocationTypeState -&gt; Exp -&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920257"><span class="hs-identifier hs-var hs-var">recur</span></a></span></span><span> </span><span id="local-6989586621680920696"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920696"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621680920697"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920697"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920215"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920216"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920696"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920697"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-860"></span><span>          </span><span id="local-6989586621680920404"><span class="annot"><span class="annottext">checkListElemTy :: UrTy LocVar -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680920404"><span class="hs-identifier hs-var hs-var">checkListElemTy</span></a></span></span><span> </span><span id="local-6989586621680920698"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920698"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-861"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isValidListElemTy"><span class="hs-identifier hs-var">isValidListElemTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920698"><span class="hs-identifier hs-var">el_ty</span></a></span><span>
</span><span id="line-862"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-863"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Gibbon-TODO: Lists of only scalars or flat products of scalars are allowed. Got&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920698"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span class="annot"><span class="hs-comment">-- | Helper function to check case branches.</span></span><span>
</span><span id="line-868"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcCases"><span class="hs-identifier hs-type">tcCases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span>
</span><span id="line-869"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>
</span><span id="line-870"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-871"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span id="tcCases"><span class="annot"><span class="annottext">tcCases :: DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; LocVar
-&gt; Region
-&gt; [(String, [(LocVar, LocVar)], Exp)]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcCases"><span class="hs-identifier hs-var hs-var">tcCases</span></a></span></span><span> </span><span id="local-6989586621680920715"><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920715"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680920716"><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920716"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680920717"><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920717"><span class="hs-identifier hs-var">funs</span></a></span></span><span> </span><span id="local-6989586621680920718"><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920718"><span class="hs-identifier hs-var">constrs</span></a></span></span><span> </span><span id="local-6989586621680920719"><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920719"><span class="hs-identifier hs-var">regs</span></a></span></span><span> </span><span id="local-6989586621680920720"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920720"><span class="hs-identifier hs-var">tstatein</span></a></span></span><span> </span><span id="local-6989586621680920721"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920721"><span class="hs-identifier hs-var">lin</span></a></span></span><span> </span><span id="local-6989586621680920722"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920722"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920723"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920723"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920724"><span class="annot"><span class="annottext">[(LocVar, LocVar)]
</span><a href="#local-6989586621680920724"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920725"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920725"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680920726"><span class="annot"><span class="annottext">[(String, [(LocVar, LocVar)], Exp)]
</span><a href="#local-6989586621680920726"><span class="hs-identifier hs-var">cases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-873"></span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920727"><span class="annot"><span class="annottext">argtys :: [((LocVar, LocVar), UrTy LocVar)]
</span><a href="#local-6989586621680920727"><span class="hs-identifier hs-var hs-var">argtys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(LocVar, LocVar)]
-&gt; [UrTy LocVar] -&gt; [((LocVar, LocVar), UrTy LocVar)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[(LocVar, LocVar)]
</span><a href="#local-6989586621680920724"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">([UrTy LocVar] -&gt; [((LocVar, LocVar), UrTy LocVar)])
-&gt; [UrTy LocVar] -&gt; [((LocVar, LocVar), UrTy LocVar)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar) -&gt; String -&gt; [UrTy LocVar]
forall a. Out a =&gt; DDefs a -&gt; String -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920715"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920723"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-875"></span><span>      </span><span id="local-6989586621680920728"><span class="annot"><span class="annottext">pairwise :: [(((LocVar, LocVar), UrTy LocVar),
  Maybe ((LocVar, LocVar), UrTy LocVar))]
</span><a href="#local-6989586621680920728"><span class="hs-identifier hs-var hs-var">pairwise</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((LocVar, LocVar), UrTy LocVar)]
-&gt; [Maybe ((LocVar, LocVar), UrTy LocVar)]
-&gt; [(((LocVar, LocVar), UrTy LocVar),
     Maybe ((LocVar, LocVar), UrTy LocVar))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[((LocVar, LocVar), UrTy LocVar)]
</span><a href="#local-6989586621680920727"><span class="hs-identifier hs-var">argtys</span></a></span><span> </span><span class="annot"><span class="annottext">([Maybe ((LocVar, LocVar), UrTy LocVar)]
 -&gt; [(((LocVar, LocVar), UrTy LocVar),
      Maybe ((LocVar, LocVar), UrTy LocVar))])
-&gt; [Maybe ((LocVar, LocVar), UrTy LocVar)]
-&gt; [(((LocVar, LocVar), UrTy LocVar),
     Maybe ((LocVar, LocVar), UrTy LocVar))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ((LocVar, LocVar), UrTy LocVar)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ((LocVar, LocVar), UrTy LocVar)
-&gt; [Maybe ((LocVar, LocVar), UrTy LocVar)]
-&gt; [Maybe ((LocVar, LocVar), UrTy LocVar)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((LocVar, LocVar), UrTy LocVar)
 -&gt; Maybe ((LocVar, LocVar), UrTy LocVar))
-&gt; [((LocVar, LocVar), UrTy LocVar)]
-&gt; [Maybe ((LocVar, LocVar), UrTy LocVar)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">((LocVar, LocVar), UrTy LocVar)
-&gt; Maybe ((LocVar, LocVar), UrTy LocVar)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[((LocVar, LocVar), UrTy LocVar)]
</span><a href="#local-6989586621680920727"><span class="hs-identifier hs-var">argtys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span>      </span><span class="hs-comment">-- Generate the new constraints to check this branch</span><span>
</span><span id="line-878"></span><span>      </span><span id="local-6989586621680920729"><span class="annot"><span class="annottext">genConstrs :: (((LocVar, LocVar), UrTy LocVar),
 Maybe ((LocVar, LocVar), UrTy LocVar))
-&gt; (LocVar, [LocConstraint]) -&gt; (LocVar, [LocConstraint])
</span><a href="#local-6989586621680920729"><span class="hs-identifier hs-var hs-var">genConstrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920730"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920730"><span class="hs-identifier hs-var">_v1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920731"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920731"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe ((LocVar, LocVar), UrTy LocVar)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920732"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920732"><span class="hs-identifier hs-var">lin</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920733"><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920733"><span class="hs-identifier hs-var">lst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-879"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920731"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; LocVar -&gt; LocVar -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#AfterConstantC"><span class="hs-identifier hs-var">AfterConstantC</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920732"><span class="hs-identifier hs-var">lin</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920731"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920731"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920722"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; [LocConstraint] -&gt; [LocConstraint]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920733"><span class="hs-identifier hs-var">lst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>      </span><span class="annot"><a href="#local-6989586621680920729"><span class="hs-identifier hs-var">genConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920734"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920734"><span class="hs-identifier hs-var">_v1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920735"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920735"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920736"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920736"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920737"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920737"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920738"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920738"><span class="hs-identifier hs-var">_lin</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920739"><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920739"><span class="hs-identifier hs-var">lst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-881"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920735"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; LocVar -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#AfterVariableC"><span class="hs-identifier hs-var">AfterVariableC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920736"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920737"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920735"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920735"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920722"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; [LocConstraint] -&gt; [LocConstraint]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920739"><span class="hs-identifier hs-var">lst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>      </span><span class="annot"><a href="#local-6989586621680920729"><span class="hs-identifier hs-var">genConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920740"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920740"><span class="hs-identifier hs-var">_v1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920741"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920741"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920742"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920742"><span class="hs-identifier hs-var">_v2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920743"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920743"><span class="hs-identifier hs-var">_l2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920744"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920744"><span class="hs-identifier hs-var">lin</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920745"><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920745"><span class="hs-identifier hs-var">lst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-883"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920748"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621680920748"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Any -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920741"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; LocVar -&gt; LocVar -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#AfterConstantC"><span class="hs-identifier hs-var">AfterConstantC</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920748"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920744"><span class="hs-identifier hs-var">lin</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920741"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920741"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920722"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; [LocConstraint] -&gt; [LocConstraint]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920745"><span class="hs-identifier hs-var">lst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-885"></span><span>      </span><span class="annot"><a href="#local-6989586621680920729"><span class="hs-identifier hs-var">genConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680920751"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920751"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe ((LocVar, LocVar), UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920752"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920752"><span class="hs-identifier hs-var">lin</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920753"><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920753"><span class="hs-identifier hs-var">lst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-886"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920752"><span class="hs-identifier hs-var">lin</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920751"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920722"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; [LocConstraint] -&gt; [LocConstraint]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920753"><span class="hs-identifier hs-var">lst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span>
</span><span id="line-888"></span><span>      </span><span class="hs-comment">-- Generate the new location state map to check this branch</span><span>
</span><span id="line-889"></span><span>      </span><span id="local-6989586621680920754"><span class="annot"><span class="annottext">genTS :: ((a, LocVar), UrTy loc) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="#local-6989586621680920754"><span class="hs-identifier hs-var hs-var">genTS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920755"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680920755"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920756"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920756"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680920757"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920757"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar
-&gt; (Modality, Bool) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#extendTS"><span class="hs-identifier hs-var">extendTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920756"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920757"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-890"></span><span>      </span><span class="annot"><a href="#local-6989586621680920754"><span class="hs-identifier hs-var">genTS</span></a></span><span> </span><span class="annot"><span class="annottext">((a, LocVar), UrTy loc)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920759"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920759"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920759"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-891"></span><span>      </span><span id="local-6989586621680920760"><span class="annot"><span class="annottext">genEnv :: ((LocVar, loc), UrTy loc) -&gt; Env2 (UrTy loc) -&gt; Env2 (UrTy loc)
</span><a href="#local-6989586621680920760"><span class="hs-identifier hs-var hs-var">genEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920761"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920761"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920762"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680920762"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680920763"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920763"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621680920764"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680920764"><span class="hs-identifier hs-var">_l'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680920765"><span class="annot"><span class="annottext">Env2 (UrTy loc)
</span><a href="#local-6989586621680920765"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; UrTy loc -&gt; Env2 (UrTy loc) -&gt; Env2 (UrTy loc)
forall a. LocVar -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920761"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; loc -&gt; UrTy loc
forall loc. String -&gt; loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-var">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920763"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680920762"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy loc)
</span><a href="#local-6989586621680920765"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-892"></span><span>      </span><span class="annot"><a href="#local-6989586621680920760"><span class="hs-identifier hs-var">genEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920766"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920766"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920767"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680920767"><span class="hs-identifier hs-var">_l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621680920768"><span class="annot"><span class="annottext">UrTy loc
</span><a href="#local-6989586621680920768"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680920769"><span class="annot"><span class="annottext">Env2 (UrTy loc)
</span><a href="#local-6989586621680920769"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; UrTy loc -&gt; Env2 (UrTy loc) -&gt; Env2 (UrTy loc)
forall a. LocVar -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920766"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy loc
</span><a href="#local-6989586621680920768"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy loc)
</span><a href="#local-6989586621680920769"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span>      </span><span class="hs-comment">-- Remove the pattern-bound location variables from the location state map</span><span>
</span><span id="line-895"></span><span>      </span><span id="local-6989586621680920770"><span class="annot"><span class="annottext">remTS :: ((a, LocVar), UrTy loc) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="#local-6989586621680920770"><span class="hs-identifier hs-var hs-var">remTS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680920771"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680920771"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920772"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920772"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680920773"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920773"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#removeTS"><span class="hs-identifier hs-var">removeTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920772"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920773"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-896"></span><span>      </span><span class="annot"><a href="#local-6989586621680920770"><span class="hs-identifier hs-var">remTS</span></a></span><span> </span><span class="annot"><span class="annottext">((a, LocVar), UrTy loc)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920775"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920775"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920775"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>      </span><span class="hs-comment">-- Use these functions with our old friend foldr</span><span>
</span><span id="line-899"></span><span>      </span><span id="local-6989586621680920776"><span class="annot"><span class="annottext">constrs1 :: ConstraintSet
</span><a href="#local-6989586621680920776"><span class="hs-identifier hs-var hs-var">constrs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet)
-&gt; ConstraintSet -&gt; [LocConstraint] -&gt; ConstraintSet
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920718"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">([LocConstraint] -&gt; ConstraintSet)
-&gt; [LocConstraint] -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LocVar, [LocConstraint]) -&gt; [LocConstraint]
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((LocVar, [LocConstraint]) -&gt; [LocConstraint])
-&gt; (LocVar, [LocConstraint]) -&gt; [LocConstraint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((((LocVar, LocVar), UrTy LocVar),
  Maybe ((LocVar, LocVar), UrTy LocVar))
 -&gt; (LocVar, [LocConstraint]) -&gt; (LocVar, [LocConstraint]))
-&gt; (LocVar, [LocConstraint])
-&gt; [(((LocVar, LocVar), UrTy LocVar),
     Maybe ((LocVar, LocVar), UrTy LocVar))]
-&gt; (LocVar, [LocConstraint])
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">(((LocVar, LocVar), UrTy LocVar),
 Maybe ((LocVar, LocVar), UrTy LocVar))
-&gt; (LocVar, [LocConstraint]) -&gt; (LocVar, [LocConstraint])
</span><a href="#local-6989586621680920729"><span class="hs-identifier hs-var">genConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920721"><span class="hs-identifier hs-var">lin</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(((LocVar, LocVar), UrTy LocVar),
  Maybe ((LocVar, LocVar), UrTy LocVar))]
</span><a href="#local-6989586621680920728"><span class="hs-identifier hs-var">pairwise</span></a></span><span>
</span><span id="line-900"></span><span>      </span><span id="local-6989586621680920779"><span class="annot"><span class="annottext">tstate1 :: LocationTypeState
</span><a href="#local-6989586621680920779"><span class="hs-identifier hs-var hs-var">tstate1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((LocVar, LocVar), UrTy LocVar)
 -&gt; LocationTypeState -&gt; LocationTypeState)
-&gt; LocationTypeState
-&gt; [((LocVar, LocVar), UrTy LocVar)]
-&gt; LocationTypeState
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">((LocVar, LocVar), UrTy LocVar)
-&gt; LocationTypeState -&gt; LocationTypeState
forall {a} {loc}.
((a, LocVar), UrTy loc) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="#local-6989586621680920754"><span class="hs-identifier hs-var">genTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920720"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">[((LocVar, LocVar), UrTy LocVar)]
</span><a href="#local-6989586621680920727"><span class="hs-identifier hs-var">argtys</span></a></span><span>
</span><span id="line-901"></span><span>      </span><span id="local-6989586621680920780"><span class="annot"><span class="annottext">env1 :: Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920780"><span class="hs-identifier hs-var hs-var">env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((LocVar, LocVar), UrTy LocVar)
 -&gt; Env2 (UrTy LocVar) -&gt; Env2 (UrTy LocVar))
-&gt; Env2 (UrTy LocVar)
-&gt; [((LocVar, LocVar), UrTy LocVar)]
-&gt; Env2 (UrTy LocVar)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">((LocVar, LocVar), UrTy LocVar)
-&gt; Env2 (UrTy LocVar) -&gt; Env2 (UrTy LocVar)
forall {loc}.
((LocVar, loc), UrTy loc) -&gt; Env2 (UrTy loc) -&gt; Env2 (UrTy loc)
</span><a href="#local-6989586621680920760"><span class="hs-identifier hs-var">genEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920716"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[((LocVar, LocVar), UrTy LocVar)]
</span><a href="#local-6989586621680920727"><span class="hs-identifier hs-var">argtys</span></a></span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680920781"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920781"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920782"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920782"><span class="hs-identifier hs-var">tstate2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920715"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920780"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920717"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920776"><span class="hs-identifier hs-var">constrs1</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920719"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920779"><span class="hs-identifier hs-var">tstate1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920725"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680920783"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920783"><span class="hs-identifier hs-var">tyRest</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920784"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920784"><span class="hs-identifier hs-var">tstateRest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="#local-6989586621680920785"><span class="hs-identifier hs-var">recur</span></a></span><span>
</span><span id="line-905"></span><span>  </span><span id="local-6989586621680920786"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920786"><span class="hs-identifier hs-var">tstateCombine</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp
-&gt; LocationTypeState -&gt; LocationTypeState -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#combineTStates"><span class="hs-identifier hs-var">combineTStates</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920725"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920782"><span class="hs-identifier hs-var">tstate2</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920784"><span class="hs-identifier hs-var">tstateRest</span></a></span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920787"><span class="annot"><span class="annottext">tstatee' :: LocationTypeState
</span><a href="#local-6989586621680920787"><span class="hs-identifier hs-var hs-var">tstatee'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((LocVar, LocVar), UrTy LocVar)
 -&gt; LocationTypeState -&gt; LocationTypeState)
-&gt; LocationTypeState
-&gt; [((LocVar, LocVar), UrTy LocVar)]
-&gt; LocationTypeState
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">((LocVar, LocVar), UrTy LocVar)
-&gt; LocationTypeState -&gt; LocationTypeState
forall {a} {loc}.
((a, LocVar), UrTy loc) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="#local-6989586621680920770"><span class="hs-identifier hs-var">remTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920786"><span class="hs-identifier hs-var">tstateCombine</span></a></span><span> </span><span class="annot"><span class="annottext">[((LocVar, LocVar), UrTy LocVar)]
</span><a href="#local-6989586621680920727"><span class="hs-identifier hs-var">argtys</span></a></span><span>
</span><span id="line-907"></span><span>  </span><span class="annot"><span class="annottext">([UrTy LocVar], LocationTypeState)
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920781"><span class="hs-identifier hs-var">ty1</span></a></span><span class="annot"><span class="annottext">UrTy LocVar -&gt; [UrTy LocVar] -&gt; [UrTy LocVar]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920783"><span class="hs-identifier hs-var">tyRest</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920787"><span class="hs-identifier hs-var">tstatee'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680920785"><span class="annot"><span class="annottext">recur :: ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="#local-6989586621680920785"><span class="hs-identifier hs-var hs-var">recur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-910"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680920788"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920788"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920789"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920789"><span class="hs-identifier hs-var">tstate2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; LocVar
-&gt; Region
-&gt; [(String, [(LocVar, LocVar)], Exp)]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcCases"><span class="hs-identifier hs-var">tcCases</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920715"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920716"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920717"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920718"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920719"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920720"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920721"><span class="hs-identifier hs-var">lin</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920722"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(LocVar, LocVar)], Exp)]
</span><a href="#local-6989586621680920726"><span class="hs-identifier hs-var">cases</span></a></span><span>
</span><span id="line-911"></span><span>            </span><span class="annot"><span class="annottext">([UrTy LocVar], LocationTypeState)
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920788"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920789"><span class="hs-identifier hs-var">tstate2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcCases"><span class="hs-identifier hs-var">tcCases</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920790"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920790"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([UrTy LocVar], LocationTypeState)
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920790"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcProj"><span class="hs-identifier hs-type">tcProj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span>
</span><span id="line-916"></span><span id="tcProj"><span class="annot"><span class="annottext">tcProj :: Exp -&gt; Int -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#tcProj"><span class="hs-identifier hs-var hs-var">tcProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920800"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920800"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680920801"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920801"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy LocVar -&gt; TcM (UrTy LocVar))
-&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920801"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; Int -&gt; UrTy LocVar
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920800"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-917"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcProj"><span class="hs-identifier hs-var">tcProj</span></a></span><span> </span><span id="local-6989586621680920802"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920802"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680920803"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680920803"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span id="local-6989586621680920804"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920804"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar)) -&gt; TCError -&gt; TcM (UrTy LocVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Projection from non-tuple type &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920804"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920802"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span class="hs-comment">-- | A wrapper for tcExp to check a list of exprs, checking them in order:</span><span>
</span><span id="line-920"></span><span class="hs-comment">-- the order matters because the location state map is threaded through,</span><span>
</span><span id="line-921"></span><span class="hs-comment">-- so this is assuming the list of expressions would have been evaluated</span><span>
</span><span id="line-922"></span><span class="hs-comment">-- in first-to-last order.</span><span>
</span><span id="line-923"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcExps"><span class="hs-identifier hs-type">tcExps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span>
</span><span id="line-924"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-925"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span id="tcExps"><span class="annot"><span class="annottext">tcExps :: DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; [Exp]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExps"><span class="hs-identifier hs-var hs-var">tcExps</span></a></span></span><span> </span><span id="local-6989586621680920810"><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920810"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680920811"><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920811"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680920812"><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920812"><span class="hs-identifier hs-var">funs</span></a></span></span><span> </span><span id="local-6989586621680920813"><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920813"><span class="hs-identifier hs-var">constrs</span></a></span></span><span> </span><span id="local-6989586621680920814"><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920814"><span class="hs-identifier hs-var">regs</span></a></span></span><span> </span><span id="local-6989586621680920815"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920815"><span class="hs-identifier hs-var">tstatein</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920816"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920816"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680920817"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920817"><span class="hs-identifier hs-var">exps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-927"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920818"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920818"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920819"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920819"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920810"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920811"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920812"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920813"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920814"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920815"><span class="hs-identifier hs-var">tstatein</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920816"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-928"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621680920820"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920820"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920821"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920821"><span class="hs-identifier hs-var">ts'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; [Exp]
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExps"><span class="hs-identifier hs-var">tcExps</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920810"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920811"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920812"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920813"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920814"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920819"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621680920817"><span class="hs-identifier hs-var">exps</span></a></span><span>
</span><span id="line-929"></span><span>       </span><span class="annot"><span class="annottext">([UrTy LocVar], LocationTypeState)
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920818"><span class="hs-identifier hs-var">ty</span></a></span><span class="annot"><span class="annottext">UrTy LocVar -&gt; [UrTy LocVar] -&gt; [UrTy LocVar]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680920820"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920821"><span class="hs-identifier hs-var">ts'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcExps"><span class="hs-identifier hs-var">tcExps</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680920822"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920822"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([UrTy LocVar], LocationTypeState)
-&gt; ExceptT TCError Identity ([UrTy LocVar], LocationTypeState)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920822"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span class="annot"><span class="hs-comment">-- | Main entry point, checks a whole program (functions and main body).</span></span><span>
</span><span id="line-935"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#tcProg"><span class="hs-identifier hs-type">tcProg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span>
</span><span id="line-936"></span><span id="tcProg"><span class="annot"><span class="annottext">tcProg :: Prog2 -&gt; PassM Prog2
</span><a href="Gibbon.L2.Typecheck.html#tcProg"><span class="hs-identifier hs-var hs-var">tcProg</span></a></span></span><span> </span><span id="local-6989586621680920867"><span class="annot"><span class="annottext">prg0 :: Prog2
</span><a href="#local-6989586621680920867"><span class="hs-identifier hs-var">prg0</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920869"><span class="annot"><span class="annottext">DDefs (TyOf Exp)
ddefs :: DDefs (TyOf Exp)
ddefs :: forall ex. Prog ex -&gt; DDefs (TyOf ex)
</span><a href="#local-6989586621680920869"><span class="hs-identifier hs-var hs-var">ddefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920871"><span class="annot"><span class="annottext">FunDefs2
fundefs :: FunDefs2
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
</span><a href="#local-6989586621680920871"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920873"><span class="annot"><span class="annottext">Maybe (Exp, TyOf Exp)
mainExp :: Maybe (Exp, TyOf Exp)
mainExp :: forall ex. Prog ex -&gt; Maybe (ex, TyOf ex)
</span><a href="#local-6989586621680920873"><span class="hs-identifier hs-var hs-var">mainExp</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-comment">-- Handle functions</span><span>
</span><span id="line-939"></span><span>  </span><span class="annot"><span class="annottext">(FunDef Exp -&gt; PassM ()) -&gt; [FunDef Exp] -&gt; PassM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef Exp -&gt; PassM ()
</span><a href="#local-6989586621680920876"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">([FunDef Exp] -&gt; PassM ()) -&gt; [FunDef Exp] -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2 -&gt; [FunDef Exp]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920871"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span>  </span><span class="hs-comment">-- Handle main function</span><span>
</span><span id="line-942"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp, TyOf Exp)
</span><a href="#local-6989586621680920873"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-943"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Exp, TyOf Exp)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; PassM ()
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920878"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920878"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920879"><span class="annot"><span class="annottext">TyOf Exp
</span><a href="#local-6989586621680920879"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-945"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920880"><span class="annot"><span class="annottext">init_env :: Env2 (TyOf Exp)
</span><a href="#local-6989586621680920880"><span class="hs-identifier hs-var hs-var">init_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog2 -&gt; Env2 (TyOf Exp)
forall a. Prog a -&gt; Env2 (TyOf a)
</span><a href="Gibbon.Language.Syntax.html#progToEnv"><span class="hs-identifier hs-var">progToEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Prog2
</span><a href="#local-6989586621680920867"><span class="hs-identifier hs-var">prg0</span></a></span><span>
</span><span id="line-946"></span><span>            </span><span id="local-6989586621680920882"><span class="annot"><span class="annottext">res :: Either TCError (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920882"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
-&gt; Either TCError (UrTy LocVar, LocationTypeState)
forall e a. Except e a -&gt; Either e a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/transformers-0.5.6.2/src/Control.Monad.Trans.Except.html#runExcept"><span class="hs-identifier hs-var">runExcept</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (UrTy LocVar, LocationTypeState)
 -&gt; Either TCError (UrTy LocVar, LocationTypeState))
-&gt; TcM (UrTy LocVar, LocationTypeState)
-&gt; Either TCError (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp)
DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920869"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (TyOf Exp)
Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920880"><span class="hs-identifier hs-var">init_env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920871"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-947"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set LocConstraint -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-var">ConstraintSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LocConstraint -&gt; ConstraintSet)
-&gt; Set LocConstraint -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set LocVar -&gt; RegionSet
</span><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-var">RegionSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LocVar -&gt; RegionSet) -&gt; Set LocVar -&gt; RegionSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocVar
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool) -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (Modality, Bool) -&gt; LocationTypeState)
-&gt; Map LocVar (Modality, Bool) -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920878"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-949"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either TCError (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920882"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-950"></span><span>             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680920886"><span class="annot"><span class="annottext">TCError
</span><a href="#local-6989586621680920886"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PassM ()) -&gt; String -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TCError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TCError
</span><a href="#local-6989586621680920886"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-951"></span><span>             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920887"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920887"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920888"><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920888"><span class="hs-identifier hs-var">_ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-952"></span><span>                 </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920887"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp
UrTy LocVar
</span><a href="#local-6989586621680920879"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; PassM ()
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PassM ()) -&gt; String -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected type &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp
UrTy LocVar
</span><a href="#local-6989586621680920879"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; and got type &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920887"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>  </span><span class="annot"><span class="annottext">Prog2 -&gt; PassM Prog2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Prog2
</span><a href="#local-6989586621680920867"><span class="hs-identifier hs-var">prg0</span></a></span><span> </span><span class="hs-comment">-- Identity function for now.</span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span>    </span><span class="annot"><a href="#local-6989586621680920876"><span class="hs-identifier hs-type">fd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDef2"><span class="hs-identifier hs-type">FunDef2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>    </span><span id="local-6989586621680920876"><span class="annot"><span class="annottext">fd :: FunDef Exp -&gt; PassM ()
</span><a href="#local-6989586621680920876"><span class="hs-identifier hs-var hs-var">fd</span></a></span></span><span> </span><span id="local-6989586621680920890"><span class="annot"><span class="annottext">func :: FunDef Exp
</span><a href="#local-6989586621680920890"><span class="hs-identifier hs-var">func</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920892"><span class="annot"><span class="annottext">ArrowTy (TyOf Exp)
funTy :: forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
funTy :: ArrowTy (TyOf Exp)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var hs-var">funTy</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920893"><span class="annot"><span class="annottext">[LocVar]
funArgs :: [LocVar]
funArgs :: forall ex. FunDef ex -&gt; [LocVar]
</span><a href="#local-6989586621680920893"><span class="hs-identifier hs-var hs-var">funArgs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920895"><span class="annot"><span class="annottext">Exp
funBody :: Exp
funBody :: forall ex. FunDef ex -&gt; ex
</span><a href="#local-6989586621680920895"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-961"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920897"><span class="annot"><span class="annottext">init_env :: Env2 (TyOf Exp)
</span><a href="#local-6989586621680920897"><span class="hs-identifier hs-var hs-var">init_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog2 -&gt; Env2 (TyOf Exp)
forall a. Prog a -&gt; Env2 (TyOf a)
</span><a href="Gibbon.Language.Syntax.html#progToEnv"><span class="hs-identifier hs-var">progToEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Prog2
</span><a href="#local-6989586621680920867"><span class="hs-identifier hs-var">prg0</span></a></span><span>
</span><span id="line-962"></span><span>            </span><span id="local-6989586621680920898"><span class="annot"><span class="annottext">env :: Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920898"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map LocVar (UrTy LocVar)
-&gt; Env2 (UrTy LocVar) -&gt; Env2 (UrTy LocVar)
forall a. Map LocVar a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendsVEnv"><span class="hs-identifier hs-var">extendsVEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(LocVar, UrTy LocVar)] -&gt; Map LocVar (UrTy LocVar)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(LocVar, UrTy LocVar)] -&gt; Map LocVar (UrTy LocVar))
-&gt; [(LocVar, UrTy LocVar)] -&gt; Map LocVar (UrTy LocVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[LocVar] -&gt; [UrTy LocVar] -&gt; [(LocVar, UrTy LocVar)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LocVar]
</span><a href="#local-6989586621680920893"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar) -&gt; [UrTy LocVar]
forall ty2. ArrowTy2 ty2 -&gt; [ty2]
</span><a href="Gibbon.L2.Syntax.html#arrIns"><span class="hs-identifier hs-var">arrIns</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp)
ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920892"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env2 (TyOf Exp)
Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920897"><span class="hs-identifier hs-var">init_env</span></a></span><span>
</span><span id="line-963"></span><span>            </span><span id="local-6989586621680920901"><span class="annot"><span class="annottext">constrs :: ConstraintSet
</span><a href="#local-6989586621680920901"><span class="hs-identifier hs-var hs-var">constrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LRM] -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#funConstrs"><span class="hs-identifier hs-var">funConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar) -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp)
ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920892"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>            </span><span id="local-6989586621680920904"><span class="annot"><span class="annottext">regs :: RegionSet
</span><a href="#local-6989586621680920904"><span class="hs-identifier hs-var hs-var">regs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LRM] -&gt; RegionSet
</span><a href="Gibbon.L2.Typecheck.html#funRegs"><span class="hs-identifier hs-var">funRegs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar) -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp)
ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920892"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-965"></span><span>            </span><span id="local-6989586621680920906"><span class="annot"><span class="annottext">tstate :: LocationTypeState
</span><a href="#local-6989586621680920906"><span class="hs-identifier hs-var hs-var">tstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LRM] -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#funTState"><span class="hs-identifier hs-var">funTState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar) -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp)
ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920892"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>            </span><span id="local-6989586621680920908"><span class="annot"><span class="annottext">res :: Either TCError (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920908"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar, LocationTypeState)
-&gt; Either TCError (UrTy LocVar, LocationTypeState)
forall e a. Except e a -&gt; Either e a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/transformers-0.5.6.2/src/Control.Monad.Trans.Except.html#runExcept"><span class="hs-identifier hs-var">runExcept</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (UrTy LocVar, LocationTypeState)
 -&gt; Either TCError (UrTy LocVar, LocationTypeState))
-&gt; TcM (UrTy LocVar, LocationTypeState)
-&gt; Either TCError (UrTy LocVar, LocationTypeState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
-&gt; Env2 (UrTy LocVar)
-&gt; FunDefs2
-&gt; ConstraintSet
-&gt; RegionSet
-&gt; LocationTypeState
-&gt; Exp
-&gt; TcM (UrTy LocVar, LocationTypeState)
</span><a href="Gibbon.L2.Typecheck.html#tcExp"><span class="hs-identifier hs-var">tcExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp)
DDefs (UrTy LocVar)
</span><a href="#local-6989586621680920869"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920898"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs2
</span><a href="#local-6989586621680920871"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680920901"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSet
</span><a href="#local-6989586621680920904"><span class="hs-identifier hs-var">regs</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680920906"><span class="hs-identifier hs-var">tstate</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920895"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-967"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either TCError (UrTy LocVar, LocationTypeState)
</span><a href="#local-6989586621680920908"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-968"></span><span>          </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680920909"><span class="annot"><span class="annottext">TCError
</span><a href="#local-6989586621680920909"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PassM ()) -&gt; String -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TCError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TCError
</span><a href="#local-6989586621680920909"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-969"></span><span>          </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920910"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920910"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocationTypeState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920910"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; UrTy LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar) -&gt; UrTy LocVar
forall ty2. ArrowTy2 ty2 -&gt; ty2
</span><a href="Gibbon.L2.Syntax.html#arrOut"><span class="hs-identifier hs-var">arrOut</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp)
ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920892"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-970"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; PassM ()
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PassM ()) -&gt; String -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected type &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 (UrTy LocVar) -&gt; UrTy LocVar
forall ty2. ArrowTy2 ty2 -&gt; ty2
</span><a href="Gibbon.L2.Syntax.html#arrOut"><span class="hs-identifier hs-var">arrOut</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp)
ArrowTy2 (UrTy LocVar)
</span><a href="#local-6989586621680920892"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-972"></span><span>                                    </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; and got type &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920910"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>                                    </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef Exp -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef Exp
</span><a href="#local-6989586621680920890"><span class="hs-identifier hs-var">func</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span class="hs-comment">--------------------------------------------------------------------------------------------</span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span class="hs-comment">-- Helper functions</span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span class="hs-comment">-- | Insert a region into a region set.</span><span>
</span><span id="line-983"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-984"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#regionInsert"><span class="hs-identifier hs-type">regionInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span>
</span><span id="line-985"></span><span id="regionInsert"><span class="annot"><span class="annottext">regionInsert :: Exp -&gt; Region -&gt; RegionSet -&gt; TcM RegionSet
</span><a href="Gibbon.L2.Typecheck.html#regionInsert"><span class="hs-identifier hs-var hs-var">regionInsert</span></a></span></span><span> </span><span id="local-6989586621680920917"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920917"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680920918"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920918"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span id="local-6989586621680920919"><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920919"><span class="hs-identifier hs-var">regSet</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-986"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Set LocVar -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; LocVar
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920918"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920919"><span class="hs-identifier hs-var">regSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM RegionSet
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM RegionSet) -&gt; TCError -&gt; TcM RegionSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Shadowed regions not allowed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920917"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-988"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RegionSet -&gt; TcM RegionSet
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(RegionSet -&gt; TcM RegionSet) -&gt; RegionSet -&gt; TcM RegionSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocVar -&gt; RegionSet
</span><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-var">RegionSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Set LocVar -&gt; Set LocVar
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; LocVar
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920918"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920919"><span class="hs-identifier hs-var">regSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span class="annot"><span class="hs-comment">-- | Ask if a region is in the region set.</span></span><span>
</span><span id="line-991"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#hasRegion"><span class="hs-identifier hs-type">hasRegion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-992"></span><span id="hasRegion"><span class="annot"><span class="annottext">hasRegion :: Region -&gt; RegionSet -&gt; Bool
</span><a href="Gibbon.L2.Typecheck.html#hasRegion"><span class="hs-identifier hs-var hs-var">hasRegion</span></a></span></span><span> </span><span id="local-6989586621680920924"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920924"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span id="local-6989586621680920925"><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920925"><span class="hs-identifier hs-var">regSet</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Set LocVar -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; LocVar
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920924"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920925"><span class="hs-identifier hs-var">regSet</span></a></span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span class="hs-comment">-- | Ensure that a region is in a region set, reporting an error otherwise.</span><span>
</span><span id="line-995"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-996"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureRegion"><span class="hs-identifier hs-type">ensureRegion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-997"></span><span id="ensureRegion"><span class="annot"><span class="annottext">ensureRegion :: Exp -&gt; Region -&gt; RegionSet -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureRegion"><span class="hs-identifier hs-var hs-var">ensureRegion</span></a></span></span><span> </span><span id="local-6989586621680920934"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920934"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680920935"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920935"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span id="local-6989586621680920936"><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920936"><span class="hs-identifier hs-var">regSet</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-998"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Set LocVar -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; LocVar
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920935"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920936"><span class="hs-identifier hs-var">regSet</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Region &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920935"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; not in scope&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920934"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span class="hs-comment">-- | Get the region of a location variable.</span><span>
</span><span id="line-1002"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1003"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#getRegion"><span class="hs-identifier hs-type">getRegion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span>
</span><span id="line-1004"></span><span id="getRegion"><span class="annot"><span class="annottext">getRegion :: Exp -&gt; ConstraintSet -&gt; LocVar -&gt; TcM Region
</span><a href="Gibbon.L2.Typecheck.html#getRegion"><span class="hs-identifier hs-var hs-var">getRegion</span></a></span></span><span> </span><span id="local-6989586621680920945"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920945"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span id="local-6989586621680920946"><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680920946"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680920947"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920947"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; TcM Region
</span><a href="#local-6989586621680920948"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">([LocConstraint] -&gt; TcM Region) -&gt; [LocConstraint] -&gt; TcM Region
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint -&gt; [LocConstraint]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680920946"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1005"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680920948"><span class="annot"><span class="annottext">go :: [LocConstraint] -&gt; TcM Region
</span><a href="#local-6989586621680920948"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-type">InRegionC</span></a></span><span> </span><span id="local-6989586621680920950"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920950"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621680920951"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920951"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680920952"><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920952"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920950"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920947"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Region -&gt; TcM Region
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920951"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1006"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; TcM Region
</span><a href="#local-6989586621680920948"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920952"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1007"></span><span>          </span><span class="annot"><a href="#local-6989586621680920948"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocConstraint
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680920953"><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920953"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; TcM Region
</span><a href="#local-6989586621680920948"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680920953"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1008"></span><span>          </span><span class="annot"><a href="#local-6989586621680920948"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM Region
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM Region) -&gt; TCError -&gt; TcM Region
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Location &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920947"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; has no region&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920945"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span class="annot"><span class="hs-comment">-- | Get the regions mentioned in the location bindings in a function type.</span></span><span>
</span><span id="line-1011"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#funRegs"><span class="hs-identifier hs-type">funRegs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span>
</span><span id="line-1012"></span><span id="funRegs"><span class="annot"><span class="annottext">funRegs :: [LRM] -&gt; RegionSet
</span><a href="Gibbon.L2.Typecheck.html#funRegs"><span class="hs-identifier hs-var hs-var">funRegs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span id="local-6989586621680920955"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920955"><span class="hs-identifier hs-var">_l</span></a></span></span><span> </span><span id="local-6989586621680920956"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920956"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680920957"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680920957"><span class="hs-identifier hs-var">_m</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680920958"><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920958"><span class="hs-identifier hs-var">lrms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1013"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-type">RegionSet</span></a></span><span> </span><span id="local-6989586621680920959"><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920959"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LRM] -&gt; RegionSet
</span><a href="Gibbon.L2.Typecheck.html#funRegs"><span class="hs-identifier hs-var">funRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920958"><span class="hs-identifier hs-var">lrms</span></a></span><span>
</span><span id="line-1014"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set LocVar -&gt; RegionSet
</span><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-var">RegionSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LocVar -&gt; RegionSet) -&gt; Set LocVar -&gt; RegionSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Set LocVar -&gt; Set LocVar
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; LocVar
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920956"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set LocVar
</span><a href="#local-6989586621680920959"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-1015"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#funRegs"><span class="hs-identifier hs-var">funRegs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set LocVar -&gt; RegionSet
</span><a href="Gibbon.L2.Typecheck.html#RegionSet"><span class="hs-identifier hs-var">RegionSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LocVar -&gt; RegionSet) -&gt; Set LocVar -&gt; RegionSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocVar
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#globalReg"><span class="hs-identifier hs-type">globalReg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span>
</span><span id="line-1018"></span><span id="globalReg"><span class="annot"><span class="annottext">globalReg :: Region
</span><a href="Gibbon.L2.Typecheck.html#globalReg"><span class="hs-identifier hs-var hs-var">globalReg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Multiplicity -&gt; Region
</span><a href="Gibbon.L2.Syntax.html#GlobR"><span class="hs-identifier hs-var">GlobR</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-string">&quot;GLOBAL&quot;</span></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="Gibbon.L2.Syntax.html#BigInfinite"><span class="hs-identifier hs-var">BigInfinite</span></a></span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span class="annot"><span class="hs-comment">-- | Get the constraints from the location bindings in a function type.</span></span><span>
</span><span id="line-1021"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#funConstrs"><span class="hs-identifier hs-type">funConstrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span>
</span><span id="line-1022"></span><span id="funConstrs"><span class="annot"><span class="annottext">funConstrs :: [LRM] -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#funConstrs"><span class="hs-identifier hs-var hs-var">funConstrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span id="local-6989586621680920964"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920964"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680920965"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920965"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680920966"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680920966"><span class="hs-identifier hs-var">_m</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680920967"><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920967"><span class="hs-identifier hs-var">lrms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1023"></span><span>    </span><span class="annot"><span class="annottext">LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var">extendConstrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Region -&gt; LocConstraint
</span><a href="Gibbon.L2.Typecheck.html#InRegionC"><span class="hs-identifier hs-var">InRegionC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920964"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920965"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ConstraintSet -&gt; ConstraintSet) -&gt; ConstraintSet -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[LRM] -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#funConstrs"><span class="hs-identifier hs-var">funConstrs</span></a></span><span> </span><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920967"><span class="hs-identifier hs-var">lrms</span></a></span><span>
</span><span id="line-1024"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#funConstrs"><span class="hs-identifier hs-var">funConstrs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set LocConstraint -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-var">ConstraintSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LocConstraint -&gt; ConstraintSet)
-&gt; Set LocConstraint -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span class="annot"><span class="hs-comment">-- | Get the type state implied by the location bindings in a function type.</span></span><span>
</span><span id="line-1027"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#funTState"><span class="hs-identifier hs-type">funTState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span>
</span><span id="line-1028"></span><span id="funTState"><span class="annot"><span class="annottext">funTState :: [LRM] -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#funTState"><span class="hs-identifier hs-var hs-var">funTState</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span id="local-6989586621680920968"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920968"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680920969"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680920969"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span id="local-6989586621680920970"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680920970"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680920971"><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920971"><span class="hs-identifier hs-var">lrms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1029"></span><span>    </span><span class="annot"><span class="annottext">LocVar
-&gt; (Modality, Bool) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#extendTS"><span class="hs-identifier hs-var">extendTS</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920968"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680920970"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(LocationTypeState -&gt; LocationTypeState)
-&gt; LocationTypeState -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[LRM] -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#funTState"><span class="hs-identifier hs-var">funTState</span></a></span><span> </span><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680920971"><span class="hs-identifier hs-var">lrms</span></a></span><span>
</span><span id="line-1030"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#funTState"><span class="hs-identifier hs-var">funTState</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool) -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (Modality, Bool) -&gt; LocationTypeState)
-&gt; Map LocVar (Modality, Bool) -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span class="hs-comment">-- | Look up the type of a variable from the environment</span><span>
</span><span id="line-1033"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1034"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#lookupVar"><span class="hs-identifier hs-type">lookupVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span>
</span><span id="line-1035"></span><span id="lookupVar"><span class="annot"><span class="annottext">lookupVar :: Env2 (UrTy LocVar) -&gt; LocVar -&gt; Exp -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#lookupVar"><span class="hs-identifier hs-var hs-var">lookupVar</span></a></span></span><span> </span><span id="local-6989586621680920976"><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920976"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680920977"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920977"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621680920978"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920978"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1036"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Map LocVar (UrTy LocVar) -&gt; Maybe (UrTy LocVar)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920977"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (UrTy LocVar) -&gt; Maybe (UrTy LocVar))
-&gt; Map LocVar (UrTy LocVar) -&gt; Maybe (UrTy LocVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar) -&gt; Map LocVar (UrTy LocVar)
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (UrTy LocVar)
</span><a href="#local-6989586621680920976"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1037"></span><span>      </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (UrTy LocVar)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (UrTy LocVar)) -&gt; TCError -&gt; TcM (UrTy LocVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#VarNotFoundTC"><span class="hs-identifier hs-var">VarNotFoundTC</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680920977"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920978"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1038"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680920979"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920979"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680920979"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span class="hs-comment">-- | Combine two location state maps.</span><span>
</span><span id="line-1041"></span><span class="hs-comment">-- Currently just uses a naive union, which will not verify that different branches do the same</span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- things.</span><span>
</span><span id="line-1043"></span><span class="hs-comment">-- TODO: Fix this!</span><span>
</span><span id="line-1044"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#combineTStates"><span class="hs-identifier hs-type">combineTStates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span>
</span><span id="line-1045"></span><span id="combineTStates"><span class="annot"><span class="annottext">combineTStates :: Exp
-&gt; LocationTypeState -&gt; LocationTypeState -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#combineTStates"><span class="hs-identifier hs-var hs-var">combineTStates</span></a></span></span><span> </span><span id="local-6989586621680920983"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920983"><span class="hs-identifier hs-var">_exp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680920984"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680920984"><span class="hs-identifier hs-var">ts1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680920985"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680920985"><span class="hs-identifier hs-var">ts2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1046"></span><span>    </span><span class="annot"><span class="annottext">LocationTypeState -&gt; TcM LocationTypeState
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(LocationTypeState -&gt; TcM LocationTypeState)
-&gt; LocationTypeState -&gt; TcM LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool) -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (Modality, Bool) -&gt; LocationTypeState)
-&gt; Map LocVar (Modality, Bool) -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
-&gt; Map LocVar (Modality, Bool) -&gt; Map LocVar (Modality, Bool)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680920984"><span class="hs-identifier hs-var">ts1</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680920985"><span class="hs-identifier hs-var">ts2</span></a></span><span>
</span><span id="line-1047"></span><span>    </span><span class="hs-comment">-- throwError $ DivergingEffectsTC exp ts1 ts2</span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span class="hs-comment">-- | Ensure that two things are equal.</span><span>
</span><span id="line-1050"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1051"></span><span id="local-6989586621680918440"><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureEqual"><span class="hs-identifier hs-type">ensureEqual</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680918440"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680918440"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680918440"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680918440"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1052"></span><span id="ensureEqual"><span class="annot"><span class="annottext">ensureEqual :: forall a. Eq a =&gt; Exp -&gt; String -&gt; a -&gt; a -&gt; TcM a
</span><a href="Gibbon.L2.Typecheck.html#ensureEqual"><span class="hs-identifier hs-var hs-var">ensureEqual</span></a></span></span><span> </span><span id="local-6989586621680920993"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920993"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680920994"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920994"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621680920995"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680920995"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680920996"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680920996"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680920995"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680920996"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; ExceptT TCError Identity a
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680920995"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity a
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity a)
-&gt; TCError -&gt; ExceptT TCError Identity a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680920994"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680920993"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span class="annot"><span class="hs-comment">-- | Ensure that the number of arguments to an operation is correct.</span></span><span>
</span><span id="line-1055"></span><span id="local-6989586621680918365"><span id="local-6989586621680918366"><span class="annot"><a href="Gibbon.L2.Typecheck.html#checkLen"><span class="hs-identifier hs-type">checkLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680918365"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680918366"><span class="hs-identifier hs-type">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680918365"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680918366"><span class="hs-identifier hs-type">arg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1056"></span><span id="checkLen"><span class="annot"><span class="annottext">checkLen :: forall op arg.
(Show op, Show arg) =&gt;
Exp -&gt; op -&gt; Int -&gt; [arg] -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#checkLen"><span class="hs-identifier hs-var hs-var">checkLen</span></a></span></span><span> </span><span id="local-6989586621680921015"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921015"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621680921016"><span class="annot"><span class="annottext">op
</span><a href="#local-6989586621680921016"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span id="local-6989586621680921017"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680921017"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680921018"><span class="annot"><span class="annottext">[arg]
</span><a href="#local-6989586621680921018"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1057"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[arg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[arg]
</span><a href="#local-6989586621680921018"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680921017"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1058"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wrong number of arguments to &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">op -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">op
</span><a href="#local-6989586621680921016"><span class="hs-identifier hs-var">pr</span></a></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1060"></span><span>                               </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.\nExpected &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680921017"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, received &quot;</span></span><span>
</span><span id="line-1061"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[arg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[arg]
</span><a href="#local-6989586621680921018"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:\n  &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[arg] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[arg]
</span><a href="#local-6989586621680921018"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921015"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span class="hs-comment">-- | Ensure that two types are equal.</span><span>
</span><span id="line-1064"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1065"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-type">ensureEqualTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span>
</span><span id="line-1066"></span><span id="ensureEqualTy"><span class="annot"><span class="annottext">ensureEqualTy :: Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var hs-var">ensureEqualTy</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-1067"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-1068"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span id="local-6989586621680921030"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921030"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921031"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921031"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680921032"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921032"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; String -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. Eq a =&gt; Exp -&gt; String -&gt; a -&gt; a -&gt; TcM a
</span><a href="Gibbon.L2.Typecheck.html#ensureEqual"><span class="hs-identifier hs-var">ensureEqual</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921030"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected these types to be the same: &quot;</span></span><span>
</span><span id="line-1069"></span><span>                                         </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921031"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921032"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921031"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921032"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureEqualTyModCursor"><span class="hs-identifier hs-type">ensureEqualTyModCursor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span>
</span><span id="line-1072"></span><span id="ensureEqualTyModCursor"><span class="annot"><span class="annottext">ensureEqualTyModCursor :: Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyModCursor"><span class="hs-identifier hs-var hs-var">ensureEqualTyModCursor</span></a></span></span><span> </span><span id="local-6989586621680921036"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921036"><span class="hs-identifier hs-var">_exp</span></a></span></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-1073"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureEqualTyModCursor"><span class="hs-identifier hs-var">ensureEqualTyModCursor</span></a></span><span> </span><span id="local-6989586621680921037"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921037"><span class="hs-identifier hs-var">_exp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-1074"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureEqualTyModCursor"><span class="hs-identifier hs-var">ensureEqualTyModCursor</span></a></span><span> </span><span id="local-6989586621680921038"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921038"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921039"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921039"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680921040"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921040"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921038"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921039"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921040"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span class="hs-comment">-- | Ensure that two types are equal, ignoring the locations if they are packed.</span><span>
</span><span id="line-1077"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1078"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureEqualTyNoLoc"><span class="hs-identifier hs-type">ensureEqualTyNoLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span>
</span><span id="line-1079"></span><span id="ensureEqualTyNoLoc"><span class="annot"><span class="annottext">ensureEqualTyNoLoc :: Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyNoLoc"><span class="hs-identifier hs-var hs-var">ensureEqualTyNoLoc</span></a></span></span><span> </span><span id="local-6989586621680921058"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921058"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921059"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921059"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621680921060"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921060"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1080"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921059"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921060"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1081"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span id="local-6989586621680921061"><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680921061"><span class="hs-identifier hs-var">_ar1</span></a></span></span><span> </span><span id="local-6989586621680921062"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680921062"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span id="local-6989586621680921063"><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680921063"><span class="hs-identifier hs-var">_ar2</span></a></span></span><span> </span><span id="local-6989586621680921064"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680921064"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1082"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680921065"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921065"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UrTy () -&gt; TcM (UrTy LocVar)
forall (f :: * -&gt; *). Applicative f =&gt; UrTy () -&gt; f (UrTy LocVar)
</span><a href="Gibbon.L2.Syntax.html#dummyTyLocs"><span class="hs-identifier hs-var">dummyTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680921062"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1083"></span><span>           </span><span id="local-6989586621680921067"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921067"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UrTy () -&gt; TcM (UrTy LocVar)
forall (f :: * -&gt; *). Applicative f =&gt; UrTy () -&gt; f (UrTy LocVar)
</span><a href="Gibbon.L2.Syntax.html#dummyTyLocs"><span class="hs-identifier hs-var">dummyTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680921064"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1084"></span><span>           </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyNoLoc"><span class="hs-identifier hs-var">ensureEqualTyNoLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921058"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921065"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921067"><span class="hs-identifier hs-var">ty2'</span></a></span><span>
</span><span id="line-1085"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680921068"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921068"><span class="hs-identifier hs-var">dc1</span></a></span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680921069"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921069"><span class="hs-identifier hs-var">dc2</span></a></span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921068"><span class="hs-identifier hs-var">dc1</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921069"><span class="hs-identifier hs-var">dc2</span></a></span><span>
</span><span id="line-1086"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921059"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1087"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTy"><span class="hs-identifier hs-var">ensureEqualTy</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921058"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921059"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921060"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1088"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680921070"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921070"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680921071"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921071"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1089"></span><span>        </span><span id="local-6989586621680921072"><span class="annot"><span class="annottext">[TcM (UrTy LocVar)]
</span><a href="#local-6989586621680921072"><span class="hs-identifier hs-var">checks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcM (UrTy LocVar)] -&gt; ExceptT TCError Identity [TcM (UrTy LocVar)]
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([TcM (UrTy LocVar)]
 -&gt; ExceptT TCError Identity [TcM (UrTy LocVar)])
-&gt; [TcM (UrTy LocVar)]
-&gt; ExceptT TCError Identity [TcM (UrTy LocVar)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((UrTy LocVar, UrTy LocVar) -&gt; TcM (UrTy LocVar))
-&gt; [(UrTy LocVar, UrTy LocVar)] -&gt; [TcM (UrTy LocVar)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680921073"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921073"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680921074"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921074"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyNoLoc"><span class="hs-identifier hs-var">ensureEqualTyNoLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921058"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921073"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921074"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy LocVar] -&gt; [UrTy LocVar] -&gt; [(UrTy LocVar, UrTy LocVar)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921070"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921071"><span class="hs-identifier hs-var">tys2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1090"></span><span>        </span><span class="hs-comment">-- TODO: avoid runExcept here</span><span>
</span><span id="line-1091"></span><span>        </span><span class="annot"><span class="annottext">[TcM (UrTy LocVar)]
-&gt; (TcM (UrTy LocVar) -&gt; ExceptT TCError Identity ())
-&gt; ExceptT TCError Identity ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[TcM (UrTy LocVar)]
</span><a href="#local-6989586621680921072"><span class="hs-identifier hs-var">checks</span></a></span><span> </span><span class="annot"><span class="annottext">((TcM (UrTy LocVar) -&gt; ExceptT TCError Identity ())
 -&gt; ExceptT TCError Identity ())
-&gt; (TcM (UrTy LocVar) -&gt; ExceptT TCError Identity ())
-&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680921076"><span class="annot"><span class="annottext">TcM (UrTy LocVar)
</span><a href="#local-6989586621680921076"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1092"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680921077"><span class="annot"><span class="annottext">c' :: Either TCError (UrTy LocVar)
</span><a href="#local-6989586621680921077"><span class="hs-identifier hs-var hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar) -&gt; Either TCError (UrTy LocVar)
forall e a. Except e a -&gt; Either e a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/transformers-0.5.6.2/src/Control.Monad.Trans.Except.html#runExcept"><span class="hs-identifier hs-var">runExcept</span></a></span><span> </span><span class="annot"><span class="annottext">TcM (UrTy LocVar)
</span><a href="#local-6989586621680921076"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1093"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either TCError (UrTy LocVar)
</span><a href="#local-6989586621680921077"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1094"></span><span>              </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680921078"><span class="annot"><span class="annottext">TCError
</span><a href="#local-6989586621680921078"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">TCError
</span><a href="#local-6989586621680921078"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1095"></span><span>              </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span>        </span><span class="annot"><span class="annottext">UrTy LocVar -&gt; TcM (UrTy LocVar)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921059"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1097"></span><span>    </span><span class="annot"><span class="annottext">(UrTy LocVar, UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; UrTy LocVar -&gt; UrTy LocVar -&gt; TcM (UrTy LocVar)
</span><a href="Gibbon.L2.Typecheck.html#ensureEqualTyModCursor"><span class="hs-identifier hs-var">ensureEqualTyModCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921058"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921059"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921060"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span>
</span><span id="line-1100"></span><span class="hs-comment">-- | Ensure that match cases make sense.</span><span>
</span><span id="line-1101"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1102"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureMatchCases"><span class="hs-identifier hs-type">ensureMatchCases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span id="ensureMatchCases"><span class="annot"><span class="annottext">ensureMatchCases :: DDefs (UrTy LocVar)
-&gt; Exp
-&gt; UrTy LocVar
-&gt; [(String, [(LocVar, LocVar)], Exp)]
-&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureMatchCases"><span class="hs-identifier hs-var hs-var">ensureMatchCases</span></a></span></span><span> </span><span id="local-6989586621680921092"><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680921092"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680921093"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921093"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921094"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921094"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680921095"><span class="annot"><span class="annottext">[(String, [(LocVar, LocVar)], Exp)]
</span><a href="#local-6989586621680921095"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1104"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921094"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1105"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680921096"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921096"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621680921097"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921097"><span class="hs-identifier hs-var">_l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1106"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680921098"><span class="annot"><span class="annottext">cons :: Set String
</span><a href="#local-6989586621680921098"><span class="hs-identifier hs-var hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Set String
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; Set String) -&gt; [String] -&gt; Set String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((String, [(Bool, UrTy LocVar)]) -&gt; String)
-&gt; [(String, [(Bool, UrTy LocVar)])] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Bool, UrTy LocVar)]) -&gt; String
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(String, [(Bool, UrTy LocVar)])] -&gt; [String])
-&gt; [(String, [(Bool, UrTy LocVar)])] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDef (UrTy LocVar) -&gt; [(String, [(Bool, UrTy LocVar)])]
forall a. DDef a -&gt; [(String, [(Bool, a)])]
</span><a href="Gibbon.Language.Syntax.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">(DDef (UrTy LocVar) -&gt; [(String, [(Bool, UrTy LocVar)])])
-&gt; DDef (UrTy LocVar) -&gt; [(String, [(Bool, UrTy LocVar)])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar) -&gt; String -&gt; DDef (UrTy LocVar)
forall a. Out a =&gt; DDefs a -&gt; String -&gt; DDef a
</span><a href="Gibbon.Language.Syntax.html#lookupDDef"><span class="hs-identifier hs-var">lookupDDef</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy LocVar)
</span><a href="#local-6989586621680921092"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921096"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1107"></span><span>            </span><span class="annot"><span class="annottext">[(String, [(LocVar, LocVar)], Exp)]
-&gt; ((String, [(LocVar, LocVar)], Exp)
    -&gt; ExceptT TCError Identity ())
-&gt; ExceptT TCError Identity [()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(LocVar, LocVar)], Exp)]
</span><a href="#local-6989586621680921095"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">(((String, [(LocVar, LocVar)], Exp) -&gt; ExceptT TCError Identity ())
 -&gt; ExceptT TCError Identity [()])
-&gt; ((String, [(LocVar, LocVar)], Exp)
    -&gt; ExceptT TCError Identity ())
-&gt; ExceptT TCError Identity [()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680921103"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921103"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(LocVar, LocVar)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1108"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Set String -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921103"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621680921098"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1109"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid case statement&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921093"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1111"></span><span>            </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>    </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot case on non-packed type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921093"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span class="hs-comment">-- | Ensure a type is at a particular location.</span><span>
</span><span id="line-1115"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1116"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensurePackedLoc"><span class="hs-identifier hs-type">ensurePackedLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span id="ensurePackedLoc"><span class="annot"><span class="annottext">ensurePackedLoc :: Exp -&gt; UrTy LocVar -&gt; LocVar -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensurePackedLoc"><span class="hs-identifier hs-var hs-var">ensurePackedLoc</span></a></span></span><span> </span><span id="local-6989586621680921114"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921114"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921115"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921115"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680921116"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921116"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1118"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921115"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1119"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680921117"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921117"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921117"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921116"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wrong location in type &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921115"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921114"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1121"></span><span>      </span><span class="annot"><span class="annottext">UrTy LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected a packed type&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921114"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1122"></span><span>
</span><span id="line-1123"></span><span class="hs-comment">-- need to check chain of aliased locations</span><span>
</span><span id="line-1124"></span><span class="hs-comment">-- linit is the location in the type i.e lout653</span><span>
</span><span id="line-1125"></span><span class="hs-comment">-- ensureAfterConstant expects l664 to be after lout653</span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span class="hs-comment">-- | Ensure the locations all line up with the constraints in a data constructor application.</span><span>
</span><span id="line-1128"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1129"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureDataCon"><span class="hs-identifier hs-type">ensureDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1130"></span><span id="ensureDataCon"><span class="annot"><span class="annottext">ensureDataCon :: Exp
-&gt; LocVar
-&gt; [UrTy LocVar]
-&gt; ConstraintSet
-&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureDataCon"><span class="hs-identifier hs-var hs-var">ensureDataCon</span></a></span></span><span> </span><span id="local-6989586621680921124"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921124"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921125"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921125"><span class="hs-identifier hs-var">linit0</span></a></span></span><span> </span><span id="local-6989586621680921126"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921126"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621680921127"><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680921127"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
-&gt; LocVar -&gt; [UrTy LocVar] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921125"><span class="hs-identifier hs-var">linit0</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921126"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1131"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680921128"><span class="annot"><span class="annottext">go :: Maybe (UrTy LocVar)
-&gt; LocVar -&gt; [UrTy LocVar] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921128"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621680921129"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921129"><span class="hs-identifier hs-var">linit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680921130"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921130"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621680921131"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921131"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680921132"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921132"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1132"></span><span>            </span><span class="annot"><span class="annottext">Exp
-&gt; ConstraintSet -&gt; LocVar -&gt; LocVar -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureAfterConstant"><span class="hs-identifier hs-var">ensureAfterConstant</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921124"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680921127"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921129"><span class="hs-identifier hs-var">linit</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921131"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1133"></span><span>            </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
-&gt; LocVar -&gt; [UrTy LocVar] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; Maybe (UrTy LocVar)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; LocVar -&gt; UrTy LocVar
forall loc. String -&gt; loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-var">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921130"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921131"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921131"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921132"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span>          </span><span class="annot"><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621680921134"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921134"><span class="hs-identifier hs-var">linit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680921135"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921135"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680921136"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921136"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1136"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConstraintSet -&gt; LocVar -&gt; Maybe LocVar
</span><a href="Gibbon.L2.Typecheck.html#getAfterConstant"><span class="hs-identifier hs-var">getAfterConstant</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680921127"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921134"><span class="hs-identifier hs-var">linit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1137"></span><span>              </span><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
-&gt; LocVar -&gt; [UrTy LocVar] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921134"><span class="hs-identifier hs-var">linit</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921136"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1138"></span><span>              </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680921138"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921138"><span class="hs-identifier hs-var">linit'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
-&gt; LocVar -&gt; [UrTy LocVar] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921138"><span class="hs-identifier hs-var">linit'</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921136"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span>          </span><span class="annot"><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680921139"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921139"><span class="hs-identifier hs-var">_dc1</span></a></span></span><span> </span><span id="local-6989586621680921140"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921140"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921141"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921141"><span class="hs-identifier hs-var">_linit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680921142"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921142"><span class="hs-identifier hs-var">dc2</span></a></span></span><span> </span><span id="local-6989586621680921143"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921143"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680921144"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921144"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1141"></span><span>            </span><span class="annot"><span class="annottext">Exp
-&gt; ConstraintSet -&gt; LocVar -&gt; LocVar -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureAfterPacked"><span class="hs-identifier hs-var">ensureAfterPacked</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921124"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintSet
</span><a href="#local-6989586621680921127"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921140"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921143"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-1142"></span><span>            </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
-&gt; LocVar -&gt; [UrTy LocVar] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy LocVar -&gt; Maybe (UrTy LocVar)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; LocVar -&gt; UrTy LocVar
forall loc. String -&gt; loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-var">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921142"><span class="hs-identifier hs-var">dc2</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921143"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921143"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921144"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span>          </span><span class="annot"><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680921146"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680921146"><span class="hs-identifier hs-var">_dc</span></a></span></span><span> </span><span id="local-6989586621680921147"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921147"><span class="hs-identifier hs-var">_l1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921148"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921148"><span class="hs-identifier hs-var">linit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680921149"><span class="annot"><span class="annottext">UrTy LocVar
</span><a href="#local-6989586621680921149"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680921150"><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921150"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1145"></span><span>              </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
-&gt; LocVar -&gt; [UrTy LocVar] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921148"><span class="hs-identifier hs-var">linit</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><a href="#local-6989586621680921150"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1146"></span><span>          </span><span class="annot"><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span>          </span><span class="annot"><a href="#local-6989586621680921128"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UrTy LocVar)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[UrTy LocVar]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ExceptT TCError Identity ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="Gibbon.Common.html#internalError"><span class="hs-identifier hs-var">internalError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unxpected case reached: L2:ensureDataCon&quot;</span></span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span>
</span><span id="line-1150"></span><span class="hs-comment">-- | Ensure that one location is +c after another location in the constraint set.</span><span>
</span><span id="line-1151"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1152"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureAfterConstant"><span class="hs-identifier hs-type">ensureAfterConstant</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span id="ensureAfterConstant"><span class="annot"><span class="annottext">ensureAfterConstant :: Exp
-&gt; ConstraintSet -&gt; LocVar -&gt; LocVar -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureAfterConstant"><span class="hs-identifier hs-var hs-var">ensureAfterConstant</span></a></span></span><span> </span><span id="local-6989586621680921158"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921158"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span id="local-6989586621680921159"><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921159"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921160"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921160"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621680921161"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921161"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1154"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(LocConstraint -&gt; Bool) -&gt; [LocConstraint] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">L.any</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; Bool
</span><a href="#local-6989586621680921163"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([LocConstraint] -&gt; Bool) -&gt; [LocConstraint] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint -&gt; [LocConstraint]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921159"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1155"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; LocVar -&gt; LocVar -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#LocationTC"><span class="hs-identifier hs-var">LocationTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected after constant relationship&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921158"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921160"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921161"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-1156"></span><span>    </span><span class="hs-comment">-- l1 is before l2</span><span>
</span><span id="line-1157"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680921163"><span class="annot"><span class="annottext">f :: LocConstraint -&gt; Bool
</span><a href="#local-6989586621680921163"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#AfterConstantC"><span class="hs-identifier hs-type">AfterConstantC</span></a></span><span> </span><span id="local-6989586621680921164"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680921164"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span id="local-6989586621680921165"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921165"><span class="hs-identifier hs-var">l1'</span></a></span></span><span> </span><span id="local-6989586621680921166"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921166"><span class="hs-identifier hs-var">l2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921165"><span class="hs-identifier hs-var">l1'</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921160"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921166"><span class="hs-identifier hs-var">l2'</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921161"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-1158"></span><span>          </span><span class="annot"><a href="#local-6989586621680921163"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span class="hs-comment">-- | Ensure that one location is a variable size after another location in the constraint set.</span><span>
</span><span id="line-1161"></span><span class="hs-comment">-- Includes an expression for error reporting.</span><span>
</span><span id="line-1162"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureAfterPacked"><span class="hs-identifier hs-type">ensureAfterPacked</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span id="ensureAfterPacked"><span class="annot"><span class="annottext">ensureAfterPacked :: Exp
-&gt; ConstraintSet -&gt; LocVar -&gt; LocVar -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#ensureAfterPacked"><span class="hs-identifier hs-var hs-var">ensureAfterPacked</span></a></span></span><span>  </span><span id="local-6989586621680921174"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921174"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span id="local-6989586621680921175"><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921175"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921176"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921176"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621680921177"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921177"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1164"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(LocConstraint -&gt; Bool) -&gt; [LocConstraint] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">L.any</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; Bool
</span><a href="#local-6989586621680921178"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([LocConstraint] -&gt; Bool) -&gt; [LocConstraint] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint -&gt; [LocConstraint]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921175"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; LocVar -&gt; LocVar -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#LocationTC"><span class="hs-identifier hs-var">LocationTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected after packed relationship&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921174"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921176"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921177"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-1166"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680921178"><span class="annot"><span class="annottext">f :: LocConstraint -&gt; Bool
</span><a href="#local-6989586621680921178"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#AfterVariableC"><span class="hs-identifier hs-type">AfterVariableC</span></a></span><span> </span><span id="local-6989586621680921179"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921179"><span class="hs-identifier hs-var">_v</span></a></span></span><span> </span><span id="local-6989586621680921180"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921180"><span class="hs-identifier hs-var">l1'</span></a></span></span><span> </span><span id="local-6989586621680921181"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921181"><span class="hs-identifier hs-var">l2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921180"><span class="hs-identifier hs-var">l1'</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921176"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921181"><span class="hs-identifier hs-var">l2'</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921177"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-1167"></span><span>          </span><span class="annot"><a href="#local-6989586621680921178"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#getAfterConstant"><span class="hs-identifier hs-type">getAfterConstant</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>
</span><span id="line-1170"></span><span id="getAfterConstant"><span class="annot"><span class="annottext">getAfterConstant :: ConstraintSet -&gt; LocVar -&gt; Maybe LocVar
</span><a href="Gibbon.L2.Typecheck.html#getAfterConstant"><span class="hs-identifier hs-var hs-var">getAfterConstant</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span id="local-6989586621680921185"><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921185"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921186"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921186"><span class="hs-identifier hs-var">l0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1171"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680921187"><span class="annot"><span class="annottext">mb_cs :: Maybe LocConstraint
</span><a href="#local-6989586621680921187"><span class="hs-identifier hs-var hs-var">mb_cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocConstraint -&gt; Bool) -&gt; Set LocConstraint -&gt; Maybe LocConstraint
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">L.find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680921188"><span class="annot"><span class="annottext">LocConstraint
</span><a href="#local-6989586621680921188"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocConstraint
</span><a href="#local-6989586621680921188"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1172"></span><span>                         </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#AfterConstantC"><span class="hs-identifier hs-type">AfterConstantC</span></a></span><span> </span><span id="local-6989586621680921189"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680921189"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span id="local-6989586621680921190"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921190"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621680921191"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921191"><span class="hs-identifier hs-var">_l2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921190"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; LocVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921186"><span class="hs-identifier hs-var">l0</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1173"></span><span>                         </span><span class="annot"><span class="annottext">LocConstraint
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1174"></span><span>              </span><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921185"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1175"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe LocConstraint
</span><a href="#local-6989586621680921187"><span class="hs-identifier hs-var">mb_cs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1176"></span><span>       </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#AfterConstantC"><span class="hs-identifier hs-type">AfterConstantC</span></a></span><span> </span><span id="local-6989586621680921192"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680921192"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span id="local-6989586621680921193"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921193"><span class="hs-identifier hs-var">_l1</span></a></span></span><span> </span><span id="local-6989586621680921194"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921194"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Maybe LocVar
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921194"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-1177"></span><span>       </span><span class="annot"><span class="annottext">Maybe LocConstraint
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe LocVar
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span>
</span><span id="line-1180"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#extendTS"><span class="hs-identifier hs-type">extendTS</span></a></span><span>
</span><span id="line-1181"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>
</span><span id="line-1182"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Aliased"><span class="hs-identifier hs-type">Aliased</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span>
</span><span id="line-1183"></span><span id="extendTS"><span class="annot"><span class="annottext">extendTS :: LocVar
-&gt; (Modality, Bool) -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#extendTS"><span class="hs-identifier hs-var hs-var">extendTS</span></a></span></span><span> </span><span id="local-6989586621680921196"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921196"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680921197"><span class="annot"><span class="annottext">(Modality, Bool)
</span><a href="#local-6989586621680921197"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680921198"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921198"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool) -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (Modality, Bool) -&gt; LocationTypeState)
-&gt; Map LocVar (Modality, Bool) -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
-&gt; (Modality, Bool)
-&gt; Map LocVar (Modality, Bool)
-&gt; Map LocVar (Modality, Bool)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921196"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Modality, Bool)
</span><a href="#local-6989586621680921197"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921198"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1184"></span><span>
</span><span id="line-1185"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#removeTS"><span class="hs-identifier hs-type">removeTS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span>
</span><span id="line-1186"></span><span id="removeTS"><span class="annot"><span class="annottext">removeTS :: LocVar -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#removeTS"><span class="hs-identifier hs-var hs-var">removeTS</span></a></span></span><span> </span><span id="local-6989586621680921201"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921201"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680921202"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921202"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool) -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (Modality, Bool) -&gt; LocationTypeState)
-&gt; Map LocVar (Modality, Bool) -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
-&gt; Map LocVar (Modality, Bool) -&gt; Map LocVar (Modality, Bool)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921201"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921202"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#setAfter"><span class="hs-identifier hs-type">setAfter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span>
</span><span id="line-1189"></span><span id="setAfter"><span class="annot"><span class="annottext">setAfter :: LocVar -&gt; LocationTypeState -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#setAfter"><span class="hs-identifier hs-var hs-var">setAfter</span></a></span></span><span> </span><span id="local-6989586621680921205"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921205"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680921206"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921206"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool) -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (Modality, Bool) -&gt; LocationTypeState)
-&gt; Map LocVar (Modality, Bool) -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Modality, Bool) -&gt; (Modality, Bool))
-&gt; LocVar
-&gt; Map LocVar (Modality, Bool)
-&gt; Map LocVar (Modality, Bool)
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#adjust"><span class="hs-identifier hs-var">M.adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680921208"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680921208"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680921208"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921205"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921206"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#_lookupTS"><span class="hs-identifier hs-type">_lookupTS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span id="_lookupTS"><span class="annot"><span class="annottext">_lookupTS :: Exp -&gt; LocVar -&gt; LocationTypeState -&gt; TcM (Modality, Bool)
</span><a href="Gibbon.L2.Typecheck.html#_lookupTS"><span class="hs-identifier hs-var hs-var">_lookupTS</span></a></span></span><span> </span><span id="local-6989586621680921217"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921217"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921218"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921218"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680921219"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921219"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1193"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Map LocVar (Modality, Bool) -&gt; Maybe (Modality, Bool)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921218"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921219"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1194"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Modality, Bool)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM (Modality, Bool)
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM (Modality, Bool))
-&gt; TCError -&gt; TcM (Modality, Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed lookup of location &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921218"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921217"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1195"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680921220"><span class="annot"><span class="annottext">(Modality, Bool)
</span><a href="#local-6989586621680921220"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Modality, Bool) -&gt; TcM (Modality, Bool)
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Modality, Bool)
</span><a href="#local-6989586621680921220"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1196"></span><span>
</span><span id="line-1197"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-type">extendConstrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocConstraint"><span class="hs-identifier hs-type">LocConstraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span>
</span><span id="line-1198"></span><span id="extendConstrs"><span class="annot"><span class="annottext">extendConstrs :: LocConstraint -&gt; ConstraintSet -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#extendConstrs"><span class="hs-identifier hs-var hs-var">extendConstrs</span></a></span></span><span> </span><span id="local-6989586621680921222"><span class="annot"><span class="annottext">LocConstraint
</span><a href="#local-6989586621680921222"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span id="local-6989586621680921223"><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921223"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set LocConstraint -&gt; ConstraintSet
</span><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-var">ConstraintSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LocConstraint -&gt; ConstraintSet)
-&gt; Set LocConstraint -&gt; ConstraintSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint -&gt; Set LocConstraint -&gt; Set LocConstraint
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="annot"><span class="annottext">LocConstraint
</span><a href="#local-6989586621680921222"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921223"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#switchOutLoc"><span class="hs-identifier hs-type">switchOutLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span>
</span><span id="line-1201"></span><span id="switchOutLoc"><span class="annot"><span class="annottext">switchOutLoc :: Exp -&gt; LocationTypeState -&gt; LocVar -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#switchOutLoc"><span class="hs-identifier hs-var hs-var">switchOutLoc</span></a></span></span><span> </span><span id="local-6989586621680921233"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921233"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921234"><span class="annot"><span class="annottext">ts :: LocationTypeState
</span><a href="#local-6989586621680921234"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680921235"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921235"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921236"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921236"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1202"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Map LocVar (Modality, Bool) -&gt; Maybe (Modality, Bool)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921236"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921235"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1203"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Modality, Bool)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM LocationTypeState
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM LocationTypeState)
-&gt; TCError -&gt; TcM LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unknown location &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921236"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921233"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1204"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span class="hs-special">,</span><span id="local-6989586621680921237"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680921237"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; TcM LocationTypeState
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(LocationTypeState -&gt; TcM LocationTypeState)
-&gt; LocationTypeState -&gt; TcM LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool) -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (Modality, Bool) -&gt; LocationTypeState)
-&gt; Map LocVar (Modality, Bool) -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Modality, Bool) -&gt; Maybe (Modality, Bool))
-&gt; LocVar
-&gt; Map LocVar (Modality, Bool)
-&gt; Map LocVar (Modality, Bool)
forall k a. Ord k =&gt; (a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#update"><span class="hs-identifier hs-var">M.update</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">(Modality, Bool)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Modality, Bool) -&gt; Maybe (Modality, Bool)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680921237"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921236"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921235"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1205"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span class="hs-special">,</span><span id="local-6989586621680921239"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680921239"><span class="hs-identifier hs-var">_a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; TcM LocationTypeState
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">LocationTypeState
</span><a href="#local-6989586621680921234"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1206"></span><span>
</span><span id="line-1207"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#_absentAfter"><span class="hs-identifier hs-type">_absentAfter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1208"></span><span id="_absentAfter"><span class="annot"><span class="annottext">_absentAfter :: Exp -&gt; LocationTypeState -&gt; LocVar -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#_absentAfter"><span class="hs-identifier hs-var hs-var">_absentAfter</span></a></span></span><span> </span><span id="local-6989586621680921251"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921251"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680921252"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921252"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921253"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921253"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1209"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Map LocVar (Modality, Bool) -&gt; Maybe (Modality, Bool)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921253"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921252"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1210"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Modality, Bool)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unknown location &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921253"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921251"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1211"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680921254"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680921254"><span class="hs-identifier hs-var">_m</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680921255"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680921255"><span class="hs-identifier hs-var">_m</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Alias of location &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921253"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921251"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span class="annot"><span class="hs-comment">-- | Ensure that a location is not already &quot;defined&quot; by a start constraint.</span></span><span>
</span><span id="line-1215"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#absentStart"><span class="hs-identifier hs-type">absentStart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span id="absentStart"><span class="annot"><span class="annottext">absentStart :: Exp -&gt; ConstraintSet -&gt; Region -&gt; ExceptT TCError Identity ()
</span><a href="Gibbon.L2.Typecheck.html#absentStart"><span class="hs-identifier hs-var hs-var">absentStart</span></a></span></span><span> </span><span id="local-6989586621680921263"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921263"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#ConstraintSet"><span class="hs-identifier hs-type">ConstraintSet</span></a></span><span> </span><span id="local-6989586621680921264"><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921264"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921265"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680921265"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921266"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">([LocConstraint] -&gt; ExceptT TCError Identity ())
-&gt; [LocConstraint] -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint -&gt; [LocConstraint]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set LocConstraint
</span><a href="#local-6989586621680921264"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1217"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680921266"><span class="annot"><span class="annottext">go :: [LocConstraint] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921266"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#StartOfC"><span class="hs-identifier hs-type">StartOfC</span></a></span><span> </span><span id="local-6989586621680921267"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921267"><span class="hs-identifier hs-var">_l</span></a></span></span><span> </span><span id="local-6989586621680921268"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680921268"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680921269"><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680921269"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1218"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680921265"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; Region -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680921268"><span class="hs-identifier hs-var">r'</span></a></span><span>
</span><span id="line-1219"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; ExceptT TCError Identity ()
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; ExceptT TCError Identity ())
-&gt; TCError -&gt; ExceptT TCError Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Repeated start of &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680921265"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921263"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1220"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921266"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680921269"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1221"></span><span>          </span><span class="annot"><a href="#local-6989586621680921266"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocConstraint
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680921270"><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680921270"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocConstraint] -&gt; ExceptT TCError Identity ()
</span><a href="#local-6989586621680921266"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocConstraint]
</span><a href="#local-6989586621680921270"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1222"></span><span>          </span><span class="annot"><a href="#local-6989586621680921266"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT TCError Identity ()
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span class="annot"><a href="Gibbon.L2.Typecheck.html#removeLoc"><span class="hs-identifier hs-type">removeLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span>
</span><span id="line-1226"></span><span id="removeLoc"><span class="annot"><span class="annottext">removeLoc :: Exp -&gt; LocationTypeState -&gt; LocVar -&gt; TcM LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#removeLoc"><span class="hs-identifier hs-var hs-var">removeLoc</span></a></span></span><span> </span><span id="local-6989586621680921279"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921279"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-type">LocationTypeState</span></a></span><span> </span><span id="local-6989586621680921280"><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921280"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680921281"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921281"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1227"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; Map LocVar (Modality, Bool) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921281"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921280"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1228"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LocationTypeState -&gt; TcM LocationTypeState
forall a. a -&gt; ExceptT TCError Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(LocationTypeState -&gt; TcM LocationTypeState)
-&gt; LocationTypeState -&gt; TcM LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool) -&gt; LocationTypeState
</span><a href="Gibbon.L2.Typecheck.html#LocationTypeState"><span class="hs-identifier hs-var">LocationTypeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar (Modality, Bool) -&gt; LocationTypeState)
-&gt; Map LocVar (Modality, Bool) -&gt; LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
-&gt; Map LocVar (Modality, Bool) -&gt; Map LocVar (Modality, Bool)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921281"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar (Modality, Bool)
</span><a href="#local-6989586621680921280"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1229"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; TcM LocationTypeState
forall a. TCError -&gt; ExceptT TCError Identity a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; TcM LocationTypeState)
-&gt; TCError -&gt; TcM LocationTypeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot remove location &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921281"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921279"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1230"></span><span>
</span><span id="line-1231"></span><span id="local-6989586621680918370"><span id="local-6989586621680918371"><span class="annot"><a href="Gibbon.L2.Typecheck.html#ensureArenaScope"><span class="hs-identifier hs-type">ensureArenaScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#MonadError"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#TCError"><span class="hs-identifier hs-type">TCError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680918370"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Typecheck.html#Exp"><span class="hs-identifier hs-type">Exp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680918371"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680918370"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1232"></span><span id="ensureArenaScope"><span class="annot"><span class="annottext">ensureArenaScope :: forall (m :: * -&gt; *) a.
MonadError TCError m =&gt;
Exp -&gt; Env2 a -&gt; Maybe LocVar -&gt; m ()
</span><a href="Gibbon.L2.Typecheck.html#ensureArenaScope"><span class="hs-identifier hs-var hs-var">ensureArenaScope</span></a></span></span><span> </span><span id="local-6989586621680921295"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921295"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680921296"><span class="annot"><span class="annottext">Env2 a
</span><a href="#local-6989586621680921296"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680921297"><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680921297"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1233"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="#local-6989586621680921297"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1234"></span><span>      </span><span class="annot"><span class="annottext">Maybe LocVar
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCError -&gt; m ()
forall a. TCError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; m ()) -&gt; TCError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected arena annotation&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921295"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1235"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680921298"><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921298"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocVar -&gt; Set LocVar -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921298"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LocVar -&gt; Bool) -&gt; (Env2 a -&gt; Set LocVar) -&gt; Env2 a -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map LocVar a -&gt; Set LocVar
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">(Map LocVar a -&gt; Set LocVar)
-&gt; (Env2 a -&gt; Map LocVar a) -&gt; Env2 a -&gt; Set LocVar
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 a -&gt; Map LocVar a
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Env2 a -&gt; Bool) -&gt; Env2 a -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 a
</span><a href="#local-6989586621680921296"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1236"></span><span>                  </span><span class="annot"><span class="annottext">TCError -&gt; m ()
forall a. TCError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Error.Class.html#throwError"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(TCError -&gt; m ()) -&gt; TCError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp -&gt; TCError
</span><a href="Gibbon.L2.Typecheck.html#GenericTC"><span class="hs-identifier hs-var">GenericTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected arena in scope: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">LocVar
</span><a href="#local-6989586621680921298"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621680921295"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1237"></span></pre></body></html>