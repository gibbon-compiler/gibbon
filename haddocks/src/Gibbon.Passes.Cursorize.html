<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.Passes.Cursorize</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorize"><span class="hs-identifier">cursorize</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier">forM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier">fromJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html"><span class="hs-identifier">Text.PrettyPrint.GenericPretty</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldrM"><span class="hs-identifier">foldrM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.DynFlags.html"><span class="hs-identifier">Gibbon.DynFlags</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html"><span class="hs-identifier">Gibbon.NewL2.Syntax</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.L3.Syntax.html"><span class="hs-identifier">Gibbon.L3.Syntax</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#BoundsCheck"><span class="hs-identifier">BoundsCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#RetE"><span class="hs-identifier">RetE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier">GetCilkWorkerNum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#LetAvail"><span class="hs-identifier">LetAvail</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>                                           </span><span class="annot"><a href="Gibbon.L3.Syntax.html#AllocateTagHere"><span class="hs-identifier">AllocateTagHere</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#AllocateScalarsHere"><span class="hs-identifier">AllocateScalarsHere</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#SSPush"><span class="hs-identifier">SSPush</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#SSPop"><span class="hs-identifier">SSPop</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>                                           </span><span class="annot"><a href="Gibbon.L3.Syntax.html#TagCursor"><span class="hs-identifier">TagCursor</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html"><span class="hs-identifier">Gibbon.L3.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L3</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.Passes.AddRAN.html"><span class="hs-identifier">Gibbon.Passes.AddRAN</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier">numRANsDataCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">{-

Cursor insertion, strategy one:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Here we go to a &quot;dilated&quot; representation of packed values, where
every `Packed T` is represented by a pair, `(Cursor,Cursor)`,
i.e. start/end. Except function arguments, and variables bound by
by a pattern match. They're just `start` cursors.

REASONING: Why the dilated convention?  In a word: conditionals.  At the
end of each function body we need to return the appropriate end cursors.
But during the computation, we may need to add an arbitrary amount of
extra state to the return type of a conditional.  Thus it's difficult to
do this routing of information without changing the types of intermediate
expressions significantly.  Dilation is the current strategy.

We proceed with two loops, corresponding to packed and unpacked
context.  When the type of the current expression satisfies
`hasPacked`, that's when we're in packed context.  And, when in
packed context, we return dilated values.


E.g.

    add1 :: Tree -&gt; Tree
    add1 tr =
      case tr of
        Leaf n   -&gt; Leaf (n + 1)
        Node l r -&gt; Node (add1 l) (add1 r)

becomes

    -- char*
    type Cursor = Ptr Char

    add1 :: Cursor -&gt; Cursor -&gt; (Cursor, (Cursor, Cursor))
    add1 lout lin =
      let tag = readTag lin
      in case tag of
           Leaf -&gt; let n  = readInt tag
                       wt = writeTag lout Leaf
                       wi = writeInt wt   (n+1)
                   in (lin + 8, (lout, wi))
           Node -&gt; ...

Every packed input becomes a read cursor. And it takes additional output cursors
for every packed type in the return value. Every packed return value becomes a
(Cursor,Cursor) i.e (start,end). And it returns additional end_of_read cursors
if the functions &quot;traverses&quot; it's input (more details in the paer).

-}</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Track variables depending on location variables.</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="hs-comment">--   If we have to create binding of the form `let v = loc` (in case expressions for example),</span><span>
</span><span id="line-77"></span><span class="hs-comment">--   but `loc` is not bound yet, we'll add the variable to this map.</span><span>
</span><span id="line-78"></span><span class="hs-comment">--   This is a stupid/simple way to get rid of FindWitnesses.</span><span>
</span><span id="line-79"></span><span class="hs-comment">--   See `FindWitnesses.hs` for why that is needed.</span><span>
</span><span id="line-80"></span><span class="hs-keyword">type</span><span> </span><span id="DepEnv"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-var">DepEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | Things we cannot define until we see a join point. There's a Ty2 to so that</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- we can extend the environment.</span><span>
</span><span id="line-84"></span><span class="hs-keyword">type</span><span> </span><span id="SyncEnv"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-var">SyncEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">type</span><span> </span><span id="OldTy2"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#OldTy2"><span class="hs-identifier hs-var">OldTy2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">-- |</span></span><span>
</span><span id="line-89"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorize"><span class="hs-identifier hs-type">cursorize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Prog3"><span class="hs-identifier hs-type">Prog3</span></a></span><span>
</span><span id="line-90"></span><span id="cursorize"><span class="annot"><span class="annottext">cursorize :: Prog2 -&gt; PassM Prog3
</span><a href="Gibbon.Passes.Cursorize.html#cursorize"><span class="hs-identifier hs-var hs-var">cursorize</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680959943"><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
ddefs :: DDefs (TyOf Exp2)
ddefs :: forall ex. Prog ex -&gt; DDefs (TyOf ex)
</span><a href="#local-6989586621680959943"><span class="hs-identifier hs-var hs-var">ddefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959945"><span class="annot"><span class="annottext">FunDefs Exp2
fundefs :: FunDefs Exp2
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
</span><a href="#local-6989586621680959945"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959947"><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
mainExp :: Maybe (Exp2, TyOf Exp2)
mainExp :: forall ex. Prog ex -&gt; Maybe (ex, TyOf ex)
</span><a href="#local-6989586621680959947"><span class="hs-identifier hs-var hs-var">mainExp</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621680959949"><span class="annot"><span class="annottext">[FunDef3]
</span><a href="#local-6989586621680959949"><span class="hs-identifier hs-var">fns'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Var, FunDef2) -&gt; PassM FunDef3)
-&gt; [(Var, FunDef2)] -&gt; PassM [FunDef3]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; FunDefs Exp2 -&gt; FunDef2 -&gt; PassM FunDef3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeFunDef"><span class="hs-identifier hs-var">cursorizeFunDef</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680959943"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959945"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; PassM FunDef3)
-&gt; ((Var, FunDef2) -&gt; FunDef2) -&gt; (Var, FunDef2) -&gt; PassM FunDef3
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, FunDef2) -&gt; FunDef2
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; [(Var, FunDef2)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959945"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959955"><span class="annot"><span class="annottext">fundefs' :: Map Var FunDef3
</span><a href="#local-6989586621680959955"><span class="hs-identifier hs-var hs-var">fundefs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, FunDef3)] -&gt; Map Var FunDef3
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, FunDef3)] -&gt; Map Var FunDef3)
-&gt; [(Var, FunDef3)] -&gt; Map Var FunDef3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef3 -&gt; (Var, FunDef3)) -&gt; [FunDef3] -&gt; [(Var, FunDef3)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680959957"><span class="annot"><span class="annottext">FunDef3
</span><a href="#local-6989586621680959957"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef3 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef3
</span><a href="#local-6989586621680959957"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDef3
</span><a href="#local-6989586621680959957"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDef3]
</span><a href="#local-6989586621680959949"><span class="hs-identifier hs-var">fns'</span></a></span><span>
</span><span id="line-93"></span><span>      </span><span id="local-6989586621680959959"><span class="annot"><span class="annottext">ddefs' :: Map Var (DDef Ty3)
</span><a href="#local-6989586621680959959"><span class="hs-identifier hs-var hs-var">ddefs'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DDef Ty2 -&gt; DDef Ty3) -&gt; DDefs Ty2 -&gt; Map Var (DDef Ty3)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="annot"><span class="annottext">DDef Ty2 -&gt; DDef Ty3
</span><a href="Gibbon.L3.Syntax.html#eraseLocMarkers"><span class="hs-identifier hs-var">eraseLocMarkers</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680959943"><span class="hs-identifier hs-var">ddefs</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621680959962"><span class="annot"><span class="annottext">Maybe (Exp3, Ty3)
</span><a href="#local-6989586621680959962"><span class="hs-identifier hs-var">mainExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="#local-6989586621680959947"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-95"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp3, Ty3) -&gt; PassM (Maybe (Exp3, Ty3))
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp3, Ty3)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-96"></span><span>                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959963"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959963"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959964"><span class="annot"><span class="annottext">TyOf Exp2
</span><a href="#local-6989586621680959964"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680959964"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Exp3, Ty3) -&gt; Maybe (Exp3, Ty3)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Exp3, Ty3) -&gt; Maybe (Exp3, Ty3))
-&gt; (Exp3 -&gt; (Exp3, Ty3)) -&gt; Exp3 -&gt; Maybe (Exp3, Ty3)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680959964"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Maybe (Exp3, Ty3))
-&gt; (DiExp Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; Maybe (Exp3, Ty3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-99"></span><span>                         </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Maybe (Exp3, Ty3))
-&gt; PassM (DiExp Exp3) -&gt; PassM (Maybe (Exp3, Ty3))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680959943"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959945"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959963"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-100"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Exp3, Ty3) -&gt; Maybe (Exp3, Ty3)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Exp3, Ty3) -&gt; Maybe (Exp3, Ty3))
-&gt; (Exp3 -&gt; (Exp3, Ty3)) -&gt; Exp3 -&gt; Maybe (Exp3, Ty3)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680959964"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Maybe (Exp3, Ty3))
-&gt; PassM Exp3 -&gt; PassM (Maybe (Exp3, Ty3))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-101"></span><span>                         </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680959943"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959945"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959963"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">Prog3 -&gt; PassM Prog3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs (TyOf Exp3)
-&gt; Map Var FunDef3 -&gt; Maybe (Exp3, TyOf Exp3) -&gt; Prog3
forall ex.
DDefs (TyOf ex) -&gt; FunDefs ex -&gt; Maybe (ex, TyOf ex) -&gt; Prog ex
</span><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-var">Prog</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp3)
Map Var (DDef Ty3)
</span><a href="#local-6989586621680959959"><span class="hs-identifier hs-var">ddefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var FunDef3
</span><a href="#local-6989586621680959955"><span class="hs-identifier hs-var">fundefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp3, TyOf Exp3)
Maybe (Exp3, Ty3)
</span><a href="#local-6989586621680959962"><span class="hs-identifier hs-var">mainExp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><span class="hs-comment">-- |</span></span><span>
</span><span id="line-105"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeFunDef"><span class="hs-identifier hs-type">cursorizeFunDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDef2"><span class="hs-identifier hs-type">FunDef2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#FunDef3"><span class="hs-identifier hs-type">FunDef3</span></a></span><span>
</span><span id="line-106"></span><span id="cursorizeFunDef"><span class="annot"><span class="annottext">cursorizeFunDef :: DDefs Ty2 -&gt; FunDefs Exp2 -&gt; FunDef2 -&gt; PassM FunDef3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeFunDef"><span class="hs-identifier hs-var hs-var">cursorizeFunDef</span></a></span></span><span> </span><span id="local-6989586621680959991"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959991"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680959992"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959992"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680959994"><span class="annot"><span class="annottext">Var
funName :: forall ex. FunDef ex -&gt; Var
funName :: Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var hs-var">funName</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959995"><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
funTy :: ArrowTy (TyOf Exp2)
funTy :: forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var hs-var">funTy</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959997"><span class="annot"><span class="annottext">[Var]
funArgs :: [Var]
funArgs :: forall ex. FunDef ex -&gt; [Var]
</span><a href="#local-6989586621680959997"><span class="hs-identifier hs-var hs-var">funArgs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959999"><span class="annot"><span class="annottext">Exp2
funBody :: Exp2
funBody :: forall ex. FunDef ex -&gt; ex
</span><a href="#local-6989586621680959999"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960001"><span class="annot"><span class="annottext">FunMeta
funMeta :: FunMeta
funMeta :: forall ex. FunDef ex -&gt; FunMeta
</span><a href="#local-6989586621680960001"><span class="hs-identifier hs-var hs-var">funMeta</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960003"><span class="annot"><span class="annottext">inLocs :: [Var]
</span><a href="#local-6989586621680960003"><span class="hs-identifier hs-var hs-var">inLocs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#inLocVars"><span class="hs-identifier hs-var">inLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span id="local-6989586621680960005"><span class="annot"><span class="annottext">outLocs :: [Var]
</span><a href="#local-6989586621680960005"><span class="hs-identifier hs-var hs-var">outLocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#outLocVars"><span class="hs-identifier hs-var">outLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-109"></span><span>      </span><span id="local-6989586621680960007"><span class="annot"><span class="annottext">outRegs :: [Var]
</span><a href="#local-6989586621680960007"><span class="hs-identifier hs-var hs-var">outRegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#outRegVars"><span class="hs-identifier hs-var">outRegVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span id="local-6989586621680960009"><span class="annot"><span class="annottext">inRegs :: [Var]
</span><a href="#local-6989586621680960009"><span class="hs-identifier hs-var hs-var">inRegs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#inRegVars"><span class="hs-identifier hs-var">inRegVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span id="local-6989586621680960011"><span class="annot"><span class="annottext">in_tys :: [Ty2]
</span><a href="#local-6989586621680960011"><span class="hs-identifier hs-var hs-var">in_tys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Ty2]
forall ty2. ArrowTy2 ty2 -&gt; [ty2]
</span><a href="Gibbon.L2.Syntax.html#arrIns"><span class="hs-identifier hs-var">arrIns</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span id="local-6989586621680960013"><span class="annot"><span class="annottext">out_ty :: Ty2
</span><a href="#local-6989586621680960013"><span class="hs-identifier hs-var hs-var">out_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; Ty2
forall ty2. ArrowTy2 ty2 -&gt; ty2
</span><a href="Gibbon.L2.Syntax.html#arrOut"><span class="hs-identifier hs-var">arrOut</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span id="local-6989586621680960015"><span class="annot"><span class="annottext">funTy' :: ([Ty3], Ty3)
</span><a href="#local-6989586621680960015"><span class="hs-identifier hs-var hs-var">funTy'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; ([Ty3], Ty3)
</span><a href="#local-6989586621680960016"><span class="hs-identifier hs-var">cursorizeArrowTy</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-comment">-- [2019.03.04] CSK: the order of these new cursor/region arguments isn't</span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-comment">-- intuitive and can be improved.</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- Input &amp; output regions are always inserted before all other arguments.</span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621680960017"><span class="annot"><span class="annottext">regBinds :: [Var]
</span><a href="#local-6989586621680960017"><span class="hs-identifier hs-var hs-var">regBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960009"><span class="hs-identifier hs-var">inRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960007"><span class="hs-identifier hs-var">outRegs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>      </span><span class="hs-comment">-- Output cursors after that.</span><span>
</span><span id="line-122"></span><span>      </span><span id="local-6989586621680960019"><span class="annot"><span class="annottext">outCurBinds :: [Var]
</span><a href="#local-6989586621680960019"><span class="hs-identifier hs-var hs-var">outCurBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960005"><span class="hs-identifier hs-var">outLocs</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-comment">-- Then the input cursors. Bind an input cursor for every packed argument.</span><span>
</span><span id="line-125"></span><span>      </span><span id="local-6989586621680960020"><span class="annot"><span class="annottext">inCurBinds :: Exp3 -&gt; Exp3
</span><a href="#local-6989586621680960020"><span class="hs-identifier hs-var hs-var">inCurBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960003"><span class="hs-identifier hs-var">inLocs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>                     </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960022"><span class="annot"><span class="annottext">projs :: [Exp3]
</span><a href="#local-6989586621680960022"><span class="hs-identifier hs-var hs-var">projs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Exp3, Ty2) -&gt; [Exp3]) -&gt; [(Exp3, Ty2)] -&gt; [Exp3]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680960024"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960024"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960025"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960025"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; Ty2 -&gt; [Exp3]
</span><a href="#local-6989586621680960026"><span class="hs-identifier hs-var">mkInProjs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960024"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960025"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp3] -&gt; [Ty2] -&gt; [(Exp3, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Exp3) -&gt; [Var] -&gt; [Exp3]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959997"><span class="hs-identifier hs-var">funArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680960011"><span class="hs-identifier hs-var">in_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>                               </span><span id="local-6989586621680960028"><span class="annot"><span class="annottext">bnds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960028"><span class="hs-identifier hs-var hs-var">bnds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960029"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960031"><span class="hs-identifier hs-var">proj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960029"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960029"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960031"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960031"><span class="hs-identifier hs-var">proj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Exp3] -&gt; [(Var, Exp3)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960003"><span class="hs-identifier hs-var">inLocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960022"><span class="hs-identifier hs-var">projs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960028"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>      </span><span id="local-6989586621680960032"><span class="annot"><span class="annottext">initTyEnv :: TyEnv Ty2
</span><a href="#local-6989586621680960032"><span class="hs-identifier hs-var hs-var">initTyEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; TyEnv Ty2) -&gt; [(Var, Ty2)] -&gt; TyEnv Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; (Var, Ty2)) -&gt; [(Var, Ty2)] -&gt; [(Var, Ty2)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680960033"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960033"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960034"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960034"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960033"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall a b. UrTy a -&gt; UrTy b
</span><a href="#local-6989586621680960036"><span class="hs-identifier hs-var">cursorizeInTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960034"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; [(Var, Ty2)]) -&gt; [(Var, Ty2)] -&gt; [(Var, Ty2)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959997"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680960011"><span class="hs-identifier hs-var">in_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; [(Var, Ty2)] -&gt; [(Var, Ty2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-133"></span><span>                               </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960037"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span id="local-6989586621680960037"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960037"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Modality
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959995"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>      </span><span id="local-6989586621680960040"><span class="annot"><span class="annottext">funargs :: [Var]
</span><a href="#local-6989586621680960040"><span class="hs-identifier hs-var hs-var">funargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960017"><span class="hs-identifier hs-var">regBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960019"><span class="hs-identifier hs-var">outCurBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959997"><span class="hs-identifier hs-var">funArgs</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621680960041"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960041"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960013"><span class="hs-identifier hs-var">out_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959991"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959992"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960032"><span class="hs-identifier hs-var">initTyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959999"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-139"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959991"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959992"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960032"><span class="hs-identifier hs-var">initTyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959999"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960042"><span class="annot"><span class="annottext">bod' :: Exp3
</span><a href="#local-6989586621680960042"><span class="hs-identifier hs-var hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; Exp3
</span><a href="#local-6989586621680960020"><span class="hs-identifier hs-var">inCurBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960041"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-141"></span><span>      </span><span id="local-6989586621680960043"><span class="annot"><span class="annottext">fn :: FunDef3
</span><a href="#local-6989586621680960043"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; ArrowTy (TyOf Exp3) -&gt; Exp3 -&gt; FunMeta -&gt; FunDef3
forall ex.
Var -&gt; [Var] -&gt; ArrowTy (TyOf ex) -&gt; ex -&gt; FunMeta -&gt; FunDef ex
</span><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959994"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960040"><span class="hs-identifier hs-var">funargs</span></a></span><span> </span><span class="annot"><span class="annottext">([Ty3], Ty3)
ArrowTy (TyOf Exp3)
</span><a href="#local-6989586621680960015"><span class="hs-identifier hs-var">funTy'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960042"><span class="hs-identifier hs-var">bod'</span></a></span><span> </span><span class="annot"><span class="annottext">FunMeta
</span><a href="#local-6989586621680960001"><span class="hs-identifier hs-var">funMeta</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="annottext">FunDef3 -&gt; PassM FunDef3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef3
</span><a href="#local-6989586621680960043"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- | The only difference between this and L3.cursorizeTy is that here,</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">--   packed types are replaced by a single CursorTy instead of</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">--   a tuple (CursorTy,CursorTy). This is because only `start` cursors are</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">--   passed in for packed function arguments.</span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621680959725"><span id="local-6989586621680959726"><span class="annot"><a href="#local-6989586621680960036"><span class="hs-identifier hs-type">cursorizeInTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959725"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959726"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621680960036"><span class="annot"><span class="annottext">cursorizeInTy :: forall a b. UrTy a -&gt; UrTy b
</span><a href="#local-6989586621680960036"><span class="hs-identifier hs-var hs-var">cursorizeInTy</span></a></span></span><span> </span><span id="local-6989586621680960044"><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960044"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960044"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#CharTy"><span class="hs-identifier hs-var">CharTy</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CharTy"><span class="hs-identifier hs-var">CharTy</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680960051"><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680960051"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UrTy b] -&gt; UrTy b
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="annot"><span class="annottext">([UrTy b] -&gt; UrTy b) -&gt; [UrTy b] -&gt; UrTy b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy a -&gt; UrTy b) -&gt; [UrTy a] -&gt; [UrTy b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a -&gt; UrTy b
forall a b. UrTy a -&gt; UrTy b
</span><a href="#local-6989586621680960036"><span class="hs-identifier hs-var">cursorizeInTy</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680960051"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span id="local-6989586621680960053"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960053"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span id="local-6989586621680960054"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680960054"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Var -&gt; Ty3 -&gt; UrTy b
forall loc. Maybe Var -&gt; Ty3 -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-var">SymDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960053"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-159"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-type">PDictTy</span></a></span><span> </span><span id="local-6989586621680960056"><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960056"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680960057"><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960057"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b -&gt; UrTy b -&gt; UrTy b
forall loc. UrTy loc -&gt; UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-var">PDictTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy a -&gt; UrTy b
forall a b. UrTy a -&gt; UrTy b
</span><a href="#local-6989586621680960036"><span class="hs-identifier hs-var">cursorizeInTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960056"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy a -&gt; UrTy b
forall a b. UrTy a -&gt; UrTy b
</span><a href="#local-6989586621680960036"><span class="hs-identifier hs-var">cursorizeInTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960057"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-161"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-type">VectorTy</span></a></span><span> </span><span id="local-6989586621680960060"><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960060"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b -&gt; UrTy b
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy b -&gt; UrTy b) -&gt; UrTy b -&gt; UrTy b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a -&gt; UrTy b
forall a b. UrTy a -&gt; UrTy b
</span><a href="#local-6989586621680960036"><span class="hs-identifier hs-var">cursorizeInTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960060"><span class="hs-identifier hs-var">el_ty</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-type">ListTy</span></a></span><span> </span><span id="local-6989586621680960062"><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960062"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b -&gt; UrTy b
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy b -&gt; UrTy b) -&gt; UrTy b -&gt; UrTy b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a -&gt; UrTy b
forall a b. UrTy a -&gt; UrTy b
</span><a href="#local-6989586621680960036"><span class="hs-identifier hs-var">cursorizeInTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680960062"><span class="hs-identifier hs-var">el_ty</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#PtrTy"><span class="hs-identifier hs-var">PtrTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PtrTy"><span class="hs-identifier hs-var">PtrTy</span></a></span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#SymSetTy"><span class="hs-identifier hs-var">SymSetTy</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymSetTy"><span class="hs-identifier hs-var">SymSetTy</span></a></span><span>
</span><span id="line-167"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">SymHashTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">SymHashTy</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><span class="annottext">UrTy a
</span><a href="Gibbon.Language.Syntax.html#IntHashTy"><span class="hs-identifier hs-var">IntHashTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy b
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntHashTy"><span class="hs-identifier hs-var">IntHashTy</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">{-

Build projections for packed values in the input type
This is used to create bindings for input location variables.

    &gt;&gt;&gt; mkInProjs e (PackedTy &quot;T&quot; &quot;l&quot;)
    [VarE (Var &quot;funArg&quot;)]

    &gt;&gt;&gt; mkInProjs e (ProdTy [IntTy,PackedTy &quot;T&quot; &quot;l&quot;])
    [ProjE 1 VarE (Var &quot;funArg&quot;)]

    &gt;&gt;&gt; mkInProje e (ProdTy [ProdTy [PackedTy &quot;T&quot; &quot;l&quot;, PackedTy &quot;T&quot; &quot;l&quot;], IntTy])
    [ProjE 0 ProjE 0 e, ProjE 1 ProjE 0 e]

    &gt;&gt;&gt; mkInProje e (ProdTy [PackedTy &quot;T&quot; &quot;l&quot;,
                             IntTy,
                             ProdTy [PackedTy &quot;T&quot; &quot;l&quot;,
                                     ProdTy [PackedTy &quot;T&quot; &quot;l&quot;, PackedTy &quot;T&quot; &quot;l&quot;]]])
    [ProjE 0 e,ProjE 0 ProjE 2 e,ProjE 0 ProjE 1 ProjE 2 e,ProjE 1 ProjE 1 ProjE 2 e]

-}</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="#local-6989586621680960026"><span class="hs-identifier hs-type">mkInProjs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621680960026"><span class="annot"><span class="annottext">mkInProjs :: Exp3 -&gt; Ty2 -&gt; [Exp3]
</span><a href="#local-6989586621680960026"><span class="hs-identifier hs-var hs-var">mkInProjs</span></a></span></span><span> </span><span id="local-6989586621680960068"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960068"><span class="hs-identifier hs-var">e0</span></a></span></span><span> </span><span id="local-6989586621680960069"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960069"><span class="hs-identifier hs-var">ty0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3 -&gt; Ty2 -&gt; [Exp3]
</span><a href="#local-6989586621680960070"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960068"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960069"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-193"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-194"></span><span>       </span><span class="annot"><a href="#local-6989586621680960070"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>       </span><span id="local-6989586621680960070"><span class="annot"><span class="annottext">go :: [Exp3] -&gt; Exp3 -&gt; Ty2 -&gt; [Exp3]
</span><a href="#local-6989586621680960070"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680960071"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960071"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680960072"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960072"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680960073"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960073"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960073"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-197"></span><span>           </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960071"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; [Exp3] -&gt; [Exp3]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960072"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-198"></span><span>           </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680960074"><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960074"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Exp3] -&gt; (Ty2, Int) -&gt; [Exp3])
-&gt; [Exp3] -&gt; [(Ty2, Int)] -&gt; [Exp3]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680960076"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960076"><span class="hs-identifier hs-var">acc2</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960077"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960077"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960078"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960078"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3 -&gt; Ty2 -&gt; [Exp3]
</span><a href="#local-6989586621680960070"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960076"><span class="hs-identifier hs-var">acc2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960078"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960072"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960077"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>                                 </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960071"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty2] -&gt; [Int] -&gt; [(Ty2, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UrTy Var -&gt; Ty2) -&gt; [UrTy Var] -&gt; [Ty2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960074"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>           </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960071"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><a href="#local-6989586621680960016"><span class="hs-identifier hs-type">cursorizeArrowTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#ArrowTy2"><span class="hs-identifier hs-type">ArrowTy2</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621680960016"><span class="annot"><span class="annottext">cursorizeArrowTy :: ArrowTy2 Ty2 -&gt; ([Ty3], Ty3)
</span><a href="#local-6989586621680960016"><span class="hs-identifier hs-var hs-var">cursorizeArrowTy</span></a></span></span><span> </span><span id="local-6989586621680960080"><span class="annot"><span class="annottext">ty :: ArrowTy2 Ty2
</span><a href="#local-6989586621680960080"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.L2.Syntax.html#ArrowTy2"><span class="hs-identifier hs-type">ArrowTy2</span></a></span><span class="hs-special">{</span><span id="local-6989586621680960082"><span class="annot"><span class="annottext">[Ty2]
arrIns :: forall ty2. ArrowTy2 ty2 -&gt; [ty2]
arrIns :: [Ty2]
</span><a href="Gibbon.L2.Syntax.html#arrIns"><span class="hs-identifier hs-var hs-var">arrIns</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960083"><span class="annot"><span class="annottext">Ty2
arrOut :: forall ty2. ArrowTy2 ty2 -&gt; ty2
arrOut :: Ty2
</span><a href="Gibbon.L2.Syntax.html#arrOut"><span class="hs-identifier hs-var hs-var">arrOut</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960084"><span class="annot"><span class="annottext">[LRM]
locVars :: forall ty2. ArrowTy2 ty2 -&gt; [LRM]
locVars :: [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var hs-var">locVars</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960085"><span class="annot"><span class="annottext">[LocRet]
locRets :: [LocRet]
locRets :: forall ty2. ArrowTy2 ty2 -&gt; [LocRet]
</span><a href="#local-6989586621680960085"><span class="hs-identifier hs-var hs-var">locRets</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-205"></span><span>          </span><span class="hs-comment">-- Regions corresponding to ouput cursors. (See [Threading regions])</span><span>
</span><span id="line-206"></span><span>          </span><span id="local-6989586621680960087"><span class="annot"><span class="annottext">numOutRegs :: Int
</span><a href="#local-6989586621680960087"><span class="hs-identifier hs-var hs-var">numOutRegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#outRegVars"><span class="hs-identifier hs-var">outRegVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2
</span><a href="#local-6989586621680960080"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>          </span><span id="local-6989586621680960089"><span class="annot"><span class="annottext">outRegs :: [UrTy Var]
</span><a href="#local-6989586621680960089"><span class="hs-identifier hs-var hs-var">outRegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; UrTy Var) -&gt; [Int] -&gt; [UrTy Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960087"><span class="hs-identifier hs-var">numOutRegs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>          </span><span class="hs-comment">-- Adding additional outputs corresponding to end-of-input-value witnesses</span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-comment">-- We've already computed additional location return value in RouteEnds</span><span>
</span><span id="line-211"></span><span>          </span><span id="local-6989586621680960090"><span class="annot"><span class="annottext">ret_curs :: [UrTy Var]
</span><a href="#local-6989586621680960090"><span class="hs-identifier hs-var hs-var">ret_curs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocRet -&gt; UrTy Var) -&gt; [LocRet] -&gt; [UrTy Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">LocRet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocRet]
</span><a href="#local-6989586621680960085"><span class="hs-identifier hs-var">locRets</span></a></span><span>
</span><span id="line-212"></span><span>          </span><span id="local-6989586621680960091"><span class="annot"><span class="annottext">out_curs :: [UrTy Var]
</span><a href="#local-6989586621680960091"><span class="hs-identifier hs-var hs-var">out_curs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960092"><span class="hs-identifier hs-var">inRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960089"><span class="hs-identifier hs-var">outRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960090"><span class="hs-identifier hs-var">ret_curs</span></a></span><span>
</span><span id="line-213"></span><span>          </span><span id="local-6989586621680960093"><span class="annot"><span class="annottext">out_ty :: UrTy Var
</span><a href="#local-6989586621680960093"><span class="hs-identifier hs-var hs-var">out_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960091"><span class="hs-identifier hs-var">out_curs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-214"></span><span>                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960083"><span class="hs-identifier hs-var">arrOut</span></a></span><span>
</span><span id="line-215"></span><span>                     </span><span class="annot"><span class="annottext">[UrTy Var]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="annot"><span class="annottext">([UrTy Var] -&gt; UrTy Var) -&gt; [UrTy Var] -&gt; UrTy Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960091"><span class="hs-identifier hs-var">out_curs</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960083"><span class="hs-identifier hs-var">arrOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>          </span><span class="hs-comment">-- Packed types in the output then become end-cursors for those same destinations.</span><span>
</span><span id="line-218"></span><span>          </span><span id="local-6989586621680960094"><span class="annot"><span class="annottext">newOut :: UrTy Var
</span><a href="#local-6989586621680960094"><span class="hs-identifier hs-var hs-var">newOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var -&gt; UrTy Var) -&gt; UrTy Var -&gt; UrTy Var
forall l. (Var -&gt; l -&gt; UrTy l) -&gt; UrTy l -&gt; UrTy l
</span><a href="Gibbon.L2.Syntax.html#mapPacked"><span class="hs-identifier hs-var">mapPacked</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960093"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>          </span><span id="local-6989586621680960096"><span class="annot"><span class="annottext">newOut' :: UrTy Var
</span><a href="#local-6989586621680960096"><span class="hs-identifier hs-var hs-var">newOut'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960094"><span class="hs-identifier hs-var">newOut</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-221"></span><span>                      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span id="local-6989586621680960097"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960097"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Var -&gt; Ty3 -&gt; UrTy Var
forall loc. Maybe Var -&gt; Ty3 -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-var">SymDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960097"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-222"></span><span>                      </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960094"><span class="hs-identifier hs-var">newOut</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>          </span><span class="hs-comment">-- Adding additional input arguments for the destination cursors to which outputs</span><span>
</span><span id="line-225"></span><span>          </span><span class="hs-comment">-- are written.</span><span>
</span><span id="line-226"></span><span>          </span><span id="local-6989586621680960098"><span class="annot"><span class="annottext">outCurs :: [LRM]
</span><a href="#local-6989586621680960098"><span class="hs-identifier hs-var hs-var">outCurs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; Bool) -&gt; [LRM] -&gt; [LRM]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960099"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680960099"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680960099"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680960084"><span class="hs-identifier hs-var">locVars</span></a></span><span>
</span><span id="line-227"></span><span>          </span><span id="local-6989586621680960101"><span class="annot"><span class="annottext">outCurTys :: [UrTy Var]
</span><a href="#local-6989586621680960101"><span class="hs-identifier hs-var hs-var">outCurTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; UrTy Var) -&gt; [LRM] -&gt; [UrTy Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">LRM
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LRM]
</span><a href="#local-6989586621680960098"><span class="hs-identifier hs-var">outCurs</span></a></span><span>
</span><span id="line-228"></span><span>          </span><span id="local-6989586621680960092"><span class="annot"><span class="annottext">inRegs :: [UrTy Var]
</span><a href="#local-6989586621680960092"><span class="hs-identifier hs-var hs-var">inRegs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; UrTy Var) -&gt; [Var] -&gt; [UrTy Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#inRegVars"><span class="hs-identifier hs-var">inRegVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2
</span><a href="#local-6989586621680960080"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>          </span><span id="local-6989586621680960102"><span class="annot"><span class="annottext">in_tys :: [UrTy Var]
</span><a href="#local-6989586621680960102"><span class="hs-identifier hs-var hs-var">in_tys</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960092"><span class="hs-identifier hs-var">inRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960089"><span class="hs-identifier hs-var">outRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960101"><span class="hs-identifier hs-var">outCurTys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty2 -&gt; UrTy Var) -&gt; [Ty2] -&gt; [UrTy Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680960082"><span class="hs-identifier hs-var">arrIns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>          </span><span class="hs-comment">-- Packed types in the input now become (read-only) cursors.</span><span>
</span><span id="line-232"></span><span>          </span><span id="local-6989586621680960103"><span class="annot"><span class="annottext">newIns :: [UrTy Any]
</span><a href="#local-6989586621680960103"><span class="hs-identifier hs-var hs-var">newIns</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; UrTy Any) -&gt; [UrTy Var] -&gt; [UrTy Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Any -&gt; UrTy Var -&gt; UrTy Any
forall a1 a2. UrTy a1 -&gt; UrTy a2 -&gt; UrTy a1
</span><a href="Gibbon.L2.Syntax.html#constPacked"><span class="hs-identifier hs-var">constPacked</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680960102"><span class="hs-identifier hs-var">in_tys</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UrTy Any -&gt; Ty3) -&gt; [UrTy Any] -&gt; [Ty3]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Any]
</span><a href="#local-6989586621680960103"><span class="hs-identifier hs-var">newIns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960096"><span class="hs-identifier hs-var">newOut'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><span class="hs-comment">-- | Cursorize expressions NOT producing `Packed` values</span></span><span>
</span><span id="line-238"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-type">cursorizeExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-239"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-240"></span><span id="cursorizeExp"><span class="annot"><span class="annottext">cursorizeExp :: DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var hs-var">cursorizeExp</span></a></span></span><span> </span><span id="local-6989586621680960203"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680960204"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680960205"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680960206"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680960207"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680960208"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960208"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960208"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680960209"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960209"><span class="hs-identifier hs-var">v</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960209"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span> </span><span id="local-6989586621680960211"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960211"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960211"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span> </span><span id="local-6989586621680960213"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680960213"><span class="hs-identifier hs-var">c</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Char -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-var">CharE</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680960213"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span> </span><span id="local-6989586621680960215"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680960215"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Double -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-var">FloatE</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680960215"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span> </span><span id="local-6989586621680960217"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960217"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-var">LitSymE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960217"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeAppE"><span class="hs-identifier hs-var">cursorizeAppE</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960208"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2
</span><a href="Gibbon.Language.Syntax.html#RequestSizeOf"><span class="hs-identifier hs-var">RequestSizeOf</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621680960222"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960222"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680960223"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960223"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960222"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960223"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeExp: Unbound variable: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960223"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960227"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960227"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960227"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#SubPtr"><span class="hs-identifier hs-var">SubPtr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960223"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960223"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-256"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Exp3) -&gt; Int -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960227"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680960232"><span class="annot"><span class="annottext">Prim Ty2
</span><a href="#local-6989586621680960232"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span id="local-6989586621680960233"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960233"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prim Ty2 -&gt; Prim Ty3
</span><a href="Gibbon.L3.Syntax.html#toL3Prim"><span class="hs-identifier hs-var">toL3Prim</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2
</span><a href="#local-6989586621680960232"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Exp3] -&gt; Exp3) -&gt; PassM [Exp3] -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp3) -&gt; [Exp2] -&gt; PassM [Exp3]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960233"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960237"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960237"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960238"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960238"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960239"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960239"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ReadPackedFile"><span class="hs-identifier hs-type">ReadPackedFile</span></a></span><span> </span><span id="local-6989586621680960241"><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621680960241"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621680960242"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960242"><span class="hs-identifier hs-var">tyc</span></a></span></span><span> </span><span id="local-6989586621680960243"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960243"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680960244"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960244"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960245"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960245"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Bool
-&gt; Var
-&gt; Maybe [Char]
-&gt; [Char]
-&gt; Maybe Var
-&gt; Ty2
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeReadPackedFile"><span class="hs-identifier hs-var">cursorizeReadPackedFile</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960237"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621680960241"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960242"><span class="hs-identifier hs-var">tyc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960243"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960244"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960245"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960247"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960247"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960248"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960248"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960249"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960249"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680960251"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960251"><span class="hs-identifier hs-var">_ls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960252"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960252"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeProd"><span class="hs-identifier hs-var">cursorizeProd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960208"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960254"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960254"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960255"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960255"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960256"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960256"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960258"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960258"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960256"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>       </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeProj"><span class="hs-identifier hs-var">cursorizeProj</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960208"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960260"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960260"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960261"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960261"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960262"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960262"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960264"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960264"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeSpawn"><span class="hs-identifier hs-var">cursorizeSpawn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960208"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960266"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960266"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960267"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960267"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960268"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960268"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960270"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960270"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeSync"><span class="hs-identifier hs-var">cursorizeSync</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960208"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960272"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960272"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960273"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960273"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960274"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960274"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960275"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680960275"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960277"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960277"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960278"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960278"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960277"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960278"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>          </span><span id="local-6989586621680960279"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960279"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960275"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-280"></span><span>          </span><span id="local-6989586621680960280"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960280"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960278"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-281"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960281"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680960281"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960274"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960272"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680960281"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960279"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960280"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960283"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960283"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960284"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960284"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960285"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960285"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960286"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680960286"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960288"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960288"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960289"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960289"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960288"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960289"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>          </span><span id="local-6989586621680960290"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960290"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960286"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span id="local-6989586621680960291"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960291"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960289"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-290"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960292"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680960292"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960285"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960283"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680960292"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960290"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960291"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span id="local-6989586621680960293"><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2)
</span><a href="#local-6989586621680960293"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span id="local-6989586621680960294"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960294"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; (Var, [LocArg], Ty2, Exp2)
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeLet"><span class="hs-identifier hs-var">cursorizeLet</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2)
</span><a href="#local-6989586621680960293"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960294"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680960297"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960297"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680960298"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960298"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680960299"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960299"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; Exp3 -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3 -&gt; Exp3 -&gt; Exp3)
-&gt; PassM Exp3 -&gt; PassM (Exp3 -&gt; Exp3 -&gt; Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960297"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp3 -&gt; Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM (Exp3 -&gt; Exp3)
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960298"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960299"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680960300"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960300"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp3] -&gt; Exp3) -&gt; PassM [Exp3] -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp3) -&gt; [Exp2] -&gt; PassM [Exp3]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960300"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680960301"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960301"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680960302"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960302"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960301"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960302"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-comment">-- Eg. leftmost</span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680960304"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960304"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680960305"><span class="annot"><span class="annottext">[([Char], [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680960305"><span class="hs-identifier hs-var">brs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>      </span><span class="hs-comment">-- ASSUMPTION: scrt is flat</span><span>
</span><span id="line-304"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span>  </span><span id="local-6989586621680960306"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960306"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960304"><span class="hs-identifier hs-var">scrt</span></a></span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; [([Char], [(Var, ())], Exp3)] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [([Char], [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Exp3) -&gt; Var -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960306"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([([Char], [(Var, ())], Exp3)] -&gt; Exp3)
-&gt; PassM [([Char], [(Var, ())], Exp3)] -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><span class="annottext">(([Char], [(Var, LocArg)], Exp2)
 -&gt; PassM ([Char], [(Var, ())], Exp3))
-&gt; [([Char], [(Var, LocArg)], Exp2)]
-&gt; PassM [([Char], [(Var, ())], Exp3)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Bool
-&gt; Var
-&gt; ([Char], [(Var, LocArg)], Exp2)
-&gt; PassM ([Char], [(Var, ())], Exp3)
forall t.
DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Bool
-&gt; Var
-&gt; ([Char], [(Var, LocArg)], Exp2)
-&gt; PassM ([Char], [t], Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#unpackDataCon"><span class="hs-identifier hs-var">unpackDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960306"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Char], [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680960305"><span class="hs-identifier hs-var">brs</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeExp: Should not have encountered DataConE if type is not packed: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#ndoc"><span class="hs-identifier hs-var">ndoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960208"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680960311"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960311"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680960312"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960312"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680960313"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960313"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; Ty3 -&gt; Bool -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Ty3 -&gt; Bool -&gt; Exp3)
-&gt; PassM Exp3 -&gt; PassM (Ty3 -&gt; Bool -&gt; Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960311"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Ty3 -&gt; Bool -&gt; Exp3) -&gt; PassM Ty3 -&gt; PassM (Bool -&gt; Exp3)
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; PassM Ty3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960312"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PassM (Bool -&gt; Exp3) -&gt; PassM Bool -&gt; PassM Exp3
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PassM Bool
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960313"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680960315"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960315"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680960316"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960316"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>      </span><span id="local-6989586621680960317"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960317"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960315"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960316"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-314"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-var">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960315"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960317"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeExp: Unbound SpawnE&quot;</span></span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-type">SyncE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeExp: Unbound SyncE&quot;</span></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-comment">-- Eg. leftmost</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680960319"><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680960319"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-321"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680960319"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AddFixed"><span class="hs-identifier hs-type">AddFixed</span></a></span><span> </span><span id="local-6989586621680960321"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960321"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680960322"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960322"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">L3.AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960321"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">L3.LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960322"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span> </span><span id="local-6989586621680960325"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960325"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680960326"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960326"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-324"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960325"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960326"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>              </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">L3.MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp3] -&gt; Exp3) -&gt; [Exp3] -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960328"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680960328"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960328"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960325"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; [Exp3] -&gt; [Exp3]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960326"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">StartOfPkdCursor</span></a></span><span> </span><span id="local-6989586621680960330"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960330"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960330"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span> </span><span id="local-6989586621680960332"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960332"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680960333"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960333"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#TagCursor"><span class="hs-identifier hs-var">L3.TagCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960332"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960333"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-comment">-- All locations are transformed into cursors here. Location arithmetic</span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-comment">-- is expressed in terms of corresponding cursor operations.</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-comment">-- See `cursorizeLocExp`</span><span>
</span><span id="line-335"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680960335"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680960336"><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680960336"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621680960337"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960337"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-336"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960338"><span class="annot"><span class="annottext">rhs_either :: Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
</span><a href="#local-6989586621680960338"><span class="hs-identifier hs-var hs-var">rhs_either</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Var
-&gt; PreLocExp LocArg
-&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeLocExp"><span class="hs-identifier hs-var">cursorizeLocExp</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680960336"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-337"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621680960340"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960340"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960341"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960341"><span class="hs-identifier hs-var">tenv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; DepEnv -&gt; Maybe [(Var, [()], Ty3, Exp3)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-338"></span><span>                               </span><span class="annot"><span class="annottext">Maybe [(Var, [()], Ty3, Exp3)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>                               </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960342"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960342"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960343"><span class="annot"><span class="annottext">extended :: TyEnv Ty2
</span><a href="#local-6989586621680960343"><span class="hs-identifier hs-var hs-var">extended</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960344"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960344"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960344"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960342"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-340"></span><span>                                          </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960342"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960343"><span class="hs-identifier hs-var">extended</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
</span><a href="#local-6989586621680960338"><span class="hs-identifier hs-var">rhs_either</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-342"></span><span>            </span><span class="hs-comment">-- Check if the location is already bound before. If so, don't</span><span>
</span><span id="line-343"></span><span>            </span><span class="hs-comment">-- create a duplicate binding. This only happens when we</span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-comment">-- have indirection _and_ a end-witness for a particular value.</span><span>
</span><span id="line-345"></span><span>            </span><span class="hs-comment">-- For example, consider a pattern like</span><span>
</span><span id="line-346"></span><span>            </span><span class="hs-comment">--     (Node^ [(ind_y2, loc_ind_y2), (x1, loc_x1), (y2, loc_y2)] BODY)</span><span>
</span><span id="line-347"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-348"></span><span>            </span><span class="hs-comment">-- occuring in a function like sum-tree.</span><span>
</span><span id="line-349"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-350"></span><span>            </span><span class="hs-comment">-- While unpacking this constructor, we bind y2 to ind_y2.</span><span>
</span><span id="line-351"></span><span>            </span><span class="hs-comment">-- But since sum-tree traverses it's input, we will enconter</span><span>
</span><span id="line-352"></span><span>            </span><span class="hs-comment">-- (y2 = end_x1) sometime later in the AST (due to RouteEnds).</span><span>
</span><span id="line-353"></span><span>            </span><span class="hs-comment">-- We just ignore the second binding for now.</span><span>
</span><span id="line-354"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-355"></span><span>            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960346"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960346"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960347"><span class="annot"><span class="annottext">[Binds Exp3]
</span><a href="#local-6989586621680960347"><span class="hs-identifier hs-var">bnds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960348"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960348"><span class="hs-identifier hs-var">tenv''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960349"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960349"><span class="hs-identifier hs-var">senv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960350"><span class="annot"><span class="annottext">tenv''' :: TyEnv Ty2
</span><a href="#local-6989586621680960350"><span class="hs-identifier hs-var hs-var">tenv'''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960341"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960348"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-357"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680960336"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-358"></span><span>                </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndLE"><span class="hs-identifier hs-type">FromEndLE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Bool
</span><a href="Gibbon.Passes.Cursorize.html#isBound"><span class="hs-identifier hs-var">isBound</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-360"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960350"><span class="hs-identifier hs-var">tenv'''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960349"><span class="hs-identifier hs-var">senv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960337"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-361"></span><span>                  </span><span class="hs-comment">-- Discharge bindings that were waiting on 'loc'.</span><span>
</span><span id="line-362"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
[Binds Exp3]
</span><a href="#local-6989586621680960347"><span class="hs-identifier hs-var">bnds'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960346"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960340"><span class="hs-identifier hs-var">bnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-363"></span><span>                         </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960350"><span class="hs-identifier hs-var">tenv'''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960349"><span class="hs-identifier hs-var">senv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960337"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-364"></span><span>                </span><span class="hs-comment">-- Discharge bindings that were waiting on 'loc'.</span><span>
</span><span id="line-365"></span><span>                </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
[Binds Exp3]
</span><a href="#local-6989586621680960347"><span class="hs-identifier hs-var">bnds'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960346"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960340"><span class="hs-identifier hs-var">bnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-366"></span><span>                       </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960335"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960350"><span class="hs-identifier hs-var">tenv'''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960337"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-367"></span><span>            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680960353"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960353"><span class="hs-identifier hs-var">denv'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960353"><span class="hs-identifier hs-var">denv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960341"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960337"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-comment">-- Exactly same as cursorizePackedExp</span><span>
</span><span id="line-370"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680960355"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960355"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680960356"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680960356"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960357"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960357"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Region -&gt; RegionSize -&gt; [(Var, [()], Ty3, Exp3)]
</span><a href="Gibbon.Passes.Cursorize.html#regionToBinds"><span class="hs-identifier hs-var">regionToBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960355"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680960356"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960357"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680960360"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960360"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680960361"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680960361"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960362"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960362"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-374"></span><span>          </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Region -&gt; RegionSize -&gt; [(Var, [()], Ty3, Exp3)]
</span><a href="Gibbon.Passes.Cursorize.html#regionToBinds"><span class="hs-identifier hs-var">regionToBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960360"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680960361"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960362"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span> </span><span id="local-6989586621680960364"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960364"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680960365"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960365"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621680960366"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960366"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Var -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. Int -&gt; Var -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#BoundsCheck"><span class="hs-identifier hs-var">L3.BoundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960364"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960365"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960366"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-type">FromEndE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeExp: TODO FromEndE&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680960319"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeExp: Unexpected IndirectionE&quot;</span></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>        </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="Gibbon.L2.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3
forall loc dec. E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">L3.GetCilkWorkerNum</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span id="local-6989586621680960371"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960371"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621680960372"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960372"><span class="hs-identifier hs-var">bod</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; (Exp3 -&gt; E3Ext () Ty3) -&gt; Exp3 -&gt; Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. [Var] -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#LetAvail"><span class="hs-identifier hs-var">L3.LetAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960371"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960372"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span> </span><span id="local-6989586621680960374"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960374"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680960375"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960375"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char] -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; [Char] -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-var">L3.AllocateTagHere</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960374"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960375"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span> </span><span id="local-6989586621680960377"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960377"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-var">L3.AllocateScalarsHere</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960377"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span> </span><span id="local-6989586621680960378"><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680960378"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680960379"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960379"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680960380"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960380"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680960381"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960381"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality -&gt; Var -&gt; Var -&gt; [Char] -&gt; E3Ext () Ty3
forall loc dec. SSModality -&gt; Var -&gt; Var -&gt; [Char] -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#SSPush"><span class="hs-identifier hs-var">L3.SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680960378"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960379"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960380"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960381"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span> </span><span id="local-6989586621680960382"><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680960382"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680960383"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960383"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680960384"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960384"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality -&gt; Var -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. SSModality -&gt; Var -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#SSPop"><span class="hs-identifier hs-var">L3.SSPop</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680960382"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960383"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960384"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TODO: cursorizeExp MapE&quot;</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TODO: cursorizeExp FoldE&quot;</span></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621680960235"><span class="annot"><span class="annottext">go :: Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960235"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960203"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960204"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960205"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960206"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960207"><span class="hs-identifier hs-var">senv</span></a></span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-comment">-- Cursorize expressions producing `Packed` values</span><span>
</span><span id="line-401"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-type">cursorizePackedExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-402"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-type">DiExp</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span id="cursorizePackedExp"><span class="annot"><span class="annottext">cursorizePackedExp :: DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var hs-var">cursorizePackedExp</span></a></span></span><span> </span><span id="local-6989586621680960580"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680960581"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680960582"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680960583"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680960584"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680960585"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">-- Here the allocation has already been performed:</span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-comment">-- To follow the calling convention, we are reponsible for tagging on the</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-comment">-- end here:</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680960586"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960586"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960587"><span class="annot"><span class="annottext">ty :: Ty2
</span><a href="#local-6989586621680960587"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960586"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-410"></span><span>                 </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960588"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960588"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960588"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-411"></span><span>                 </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Ty2
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Ty2) -&gt; [Char] -&gt; Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960586"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; not found.&quot;</span></span><span>
</span><span id="line-412"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960587"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; [Exp3] -&gt; DiExp Exp3
</span><a href="Gibbon.Passes.Cursorize.html#mkDi"><span class="hs-identifier hs-var">mkDi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960586"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960586"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960586"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span> </span><span id="local-6989586621680960591"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960591"><span class="hs-identifier hs-var">_n</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM (DiExp Exp3)) -&gt; [Char] -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Shouldn't encounter LitE in packed context:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span> </span><span id="local-6989586621680960592"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680960592"><span class="hs-identifier hs-var">_n</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM (DiExp Exp3)) -&gt; [Char] -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Shouldn't encounter CharE in packed context:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM (DiExp Exp3)) -&gt; [Char] -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Shouldn't encounter FloatE in packed context:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-419"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span> </span><span id="local-6989586621680960593"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960593"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM (DiExp Exp3)) -&gt; [Char] -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Shouldn't encounter LitSymE in packed context:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; PassM Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeAppE"><span class="hs-identifier hs-var">cursorizeAppE</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>    </span><span class="hs-comment">-- DictLookup returns a packed value bound to a free location.</span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-comment">-- PrimAppE (DictLookupP (PackedTy _ ploc)) vs -&gt;</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-comment">--     do vs' &lt;- forM vs $ \v -&gt; cursorizeExp ddfs fundefs denv tenv v</span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-comment">--        return $ mkDi (PrimAppE (DictLookupP CursorTy) vs') [ Ext NullCursor ]</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM (DiExp Exp3)) -&gt; [Char] -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizePackedExp: unexpected PrimAppE in packed context:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-comment">-- The only (other) primitive that returns packed data is ReadPackedFile:</span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-comment">-- This is simpler than TimeIt below.  While it's out-of-line,</span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-comment">-- it doesn't need memory allocation (NewBuffer/ScopedBuffer).</span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-comment">-- This is more like the witness case below.</span><span>
</span><span id="line-434"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960594"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960594"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960595"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960595"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960596"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960596"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ReadPackedFile"><span class="hs-identifier hs-type">ReadPackedFile</span></a></span><span> </span><span id="local-6989586621680960597"><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621680960597"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621680960598"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960598"><span class="hs-identifier hs-var">tyc</span></a></span></span><span> </span><span id="local-6989586621680960599"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960599"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680960600"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960600"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960601"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960601"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-435"></span><span>       </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; PassM Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Bool
-&gt; Var
-&gt; Maybe [Char]
-&gt; [Char]
-&gt; Maybe Var
-&gt; Ty2
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeReadPackedFile"><span class="hs-identifier hs-var">cursorizeReadPackedFile</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960594"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621680960597"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960598"><span class="hs-identifier hs-var">tyc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960599"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960600"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960601"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960603"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960603"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960604"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960604"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960605"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960605"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictLookupP"><span class="hs-identifier hs-type">DictLookupP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960607"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960607"><span class="hs-identifier hs-var">ploc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960608"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960608"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960609"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960609"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-438"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680960610"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960610"><span class="hs-identifier hs-var">vs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Exp2] -&gt; (Exp2 -&gt; PassM Exp3) -&gt; PassM [Exp3]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960608"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">((Exp2 -&gt; PassM Exp3) -&gt; PassM [Exp3])
-&gt; (Exp2 -&gt; PassM Exp3) -&gt; PassM [Exp3]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680960611"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960611"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960611"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-439"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960612"><span class="annot"><span class="annottext">bnd :: Exp3 -&gt; Exp3
</span><a href="#local-6989586621680960612"><span class="hs-identifier hs-var hs-var">bnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960607"><span class="hs-identifier hs-var">ploc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Prim Ty3
forall ty. ty -&gt; Prim ty
</span><a href="Gibbon.Language.Syntax.html#DictLookupP"><span class="hs-identifier hs-var">DictLookupP</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960610"><span class="hs-identifier hs-var">vs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>                            </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960603"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960607"><span class="hs-identifier hs-var">ploc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-441"></span><span>               </span><span id="local-6989586621680960613"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680960613"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960607"><span class="hs-identifier hs-var">ploc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TyEnv Ty2 -&gt; TyEnv Ty2) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960603"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-442"></span><span>           </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; DiExp Exp3
forall ex. (ex -&gt; ex) -&gt; DiExp ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-var">onDi</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; Exp3
</span><a href="#local-6989586621680960612"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; DiExp Exp3)
-&gt; PassM (DiExp Exp3) -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960613"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960609"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960616"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960616"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960617"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960617"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960618"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960618"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680960619"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960619"><span class="hs-identifier hs-var">_ls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960620"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960620"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-445"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; PassM Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeProd"><span class="hs-identifier hs-var">cursorizeProd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960621"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960621"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960622"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960622"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960623"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960623"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960624"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960624"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960623"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; PassM Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeProj"><span class="hs-identifier hs-var">cursorizeProj</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680960625"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960625"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960626"><span class="annot"><span class="annottext">tys :: [Ty2]
</span><a href="#local-6989586621680960626"><span class="hs-identifier hs-var hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Ty2) -&gt; [Exp2] -&gt; [Ty2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy Ty2)
Map Var (ArrowTy2 Ty2)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960625"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-453"></span><span>      </span><span id="local-6989586621680960629"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960629"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Ty2, Exp2)] -&gt; ((Ty2, Exp2) -&gt; PassM Exp3) -&gt; PassM [Exp3]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty2] -&gt; [Exp2] -&gt; [(Ty2, Exp2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680960626"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960625"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Ty2, Exp2) -&gt; PassM Exp3) -&gt; PassM [Exp3])
-&gt; ((Ty2, Exp2) -&gt; PassM Exp3) -&gt; PassM [Exp3]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680960630"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960630"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960631"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960631"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-454"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960630"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-455"></span><span>                  </span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960630"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960631"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-456"></span><span>                  </span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960631"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-457"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960632"><span class="annot"><span class="annottext">rhs' :: Exp3
</span><a href="#local-6989586621680960632"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960629"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-458"></span><span>      </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960632"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-comment">-- Not sure if we need to replicate all the checks from Cursorize1</span><span>
</span><span id="line-461"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680960633"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960633"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680960634"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960634"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; (Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960633"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3)
-&gt; (DiExp Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; DiExp Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; DiExp Exp3)
-&gt; PassM (DiExp Exp3) -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960634"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960635"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960635"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960636"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960636"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960637"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960637"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960638"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960638"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-464"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; PassM Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeSpawn"><span class="hs-identifier hs-var">cursorizeSpawn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960639"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960639"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960640"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960640"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960641"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960641"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960642"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960642"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; PassM Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeSync"><span class="hs-identifier hs-var">cursorizeSync</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960585"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960643"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960643"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960644"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960644"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960645"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960645"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960646"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680960646"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960647"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960647"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960648"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960648"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-470"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960647"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-471"></span><span>        </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960648"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-472"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>          </span><span id="local-6989586621680960649"><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960649"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960646"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-474"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960650"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680960650"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960645"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>          </span><span id="local-6989586621680960651"><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960651"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960643"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960645"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960648"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-476"></span><span>          </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960643"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680960650"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960649"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960651"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960652"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960652"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960653"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960653"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960654"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960654"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960655"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680960655"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960656"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960656"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960657"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960657"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-479"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960656"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960657"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>          </span><span id="local-6989586621680960658"><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960658"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960655"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-483"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960659"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680960659"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960654"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>          </span><span id="local-6989586621680960660"><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960660"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960652"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960654"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960657"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-485"></span><span>          </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960652"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680960659"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960658"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960660"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span id="local-6989586621680960661"><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2)
</span><a href="#local-6989586621680960661"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span id="local-6989586621680960662"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960662"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; PassM Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; (Var, [LocArg], Ty2, Exp2)
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeLet"><span class="hs-identifier hs-var">cursorizeLet</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2)
</span><a href="#local-6989586621680960661"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960662"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-comment">-- Here we route the dest cursor to both braches.  We switch</span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-comment">-- back to the other mode for the (non-packed) test condition.</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680960663"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960663"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680960664"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960664"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680960665"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960665"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-492"></span><span>      </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-type">Di</span></a></span><span> </span><span id="local-6989586621680960666"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960666"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960664"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-493"></span><span>      </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-type">Di</span></a></span><span> </span><span id="local-6989586621680960667"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960667"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960665"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-494"></span><span>      </span><span id="local-6989586621680960668"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960668"><span class="hs-identifier hs-var">a'</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960663"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-495"></span><span>      </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; Exp3 -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960668"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960666"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960667"><span class="hs-identifier hs-var">c'</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-comment">-- A case expression is eventually transformed into a ReadTag + switch stmt.</span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-comment">-- We first retrieve the cursor referred to by the scrutinee, and unpack</span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-comment">-- the first bound variable 1 byte after that cursor. Thats all we need to do</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-comment">-- here, because we've already computed other locations in InferLocations and</span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-comment">-- RouteEnds</span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680960669"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960669"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680960670"><span class="annot"><span class="annottext">[([Char], [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680960670"><span class="hs-identifier hs-var">brs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-503"></span><span>      </span><span class="hs-comment">-- ASSUMPTION: scrutinee is always flat</span><span>
</span><span id="line-504"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680960671"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960671"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960669"><span class="hs-identifier hs-var">scrt</span></a></span><span>
</span><span id="line-505"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3)
-&gt; ([([Char], [(Var, ())], Exp3)] -&gt; Exp3)
-&gt; [([Char], [(Var, ())], Exp3)]
-&gt; DiExp Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-506"></span><span>        </span><span class="annot"><span class="annottext">Exp3 -&gt; [([Char], [(Var, ())], Exp3)] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [([Char], [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Exp3) -&gt; Var -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960671"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([([Char], [(Var, ())], Exp3)] -&gt; DiExp Exp3)
-&gt; PassM [([Char], [(Var, ())], Exp3)] -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-507"></span><span>          </span><span class="annot"><span class="annottext">(([Char], [(Var, LocArg)], Exp2)
 -&gt; PassM ([Char], [(Var, ())], Exp3))
-&gt; [([Char], [(Var, LocArg)], Exp2)]
-&gt; PassM [([Char], [(Var, ())], Exp3)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Bool
-&gt; Var
-&gt; ([Char], [(Var, LocArg)], Exp2)
-&gt; PassM ([Char], [(Var, ())], Exp3)
forall t.
DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Bool
-&gt; Var
-&gt; ([Char], [(Var, LocArg)], Exp2)
-&gt; PassM ([Char], [t], Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#unpackDataCon"><span class="hs-identifier hs-var">unpackDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960671"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Char], [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680960670"><span class="hs-identifier hs-var">brs</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680960672"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960672"><span class="hs-identifier hs-var">slocarg</span></a></span></span><span> </span><span id="local-6989586621680960673"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960673"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621680960674"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960674"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-510"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960675"><span class="annot"><span class="annottext">sloc :: Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var hs-var">sloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960672"><span class="hs-identifier hs-var">slocarg</span></a></span><span>
</span><span id="line-511"></span><span>          </span><span class="hs-comment">-- Return (start,end) cursors</span><span>
</span><span id="line-512"></span><span>          </span><span class="hs-comment">-- The final return value lives at the position of the out cursors:</span><span>
</span><span id="line-513"></span><span>          </span><span class="annot"><a href="#local-6989586621680960676"><span class="hs-identifier hs-type">go2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-514"></span><span>          </span><span id="local-6989586621680960676"><span class="annot"><span class="annottext">go2 :: Bool -&gt; Var -&gt; [(Exp2, Ty2)] -&gt; PassM Exp3
</span><a href="#local-6989586621680960676"><span class="hs-identifier hs-var hs-var">go2</span></a></span></span><span> </span><span id="local-6989586621680960677"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960677"><span class="hs-identifier hs-var">marker_added</span></a></span></span><span> </span><span id="local-6989586621680960678"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960678"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-515"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960677"><span class="hs-identifier hs-var">marker_added</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-517"></span><span>              </span><span id="local-6989586621680960680"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960680"><span class="hs-identifier hs-var">end_scalars_alloc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;end_scalars_alloc&quot;</span></span><span>
</span><span id="line-518"></span><span>              </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960680"><span class="hs-identifier hs-var">end_scalars_alloc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#EndScalarsAllocation"><span class="hs-identifier hs-var">EndScalarsAllocation</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960678"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960678"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>          </span><span class="annot"><a href="#local-6989586621680960676"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span id="local-6989586621680960683"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960683"><span class="hs-identifier hs-var">marker_added</span></a></span></span><span> </span><span id="local-6989586621680960684"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960684"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680960685"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960685"><span class="hs-identifier hs-var">rnd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span id="local-6989586621680960686"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960686"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680960687"><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680960687"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-523"></span><span>            </span><span id="local-6989586621680960688"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;writecur&quot;</span></span><span>
</span><span id="line-524"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960686"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-525"></span><span>              </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960686"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>                 </span><span id="local-6989586621680960689"><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960689"><span class="hs-identifier hs-var">rnd'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960685"><span class="hs-identifier hs-var">rnd</span></a></span><span>
</span><span id="line-528"></span><span>                 </span><span id="local-6989586621680960690"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960690"><span class="hs-identifier hs-var">end_scalars_alloc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;end_scalars_alloc&quot;</span></span><span>
</span><span id="line-529"></span><span>                 </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960683"><span class="hs-identifier hs-var">marker_added</span></a></span><span>
</span><span id="line-530"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960690"><span class="hs-identifier hs-var">end_scalars_alloc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#EndScalarsAllocation"><span class="hs-identifier hs-var">EndScalarsAllocation</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; Exp3
forall a. a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; (Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-532"></span><span>                   </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
</span><a href="Gibbon.Passes.Cursorize.html#projEnds"><span class="hs-identifier hs-var">projEnds</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960689"><span class="hs-identifier hs-var">rnd'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-533"></span><span>                   </span><span class="annot"><span class="annottext">Bool -&gt; Var -&gt; [(Exp2, Ty2)] -&gt; PassM Exp3
</span><a href="#local-6989586621680960676"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680960687"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>              </span><span class="hs-comment">-- Int, Float, Sym, or Bool</span><span>
</span><span id="line-536"></span><span>              </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isScalarTy"><span class="hs-identifier hs-var">isScalarTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960686"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-537"></span><span>                </span><span id="local-6989586621680960694"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960694"><span class="hs-identifier hs-var">rnd'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960685"><span class="hs-identifier hs-var">rnd</span></a></span><span>
</span><span id="line-538"></span><span>                </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar -&gt; Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec.
Scalar -&gt; Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#WriteScalar"><span class="hs-identifier hs-var">WriteScalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Scalar
forall a. Out a =&gt; UrTy a -&gt; Scalar
</span><a href="Gibbon.L3.Syntax.html#mkScalar"><span class="hs-identifier hs-var">mkScalar</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960686"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960684"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960694"><span class="hs-identifier hs-var">rnd'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-539"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; Var -&gt; [(Exp2, Ty2)] -&gt; PassM Exp3
</span><a href="#local-6989586621680960676"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960683"><span class="hs-identifier hs-var">marker_added</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680960687"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span>              </span><span class="hs-comment">-- Write a pointer to a vector</span><span>
</span><span id="line-542"></span><span>              </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-type">VectorTy</span></a></span><span> </span><span id="local-6989586621680960697"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960697"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>                </span><span id="local-6989586621680960698"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960698"><span class="hs-identifier hs-var">rnd'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960685"><span class="hs-identifier hs-var">rnd</span></a></span><span>
</span><span id="line-544"></span><span>                </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; Ty3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#WriteVector"><span class="hs-identifier hs-var">WriteVector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960684"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960698"><span class="hs-identifier hs-var">rnd'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960697"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-545"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; Var -&gt; [(Exp2, Ty2)] -&gt; PassM Exp3
</span><a href="#local-6989586621680960676"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960683"><span class="hs-identifier hs-var">marker_added</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680960687"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>              </span><span class="hs-comment">-- Write a pointer to a vector</span><span>
</span><span id="line-548"></span><span>              </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-type">ListTy</span></a></span><span> </span><span id="local-6989586621680960700"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960700"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>                </span><span id="local-6989586621680960701"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960701"><span class="hs-identifier hs-var">rnd'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960685"><span class="hs-identifier hs-var">rnd</span></a></span><span>
</span><span id="line-550"></span><span>                </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; Ty3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#WriteList"><span class="hs-identifier hs-var">WriteList</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960684"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960701"><span class="hs-identifier hs-var">rnd'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960700"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-551"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; Var -&gt; [(Exp2, Ty2)] -&gt; PassM Exp3
</span><a href="#local-6989586621680960676"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960683"><span class="hs-identifier hs-var">marker_added</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680960687"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>              </span><span class="hs-comment">-- shortcut pointer</span><span>
</span><span id="line-554"></span><span>              </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-555"></span><span>                </span><span id="local-6989586621680960703"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960703"><span class="hs-identifier hs-var">rnd'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960685"><span class="hs-identifier hs-var">rnd</span></a></span><span>
</span><span id="line-556"></span><span>                </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#WriteTaggedCursor"><span class="hs-identifier hs-var">WriteTaggedCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960684"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960703"><span class="hs-identifier hs-var">rnd'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-557"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; Var -&gt; [(Exp2, Ty2)] -&gt; PassM Exp3
</span><a href="#local-6989586621680960676"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960683"><span class="hs-identifier hs-var">marker_added</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960688"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680960687"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-558"></span><span>              </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unknown type encounterred while cursorizing DataConE. Type was &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960686"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span>      </span><span id="local-6989586621680960706"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960706"><span class="hs-identifier hs-var">writetag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;writetag&quot;</span></span><span>
</span><span id="line-561"></span><span>      </span><span id="local-6989586621680960707"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960707"><span class="hs-identifier hs-var">after_tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;after_tag&quot;</span></span><span>
</span><span id="line-562"></span><span>      </span><span id="local-6989586621680960708"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960708"><span class="hs-identifier hs-var">start_tag_alloc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;start_tag_alloc&quot;</span></span><span>
</span><span id="line-563"></span><span>      </span><span id="local-6989586621680960709"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960709"><span class="hs-identifier hs-var">end_tag_alloc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;end_tag_alloc&quot;</span></span><span>
</span><span id="line-564"></span><span>      </span><span id="local-6989586621680960710"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960710"><span class="hs-identifier hs-var">start_scalars_alloc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;start_scalars_alloc&quot;</span></span><span>
</span><span id="line-565"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; (Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-566"></span><span>        </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960708"><span class="hs-identifier hs-var">start_tag_alloc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#StartTagAllocation"><span class="hs-identifier hs-var">StartTagAllocation</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; (Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-567"></span><span>        </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960706"><span class="hs-identifier hs-var">writetag</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. [Char] -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#WriteTag"><span class="hs-identifier hs-var">WriteTag</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960673"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; (Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-568"></span><span>        </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960709"><span class="hs-identifier hs-var">end_tag_alloc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#EndTagAllocation"><span class="hs-identifier hs-var">EndTagAllocation</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; (Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-569"></span><span>        </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960710"><span class="hs-identifier hs-var">start_scalars_alloc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#StartScalarsAllocation"><span class="hs-identifier hs-var">StartScalarsAllocation</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; (Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-570"></span><span>        </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960707"><span class="hs-identifier hs-var">after_tag</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960675"><span class="hs-identifier hs-var">sloc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">L3.LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; PassM Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-571"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Var -&gt; [(Exp2, Ty2)] -&gt; PassM Exp3
</span><a href="#local-6989586621680960676"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960707"><span class="hs-identifier hs-var">after_tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp2] -&gt; [Ty2] -&gt; [(Exp2, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960674"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; [Char] -&gt; [Ty2]
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960673"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680960716"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960716"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680960717"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960717"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680960718"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960718"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-574"></span><span>      </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-type">Di</span></a></span><span> </span><span id="local-6989586621680960719"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960719"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960716"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-575"></span><span>      </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; Ty3 -&gt; Bool -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960719"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960717"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960718"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680960720"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960720"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680960721"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960721"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-578"></span><span>      </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-type">Di</span></a></span><span> </span><span id="local-6989586621680960722"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960722"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960720"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960721"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-579"></span><span>      </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-var">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960720"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960722"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizePackedExp: Unbound SpawnE&quot;</span></span><span>
</span><span id="line-582"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-type">SyncE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizePackedExp: Unbound SyncE&quot;</span></span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680960723"><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680960723"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680960723"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-comment">-- All locations are transformed into cursors here. Location arithmetic</span><span>
</span><span id="line-587"></span><span>        </span><span class="hs-comment">-- is expressed in terms of corresponding cursor operations.</span><span>
</span><span id="line-588"></span><span>        </span><span class="hs-comment">-- See `cursorizeLocExp`</span><span>
</span><span id="line-589"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680960724"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680960725"><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680960725"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621680960726"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960726"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960727"><span class="annot"><span class="annottext">rhs_either :: Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
</span><a href="#local-6989586621680960727"><span class="hs-identifier hs-var hs-var">rhs_either</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Var
-&gt; PreLocExp LocArg
-&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeLocExp"><span class="hs-identifier hs-var">cursorizeLocExp</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680960725"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-591"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621680960728"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960728"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960729"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960729"><span class="hs-identifier hs-var">tenv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; DepEnv -&gt; Maybe [(Var, [()], Ty3, Exp3)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-592"></span><span>                               </span><span class="annot"><span class="annottext">Maybe [(Var, [()], Ty3, Exp3)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>                               </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960730"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960730"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960731"><span class="annot"><span class="annottext">extended :: TyEnv Ty2
</span><a href="#local-6989586621680960731"><span class="hs-identifier hs-var hs-var">extended</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960732"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960732"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960732"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960730"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-594"></span><span>                                          </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960730"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960731"><span class="hs-identifier hs-var">extended</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
</span><a href="#local-6989586621680960727"><span class="hs-identifier hs-var">rhs_either</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-596"></span><span>            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960733"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960733"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960734"><span class="annot"><span class="annottext">[Binds Exp3]
</span><a href="#local-6989586621680960734"><span class="hs-identifier hs-var">bnds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960735"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960735"><span class="hs-identifier hs-var">tenv''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960736"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960736"><span class="hs-identifier hs-var">senv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-597"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960737"><span class="annot"><span class="annottext">tenv''' :: TyEnv Ty2
</span><a href="#local-6989586621680960737"><span class="hs-identifier hs-var hs-var">tenv'''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960729"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960735"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-598"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680960725"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-599"></span><span>                </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndLE"><span class="hs-identifier hs-type">FromEndLE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-600"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Bool
</span><a href="Gibbon.Passes.Cursorize.html#isBound"><span class="hs-identifier hs-var">isBound</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-601"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960737"><span class="hs-identifier hs-var">tenv'''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960736"><span class="hs-identifier hs-var">senv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960726"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-602"></span><span>                    </span><span class="hs-comment">-- Discharge bindings that were waiting on 'loc'.</span><span>
</span><span id="line-603"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; DiExp Exp3
forall ex. (ex -&gt; ex) -&gt; DiExp ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-var">onDi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
[Binds Exp3]
</span><a href="#local-6989586621680960734"><span class="hs-identifier hs-var">bnds'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960733"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960728"><span class="hs-identifier hs-var">bnds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; DiExp Exp3)
-&gt; PassM (DiExp Exp3) -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-604"></span><span>                         </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960729"><span class="hs-identifier hs-var">tenv'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960736"><span class="hs-identifier hs-var">senv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960726"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-605"></span><span>                </span><span class="hs-comment">-- Discharge bindings that were waiting on 'loc'.</span><span>
</span><span id="line-606"></span><span>                </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; DiExp Exp3
forall ex. (ex -&gt; ex) -&gt; DiExp ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-var">onDi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
[Binds Exp3]
</span><a href="#local-6989586621680960734"><span class="hs-identifier hs-var">bnds'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960733"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960728"><span class="hs-identifier hs-var">bnds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; DiExp Exp3)
-&gt; PassM (DiExp Exp3) -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-607"></span><span>                       </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960724"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960737"><span class="hs-identifier hs-var">tenv'''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960736"><span class="hs-identifier hs-var">senv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960726"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-608"></span><span>            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680960738"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960738"><span class="hs-identifier hs-var">denv'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; DiExp Exp3
forall ex. (ex -&gt; ex) -&gt; DiExp ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-var">onDi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960728"><span class="hs-identifier hs-var">bnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; DiExp Exp3)
-&gt; PassM (DiExp Exp3) -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-609"></span><span>                            </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960738"><span class="hs-identifier hs-var">denv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960729"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960726"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">StartOfPkdCursor</span></a></span><span> </span><span id="local-6989586621680960739"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960739"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960739"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span> </span><span id="local-6989586621680960740"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960740"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680960741"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960741"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#TagCursor"><span class="hs-identifier hs-var">L3.TagCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960740"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960741"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>        </span><span class="hs-comment">-- ASSUMPTION: RetE forms are inserted at the tail position of functions,</span><span>
</span><span id="line-617"></span><span>        </span><span class="hs-comment">-- and we safely just return ends-witnesses &amp; ends of the dilated expressions</span><span>
</span><span id="line-618"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span> </span><span id="local-6989586621680960742"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960742"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680960743"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960743"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-619"></span><span>          </span><span id="local-6989586621680960744"><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960744"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960743"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960742"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-621"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960744"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-622"></span><span>            </span><span class="hs-special">[</span><span id="local-6989586621680960745"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960745"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; [Exp3] -&gt; DiExp Exp3
</span><a href="Gibbon.Passes.Cursorize.html#mkDi"><span class="hs-identifier hs-var">mkDi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960745"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960744"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-623"></span><span>            </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">L3.MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp3] -&gt; Exp3) -&gt; [Exp3] -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LocArg -&gt; [Exp3] -&gt; [Exp3]) -&gt; [Exp3] -&gt; [LocArg] -&gt; [Exp3]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680960747"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960747"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680960748"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960748"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960747"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">Exp3 -&gt; [Exp3] -&gt; [Exp3]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960748"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680960744"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960742"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680960749"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960749"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680960750"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680960750"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960751"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960751"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-626"></span><span>          </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; DiExp Exp3
forall ex. (ex -&gt; ex) -&gt; DiExp ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-var">onDi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Region -&gt; RegionSize -&gt; [(Var, [()], Ty3, Exp3)]
</span><a href="Gibbon.Passes.Cursorize.html#regionToBinds"><span class="hs-identifier hs-var">regionToBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960749"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680960750"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; DiExp Exp3)
-&gt; PassM (DiExp Exp3) -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960751"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680960752"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960752"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680960753"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680960753"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680960754"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960754"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-629"></span><span>          </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; DiExp Exp3
forall ex. (ex -&gt; ex) -&gt; DiExp ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-var">onDi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Region -&gt; RegionSize -&gt; [(Var, [()], Ty3, Exp3)]
</span><a href="Gibbon.Passes.Cursorize.html#regionToBinds"><span class="hs-identifier hs-var">regionToBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960752"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680960753"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; DiExp Exp3)
-&gt; PassM (DiExp Exp3) -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960754"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-type">FromEndE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM (DiExp Exp3)) -&gt; [Char] -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizePackedExp: TODO &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680960723"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span> </span><span id="local-6989586621680960755"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960755"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680960756"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960756"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621680960757"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960757"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; PassM (DiExp Exp3))
-&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Var -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. Int -&gt; Var -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#BoundsCheck"><span class="hs-identifier hs-var">L3.BoundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960755"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960756"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960757"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span> </span><span id="local-6989586621680960758"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960758"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680960759"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960759"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960760"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960760"><span class="hs-identifier hs-var">from</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960761"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960761"><span class="hs-identifier hs-var">from_reg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960762"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960762"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960763"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960763"><span class="hs-identifier hs-var">to_reg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-636"></span><span>          </span><span id="local-6989586621680960764"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680960764"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-637"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_DisableGC"><span class="hs-identifier hs-var">Opt_DisableGC</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680960764"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-638"></span><span>             </span><span class="hs-comment">-- || (from_reg == &quot;dummy&quot; || to_reg == &quot;dummy&quot;) -- HACK!!!</span><span>
</span><span id="line-639"></span><span>             </span><span class="hs-comment">-- [2022.03.02]: ckoparkar:WTH does this hack enable?</span><span>
</span><span id="line-640"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; [Char] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; [Char] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960760"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960759"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960762"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-642"></span><span>            </span><span id="local-6989586621680960768"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960768"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;start&quot;</span></span><span>
</span><span id="line-643"></span><span>            </span><span id="local-6989586621680960769"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960769"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;end&quot;</span></span><span>
</span><span id="line-644"></span><span>            </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-645"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; (Var, Var, Var, Var) -&gt; E3Ext () Ty3
forall loc dec. [Char] -&gt; (Var, Var, Var, Var) -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#IndirectionBarrier"><span class="hs-identifier hs-var">IndirectionBarrier</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960758"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960760"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960761"><span class="hs-identifier hs-var">from_reg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960762"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960763"><span class="hs-identifier hs-var">to_reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-646"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960768"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960760"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-647"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960769"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960760"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">L3.LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-648"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960768"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960769"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AddFixed"><span class="hs-identifier hs-type">AddFixed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizePackedExp: AddFixed not handled.&quot;</span></span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>        </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="Gibbon.L2.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3
forall loc dec. E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">L3.GetCilkWorkerNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span id="local-6989586621680960771"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960771"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621680960772"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960772"><span class="hs-identifier hs-var">bod</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-655"></span><span>          </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; DiExp Exp3 -&gt; DiExp Exp3
forall ex. (ex -&gt; ex) -&gt; DiExp ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-var">onDi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; (Exp3 -&gt; E3Ext () Ty3) -&gt; Exp3 -&gt; Exp3
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. [Var] -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#LetAvail"><span class="hs-identifier hs-var">L3.LetAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960771"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; DiExp Exp3)
-&gt; PassM (DiExp Exp3) -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960583"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960584"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960772"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span> </span><span id="local-6989586621680960773"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960773"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680960774"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960774"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; PassM (DiExp Exp3))
-&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char] -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; [Char] -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-var">L3.AllocateTagHere</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960773"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960774"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span> </span><span id="local-6989586621680960775"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960775"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; PassM (DiExp Exp3))
-&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-var">L3.AllocateScalarsHere</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960775"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span> </span><span id="local-6989586621680960776"><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680960776"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680960777"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960777"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680960778"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960778"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680960779"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960779"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; PassM (DiExp Exp3))
-&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality -&gt; Var -&gt; Var -&gt; [Char] -&gt; E3Ext () Ty3
forall loc dec. SSModality -&gt; Var -&gt; Var -&gt; [Char] -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#SSPush"><span class="hs-identifier hs-var">L3.SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680960776"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960777"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960778"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960779"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-662"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span> </span><span id="local-6989586621680960780"><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680960780"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680960781"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960781"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680960782"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960782"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; PassM (DiExp Exp3)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM (DiExp Exp3))
-&gt; (E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; PassM (DiExp Exp3))
-&gt; E3Ext () Ty3 -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality -&gt; Var -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. SSModality -&gt; Var -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#SSPop"><span class="hs-identifier hs-var">L3.SSPop</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680960780"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960781"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960782"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM (DiExp Exp3)) -&gt; [Char] -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TODO: cursorizePackedExp MapE&quot;</span></span><span>
</span><span id="line-665"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM (DiExp Exp3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM (DiExp Exp3)) -&gt; [Char] -&gt; PassM (DiExp Exp3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TODO: cursorizePackedExp FoldE&quot;</span></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680960615"><span class="annot"><span class="annottext">go :: TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM (DiExp Exp3)
</span><a href="#local-6989586621680960615"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960580"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960581"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960582"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-668"></span><span>        </span><span id="local-6989586621680960590"><span class="annot"><span class="annottext">dl :: ex -&gt; DiExp ex
</span><a href="#local-6989586621680960590"><span class="hs-identifier hs-var hs-var">dl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ex -&gt; DiExp ex
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeReadPackedFile"><span class="hs-identifier hs-type">cursorizeReadPackedFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-672"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-673"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-674"></span><span id="cursorizeReadPackedFile"><span class="annot"><span class="annottext">cursorizeReadPackedFile :: DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Bool
-&gt; Var
-&gt; Maybe [Char]
-&gt; [Char]
-&gt; Maybe Var
-&gt; Ty2
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeReadPackedFile"><span class="hs-identifier hs-var hs-var">cursorizeReadPackedFile</span></a></span></span><span> </span><span id="local-6989586621680960792"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960792"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680960793"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960793"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680960794"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960794"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680960795"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960795"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680960796"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960796"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680960797"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960797"><span class="hs-identifier hs-var">isPackedContext</span></a></span></span><span> </span><span id="local-6989586621680960798"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960798"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680960799"><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621680960799"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621680960800"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960800"><span class="hs-identifier hs-var">tyc</span></a></span></span><span> </span><span id="local-6989586621680960801"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960801"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680960802"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960802"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621680960803"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960803"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960801"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-676"></span><span>    </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizePackedExp: InferLocations did not set the reg for ReadPackedFile.&quot;</span></span><span>
</span><span id="line-677"></span><span>    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960804"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960804"><span class="hs-identifier hs-var">reg_var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-678"></span><span>      </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960798"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prim Ty2 -&gt; Prim Ty3
</span><a href="Gibbon.L3.Syntax.html#toL3Prim"><span class="hs-identifier hs-var">toL3Prim</span></a></span><span> </span><span class="annot"><span class="annottext">(Prim Ty2 -&gt; Prim Ty3) -&gt; Prim Ty2 -&gt; Prim Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; Maybe Var -&gt; Ty2 -&gt; Prim Ty2
forall ty. Maybe [Char] -&gt; [Char] -&gt; Maybe Var -&gt; ty -&gt; Prim ty
</span><a href="Gibbon.Language.Syntax.html#ReadPackedFile"><span class="hs-identifier hs-var">ReadPackedFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621680960799"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680960800"><span class="hs-identifier hs-var">tyc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680960801"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960802"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960804"><span class="hs-identifier hs-var">reg_var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960798"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960804"><span class="hs-identifier hs-var">reg_var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960804"><span class="hs-identifier hs-var">reg_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#MMapFileSize"><span class="hs-identifier hs-var">MMapFileSize</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960798"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-681"></span><span>         </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960806"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960798"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960795"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960803"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-684"></span><span>    </span><span id="local-6989586621680960806"><span class="annot"><span class="annottext">go :: TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680960806"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680960807"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960807"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680960808"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960808"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960797"><span class="hs-identifier hs-var">isPackedContext</span></a></span><span>
</span><span id="line-685"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960792"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960793"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960794"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960807"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960796"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960808"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-686"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960792"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960793"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960794"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960807"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960796"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960808"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span class="hs-comment">-- We may sometimes encounter a letloc which uses an unbound location.</span><span>
</span><span id="line-689"></span><span class="hs-comment">--</span><span>
</span><span id="line-690"></span><span class="hs-comment">--     letloc loc_b = loc_a + 1</span><span>
</span><span id="line-691"></span><span class="hs-comment">--</span><span>
</span><span id="line-692"></span><span class="hs-comment">-- i.e `loc_a` may not always be bound. If that's the case, don't process `loc_b`</span><span>
</span><span id="line-693"></span><span class="hs-comment">-- now. Instead, add it to the dependency environment.</span><span>
</span><span id="line-694"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeLocExp"><span class="hs-identifier hs-type">cursorizeLocExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocExp"><span class="hs-identifier hs-type">LocExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Binds"><span class="hs-identifier hs-type">Binds</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span id="cursorizeLocExp"><span class="annot"><span class="annottext">cursorizeLocExp :: DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Var
-&gt; PreLocExp LocArg
-&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeLocExp"><span class="hs-identifier hs-var hs-var">cursorizeLocExp</span></a></span></span><span> </span><span id="local-6989586621680960840"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960840"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680960841"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680960842"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680960843"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960843"><span class="hs-identifier hs-var">lvar</span></a></span></span><span> </span><span id="local-6989586621680960844"><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680960844"><span class="hs-identifier hs-var">locExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680960844"><span class="hs-identifier hs-var">locExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterConstantLE"><span class="hs-identifier hs-type">AfterConstantLE</span></a></span><span> </span><span id="local-6989586621680960846"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960846"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680960847"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960847"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960848"><span class="annot"><span class="annottext">rhs :: Exp3
</span><a href="#local-6989586621680960848"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960847"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960846"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Bool
</span><a href="Gibbon.Passes.Cursorize.html#isBound"><span class="hs-identifier hs-var">isBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960847"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-700"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960848"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span class="annot"><span class="annottext">(DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv))
-&gt; DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, [()], Ty3, Exp3)]
 -&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)])
-&gt; Var -&gt; [(Var, [()], Ty3, Exp3)] -&gt; DepEnv -&gt; DepEnv
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960847"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960843"><span class="hs-identifier hs-var">lvar</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960848"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960840"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-702"></span><span>    </span><span class="hs-comment">-- TODO: handle product types here</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-comment">{- [2018.03.07]:

Changing it's meaning to just be &quot;after a variable&quot;, but not offset from any
particular location. Such an offset requires calculating the size of the variable.
For BigInfinite regions, this is simple:

    size = (endof v) - v

But Infinite regions do not support sizes yet. Re-enable this later.
-}</span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterVariableLE"><span class="hs-identifier hs-type">AfterVariableLE</span></a></span><span> </span><span id="local-6989586621680960851"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680960852"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960852"><span class="hs-identifier hs-var">locarg</span></a></span></span><span> </span><span id="local-6989586621680960853"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960853"><span class="hs-identifier hs-var">was_stolen</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960854"><span class="annot"><span class="annottext">vty :: Ty2
</span><a href="#local-6989586621680960854"><span class="hs-identifier hs-var hs-var">vty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-716"></span><span>                  </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960855"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960855"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960855"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-717"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; SyncEnv -&gt; Maybe [(Var, [()], Ty3, Ty2, Exp3)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-718"></span><span>                               </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960856"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680960856"><span class="hs-identifier hs-var">pending_bnds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-719"></span><span>                                 </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960857"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680960857"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, [()], Ty3, Ty2, Exp3) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2)
-&gt; TyEnv Ty2 -&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; TyEnv Ty2
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680960858"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960858"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680960859"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960859"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960860"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960860"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960858"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960859"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960860"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680960856"><span class="hs-identifier hs-var">pending_bnds</span></a></span><span>
</span><span id="line-720"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960857"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-721"></span><span>                                      </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Ty2
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeLocExp: AfterVariableLE, undound var: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>                                      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960861"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960861"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960861"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-723"></span><span>                               </span><span class="annot"><span class="annottext">Maybe [(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Ty2
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Ty2) -&gt; [Char] -&gt; Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeLocExp: Var &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; not found. &quot;</span></span><span>
</span><span id="line-724"></span><span>          </span><span id="local-6989586621680960862"><span class="annot"><span class="annottext">loc :: Var
</span><a href="#local-6989586621680960862"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960852"><span class="hs-identifier hs-var">locarg</span></a></span><span>
</span><span id="line-725"></span><span>          </span><span id="local-6989586621680960863"><span class="annot"><span class="annottext">bod :: Exp3
</span><a href="#local-6989586621680960863"><span class="hs-identifier hs-var hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960854"><span class="hs-identifier hs-var">vty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-726"></span><span>                  </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>                  </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span class="hs-comment">{-
                  IntTy -&gt; let sizeVal = LitE (fromJust $ sizeOfTy IntTy)
                               rhs = Ext $ AddCursor loc sizeVal
                           in rhs
                  FloatTy -&gt; let sizeVal = LitE (fromJust $ sizeOfTy FloatTy)
                                 rhs = Ext $ AddCursor loc sizeVal
                             in rhs
                  BoolTy -&gt; let sizeVal = LitE (fromJust $ sizeOfTy BoolTy)
                                rhs = Ext $ AddCursor loc sizeVal
                            in rhs
                  CharTy -&gt; let sizeVal = LitE (fromJust $ sizeOfTy CharTy)
                                rhs = Ext $ AddCursor loc sizeVal
                            in rhs
                  SymTy -&gt; let sizeVal = LitE (fromJust $ sizeOfTy SymTy)
                               rhs = Ext $ AddCursor loc sizeVal
                           in rhs
                  VectorTy elty -&gt; let sizeVal = LitE (fromJust $ sizeOfTy (VectorTy elty))
                                       rhs = Ext $ AddCursor loc sizeVal
                                   in rhs
                  ListTy elty -&gt; let sizeVal = LitE (fromJust $ sizeOfTy (ListTy elty))
                                     rhs = Ext $ AddCursor loc sizeVal
                                 in rhs
-}</span><span>
</span><span id="line-751"></span><span>                  </span><span id="local-6989586621680960864"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960864"><span class="hs-identifier hs-var">oth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Exp3) -&gt; [Char] -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeLocExp: AfterVariable TODO &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680960864"><span class="hs-identifier hs-var">oth</span></a></span><span>
</span><span id="line-752"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Bool
</span><a href="Gibbon.Passes.Cursorize.html#isBound"><span class="hs-identifier hs-var">isBound</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960862"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-753"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960853"><span class="hs-identifier hs-var">was_stolen</span></a></span><span>
</span><span id="line-754"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960863"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>           </span><span class="hs-comment">-- The continuation was not stolen. It's safe to discharge all</span><span>
</span><span id="line-756"></span><span>           </span><span class="hs-comment">-- pending bindings of this particular variable.</span><span>
</span><span id="line-757"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-758"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; SyncEnv -&gt; Maybe [(Var, [()], Ty3, Ty2, Exp3)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-759"></span><span>                </span><span class="annot"><span class="annottext">Maybe [(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960863"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960865"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680960865"><span class="hs-identifier hs-var">pending_bnds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-761"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960866"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680960866"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, [()], Ty3, Ty2, Exp3) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2)
-&gt; TyEnv Ty2 -&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; TyEnv Ty2
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680960867"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960867"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680960868"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960868"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960869"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960869"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960867"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960868"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960869"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680960865"><span class="hs-identifier hs-var">pending_bnds</span></a></span><span>
</span><span id="line-762"></span><span>                      </span><span id="local-6989586621680960870"><span class="annot"><span class="annottext">bnds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960870"><span class="hs-identifier hs-var hs-var">bnds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, [()], Ty3, Ty2, Exp3) -&gt; (Var, [()], Ty3, Exp3))
-&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680960871"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960871"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960872"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680960872"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960873"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680960873"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680960874"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960874"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960871"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680960872"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680960873"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960874"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680960865"><span class="hs-identifier hs-var">pending_bnds</span></a></span><span>
</span><span id="line-763"></span><span>                  </span><span class="annot"><span class="annottext">(Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960863"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680960870"><span class="hs-identifier hs-var">bnds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960866"><span class="hs-identifier hs-var">tenv'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; SyncEnv -&gt; SyncEnv
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960851"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv))
-&gt; DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, [()], Ty3, Exp3)]
 -&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)])
-&gt; Var -&gt; [(Var, [()], Ty3, Exp3)] -&gt; DepEnv -&gt; DepEnv
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960862"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960843"><span class="hs-identifier hs-var">lvar</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960863"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960840"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndLE"><span class="hs-identifier hs-type">FromEndLE</span></a></span><span> </span><span id="local-6989586621680960876"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960876"><span class="hs-identifier hs-var">locarg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-767"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960877"><span class="annot"><span class="annottext">loc :: Var
</span><a href="#local-6989586621680960877"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960876"><span class="hs-identifier hs-var">locarg</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-768"></span><span>                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Bool
</span><a href="Gibbon.Passes.Cursorize.html#isBound"><span class="hs-identifier hs-var">isBound</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960877"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-769"></span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960877"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span class="annot"><span class="annottext">(DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv))
-&gt; DepEnv -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, [()], Ty3, Exp3)]
 -&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)])
-&gt; Var -&gt; [(Var, [()], Ty3, Exp3)] -&gt; DepEnv -&gt; DepEnv
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960877"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960843"><span class="hs-identifier hs-var">lvar</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960877"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960840"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfRegionLE"><span class="hs-identifier hs-type">StartOfRegionLE</span></a></span><span> </span><span id="local-6989586621680960879"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960879"><span class="hs-identifier hs-var">r</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680960879"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-772"></span><span>                       </span><span class="annot"><a href="Gibbon.L2.Syntax.html#GlobR"><span class="hs-identifier hs-type">GlobR</span></a></span><span> </span><span id="local-6989586621680960881"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960881"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960881"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>                       </span><span class="annot"><a href="Gibbon.L2.Syntax.html#VarR"><span class="hs-identifier hs-type">VarR</span></a></span><span> </span><span id="local-6989586621680960883"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960883"><span class="hs-identifier hs-var">v</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960883"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>                       </span><span class="annot"><a href="Gibbon.L2.Syntax.html#DynR"><span class="hs-identifier hs-type">DynR</span></a></span><span> </span><span id="local-6989586621680960885"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960885"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960885"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960841"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960842"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>                       </span><span class="hs-comment">-- TODO: docs</span><span>
</span><span id="line-776"></span><span>                       </span><span class="annot"><a href="Gibbon.L2.Syntax.html#MMapR"><span class="hs-identifier hs-type">MMapR</span></a></span><span> </span><span id="local-6989586621680960887"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960887"><span class="hs-identifier hs-var">_v</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DepEnv
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960840"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span>
</span><span id="line-779"></span><span>    </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="Gibbon.L2.Syntax.html#FreeLE"><span class="hs-identifier hs-var">FreeLE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DepEnv
-&gt; Either
     DepEnv (Exp3, [(Var, [()], Ty3, Exp3)], TyEnv Ty2, SyncEnv)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960840"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-comment">-- AUDIT: should we just throw away this information?</span><span>
</span><span id="line-780"></span><span>
</span><span id="line-781"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#InRegionLE"><span class="hs-identifier hs-type">InRegionLE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv))
-&gt; [Char] -&gt; Either DepEnv (Exp3, [Binds Exp3], TyEnv Ty2, SyncEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeExp: TODO InRegionLE&quot;</span></span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span class="hs-comment">-- ASSUMPTIONS:</span><span>
</span><span id="line-785"></span><span class="hs-comment">-- (1) `locs` has [in_regions, out_regions, in_locs, out_locs] for the function.</span><span>
</span><span id="line-786"></span><span class="hs-comment">--     But after Cursorize, the calling convention changes so that input</span><span>
</span><span id="line-787"></span><span class="hs-comment">--     locations appear last. Plus, `arg` would supply those. So we can</span><span>
</span><span id="line-788"></span><span class="hs-comment">--     safely drop them from `locs`.</span><span>
</span><span id="line-789"></span><span class="hs-comment">--</span><span>
</span><span id="line-790"></span><span class="hs-comment">-- (2) We update `arg` so that all packed values in it only have start cursors.</span><span>
</span><span id="line-791"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeAppE"><span class="hs-identifier hs-type">cursorizeAppE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-792"></span><span id="cursorizeAppE"><span class="annot"><span class="annottext">cursorizeAppE :: DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeAppE"><span class="hs-identifier hs-var hs-var">cursorizeAppE</span></a></span></span><span> </span><span id="local-6989586621680960926"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960926"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680960927"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960927"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680960928"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960928"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680960929"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960929"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680960930"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960930"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680960931"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960931"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960931"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-794"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680960932"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960932"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680960933"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960933"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680960934"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960934"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-795"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960935"><span class="annot"><span class="annottext">fnTy :: ArrowTy (TyOf Exp2)
</span><a href="#local-6989586621680960935"><span class="hs-identifier hs-var hs-var">fnTy</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs Exp2 -&gt; Maybe FunDef2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960932"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960927"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-796"></span><span>                     </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680960936"><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680960936"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunDef2 -&gt; ArrowTy (TyOf Exp2)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680960936"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-797"></span><span>                     </span><span class="annot"><span class="annottext">Maybe FunDef2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ArrowTy2 Ty2
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ArrowTy2 Ty2) -&gt; [Char] -&gt; ArrowTy2 Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unknown function: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960932"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-798"></span><span>          </span><span id="local-6989586621680960937"><span class="annot"><span class="annottext">in_tys :: [Ty2]
</span><a href="#local-6989586621680960937"><span class="hs-identifier hs-var hs-var">in_tys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Ty2]
forall ty2. ArrowTy2 ty2 -&gt; [ty2]
</span><a href="Gibbon.L2.Syntax.html#arrIns"><span class="hs-identifier hs-var">arrIns</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680960935"><span class="hs-identifier hs-var">fnTy</span></a></span><span>
</span><span id="line-799"></span><span>          </span><span id="local-6989586621680960938"><span class="annot"><span class="annottext">inLocs :: [Var]
</span><a href="#local-6989586621680960938"><span class="hs-identifier hs-var hs-var">inLocs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#inLocVars"><span class="hs-identifier hs-var">inLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680960935"><span class="hs-identifier hs-var">fnTy</span></a></span><span>
</span><span id="line-800"></span><span>          </span><span id="local-6989586621680960939"><span class="annot"><span class="annottext">numRegs :: Int
</span><a href="#local-6989586621680960939"><span class="hs-identifier hs-var hs-var">numRegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#outRegVars"><span class="hs-identifier hs-var">outRegVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680960935"><span class="hs-identifier hs-var">fnTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#inRegVars"><span class="hs-identifier hs-var">inRegVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680960935"><span class="hs-identifier hs-var">fnTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>          </span><span class="hs-comment">-- Drop input locations, but keep everything else</span><span>
</span><span id="line-802"></span><span>          </span><span id="local-6989586621680960941"><span class="annot"><span class="annottext">outs :: [LocArg]
</span><a href="#local-6989586621680960941"><span class="hs-identifier hs-var hs-var">outs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [LocArg] -&gt; [LocArg]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">L.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960939"><span class="hs-identifier hs-var">numRegs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960933"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [LocArg] -&gt; [LocArg]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#drop"><span class="hs-identifier hs-var">L.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680960939"><span class="hs-identifier hs-var">numRegs</span></a></span><span> </span><span class="annot"><span class="annottext">([LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [LocArg] -&gt; [LocArg]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#drop"><span class="hs-identifier hs-var">L.drop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680960938"><span class="hs-identifier hs-var">inLocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960933"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>          </span><span id="local-6989586621680960944"><span class="annot"><span class="annottext">argTys :: [Ty2]
</span><a href="#local-6989586621680960944"><span class="hs-identifier hs-var hs-var">argTys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Ty2) -&gt; [Exp2] -&gt; [Ty2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680960926"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960929"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy Ty2)
Map Var (ArrowTy2 Ty2)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960934"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-804"></span><span>      </span><span id="local-6989586621680960945"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960945"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Ty2, Exp2) -&gt; PassM Exp3) -&gt; [(Ty2, Exp2)] -&gt; PassM [Exp3]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span>
</span><span id="line-805"></span><span>                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680960946"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960946"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960947"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960947"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960946"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-806"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960926"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960927"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960928"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960929"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960930"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960947"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-807"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960926"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960927"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960928"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960929"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960930"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960947"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty2] -&gt; [Exp2] -&gt; [(Ty2, Exp2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680960937"><span class="hs-identifier hs-var">in_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680960934"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960948"><span class="annot"><span class="annottext">starts :: [Exp3]
</span><a href="#local-6989586621680960948"><span class="hs-identifier hs-var hs-var">starts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; Exp3 -&gt; Exp3) -&gt; [UrTy Var] -&gt; [Exp3] -&gt; [Exp3]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Exp3 -&gt; Exp3
</span><a href="Gibbon.Passes.Cursorize.html#giveStarts"><span class="hs-identifier hs-var">giveStarts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty2 -&gt; UrTy Var) -&gt; [Ty2] -&gt; [UrTy Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680960944"><span class="hs-identifier hs-var">argTys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960945"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-810"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680960951"><span class="annot"><span class="annottext">bod :: Exp3
</span><a href="#local-6989586621680960951"><span class="hs-identifier hs-var hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960933"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-811"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960932"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960948"><span class="hs-identifier hs-var">starts</span></a></span><span>
</span><span id="line-812"></span><span>                  </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960932"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960952"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680960952"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960952"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960941"><span class="hs-identifier hs-var">outs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; [Exp3] -&gt; [Exp3]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680960948"><span class="hs-identifier hs-var">starts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>      </span><span id="local-6989586621680960953"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960953"><span class="hs-identifier hs-var">asserts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LocArg -&gt; Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; [LocArg] -&gt; PassM Exp3
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldrM"><span class="hs-identifier hs-var">foldrM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680960954"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960954"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680960955"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960955"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-814"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680960954"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-815"></span><span>                             </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-type">Loc</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LREM"><span class="hs-identifier hs-type">LREM</span></a></span><span class="hs-special">{</span><span id="local-6989586621680960958"><span class="annot"><span class="annottext">Var
lremEndReg :: Var
lremEndReg :: LREM -&gt; Var
</span><a href="#local-6989586621680960958"><span class="hs-identifier hs-var hs-var">lremEndReg</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960960"><span class="annot"><span class="annottext">Var
lremLoc :: Var
lremLoc :: LREM -&gt; Var
</span><a href="#local-6989586621680960960"><span class="hs-identifier hs-var hs-var">lremLoc</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-816"></span><span>                               </span><span id="local-6989586621680960962"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960962"><span class="hs-identifier hs-var">chk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;chk&quot;</span></span><span>
</span><span id="line-817"></span><span>                               </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-818"></span><span>                                 </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960962"><span class="hs-identifier hs-var">chk</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
forall ty. Prim ty
</span><a href="Gibbon.Language.Syntax.html#LtP"><span class="hs-identifier hs-var">LtP</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960960"><span class="hs-identifier hs-var">lremLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960958"><span class="hs-identifier hs-var">lremEndReg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-819"></span><span>                                 </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; E3Ext () Ty3
forall loc dec. PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960962"><span class="hs-identifier hs-var">chk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-820"></span><span>                                 </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960955"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-821"></span><span>                             </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960955"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>                        </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960951"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960933"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-823"></span><span>      </span><span id="local-6989586621680960965"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680960965"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-824"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_RtsDebug"><span class="hs-identifier hs-var">Opt_RtsDebug</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680960965"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-825"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960953"><span class="hs-identifier hs-var">asserts</span></a></span><span>
</span><span id="line-826"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960951"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-827"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeAppE: Unexpected &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960931"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span class="hs-comment">{-

Cursorizing projections
~~~~~~~~~~~~~~~~~~~~~~~

There are two ways in which projections can be cursorized:

    let pakd_tup = projE n something in
    let x        = projE 0 pakd_tup in
    let end_x    = projE 1 pakd_tup

    OR

    let x     = projE 0 (projE n something) in
    let end_x = projE 1 (projE n something)

`cursorizeLet` creates the former, while the special case here outputs the latter.
Reason: unariser can only eliminate direct projections of this form.
-}</span><span>
</span><span id="line-848"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeProj"><span class="hs-identifier hs-type">cursorizeProj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-849"></span><span id="cursorizeProj"><span class="annot"><span class="annottext">cursorizeProj :: Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeProj"><span class="hs-identifier hs-var hs-var">cursorizeProj</span></a></span></span><span> </span><span id="local-6989586621680960987"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960987"><span class="hs-identifier hs-var">isPackedContext</span></a></span></span><span> </span><span id="local-6989586621680960988"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960988"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680960989"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960989"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680960990"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960990"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680960991"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960991"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680960992"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960992"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680960993"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960993"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-850"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960993"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-851"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680960994"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960994"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960995"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680960995"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680960996"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960996"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680960997"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680960997"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680960998"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960998"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680960996"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-852"></span><span>      </span><span id="local-6989586621680960999"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960999"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961000"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960991"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960997"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-853"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961001"><span class="annot"><span class="annottext">ty' :: TyOf Exp2
</span><a href="#local-6989586621680961001"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680960988"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960991"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy Ty2)
Map Var (ArrowTy2 Ty2)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960997"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-854"></span><span>          </span><span id="local-6989586621680961002"><span class="annot"><span class="annottext">ty'' :: Ty3
</span><a href="#local-6989586621680961002"><span class="hs-identifier hs-var hs-var">ty''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680961001"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>          </span><span id="local-6989586621680961003"><span class="annot"><span class="annottext">bnds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961003"><span class="hs-identifier hs-var hs-var">bnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680961001"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960994"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty3
forall a. Out a =&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Passes.Cursorize.html#projValTy"><span class="hs-identifier hs-var">projValTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961002"><span class="hs-identifier hs-var">ty''</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960999"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960994"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty3
forall a. Out a =&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Passes.Cursorize.html#projEndsTy"><span class="hs-identifier hs-var">projEndsTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961002"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960999"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-858"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960994"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961002"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680960999"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-859"></span><span>          </span><span id="local-6989586621680961006"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961006"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680961001"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960994"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680961001"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960994"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall a. Out a =&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Passes.Cursorize.html#projEndsTy"><span class="hs-identifier hs-var">projEndsTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680961001"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960991"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-861"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680960994"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680961001"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680960991"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-862"></span><span>      </span><span id="local-6989586621680961007"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961007"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961000"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961006"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960998"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-863"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961003"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961007"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeProj: Unexpected expression: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680960993"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-868"></span><span>    </span><span id="local-6989586621680961000"><span class="annot"><span class="annottext">go :: TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961000"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961008"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961008"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680961009"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961009"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680960987"><span class="hs-identifier hs-var">isPackedContext</span></a></span><span>
</span><span id="line-869"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960988"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960989"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960990"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961008"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960992"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961009"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-870"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680960988"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680960989"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680960990"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961008"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680960992"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961009"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span class="hs-comment">{-

Products and projections
~~~~~~~~~~~~~~~~~~~~~~~~

As per the dilated representation, all packed values are (start,end) tuples.
Except fn arguments and pattern matched vars (which are just start cursors).
So instead of using the type from the AST, which will always be `Packed`,
we recover type of RHS in the current type environment using gRecoverType.
If it's just `CursorTy`, this packed value doesn't have an end cursor,
otherwise, the type is `PackedTy{}`, and it also has an end cursor.

-}</span><span>
</span><span id="line-886"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeProd"><span class="hs-identifier hs-type">cursorizeProd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-887"></span><span id="cursorizeProd"><span class="annot"><span class="annottext">cursorizeProd :: Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeProd"><span class="hs-identifier hs-var hs-var">cursorizeProd</span></a></span></span><span> </span><span id="local-6989586621680961029"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961029"><span class="hs-identifier hs-var">isPackedContext</span></a></span></span><span> </span><span id="local-6989586621680961030"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961030"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680961031"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961031"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680961032"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961032"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680961033"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961033"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680961034"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961034"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680961035"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961035"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961035"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-889"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961036"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961036"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961037"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961037"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680961038"><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680961038"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961039"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680961039"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680961040"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680961040"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680961041"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961041"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-890"></span><span>      </span><span id="local-6989586621680961042"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961042"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UrTy Var, Exp2)]
-&gt; ((UrTy Var, Exp2) -&gt; PassM Exp3) -&gt; PassM [Exp3]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [Exp2] -&gt; [(UrTy Var, Exp2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680961038"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680961040"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((UrTy Var, Exp2) -&gt; PassM Exp3) -&gt; PassM [Exp3])
-&gt; ((UrTy Var, Exp2) -&gt; PassM Exp3) -&gt; PassM [Exp3]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680961043"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961043"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961044"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961044"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-891"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961043"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-892"></span><span>                  </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961043"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961030"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961031"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961032"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961033"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961034"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961044"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-893"></span><span>                  </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961043"><span class="hs-identifier hs-var">ty</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961030"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961031"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961032"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961033"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961034"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961044"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-894"></span><span>                  </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961030"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961031"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961032"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961033"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961034"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961044"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-895"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961045"><span class="annot"><span class="annottext">rhs' :: Exp3
</span><a href="#local-6989586621680961045"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961042"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-896"></span><span>          </span><span id="local-6989586621680961046"><span class="annot"><span class="annottext">ty :: TyOf Exp2
</span><a href="#local-6989586621680961046"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680961030"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961033"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy Ty2)
Map Var (ArrowTy2 Ty2)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961039"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-897"></span><span>          </span><span id="local-6989586621680961047"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680961047"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680961046"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span>          </span><span id="local-6989586621680961048"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961048"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961036"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680961046"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961033"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-899"></span><span>      </span><span id="local-6989586621680961049"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961049"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961050"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961048"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961041"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-900"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961036"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961047"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961045"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961049"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeProj: Unexpected expression: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961035"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-905"></span><span>    </span><span id="local-6989586621680961050"><span class="annot"><span class="annottext">go :: TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961050"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961051"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961051"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680961052"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961052"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961029"><span class="hs-identifier hs-var">isPackedContext</span></a></span><span>
</span><span id="line-906"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961030"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961031"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961032"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961051"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961034"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-907"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961030"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961031"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961032"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961051"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961034"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span class="hs-comment">{-

Spawn and sync
~~~~~~~~~~~~~~

This is almost identical to a cursorizeLet case below. Except we bind fewer things
and add fewer things to the type environemnt because we have to wait until the
join point.

-}</span><span>
</span><span id="line-920"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeSpawn"><span class="hs-identifier hs-type">cursorizeSpawn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-921"></span><span id="cursorizeSpawn"><span class="annot"><span class="annottext">cursorizeSpawn :: Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeSpawn"><span class="hs-identifier hs-var hs-var">cursorizeSpawn</span></a></span></span><span> </span><span id="local-6989586621680961134"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961134"><span class="hs-identifier hs-var">isPackedContext</span></a></span></span><span> </span><span id="local-6989586621680961135"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961135"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680961136"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961136"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680961137"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961137"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680961138"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961138"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680961139"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680961140"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961140"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961140"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-923"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961141"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961142"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span id="local-6989586621680961143"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span id="local-6989586621680961144"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961144"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621680961145"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961145"><span class="hs-identifier hs-var">applocs</span></a></span></span><span> </span><span id="local-6989586621680961146"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680961146"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680961147"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961147"><span class="hs-identifier hs-var">bod</span></a></span></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-926"></span><span>          </span><span id="local-6989586621680961148"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961148"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961135"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961136"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961137"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961138"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961144"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961145"><span class="hs-identifier hs-var">applocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680961146"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961149"><span class="annot"><span class="annottext">rhs'' :: Exp3
</span><a href="#local-6989586621680961149"><span class="hs-identifier hs-var hs-var">rhs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961148"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-928"></span><span>                        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680961150"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961150"><span class="hs-identifier hs-var">fn'</span></a></span></span><span> </span><span id="local-6989586621680961151"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680961151"><span class="hs-identifier hs-var">applocs'</span></a></span></span><span> </span><span id="local-6989586621680961152"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961152"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-var">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961150"><span class="hs-identifier hs-var">fn'</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680961151"><span class="hs-identifier hs-var">applocs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961152"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-929"></span><span>                        </span><span class="annot"><span class="annottext">Exp3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeSpawn&quot;</span></span><span>
</span><span id="line-930"></span><span>          </span><span id="local-6989586621680961153"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961153"><span class="hs-identifier hs-var">fresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tup_packed&quot;</span></span><span>
</span><span id="line-931"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961154"><span class="annot"><span class="annottext">ty' :: UrTy Var
</span><a href="#local-6989586621680961154"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-932"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-933"></span><span>                      </span><span id="local-6989586621680961155"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961155"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961155"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>              </span><span id="local-6989586621680961156"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961156"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961153"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961154"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961138"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-935"></span><span>                      </span><span class="hs-comment">-- L.foldr (\(a,b) acc -&gt; M.insert a b acc) tenv $</span><span>
</span><span id="line-936"></span><span>                      </span><span class="hs-comment">--   [(v, ty),(fresh, ty'),(toEndV v, projTy 1 ty')] ++ [(loc,CursorTy) | loc &lt;- locs]</span><span>
</span><span id="line-937"></span><span>              </span><span class="hs-comment">-- TyEnv Ty2 and L3 expresssions are tagged with different types</span><span>
</span><span id="line-938"></span><span>              </span><span id="local-6989586621680961157"><span class="annot"><span class="annottext">ty'' :: Ty3
</span><a href="#local-6989586621680961157"><span class="hs-identifier hs-var hs-var">ty''</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty3
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Passes.Cursorize.html#curDict"><span class="hs-identifier hs-var">curDict</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961154"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-939"></span><span>              </span><span id="local-6989586621680961159"><span class="annot"><span class="annottext">fresh_rhs :: Exp3
</span><a href="#local-6989586621680961159"><span class="hs-identifier hs-var hs-var">fresh_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961153"><span class="hs-identifier hs-var">fresh</span></a></span><span>
</span><span id="line-940"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621680961160"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961160"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961161"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961161"><span class="hs-identifier hs-var">pending_bnds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-941"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-942"></span><span>                        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961153"><span class="hs-identifier hs-var">fresh</span></a></span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961157"><span class="hs-identifier hs-var">ty''</span></a></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961149"><span class="hs-identifier hs-var">rhs''</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-943"></span><span>                                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961157"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961159"><span class="hs-identifier hs-var">fresh_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961157"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; UrTy Var -&gt; UrTy Var
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961154"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961159"><span class="hs-identifier hs-var">fresh_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>                        </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961163"><span class="annot"><span class="annottext">nLocs :: Int
</span><a href="#local-6989586621680961163"><span class="hs-identifier hs-var hs-var">nLocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-946"></span><span>                                 </span><span id="local-6989586621680961164"><span class="annot"><span class="annottext">locBnds :: [(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961164"><span class="hs-identifier hs-var hs-var">locBnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961165"><span class="hs-identifier hs-var">loc</span></a></span><span>  </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961166"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961159"><span class="hs-identifier hs-var">fresh_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>                                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961165"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961165"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961166"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961166"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [Int] -&gt; [(LocArg, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-948"></span><span>                                 </span><span id="local-6989586621680961167"><span class="annot"><span class="annottext">bnds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961167"><span class="hs-identifier hs-var hs-var">bnds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961153"><span class="hs-identifier hs-var">fresh</span></a></span><span> </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961157"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961149"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-949"></span><span>                                 </span><span id="local-6989586621680961168"><span class="annot"><span class="annottext">pending_bnds' :: [(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961168"><span class="hs-identifier hs-var hs-var">pending_bnds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961163"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961157"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span>                            </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961163"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961159"><span class="hs-identifier hs-var">fresh_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>                                                 </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961163"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961157"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; UrTy Var -&gt; UrTy Var
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; UrTy Var) -&gt; UrTy Var -&gt; UrTy Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; UrTy Var -&gt; UrTy Var
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961163"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961154"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961163"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961159"><span class="hs-identifier hs-var">fresh_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-951"></span><span>                                                 </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
-&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; [(Var, [()], Ty3, Ty2, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961164"><span class="hs-identifier hs-var">locBnds</span></a></span><span>
</span><span id="line-952"></span><span>                             </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961167"><span class="hs-identifier hs-var">bnds'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961168"><span class="hs-identifier hs-var">pending_bnds'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; DepEnv -&gt; Maybe [(Var, [()], Ty3, Exp3)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961137"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-954"></span><span>            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680961169"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961169"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM ()) -&gt; [Char] -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeSpawn todo: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961169"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-955"></span><span>            </span><span class="annot"><span class="annottext">Maybe [(Var, [()], Ty3, Exp3)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; PassM ()
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961170"><span class="annot"><span class="annottext">senv' :: SyncEnv
</span><a href="#local-6989586621680961170"><span class="hs-identifier hs-var hs-var">senv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; SyncEnv -&gt; SyncEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961161"><span class="hs-identifier hs-var">pending_bnds</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span><span>
</span><span id="line-957"></span><span>          </span><span id="local-6989586621680961171"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961171"><span class="hs-identifier hs-var">bod'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961172"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961156"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961170"><span class="hs-identifier hs-var">senv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961147"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-958"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961173"><span class="annot"><span class="annottext">bod'' :: Exp3
</span><a href="#local-6989586621680961173"><span class="hs-identifier hs-var hs-var">bod''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; Exp3 -&gt; Exp3
</span><a href="Gibbon.L3.Syntax.html#updateAvailVars"><span class="hs-identifier hs-var">updateAvailVars</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961153"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961171"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-959"></span><span>          </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961160"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961173"><span class="hs-identifier hs-var">bod''</span></a></span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-962"></span><span>          </span><span id="local-6989586621680961175"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961175"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961135"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961136"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961137"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961138"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961144"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961145"><span class="hs-identifier hs-var">applocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680961146"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961176"><span class="annot"><span class="annottext">rhs'' :: Exp3
</span><a href="#local-6989586621680961176"><span class="hs-identifier hs-var hs-var">rhs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961175"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-964"></span><span>                        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680961177"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961177"><span class="hs-identifier hs-var">fn'</span></a></span></span><span> </span><span id="local-6989586621680961178"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680961178"><span class="hs-identifier hs-var">applocs'</span></a></span></span><span> </span><span id="local-6989586621680961179"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961179"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-var">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961177"><span class="hs-identifier hs-var">fn'</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680961178"><span class="hs-identifier hs-var">applocs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961179"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-965"></span><span>                        </span><span class="annot"><span class="annottext">Exp3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Exp3) -&gt; [Char] -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeSpawn: this should've been an AppE. Got&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961175"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-966"></span><span>          </span><span id="local-6989586621680961180"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961180"><span class="hs-identifier hs-var">fresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tup_haspacked&quot;</span></span><span>
</span><span id="line-967"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961181"><span class="annot"><span class="annottext">ty' :: UrTy Any
</span><a href="#local-6989586621680961181"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-968"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Any
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-969"></span><span>                      </span><span id="local-6989586621680961182"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961182"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UrTy Any] -&gt; UrTy Any
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961182"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[UrTy Any] -&gt; [UrTy Any] -&gt; [UrTy Any]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Any
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-970"></span><span>              </span><span id="local-6989586621680961183"><span class="annot"><span class="annottext">ty'' :: Ty3
</span><a href="#local-6989586621680961183"><span class="hs-identifier hs-var hs-var">ty''</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Any -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
</span><a href="#local-6989586621680961181"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-971"></span><span>              </span><span id="local-6989586621680961184"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961184"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961138"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-972"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-973"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961183"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961176"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-974"></span><span>                    </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961172"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961184"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961147"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-975"></span><span>            </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-976"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961185"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961185"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961186"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961186"><span class="hs-identifier hs-var">pending_bnds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-977"></span><span>                    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961180"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961183"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961176"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-978"></span><span>                     </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961187"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961188"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961180"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961187"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961187"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961188"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961188"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; [Int] -&gt; [(LocArg, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
-&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; [(Var, [()], Ty3, Ty2, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-979"></span><span>                     </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span>           </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961183"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961180"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>                  </span><span id="local-6989586621680961189"><span class="annot"><span class="annottext">senv' :: SyncEnv
</span><a href="#local-6989586621680961189"><span class="hs-identifier hs-var hs-var">senv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; SyncEnv -&gt; SyncEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961186"><span class="hs-identifier hs-var">pending_bnds</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span><span>
</span><span id="line-981"></span><span>              </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961185"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961172"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961184"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961189"><span class="hs-identifier hs-var">senv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961147"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-984"></span><span>          </span><span id="local-6989586621680961190"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961190"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961135"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961136"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961137"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961138"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961144"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961145"><span class="hs-identifier hs-var">applocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680961146"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-985"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961191"><span class="annot"><span class="annottext">rhs'' :: Exp3
</span><a href="#local-6989586621680961191"><span class="hs-identifier hs-var hs-var">rhs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961190"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-986"></span><span>                        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680961192"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961192"><span class="hs-identifier hs-var">fn'</span></a></span></span><span> </span><span id="local-6989586621680961193"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680961193"><span class="hs-identifier hs-var">applocs'</span></a></span></span><span> </span><span id="local-6989586621680961194"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961194"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-var">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961192"><span class="hs-identifier hs-var">fn'</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680961193"><span class="hs-identifier hs-var">applocs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961194"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-987"></span><span>                        </span><span class="annot"><span class="annottext">Exp3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeSpawn&quot;</span></span><span>
</span><span id="line-988"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-989"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty3
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Passes.Cursorize.html#curDict"><span class="hs-identifier hs-var">curDict</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961191"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-990"></span><span>                    </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961172"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961138"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961147"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-991"></span><span>            </span><span class="hs-special">[</span><span id="local-6989586621680961195"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961195"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-992"></span><span>              </span><span id="local-6989586621680961196"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961196"><span class="hs-identifier hs-var">fresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;par_tup_scalar&quot;</span></span><span>
</span><span id="line-993"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680961197"><span class="hs-identifier hs-type">ty'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#OldTy2"><span class="hs-identifier hs-type">OldTy2</span></a></span><span>
</span><span id="line-994"></span><span>                  </span><span id="local-6989586621680961197"><span class="annot"><span class="annottext">ty' :: UrTy Var
</span><a href="#local-6989586621680961197"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961142"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961143"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>                  </span><span id="local-6989586621680961198"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961198"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961196"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961197"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961138"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-996"></span><span>                  </span><span class="annot"><a href="#local-6989586621680961199"><span class="hs-identifier hs-type">ty''</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span>
</span><span id="line-997"></span><span>                  </span><span id="local-6989586621680961199"><span class="annot"><span class="annottext">ty'' :: Ty3
</span><a href="#local-6989586621680961199"><span class="hs-identifier hs-var hs-var">ty''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961197"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-998"></span><span>                  </span><span id="local-6989586621680961200"><span class="annot"><span class="annottext">rhs''' :: DiExp Exp3
</span><a href="#local-6989586621680961200"><span class="hs-identifier hs-var hs-var">rhs'''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961196"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>                  </span><span id="local-6989586621680961201"><span class="annot"><span class="annottext">pending_bnds :: [(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961201"><span class="hs-identifier hs-var hs-var">pending_bnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961195"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961199"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; UrTy Var -&gt; UrTy Var
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961197"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
</span><a href="Gibbon.Passes.Cursorize.html#projVal"><span class="hs-identifier hs-var">projVal</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680961200"><span class="hs-identifier hs-var">rhs'''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>                                 </span><span class="hs-comment">-- [2022.09.21]: Shouldn't this be projTy 1 ty'?</span><span>
</span><span id="line-1001"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span>            </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961199"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; UrTy Var -&gt; UrTy Var
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961197"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
</span><a href="Gibbon.Passes.Cursorize.html#projEnds"><span class="hs-identifier hs-var">projEnds</span></a></span><span> </span><span class="annot"><span class="annottext">DiExp Exp3
</span><a href="#local-6989586621680961200"><span class="hs-identifier hs-var">rhs'''</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1002"></span><span>                  </span><span id="local-6989586621680961203"><span class="annot"><span class="annottext">senv' :: SyncEnv
</span><a href="#local-6989586621680961203"><span class="hs-identifier hs-var hs-var">senv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; SyncEnv -&gt; SyncEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961141"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961201"><span class="hs-identifier hs-var">pending_bnds</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961139"><span class="hs-identifier hs-var">senv</span></a></span><span>
</span><span id="line-1003"></span><span>              </span><span id="local-6989586621680961204"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961204"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961172"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961198"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961203"><span class="hs-identifier hs-var">senv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961147"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1004"></span><span>              </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961196"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961199"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961191"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961204"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-1005"></span><span>
</span><span id="line-1006"></span><span>            </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;TODO: cursorizeSpawn&quot;</span></span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeSpawn: Unbound SpawnE&quot;</span></span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680961172"><span class="annot"><span class="annottext">go :: TyEnv Ty2 -&gt; SyncEnv -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961172"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961205"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961205"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680961206"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961206"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680961207"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961207"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961134"><span class="hs-identifier hs-var">isPackedContext</span></a></span><span>
</span><span id="line-1011"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961135"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961136"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961137"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961205"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961206"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961207"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1012"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961135"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961136"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961137"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961205"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961206"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961207"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1013"></span><span>
</span><span id="line-1014"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeSync"><span class="hs-identifier hs-type">cursorizeSync</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1015"></span><span id="cursorizeSync"><span class="annot"><span class="annottext">cursorizeSync :: Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeSync"><span class="hs-identifier hs-var hs-var">cursorizeSync</span></a></span></span><span> </span><span id="local-6989586621680961216"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961216"><span class="hs-identifier hs-var">isPackedContext</span></a></span></span><span> </span><span id="local-6989586621680961217"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961217"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680961218"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961218"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680961219"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961219"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680961220"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961220"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680961221"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961221"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680961222"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961222"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1016"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961222"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1017"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961223"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961223"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961224"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961224"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span id="local-6989586621680961225"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961225"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680961226"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961226"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1018"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961227"><span class="annot"><span class="annottext">pending_bnds :: [(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961227"><span class="hs-identifier hs-var hs-var">pending_bnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Var, [()], Ty3, Ty2, Exp3)]] -&gt; [(Var, [()], Ty3, Ty2, Exp3)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SyncEnv -&gt; [[(Var, [()], Ty3, Ty2, Exp3)]]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961221"><span class="hs-identifier hs-var">senv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>          </span><span id="local-6989586621680961230"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961230"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, [()], Ty3, Ty2, Exp3) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2)
-&gt; TyEnv Ty2 -&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; TyEnv Ty2
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680961231"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961231"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680961232"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680961232"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680961233"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961233"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961231"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680961232"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961233"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961220"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961227"><span class="hs-identifier hs-var">pending_bnds</span></a></span><span>
</span><span id="line-1020"></span><span>          </span><span class="hs-comment">-- Discharge bindings that depending on the join point.</span><span>
</span><span id="line-1021"></span><span>          </span><span id="local-6989586621680961234"><span class="annot"><span class="annottext">bnds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961234"><span class="hs-identifier hs-var hs-var">bnds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, [()], Ty3, Ty2, Exp3) -&gt; (Var, [()], Ty3, Exp3))
-&gt; [(Var, [()], Ty3, Ty2, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680961235"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961235"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961236"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680961236"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961237"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961237"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680961238"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961238"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961235"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680961236"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961237"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961238"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Ty2, Exp3)]
</span><a href="#local-6989586621680961227"><span class="hs-identifier hs-var">pending_bnds</span></a></span><span>
</span><span id="line-1022"></span><span>          </span><span id="local-6989586621680961239"><span class="annot"><span class="annottext">bnds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961239"><span class="hs-identifier hs-var hs-var">bnds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961223"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961225"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961234"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-1023"></span><span>      </span><span id="local-6989586621680961240"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961240"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961241"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961230"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961226"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1024"></span><span>      </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961239"><span class="hs-identifier hs-var">bnds'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961240"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-1025"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;cursorizeSpawn: Unbound SyncE&quot;</span></span><span>
</span><span id="line-1026"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680961241"><span class="annot"><span class="annottext">go :: TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961241"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961242"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961242"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680961243"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961243"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961216"><span class="hs-identifier hs-var">isPackedContext</span></a></span><span>
</span><span id="line-1027"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961217"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961218"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961219"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961242"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961243"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1028"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961217"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961218"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961219"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961242"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961243"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span class="hs-comment">{-

Cursorizing let expressions
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Process RHS and bind the following cursors

     v     -&gt; start_write
     end_v -&gt; end_write
     loc   -&gt; end_read     (only if it's available)

An expression returning packed value can either be a `DataConE` or a `AppE`.
DataConE returns a (start_write,end_write) tuple whereas
AppE returns (end_read,end_write).

So we cannot always rely on the RHS to return a start_write cursor.
But since the types of all packed expressions are already annotated with locations,
we can take a shortcut here and directly bind `v` to the tagged location.

Other bindings are straightforward projections of the processed RHS.

-}</span><span>
</span><span id="line-1053"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#cursorizeLet"><span class="hs-identifier hs-type">cursorizeLet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span>
</span><span id="line-1054"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1055"></span><span id="cursorizeLet"><span class="annot"><span class="annottext">cursorizeLet :: Bool
-&gt; DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; (Var, [LocArg], Ty2, Exp2)
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeLet"><span class="hs-identifier hs-var hs-var">cursorizeLet</span></a></span></span><span> </span><span id="local-6989586621680961311"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961311"><span class="hs-identifier hs-var">isPackedContext</span></a></span></span><span> </span><span id="local-6989586621680961312"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961312"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680961313"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961313"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680961314"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961314"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680961315"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961315"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621680961316"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961316"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961317"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961318"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span id="local-6989586621680961319"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621680961320"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961320"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680961321"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961321"><span class="hs-identifier hs-var">bod</span></a></span></span><span>
</span><span id="line-1056"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1057"></span><span>        </span><span id="local-6989586621680961322"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961322"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961312"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961313"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961314"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961315"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961316"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961320"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1058"></span><span>        </span><span id="local-6989586621680961323"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961323"><span class="hs-identifier hs-var">fresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tup_packed&quot;</span></span><span>
</span><span id="line-1059"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961324"><span class="annot"><span class="annottext">ty' :: UrTy Var
</span><a href="#local-6989586621680961324"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1060"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1061"></span><span>                    </span><span id="local-6989586621680961325"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961325"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961325"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[UrTy Var] -&gt; [UrTy Var] -&gt; [UrTy Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span>            </span><span id="local-6989586621680961326"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961326"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2)
-&gt; TyEnv Ty2 -&gt; [(Var, Ty2)] -&gt; TyEnv Ty2
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680961327"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961327"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961328"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680961328"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680961329"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961329"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961327"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680961328"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961329"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961315"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; TyEnv Ty2) -&gt; [(Var, Ty2)] -&gt; TyEnv Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1064"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961323"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961324"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; UrTy Var -&gt; UrTy Var
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961324"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; [(Var, Ty2)] -&gt; [(Var, Ty2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1065"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961330"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680961330"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961330"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1066"></span><span>
</span><span id="line-1067"></span><span>            </span><span class="hs-comment">-- TyEnv Ty2 and L3 expresssions are tagged with different types</span><span>
</span><span id="line-1068"></span><span>            </span><span id="local-6989586621680961331"><span class="annot"><span class="annottext">ty'' :: Ty3
</span><a href="#local-6989586621680961331"><span class="hs-identifier hs-var hs-var">ty''</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty3
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Passes.Cursorize.html#curDict"><span class="hs-identifier hs-var">curDict</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961324"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1069"></span><span>            </span><span id="local-6989586621680961332"><span class="annot"><span class="annottext">rhs'' :: Exp3
</span><a href="#local-6989586621680961332"><span class="hs-identifier hs-var hs-var">rhs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961323"><span class="hs-identifier hs-var">fresh</span></a></span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span>            </span><span id="local-6989586621680961333"><span class="annot"><span class="annottext">bnds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961333"><span class="hs-identifier hs-var hs-var">bnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1072"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961323"><span class="hs-identifier hs-var">fresh</span></a></span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961331"><span class="hs-identifier hs-var">ty''</span></a></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961322"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1073"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961331"><span class="hs-identifier hs-var">ty''</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961332"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1074"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961331"><span class="hs-identifier hs-var">ty''</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961332"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span>                      </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961334"><span class="annot"><span class="annottext">nLocs :: Int
</span><a href="#local-6989586621680961334"><span class="hs-identifier hs-var hs-var">nLocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-1077"></span><span>                               </span><span id="local-6989586621680961335"><span class="annot"><span class="annottext">locBnds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961335"><span class="hs-identifier hs-var hs-var">locBnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961336"><span class="hs-identifier hs-var">loc</span></a></span><span>  </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961337"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961332"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1078"></span><span>                                         </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961336"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961336"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961337"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961337"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [Int] -&gt; [(LocArg, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1079"></span><span>                               </span><span id="local-6989586621680961338"><span class="annot"><span class="annottext">bnds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961338"><span class="hs-identifier hs-var hs-var">bnds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961323"><span class="hs-identifier hs-var">fresh</span></a></span><span>   </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961331"><span class="hs-identifier hs-var">ty''</span></a></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961322"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span>                                       </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961334"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961331"><span class="hs-identifier hs-var">ty''</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961334"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961332"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>                                       </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961334"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961331"><span class="hs-identifier hs-var">ty''</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961334"><span class="hs-identifier hs-var">nLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961332"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1082"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961338"><span class="hs-identifier hs-var">bnds'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961335"><span class="hs-identifier hs-var">locBnds</span></a></span><span>
</span><span id="line-1083"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; DepEnv -&gt; Maybe [(Var, [()], Ty3, Exp3)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961314"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1084"></span><span>          </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680961339"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961339"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM ()) -&gt; [Char] -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;todo: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961339"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1085"></span><span>          </span><span class="annot"><span class="annottext">Maybe [(Var, [()], Ty3, Exp3)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; PassM ()
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>        </span><span id="local-6989586621680961340"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961340"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961341"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961326"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961321"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1087"></span><span>        </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961333"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961340"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1090"></span><span>        </span><span id="local-6989586621680961342"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961342"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961312"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961313"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961314"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961315"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961316"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961320"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1091"></span><span>        </span><span id="local-6989586621680961343"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961343"><span class="hs-identifier hs-var">fresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tup_haspacked&quot;</span></span><span>
</span><span id="line-1092"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961344"><span class="annot"><span class="annottext">ty' :: UrTy Any
</span><a href="#local-6989586621680961344"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1093"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Any
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1094"></span><span>                    </span><span id="local-6989586621680961345"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961345"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UrTy Any] -&gt; UrTy Any
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961345"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[UrTy Any] -&gt; [UrTy Any] -&gt; [UrTy Any]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Any
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>            </span><span id="local-6989586621680961346"><span class="annot"><span class="annottext">ty'' :: Ty3
</span><a href="#local-6989586621680961346"><span class="hs-identifier hs-var hs-var">ty''</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Any -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
</span><a href="#local-6989586621680961344"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1096"></span><span>            </span><span id="local-6989586621680961347"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961347"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961315"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961348"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680961348"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961348"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1097"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1098"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961346"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961342"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-1099"></span><span>                  </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961341"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961347"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961321"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1100"></span><span>          </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1101"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961349"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961349"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961347"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">(TyEnv Ty2 -&gt; TyEnv Ty2) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1102"></span><span>                          </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961350"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680961350"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961350"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span>                </span><span id="local-6989586621680961351"><span class="annot"><span class="annottext">bnds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961351"><span class="hs-identifier hs-var hs-var">bnds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961343"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961346"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961342"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1105"></span><span>                        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961352"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961353"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961343"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961352"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961352"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961353"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961353"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; [Int] -&gt; [(LocArg, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1106"></span><span>                        </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961346"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961343"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1107"></span><span>            </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961351"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961341"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961349"><span class="hs-identifier hs-var">tenv''</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961321"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>  </span><span class="hs-comment">{-

This was a scalar binding before, but now has been transformed to
also return an end_read cursor. So the type of the binding now
becomes:

    ProdTy [CursorTy, old_ty]

Also, the binding itself now changes to:

    end_read -&gt; ProjE 0 RHS'
    v        -&gt; ProjE 1 RHS'

`rightmost` is an example of a program that does this.

-}</span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1127"></span><span>        </span><span id="local-6989586621680961354"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961354"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961312"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961313"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961314"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961315"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961316"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961320"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1128"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1129"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3) -&gt; Exp3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty3
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Passes.Cursorize.html#curDict"><span class="hs-identifier hs-var">curDict</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961354"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; Exp3) -&gt; PassM Exp3 -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-1130"></span><span>                    </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961341"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961315"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961321"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1131"></span><span>            </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1132"></span><span>              </span><span id="local-6989586621680961355"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961355"><span class="hs-identifier hs-var">fresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tup_scalar&quot;</span></span><span>
</span><span id="line-1133"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961356"><span class="annot"><span class="annottext">rhs'' :: Exp3
</span><a href="#local-6989586621680961356"><span class="hs-identifier hs-var hs-var">rhs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961355"><span class="hs-identifier hs-var">fresh</span></a></span><span>
</span><span id="line-1134"></span><span>                  </span><span id="local-6989586621680961357"><span class="annot"><span class="annottext">ty' :: UrTy Any
</span><a href="#local-6989586621680961357"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UrTy Any] -&gt; UrTy Any
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[UrTy Any] -&gt; [UrTy Any] -&gt; [UrTy Any]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Any
forall a b. UrTy a -&gt; UrTy b
</span><a href="Gibbon.L3.Syntax.html#cursorizeTy"><span class="hs-identifier hs-var">cursorizeTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>                  </span><span class="hs-comment">-- We cannot resuse ty' here because TyEnv Ty2 and expresssions are</span><span>
</span><span id="line-1136"></span><span>                  </span><span class="hs-comment">-- tagged with different</span><span>
</span><span id="line-1137"></span><span>                  </span><span id="local-6989586621680961358"><span class="annot"><span class="annottext">ty'' :: Ty3
</span><a href="#local-6989586621680961358"><span class="hs-identifier hs-var hs-var">ty''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Any -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
</span><a href="#local-6989586621680961357"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1138"></span><span>                  </span><span id="local-6989586621680961359"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961359"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961319"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961315"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TyEnv Ty2 -&gt; TyEnv Ty2) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1139"></span><span>                           </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961360"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680961360"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961360"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1140"></span><span>                  </span><span id="local-6989586621680961361"><span class="annot"><span class="annottext">bnds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961361"><span class="hs-identifier hs-var hs-var">bnds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961355"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961358"><span class="hs-identifier hs-var">ty''</span></a></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961354"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1141"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961362"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961363"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961356"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961362"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961362"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961363"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961363"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; [Int] -&gt; [(LocArg, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1142"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961317"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Ty3 -&gt; Ty3
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961358"><span class="hs-identifier hs-var">ty''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961318"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961356"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1143"></span><span>              </span><span id="local-6989586621680961364"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961364"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961341"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961359"><span class="hs-identifier hs-var">tenv'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961321"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1144"></span><span>              </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961361"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961364"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680961341"><span class="annot"><span class="annottext">go :: TyEnv Ty2 -&gt; Exp2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961341"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961365"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961365"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680961366"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961366"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961311"><span class="hs-identifier hs-var">isPackedContext</span></a></span><span>
</span><span id="line-1147"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961312"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961313"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961314"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961365"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961316"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961366"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1148"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961312"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961313"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961314"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961365"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961316"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961366"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1149"></span><span>
</span><span id="line-1150"></span><span class="hs-comment">{-

Unpacking constructors
~~~~~~~~~~~~~~~~~~~~~~

(1) Take a cursor pointing to the start of the tag, and advance it by 1 byte.
(2) If this DataCon has random access nodes, unpack those.
(3) If the first bound varaible is a scalar (IntTy), read it using the newly
returned cursor. Otherwise, just process the body. it'll have the correct
instructions to process other bound locations

Consider an example of unpacking of a Node^ pattern:

    (Node^ [(ind_y3, loc_ind_y3), (n1, loc_n1) , (x2 , loc_x2), (y3 , loc_y3)]
      BODY)

..TODO..

-}</span><span>
</span><span id="line-1169"></span><span id="local-6989586621680959772"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#unpackDataCon"><span class="hs-identifier hs-type">unpackDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#SyncEnv"><span class="hs-identifier hs-type">SyncEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-1170"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680959772"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1171"></span><span id="unpackDataCon"><span class="annot"><span class="annottext">unpackDataCon :: forall t.
DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Bool
-&gt; Var
-&gt; ([Char], [(Var, LocArg)], Exp2)
-&gt; PassM ([Char], [t], Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#unpackDataCon"><span class="hs-identifier hs-var hs-var">unpackDataCon</span></a></span></span><span> </span><span id="local-6989586621680961525"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961525"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680961526"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961526"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680961527"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961527"><span class="hs-identifier hs-var">denv1</span></a></span></span><span> </span><span id="local-6989586621680961528"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961528"><span class="hs-identifier hs-var">tenv1</span></a></span></span><span> </span><span id="local-6989586621680961529"><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961529"><span class="hs-identifier hs-var">senv</span></a></span></span><span> </span><span id="local-6989586621680961530"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961530"><span class="hs-identifier hs-var">isPacked</span></a></span></span><span> </span><span id="local-6989586621680961531"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961531"><span class="hs-identifier hs-var">scrtCur</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961532"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961533"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961533"><span class="hs-identifier hs-var">vlocs1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961534"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961534"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1172"></span><span>  </span><span id="local-6989586621680961535"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961535"><span class="hs-identifier hs-var">field_cur</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;field_cur&quot;</span></span><span>
</span><span id="line-1173"></span><span>
</span><span id="line-1174"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>    </span><span class="hs-comment">-- Advance the cursor by 1 byte so that it points to the first field</span><span>
</span><span id="line-1176"></span><span>    </span><span class="annot"><span class="annottext">(Exp3 -&gt; ([Char], [t], Exp3))
-&gt; (Exp3 -&gt; Exp3) -&gt; Exp3 -&gt; ([Char], [t], Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961535"><span class="hs-identifier hs-var">field_cur</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961531"><span class="hs-identifier hs-var">scrtCur</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1177"></span><span>    </span><span class="annot"><span class="annottext">(Exp3 -&gt; ([Char], [t], Exp3))
-&gt; PassM Exp3 -&gt; PassM ([Char], [t], Exp3)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isAbsRANDataCon"><span class="hs-identifier hs-var">isAbsRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-1178"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Exp3
</span><a href="#local-6989586621680961537"><span class="hs-identifier hs-var">unpackWithAbsRAN</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961535"><span class="hs-identifier hs-var">field_cur</span></a></span><span>
</span><span id="line-1179"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRelRANDataCon"><span class="hs-identifier hs-var">isRelRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-1180"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Exp3
</span><a href="#local-6989586621680961539"><span class="hs-identifier hs-var">unpackWithRelRAN</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961535"><span class="hs-identifier hs-var">field_cur</span></a></span><span>
</span><span id="line-1181"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Exp3
</span><a href="#local-6989586621680961540"><span class="hs-identifier hs-var">unpackRegularDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961535"><span class="hs-identifier hs-var">field_cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1184"></span><span>    </span><span id="local-6989586621680961541"><span class="annot"><span class="annottext">tys1 :: [Ty2]
</span><a href="#local-6989586621680961541"><span class="hs-identifier hs-var hs-var">tys1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; [Char] -&gt; [Ty2]
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961525"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-1185"></span><span>    </span><span id="local-6989586621680961542"><span class="annot"><span class="annottext">processRhs :: DepEnv -&gt; TyEnv Ty2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961542"><span class="hs-identifier hs-var hs-var">processRhs</span></a></span></span><span> </span><span id="local-6989586621680961543"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961543"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680961544"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961544"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961530"><span class="hs-identifier hs-var">isPacked</span></a></span><span>
</span><span id="line-1186"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DiExp Exp3 -&gt; Exp3
forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var">fromDi</span></a></span><span> </span><span class="annot"><span class="annottext">(DiExp Exp3 -&gt; Exp3) -&gt; PassM (DiExp Exp3) -&gt; PassM Exp3
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM (DiExp Exp3)
</span><a href="Gibbon.Passes.Cursorize.html#cursorizePackedExp"><span class="hs-identifier hs-var">cursorizePackedExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961525"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961543"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961544"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961529"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961534"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1187"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; SyncEnv
-&gt; Exp2
-&gt; PassM Exp3
</span><a href="Gibbon.Passes.Cursorize.html#cursorizeExp"><span class="hs-identifier hs-var">cursorizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961525"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680961526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961543"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961544"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SyncEnv
</span><a href="#local-6989586621680961529"><span class="hs-identifier hs-var">senv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680961534"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1188"></span><span>
</span><span id="line-1189"></span><span>    </span><span class="hs-comment">-- Since this constructor does not have random access nodes, we may not be able</span><span>
</span><span id="line-1190"></span><span>    </span><span class="hs-comment">-- to unpack all the fields. Basically, anything after the first packed</span><span>
</span><span id="line-1191"></span><span>    </span><span class="hs-comment">-- value isn't accessible since we have no way to reach it without knowing</span><span>
</span><span id="line-1192"></span><span>    </span><span class="hs-comment">-- the end of the packed value. So we punt on creating bindings for such</span><span>
</span><span id="line-1193"></span><span>    </span><span class="hs-comment">-- variables, and add them to the dependency environment instead. Later, when</span><span>
</span><span id="line-1194"></span><span>    </span><span class="hs-comment">-- the appropriate end locations become available (see the LetLocE cases),</span><span>
</span><span id="line-1195"></span><span>    </span><span class="hs-comment">-- these bindings are discharged from the dependency environment.</span><span>
</span><span id="line-1196"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1197"></span><span>    </span><span class="hs-comment">-- We recurse over the fields in `go`, and create bindings as long as we `canBind`.</span><span>
</span><span id="line-1198"></span><span>    </span><span class="hs-comment">-- Otherwise, we add things to the dependency environment. `canBind` is set</span><span>
</span><span id="line-1199"></span><span>    </span><span class="hs-comment">-- to true initially, and we flip it as soon as we see a packed value.</span><span>
</span><span id="line-1200"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1201"></span><span>    </span><span class="annot"><a href="#local-6989586621680961540"><span class="hs-identifier hs-type">unpackRegularDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1202"></span><span>    </span><span id="local-6989586621680961540"><span class="annot"><span class="annottext">unpackRegularDataCon :: Var -&gt; PassM Exp3
</span><a href="#local-6989586621680961540"><span class="hs-identifier hs-var hs-var">unpackRegularDataCon</span></a></span></span><span> </span><span id="local-6989586621680961545"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961545"><span class="hs-identifier hs-var">field_cur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961545"><span class="hs-identifier hs-var">field_cur</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961533"><span class="hs-identifier hs-var">vlocs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961541"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961527"><span class="hs-identifier hs-var">denv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961545"><span class="hs-identifier hs-var">field_cur</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961528"><span class="hs-identifier hs-var">tenv1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1203"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1204"></span><span>        </span><span class="annot"><a href="#local-6989586621680961546"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1205"></span><span>        </span><span id="local-6989586621680961546"><span class="annot"><span class="annottext">go :: Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961547"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961547"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621680961548"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961548"><span class="hs-identifier hs-var">vlocs</span></a></span></span><span> </span><span id="local-6989586621680961549"><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961549"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621680961550"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span></span><span> </span><span id="local-6989586621680961551"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680961552"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961552"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1206"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961548"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961549"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1207"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DepEnv -&gt; TyEnv Ty2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961542"><span class="hs-identifier hs-var">processRhs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961552"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1208"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680961553"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961554"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961554"><span class="hs-identifier hs-var">locarg</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680961555"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span id="local-6989586621680961556"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961556"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680961557"><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1209"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961558"><span class="annot"><span class="annottext">loc :: Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961554"><span class="hs-identifier hs-var">locarg</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1210"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961556"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1211"></span><span>                </span><span class="hs-comment">-- Int, Float, Sym, or Bool</span><span>
</span><span id="line-1212"></span><span>                </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isScalarTy"><span class="hs-identifier hs-var">isScalarTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961556"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1213"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621680961559"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961559"><span class="hs-identifier hs-var">tenv'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961560"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961560"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UrTy Var
-&gt; Var
-&gt; Var
-&gt; TyEnv Ty2
-&gt; PassM (TyEnv Ty2, [(Var, [()], Ty3, Exp3)])
</span><a href="#local-6989586621680961561"><span class="hs-identifier hs-var">scalarBinds</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961556"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961552"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1214"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span>
</span><span id="line-1215"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1216"></span><span>                    </span><span class="hs-comment">-- If the location exists in the environment, it indicates that the</span><span>
</span><span id="line-1217"></span><span>                    </span><span class="hs-comment">-- corresponding variable was also bound and we shouldn't create duplicate</span><span>
</span><span id="line-1218"></span><span>                    </span><span class="hs-comment">-- bindings (checked in the LetLocE cases).</span><span>
</span><span id="line-1219"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961562"><span class="annot"><span class="annottext">binds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961562"><span class="hs-identifier hs-var hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961547"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961560"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1220"></span><span>                        </span><span id="local-6989586621680961563"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961563"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961559"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1221"></span><span>                    </span><span id="local-6989586621680961564"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961564"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961563"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-1222"></span><span>                    </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961562"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961564"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1223"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1224"></span><span>                    </span><span class="hs-comment">-- Cannot read this int. Instead, we add it to DepEnv.</span><span>
</span><span id="line-1225"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961565"><span class="annot"><span class="annottext">denv' :: DepEnv
</span><a href="#local-6989586621680961565"><span class="hs-identifier hs-var hs-var">denv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Var, [()], Ty3, Exp3)]
 -&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)])
-&gt; Var -&gt; [(Var, [()], Ty3, Exp3)] -&gt; DepEnv -&gt; DepEnv
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961560"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-1226"></span><span>                    </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961565"><span class="hs-identifier hs-var">denv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961559"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1227"></span><span>
</span><span id="line-1228"></span><span>                </span><span class="hs-comment">-- An indirection or redirection pointer.</span><span>
</span><span id="line-1229"></span><span>                </span><span class="hs-comment">-- ASSUMPTION: We can always bind it, since it occurs immediately after the tag.</span><span>
</span><span id="line-1230"></span><span>                </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1231"></span><span>                  </span><span id="local-6989586621680961566"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961566"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;readcursor_indir&quot;</span></span><span>
</span><span id="line-1232"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961567"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961567"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961566"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1233"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1234"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1235"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1236"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toTagV"><span class="hs-identifier hs-var">toTagV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1237"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toEndFromTaggedV"><span class="hs-identifier hs-var">toEndFromTaggedV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1238"></span><span>                              </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961552"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1239"></span><span>                      </span><span id="local-6989586621680961570"><span class="annot"><span class="annottext">read_cursor :: Exp3
</span><a href="#local-6989586621680961570"><span class="hs-identifier hs-var hs-var">read_cursor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isIndirectionTag"><span class="hs-identifier hs-var">isIndirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRedirectionTag"><span class="hs-identifier hs-var">isRedirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-1240"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ReadTaggedCursor"><span class="hs-identifier hs-var">ReadTaggedCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961547"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Exp3) -&gt; [Char] -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unpackRegularDataCon: cursorty without indirection/redirection.&quot;</span></span><span>
</span><span id="line-1242"></span><span>                      </span><span id="local-6989586621680961575"><span class="annot"><span class="annottext">binds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961575"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961566"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961570"><span class="hs-identifier hs-var">read_cursor</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1243"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961547"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1244"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961566"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1245"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961566"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1246"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toTagV"><span class="hs-identifier hs-var">toTagV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961566"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1247"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toEndFromTaggedV"><span class="hs-identifier hs-var">toEndFromTaggedV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toTagV"><span class="hs-identifier hs-var">toTagV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1248"></span><span>                  </span><span id="local-6989586621680961576"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961576"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961567"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1249"></span><span>                  </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961575"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961576"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1250"></span><span>
</span><span id="line-1251"></span><span>
</span><span id="line-1252"></span><span>                </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-type">VectorTy</span></a></span><span> </span><span id="local-6989586621680961577"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961577"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1253"></span><span>                  </span><span id="local-6989586621680961578"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961578"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;read_vec_tuple&quot;</span></span><span>
</span><span id="line-1254"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961579"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961579"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961578"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961577"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1255"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961577"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1256"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>                              </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961552"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1258"></span><span>                      </span><span id="local-6989586621680961580"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680961580"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961556"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1259"></span><span>                      </span><span id="local-6989586621680961581"><span class="annot"><span class="annottext">binds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961581"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961578"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961580"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ReadVector"><span class="hs-identifier hs-var">ReadVector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961577"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1260"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961580"><span class="hs-identifier hs-var">ty'</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961578"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1261"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961578"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1262"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span>
</span><span id="line-1263"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1264"></span><span>                    </span><span class="hs-comment">-- If the location exists in the environment, it indicates that the</span><span>
</span><span id="line-1265"></span><span>                    </span><span class="hs-comment">-- corresponding variable was also bound and we shouldn't create duplicate</span><span>
</span><span id="line-1266"></span><span>                    </span><span class="hs-comment">-- bindings (checked in the LetLocE cases).</span><span>
</span><span id="line-1267"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961583"><span class="annot"><span class="annottext">binds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961583"><span class="hs-identifier hs-var hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961547"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961581"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1268"></span><span>                        </span><span id="local-6989586621680961584"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961584"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961579"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1269"></span><span>                    </span><span id="local-6989586621680961585"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961585"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961584"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-1270"></span><span>                    </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961583"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961585"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1271"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1272"></span><span>                    </span><span class="hs-comment">-- Cannot read this int. Instead, we add it to DepEnv.</span><span>
</span><span id="line-1273"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961586"><span class="annot"><span class="annottext">denv' :: DepEnv
</span><a href="#local-6989586621680961586"><span class="hs-identifier hs-var hs-var">denv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Var, [()], Ty3, Exp3)]
 -&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)])
-&gt; Var -&gt; [(Var, [()], Ty3, Exp3)] -&gt; DepEnv -&gt; DepEnv
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961581"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-1274"></span><span>                    </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961586"><span class="hs-identifier hs-var">denv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961579"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1275"></span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span>                </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-type">ListTy</span></a></span><span> </span><span id="local-6989586621680961587"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961587"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1278"></span><span>                  </span><span id="local-6989586621680961588"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961588"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;read_list_tuple&quot;</span></span><span>
</span><span id="line-1279"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961589"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961589"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961588"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961587"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1280"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961587"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1281"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1282"></span><span>                              </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961552"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1283"></span><span>                      </span><span id="local-6989586621680961590"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680961590"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961556"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1284"></span><span>                      </span><span id="local-6989586621680961591"><span class="annot"><span class="annottext">binds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961591"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961588"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961590"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ReadList"><span class="hs-identifier hs-var">ReadList</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961587"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1285"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961590"><span class="hs-identifier hs-var">ty'</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961588"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1286"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961588"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1287"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span>
</span><span id="line-1288"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1289"></span><span>                    </span><span class="hs-comment">-- If the location exists in the environment, it indicates that the</span><span>
</span><span id="line-1290"></span><span>                    </span><span class="hs-comment">-- corresponding variable was also bound and we shouldn't create duplicate</span><span>
</span><span id="line-1291"></span><span>                    </span><span class="hs-comment">-- bindings (checked in the LetLocE cases).</span><span>
</span><span id="line-1292"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961593"><span class="annot"><span class="annottext">binds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961593"><span class="hs-identifier hs-var hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961547"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961591"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1293"></span><span>                        </span><span id="local-6989586621680961594"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961594"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961589"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1294"></span><span>                    </span><span id="local-6989586621680961595"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961595"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961594"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-1295"></span><span>                    </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961593"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961595"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1296"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1297"></span><span>                    </span><span class="hs-comment">-- Cannot read this int. Instead, we add it to DepEnv.</span><span>
</span><span id="line-1298"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961596"><span class="annot"><span class="annottext">denv' :: DepEnv
</span><a href="#local-6989586621680961596"><span class="hs-identifier hs-var hs-var">denv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Var, [()], Ty3, Exp3)]
 -&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)])
-&gt; Var -&gt; [(Var, [()], Ty3, Exp3)] -&gt; DepEnv -&gt; DepEnv
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961591"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-1299"></span><span>                    </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961596"><span class="hs-identifier hs-var">denv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961589"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1300"></span><span>
</span><span id="line-1301"></span><span>                </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1302"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961597"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961597"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961552"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1303"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961550"><span class="hs-identifier hs-var">canBind</span></a></span><span>
</span><span id="line-1304"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1305"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961598"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961598"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961597"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1306"></span><span>                    </span><span class="hs-comment">-- Flip canBind to indicate that the subsequent fields</span><span>
</span><span id="line-1307"></span><span>                    </span><span class="hs-comment">-- should be added to the dependency environment.</span><span>
</span><span id="line-1308"></span><span>                    </span><span id="local-6989586621680961599"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961599"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961598"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-1309"></span><span>                    </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961547"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1310"></span><span>                                    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1311"></span><span>                             </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961599"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1312"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1313"></span><span>                    </span><span class="hs-comment">-- Cannot read this. Instead, we add it to DepEnv.</span><span>
</span><span id="line-1314"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961600"><span class="annot"><span class="annottext">denv' :: DepEnv
</span><a href="#local-6989586621680961600"><span class="hs-identifier hs-var hs-var">denv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Var, [()], Ty3, Exp3)]
 -&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)])
-&gt; Var -&gt; [(Var, [()], Ty3, Exp3)] -&gt; DepEnv -&gt; DepEnv
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961551"><span class="hs-identifier hs-var">denv</span></a></span><span>
</span><span id="line-1315"></span><span>                    </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Bool
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961546"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961555"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961557"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961600"><span class="hs-identifier hs-var">denv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961597"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1316"></span><span>
</span><span id="line-1317"></span><span>                </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unpackRegularDataCon: Unexpected field &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var) -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961558"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961556"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1318"></span><span>
</span><span id="line-1319"></span><span>            </span><span class="annot"><span class="annottext">([(Var, LocArg)], [Ty2])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unpackRegularDataCon: Unexpected numnber of varible, type pairs: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, LocArg)], [Ty2]) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961548"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961549"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1320"></span><span>
</span><span id="line-1321"></span><span>    </span><span class="hs-comment">-- We have access to all fields in this constructor, and can create</span><span>
</span><span id="line-1322"></span><span>    </span><span class="hs-comment">-- bindings for everything. We begin by unpacking the random access nodes.</span><span>
</span><span id="line-1323"></span><span>    </span><span class="annot"><a href="#local-6989586621680961537"><span class="hs-identifier hs-type">unpackWithAbsRAN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1324"></span><span>    </span><span id="local-6989586621680961537"><span class="annot"><span class="annottext">unpackWithAbsRAN :: Var -&gt; PassM Exp3
</span><a href="#local-6989586621680961537"><span class="hs-identifier hs-var hs-var">unpackWithAbsRAN</span></a></span></span><span> </span><span id="local-6989586621680961601"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961601"><span class="hs-identifier hs-var">field_cur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1325"></span><span>        </span><span class="hs-comment">-- A map from a variable to a tuple containing it's location and</span><span>
</span><span id="line-1326"></span><span>        </span><span class="hs-comment">-- the RAN field it depends on. Consider this constructor:</span><span>
</span><span id="line-1327"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1328"></span><span>        </span><span class="hs-comment">--     (Node^ [(ran_y3, loc_ran_y3), (n1, loc_n1) , (x2 , loc_x2), (y3 , loc_y3)] ...),</span><span>
</span><span id="line-1329"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1330"></span><span>        </span><span class="hs-comment">-- it will be the map:</span><span>
</span><span id="line-1331"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1332"></span><span>        </span><span class="hs-comment">--     (y3 -&gt; (loc_y3, ran_y3))</span><span>
</span><span id="line-1333"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961602"><span class="annot"><span class="annottext">ran_mp :: Map Var (Var, Var)
</span><a href="#local-6989586621680961602"><span class="hs-identifier hs-var hs-var">ran_mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1334"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy Var) -&gt; [Char] -&gt; Int
forall a. Out a =&gt; DDefs (UrTy a) -&gt; [Char] -&gt; Int
</span><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier hs-var">numRANsDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DDef Ty2 -&gt; DDef (UrTy Var)) -&gt; DDefs Ty2 -&gt; DDefs (UrTy Var)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty2 -&gt; UrTy Var) -&gt; DDef Ty2 -&gt; DDef (UrTy Var)
forall a b. (a -&gt; b) -&gt; DDef a -&gt; DDef b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961525"><span class="hs-identifier hs-var">ddfs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Gibbon.Language.Constants.html#fromRANDataCon"><span class="hs-identifier hs-var">fromRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1335"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-1336"></span><span>                </span><span id="local-6989586621680961604"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961604"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Random access nodes occur immediately after the tag</span><span>
</span><span id="line-1337"></span><span>                         </span><span id="local-6989586621680961605"><span class="annot"><span class="annottext">ind_vars :: [Var]
</span><a href="#local-6989586621680961605"><span class="hs-identifier hs-var hs-var">ind_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, LocArg) -&gt; Var) -&gt; [(Var, LocArg)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, LocArg) -&gt; Var
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, LocArg)] -&gt; [Var]) -&gt; [(Var, LocArg)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">L.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961604"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961533"><span class="hs-identifier hs-var">vlocs1</span></a></span><span>
</span><span id="line-1338"></span><span>                         </span><span class="hs-comment">-- Everything else is a regular consturctor field,</span><span>
</span><span id="line-1339"></span><span>                         </span><span class="hs-comment">-- which depends on some random access node</span><span>
</span><span id="line-1340"></span><span>                         </span><span id="local-6989586621680961607"><span class="annot"><span class="annottext">data_fields :: [(Var, LocArg)]
</span><a href="#local-6989586621680961607"><span class="hs-identifier hs-var hs-var">data_fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, LocArg)] -&gt; [(Var, LocArg)])
-&gt; [(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">L.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961604"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961533"><span class="hs-identifier hs-var">vlocs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>                         </span><span class="hs-special">(</span><span id="local-6989586621680961609"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680961609"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961610"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961610"><span class="hs-identifier hs-var">var_locargs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)] -&gt; ([Var], [LocArg])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961607"><span class="hs-identifier hs-var">data_fields</span></a></span><span>
</span><span id="line-1342"></span><span>                         </span><span id="local-6989586621680961612"><span class="annot"><span class="annottext">var_locs :: [Var]
</span><a href="#local-6989586621680961612"><span class="hs-identifier hs-var hs-var">var_locs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961610"><span class="hs-identifier hs-var">var_locargs</span></a></span><span>
</span><span id="line-1343"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Var, (Var, Var))] -&gt; Map Var (Var, Var)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, (Var, Var))] -&gt; Map Var (Var, Var))
-&gt; [(Var, (Var, Var))] -&gt; Map Var (Var, Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [(Var, Var)] -&gt; [(Var, (Var, Var))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680961609"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [(Var, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680961612"><span class="hs-identifier hs-var">var_locs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680961605"><span class="hs-identifier hs-var">ind_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1344"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, Var)
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961613"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961601"><span class="hs-identifier hs-var">field_cur</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961533"><span class="hs-identifier hs-var">vlocs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961541"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961602"><span class="hs-identifier hs-var">ran_mp</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961527"><span class="hs-identifier hs-var">denv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961601"><span class="hs-identifier hs-var">field_cur</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961528"><span class="hs-identifier hs-var">tenv1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1345"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1346"></span><span>        </span><span class="annot"><a href="#local-6989586621680961613"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1347"></span><span>        </span><span id="local-6989586621680961613"><span class="annot"><span class="annottext">go :: Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, Var)
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961613"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961614"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961614"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621680961615"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961615"><span class="hs-identifier hs-var">vlocs</span></a></span></span><span> </span><span id="local-6989586621680961616"><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961616"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621680961617"><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span></span><span> </span><span id="local-6989586621680961618"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961618"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680961619"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961619"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1348"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961615"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961616"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1349"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DepEnv -&gt; TyEnv Ty2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961542"><span class="hs-identifier hs-var">processRhs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961618"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961619"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1350"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680961620"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961621"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961621"><span class="hs-identifier hs-var">locarg</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680961622"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961622"><span class="hs-identifier hs-var">rst_vlocs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span id="local-6989586621680961623"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961623"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680961624"><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961624"><span class="hs-identifier hs-var">rst_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1351"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961625"><span class="annot"><span class="annottext">loc :: Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961621"><span class="hs-identifier hs-var">locarg</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1352"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961623"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1353"></span><span>                </span><span class="hs-comment">-- The random access pointer</span><span>
</span><span id="line-1354"></span><span>                </span><span class="hs-comment">-- ASSUMPTION: We can always bind it, since it occurs immediately after the tag.</span><span>
</span><span id="line-1355"></span><span class="hs-comment">{-
                CursorTy -&gt; do
                  tmp &lt;- gensym &quot;readcursor_shortcut&quot;
                  let tenv' = M.union (M.fromList [(tmp     , MkTy2 (ProdTy [CursorTy, CursorTy])),
                                                   (loc     , MkTy2 CursorTy),
                                                   (v       , MkTy2 CursorTy),
                                                   (toEndV v, MkTy2 CursorTy)])
                              tenv

                      binds = [(tmp     , [], ProdTy [CursorTy, CursorTy], Ext $ ReadCursor cur),
                               (loc     , [], CursorTy, VarE cur),
                               (v       , [], CursorTy, ProjE 0 (VarE tmp)),
                               (toEndV v, [], CursorTy, ProjE 1 (VarE tmp))]
                  bod &lt;- go (toEndV v) rst_vlocs rst_tys indirections_env denv tenv'
                  return $ mkLets binds bod
-}</span><span>
</span><span id="line-1371"></span><span>
</span><span id="line-1372"></span><span>                </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1373"></span><span>                  </span><span id="local-6989586621680961626"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961626"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;readcursor_shortcut&quot;</span></span><span>
</span><span id="line-1374"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961627"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961627"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961626"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1375"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1376"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1377"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1378"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toTagV"><span class="hs-identifier hs-var">toTagV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1379"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toEndFromTaggedV"><span class="hs-identifier hs-var">toEndFromTaggedV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>                              </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961619"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1381"></span><span>                      </span><span id="local-6989586621680961628"><span class="annot"><span class="annottext">read_cursor :: Exp3
</span><a href="#local-6989586621680961628"><span class="hs-identifier hs-var hs-var">read_cursor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ReadTaggedCursor"><span class="hs-identifier hs-var">ReadTaggedCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961614"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1382"></span><span>                      </span><span id="local-6989586621680961629"><span class="annot"><span class="annottext">binds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961629"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961626"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961628"><span class="hs-identifier hs-var">read_cursor</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1383"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961614"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1384"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961626"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1385"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961626"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1386"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toTagV"><span class="hs-identifier hs-var">toTagV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961626"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1387"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toEndFromTaggedV"><span class="hs-identifier hs-var">toEndFromTaggedV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toTagV"><span class="hs-identifier hs-var">toTagV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1388"></span><span>                  </span><span id="local-6989586621680961630"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961630"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, Var)
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961613"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961622"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961624"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961618"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961627"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1389"></span><span>                  </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961629"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961630"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1390"></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span>                </span><span class="hs-comment">-- Int, Sym, or Bool</span><span>
</span><span id="line-1393"></span><span>                </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isScalarTy"><span class="hs-identifier hs-var">isScalarTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961623"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1394"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621680961631"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961631"><span class="hs-identifier hs-var">tenv'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961632"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961632"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UrTy Var
-&gt; Var
-&gt; Var
-&gt; TyEnv Ty2
-&gt; PassM (TyEnv Ty2, [(Var, [()], Ty3, Exp3)])
</span><a href="#local-6989586621680961561"><span class="hs-identifier hs-var">scalarBinds</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961623"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961619"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1395"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961633"><span class="annot"><span class="annottext">loc_bind :: (Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961633"><span class="hs-identifier hs-var hs-var">loc_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var (Var, Var) -&gt; Maybe (Var, Var)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1396"></span><span>                                   </span><span class="annot"><span class="annottext">Maybe (Var, Var)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1397"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961614"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1398"></span><span>                                   </span><span class="hs-comment">-- Read this using a random access node</span><span>
</span><span id="line-1399"></span><span>                                   </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961634"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961634"><span class="hs-identifier hs-var">_var_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961635"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961635"><span class="hs-identifier hs-var">ind_var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1400"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961635"><span class="hs-identifier hs-var">ind_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1401"></span><span>                      </span><span id="local-6989586621680961636"><span class="annot"><span class="annottext">binds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961636"><span class="hs-identifier hs-var hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961633"><span class="hs-identifier hs-var">loc_bind</span></a></span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961632"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1402"></span><span>                      </span><span id="local-6989586621680961637"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961637"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961631"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1403"></span><span>                  </span><span id="local-6989586621680961638"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961638"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, Var)
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961613"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961622"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961624"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961618"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961637"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-1404"></span><span>                  </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961636"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961638"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1405"></span><span>
</span><span id="line-1406"></span><span>                </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-type">VectorTy</span></a></span><span> </span><span id="local-6989586621680961639"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961639"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1407"></span><span>                  </span><span id="local-6989586621680961640"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961640"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;read_vec_tuple&quot;</span></span><span>
</span><span id="line-1408"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961641"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961641"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961640"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961639"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1409"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961639"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1410"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1411"></span><span>                              </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961619"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1412"></span><span>                      </span><span id="local-6989586621680961642"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680961642"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961623"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1413"></span><span>                      </span><span id="local-6989586621680961643"><span class="annot"><span class="annottext">binds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961643"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961640"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961642"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ReadVector"><span class="hs-identifier hs-var">ReadVector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961639"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1414"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961642"><span class="hs-identifier hs-var">ty'</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961640"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1415"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961640"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1416"></span><span>                      </span><span id="local-6989586621680961644"><span class="annot"><span class="annottext">loc_bind :: (Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961644"><span class="hs-identifier hs-var hs-var">loc_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var (Var, Var) -&gt; Maybe (Var, Var)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1417"></span><span>                                   </span><span class="annot"><span class="annottext">Maybe (Var, Var)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1418"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961614"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1419"></span><span>                                   </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961645"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961645"><span class="hs-identifier hs-var">_var_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961646"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961646"><span class="hs-identifier hs-var">ind_var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1420"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961646"><span class="hs-identifier hs-var">ind_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1421"></span><span>                      </span><span id="local-6989586621680961647"><span class="annot"><span class="annottext">binds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961647"><span class="hs-identifier hs-var hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961644"><span class="hs-identifier hs-var">loc_bind</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961643"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1422"></span><span>                      </span><span id="local-6989586621680961648"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961648"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961641"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1423"></span><span>                  </span><span id="local-6989586621680961649"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961649"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, Var)
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961613"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961622"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961624"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961618"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961648"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-1424"></span><span>                  </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961647"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961649"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1425"></span><span>
</span><span id="line-1426"></span><span>                </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-type">ListTy</span></a></span><span> </span><span id="local-6989586621680961650"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961650"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1427"></span><span>                  </span><span id="local-6989586621680961651"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961651"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;read_list_tuple&quot;</span></span><span>
</span><span id="line-1428"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961652"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961652"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961651"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-var">VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961650"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1429"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var
forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-var">ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961650"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1430"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1431"></span><span>                              </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961619"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1432"></span><span>                      </span><span id="local-6989586621680961653"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680961653"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961623"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1433"></span><span>                      </span><span id="local-6989586621680961654"><span class="annot"><span class="annottext">binds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961654"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961651"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961653"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ReadList"><span class="hs-identifier hs-var">ReadList</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961650"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1434"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961653"><span class="hs-identifier hs-var">ty'</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961651"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1435"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961651"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1436"></span><span>                      </span><span id="local-6989586621680961655"><span class="annot"><span class="annottext">loc_bind :: (Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961655"><span class="hs-identifier hs-var hs-var">loc_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var (Var, Var) -&gt; Maybe (Var, Var)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1437"></span><span>                                   </span><span class="annot"><span class="annottext">Maybe (Var, Var)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1438"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961614"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1439"></span><span>                                   </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961656"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961656"><span class="hs-identifier hs-var">_var_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961657"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961657"><span class="hs-identifier hs-var">ind_var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1440"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961657"><span class="hs-identifier hs-var">ind_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1441"></span><span>                      </span><span id="local-6989586621680961658"><span class="annot"><span class="annottext">binds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961658"><span class="hs-identifier hs-var hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961655"><span class="hs-identifier hs-var">loc_bind</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961654"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1442"></span><span>                      </span><span id="local-6989586621680961659"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961659"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961652"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1443"></span><span>                  </span><span id="local-6989586621680961660"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961660"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, Var)
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961613"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961622"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961624"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961618"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961659"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-1444"></span><span>                  </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961658"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961660"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1445"></span><span>
</span><span id="line-1446"></span><span>                </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1447"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961661"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961661"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1448"></span><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span>                              </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961619"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1450"></span><span>                      </span><span id="local-6989586621680961662"><span class="annot"><span class="annottext">loc_bind :: (Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961662"><span class="hs-identifier hs-var hs-var">loc_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var (Var, Var) -&gt; Maybe (Var, Var)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1451"></span><span>                                   </span><span class="hs-comment">-- This is the first packed value. We can unpack this.</span><span>
</span><span id="line-1452"></span><span>                                   </span><span class="annot"><span class="annottext">Maybe (Var, Var)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1453"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961614"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1454"></span><span>                                   </span><span class="hs-comment">-- We need to access this using a random access node</span><span>
</span><span id="line-1455"></span><span>                                   </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961663"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961663"><span class="hs-identifier hs-var">_var_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961664"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961664"><span class="hs-identifier hs-var">ind_var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1456"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961664"><span class="hs-identifier hs-var">ind_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1457"></span><span>                  </span><span id="local-6989586621680961665"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961665"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, Var)
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961613"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961622"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961624"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, Var)
</span><a href="#local-6989586621680961617"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961618"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961661"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1458"></span><span>                  </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961662"><span class="hs-identifier hs-var">loc_bind</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961665"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span>                </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unpackWitnAbsRAN: Unexpected field &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var) -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961620"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961625"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961623"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1461"></span><span>
</span><span id="line-1462"></span><span>            </span><span class="annot"><span class="annottext">([(Var, LocArg)], [Ty2])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unpackWitnAbsRAN: Unexpected numnber of varible, type pairs: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, LocArg)], [Ty2]) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961615"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961616"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1463"></span><span>
</span><span id="line-1464"></span><span>    </span><span class="hs-comment">-- We have access to all fields in this constructor, and can create</span><span>
</span><span id="line-1465"></span><span>    </span><span class="hs-comment">-- bindings for everything. We begin by unpacking the random access nodes.</span><span>
</span><span id="line-1466"></span><span>    </span><span class="annot"><a href="#local-6989586621680961539"><span class="hs-identifier hs-type">unpackWithRelRAN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1467"></span><span>    </span><span id="local-6989586621680961539"><span class="annot"><span class="annottext">unpackWithRelRAN :: Var -&gt; PassM Exp3
</span><a href="#local-6989586621680961539"><span class="hs-identifier hs-var hs-var">unpackWithRelRAN</span></a></span></span><span> </span><span id="local-6989586621680961666"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961666"><span class="hs-identifier hs-var">field_cur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1468"></span><span>        </span><span class="hs-comment">-- ran_mp is a map from a variable to a tuple containing it's location and</span><span>
</span><span id="line-1469"></span><span>        </span><span class="hs-comment">-- the RAN field it depends on. Consider this constructor:</span><span>
</span><span id="line-1470"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1471"></span><span>        </span><span class="hs-comment">--     (Node* [(ran_y3, loc_ran_y3), (n1, loc_n1) , (x2 , loc_x2), (y3 , loc_y3)] ...),</span><span>
</span><span id="line-1472"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1473"></span><span>        </span><span class="hs-comment">-- it will be the map:</span><span>
</span><span id="line-1474"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1475"></span><span>        </span><span class="hs-comment">--     (y3 -&gt; (loc_y3, ran_y3))</span><span>
</span><span id="line-1476"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961667"><span class="annot"><span class="annottext">ran_mp :: Map Var (Var, (Var, Var))
</span><a href="#local-6989586621680961667"><span class="hs-identifier hs-var hs-var">ran_mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1477"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy Var) -&gt; [Char] -&gt; Int
forall a. Out a =&gt; DDefs (UrTy a) -&gt; [Char] -&gt; Int
</span><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier hs-var">numRANsDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DDef Ty2 -&gt; DDef (UrTy Var)) -&gt; DDefs Ty2 -&gt; DDefs (UrTy Var)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty2 -&gt; UrTy Var) -&gt; DDef Ty2 -&gt; DDef (UrTy Var)
forall a b. (a -&gt; b) -&gt; DDef a -&gt; DDef b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680961525"><span class="hs-identifier hs-var">ddfs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Gibbon.Language.Constants.html#fromRANDataCon"><span class="hs-identifier hs-var">fromRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680961532"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1478"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var (Var, (Var, Var))
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-1479"></span><span>                </span><span id="local-6989586621680961668"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961668"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Random access nodes occur immediately after the tag</span><span>
</span><span id="line-1480"></span><span>                         </span><span id="local-6989586621680961669"><span class="annot"><span class="annottext">inds :: [(Var, LocArg)]
</span><a href="#local-6989586621680961669"><span class="hs-identifier hs-var hs-var">inds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">L.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961668"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, LocArg)] -&gt; [(Var, LocArg)])
-&gt; [(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#drop"><span class="hs-identifier hs-var">L.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961533"><span class="hs-identifier hs-var">vlocs1</span></a></span><span>
</span><span id="line-1481"></span><span>                         </span><span class="hs-comment">-- Everything else is a regular consturctor field,</span><span>
</span><span id="line-1482"></span><span>                         </span><span class="hs-comment">-- which depends on some random access node</span><span>
</span><span id="line-1483"></span><span>                         </span><span id="local-6989586621680961670"><span class="annot"><span class="annottext">data_fields :: [(Var, LocArg)]
</span><a href="#local-6989586621680961670"><span class="hs-identifier hs-var hs-var">data_fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, LocArg)] -&gt; [(Var, LocArg)])
-&gt; [(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">L.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961668"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, LocArg)] -&gt; [(Var, LocArg)]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961533"><span class="hs-identifier hs-var">vlocs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1484"></span><span>                         </span><span class="hs-special">(</span><span id="local-6989586621680961671"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680961671"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961672"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961672"><span class="hs-identifier hs-var">var_locargs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)] -&gt; ([Var], [LocArg])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961670"><span class="hs-identifier hs-var">data_fields</span></a></span><span>
</span><span id="line-1485"></span><span>                         </span><span id="local-6989586621680961673"><span class="annot"><span class="annottext">var_locs :: [Var]
</span><a href="#local-6989586621680961673"><span class="hs-identifier hs-var hs-var">var_locs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680961672"><span class="hs-identifier hs-var">var_locargs</span></a></span><span>
</span><span id="line-1486"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Var, (Var, (Var, Var)))] -&gt; Map Var (Var, (Var, Var))
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, (Var, (Var, Var)))] -&gt; Map Var (Var, (Var, Var)))
-&gt; [(Var, (Var, (Var, Var)))] -&gt; Map Var (Var, (Var, Var))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [(Var, (Var, Var))] -&gt; [(Var, (Var, (Var, Var)))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680961671"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [(Var, Var)] -&gt; [(Var, (Var, Var))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680961673"><span class="hs-identifier hs-var">var_locs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Var, LocArg) -&gt; (Var, Var)) -&gt; [(Var, LocArg)] -&gt; [(Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680961674"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961674"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961675"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961675"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961674"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961675"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961669"><span class="hs-identifier hs-var">inds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1487"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, (Var, Var))
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961676"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961666"><span class="hs-identifier hs-var">field_cur</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961533"><span class="hs-identifier hs-var">vlocs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961541"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, (Var, Var))
</span><a href="#local-6989586621680961667"><span class="hs-identifier hs-var">ran_mp</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961527"><span class="hs-identifier hs-var">denv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961666"><span class="hs-identifier hs-var">field_cur</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961528"><span class="hs-identifier hs-var">tenv1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1488"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1489"></span><span>        </span><span class="annot"><a href="#local-6989586621680961676"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DepEnv"><span class="hs-identifier hs-type">DepEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1490"></span><span>        </span><span id="local-6989586621680961676"><span class="annot"><span class="annottext">go :: Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, (Var, Var))
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961676"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961677"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961677"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621680961678"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961678"><span class="hs-identifier hs-var">vlocs</span></a></span></span><span> </span><span id="local-6989586621680961679"><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961679"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621680961680"><span class="annot"><span class="annottext">Map Var (Var, (Var, Var))
</span><a href="#local-6989586621680961680"><span class="hs-identifier hs-var">indirections_env</span></a></span></span><span> </span><span id="local-6989586621680961681"><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961681"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621680961682"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961682"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1491"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961678"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961679"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1492"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DepEnv -&gt; TyEnv Ty2 -&gt; PassM Exp3
</span><a href="#local-6989586621680961542"><span class="hs-identifier hs-var">processRhs</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961681"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961682"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1493"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680961683"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680961684"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961684"><span class="hs-identifier hs-var">locarg</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680961685"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961685"><span class="hs-identifier hs-var">rst_vlocs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span id="local-6989586621680961686"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961686"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680961687"><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961687"><span class="hs-identifier hs-var">rst_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1494"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961688"><span class="annot"><span class="annottext">loc :: Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680961684"><span class="hs-identifier hs-var">locarg</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1495"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961686"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1496"></span><span>                </span><span class="hs-comment">-- Int, Sym, or Bool</span><span>
</span><span id="line-1497"></span><span>                </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isScalarTy"><span class="hs-identifier hs-var">isScalarTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961686"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1498"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621680961689"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961689"><span class="hs-identifier hs-var">tenv'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961690"><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961690"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UrTy Var
-&gt; Var
-&gt; Var
-&gt; TyEnv Ty2
-&gt; PassM (TyEnv Ty2, [(Var, [()], Ty3, Exp3)])
</span><a href="#local-6989586621680961561"><span class="hs-identifier hs-var">scalarBinds</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961686"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961682"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1499"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961691"><span class="annot"><span class="annottext">loc_bind :: (Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961691"><span class="hs-identifier hs-var hs-var">loc_bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var (Var, (Var, Var)) -&gt; Maybe (Var, (Var, Var))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, (Var, Var))
</span><a href="#local-6989586621680961680"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1500"></span><span>                                   </span><span class="hs-comment">-- This appears before the first packed field. Unpack it</span><span>
</span><span id="line-1501"></span><span>                                   </span><span class="hs-comment">-- in the usual way.</span><span>
</span><span id="line-1502"></span><span>                                   </span><span class="annot"><span class="annottext">Maybe (Var, (Var, Var))
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1503"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961677"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1504"></span><span>                                   </span><span class="hs-comment">-- We need to read this using a random access node</span><span>
</span><span id="line-1505"></span><span>                                   </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961692"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961692"><span class="hs-identifier hs-var">_var_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961693"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961693"><span class="hs-identifier hs-var">ind_var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961694"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961694"><span class="hs-identifier hs-var">ind_loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1506"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961694"><span class="hs-identifier hs-var">ind_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961693"><span class="hs-identifier hs-var">ind_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1507"></span><span>                      </span><span id="local-6989586621680961695"><span class="annot"><span class="annottext">binds' :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961695"><span class="hs-identifier hs-var hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
</span><a href="#local-6989586621680961691"><span class="hs-identifier hs-var">loc_bind</span></a></span><span class="annot"><span class="annottext">(Var, [()], Ty3, Exp3)
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961690"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1508"></span><span>                      </span><span id="local-6989586621680961696"><span class="annot"><span class="annottext">tenv'' :: TyEnv Ty2
</span><a href="#local-6989586621680961696"><span class="hs-identifier hs-var hs-var">tenv''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961689"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1509"></span><span>                  </span><span id="local-6989586621680961697"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961697"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, (Var, Var))
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961676"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961685"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961687"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, (Var, Var))
</span><a href="#local-6989586621680961680"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961681"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961696"><span class="hs-identifier hs-var">tenv''</span></a></span><span>
</span><span id="line-1510"></span><span>                  </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961695"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961697"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1511"></span><span>
</span><span id="line-1512"></span><span>                </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1513"></span><span>                  </span><span id="local-6989586621680961698"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961698"><span class="hs-identifier hs-var">tmp_loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;loc&quot;</span></span><span>
</span><span id="line-1514"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961699"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961699"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1515"></span><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1516"></span><span>                              </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961682"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1517"></span><span>                      </span><span id="local-6989586621680961700"><span class="annot"><span class="annottext">loc_binds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961700"><span class="hs-identifier hs-var hs-var">loc_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var (Var, (Var, Var)) -&gt; Maybe (Var, (Var, Var))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, (Var, Var))
</span><a href="#local-6989586621680961680"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1518"></span><span>                                    </span><span class="hs-comment">-- This is the first packed value. We can unpack this.</span><span>
</span><span id="line-1519"></span><span>                                    </span><span class="annot"><span class="annottext">Maybe (Var, (Var, Var))
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1520"></span><span>                                      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961677"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1521"></span><span>                                    </span><span class="hs-comment">-- We need to access this using a random access node</span><span>
</span><span id="line-1522"></span><span>                                    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961701"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961701"><span class="hs-identifier hs-var">_var_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961702"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961702"><span class="hs-identifier hs-var">ind_var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961703"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961703"><span class="hs-identifier hs-var">ind_loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1523"></span><span>                                      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961698"><span class="hs-identifier hs-var">tmp_loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961703"><span class="hs-identifier hs-var">ind_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961702"><span class="hs-identifier hs-var">ind_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1524"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961698"><span class="hs-identifier hs-var">tmp_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1525"></span><span>                  </span><span id="local-6989586621680961704"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961704"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [(Var, LocArg)]
-&gt; [Ty2]
-&gt; Map Var (Var, (Var, Var))
-&gt; DepEnv
-&gt; TyEnv Ty2
-&gt; PassM Exp3
</span><a href="#local-6989586621680961676"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961685"><span class="hs-identifier hs-var">rst_vlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961687"><span class="hs-identifier hs-var">rst_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Var, (Var, Var))
</span><a href="#local-6989586621680961680"><span class="hs-identifier hs-var">indirections_env</span></a></span><span> </span><span class="annot"><span class="annottext">DepEnv
</span><a href="#local-6989586621680961681"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961699"><span class="hs-identifier hs-var">tenv'</span></a></span><span>
</span><span id="line-1526"></span><span>                  </span><span class="annot"><span class="annottext">Exp3 -&gt; PassM Exp3
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; PassM Exp3) -&gt; Exp3 -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)] -&gt; Exp3 -&gt; Exp3
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961700"><span class="hs-identifier hs-var">loc_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
-&gt; [(Var, [()], Ty3, Exp3)] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961704"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1527"></span><span>
</span><span id="line-1528"></span><span>                </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unpackWithRelRAN: Unexpected field &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var) -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961683"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961688"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961686"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1529"></span><span>
</span><span id="line-1530"></span><span>            </span><span class="annot"><span class="annottext">([(Var, LocArg)], [Ty2])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp3
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp3) -&gt; [Char] -&gt; PassM Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unpackWithRelRAN: Unexpected numnber of varible, type pairs: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, LocArg)], [Ty2]) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680961678"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680961679"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1531"></span><span>
</span><span id="line-1532"></span><span>    </span><span class="hs-comment">-- Generate bindings for unpacking int fields. A convenient</span><span>
</span><span id="line-1533"></span><span>    </span><span class="annot"><a href="#local-6989586621680961561"><span class="hs-identifier hs-type">scalarBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#OldTy2"><span class="hs-identifier hs-type">OldTy2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1534"></span><span>    </span><span id="local-6989586621680961561"><span class="annot"><span class="annottext">scalarBinds :: UrTy Var
-&gt; Var
-&gt; Var
-&gt; TyEnv Ty2
-&gt; PassM (TyEnv Ty2, [(Var, [()], Ty3, Exp3)])
</span><a href="#local-6989586621680961561"><span class="hs-identifier hs-var hs-var">scalarBinds</span></a></span></span><span> </span><span id="local-6989586621680961705"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961705"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680961706"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961706"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680961707"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961707"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680961708"><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961708"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1535"></span><span>      </span><span id="local-6989586621680961709"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961709"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;read_scalar_tuple&quot;</span></span><span>
</span><span id="line-1536"></span><span>      </span><span class="hs-comment">-- Note that the location is not added to the type environment here.</span><span>
</span><span id="line-1537"></span><span>      </span><span class="hs-comment">-- The caller of this fn will do that later, depending on whether we're</span><span>
</span><span id="line-1538"></span><span>      </span><span class="hs-comment">-- binding the location now or later via DepEnv.</span><span>
</span><span id="line-1539"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961710"><span class="annot"><span class="annottext">s :: Scalar
</span><a href="#local-6989586621680961710"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Scalar
forall a. Out a =&gt; UrTy a -&gt; Scalar
</span><a href="Gibbon.L3.Syntax.html#mkScalar"><span class="hs-identifier hs-var">mkScalar</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961705"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1540"></span><span>          </span><span id="local-6989586621680961711"><span class="annot"><span class="annottext">tenv' :: TyEnv Ty2
</span><a href="#local-6989586621680961711"><span class="hs-identifier hs-var hs-var">tenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961709"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961705"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1541"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961706"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961705"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1542"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961706"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1543"></span><span>                  </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961708"><span class="hs-identifier hs-var">tenv</span></a></span><span>
</span><span id="line-1544"></span><span>
</span><span id="line-1545"></span><span>          </span><span id="local-6989586621680961712"><span class="annot"><span class="annottext">ty' :: Ty3
</span><a href="#local-6989586621680961712"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty3
forall a. UrTy a -&gt; Ty3
</span><a href="Gibbon.Language.html#stripTyLocs"><span class="hs-identifier hs-var">stripTyLocs</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961705"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1546"></span><span>
</span><span id="line-1547"></span><span>          </span><span id="local-6989586621680961713"><span class="annot"><span class="annottext">binds :: [(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961713"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961709"><span class="hs-identifier hs-var">tmp</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961712"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar -&gt; Var -&gt; E3Ext () Ty3
forall loc dec. Scalar -&gt; Var -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ReadScalar"><span class="hs-identifier hs-var">ReadScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680961710"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961707"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1548"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961706"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961712"><span class="hs-identifier hs-var">ty'</span></a></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961709"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1549"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961706"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961709"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1550"></span><span>      </span><span class="annot"><span class="annottext">(TyEnv Ty2, [(Var, [()], Ty3, Exp3)])
-&gt; PassM (TyEnv Ty2, [(Var, [()], Ty3, Exp3)])
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680961711"><span class="hs-identifier hs-var">tenv'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], Ty3, Exp3)]
</span><a href="#local-6989586621680961713"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1551"></span><span>
</span><span id="line-1552"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#giveStarts"><span class="hs-identifier hs-type">giveStarts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#OldTy2"><span class="hs-identifier hs-type">OldTy2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1553"></span><span id="giveStarts"><span class="annot"><span class="annottext">giveStarts :: UrTy Var -&gt; Exp3 -&gt; Exp3
</span><a href="Gibbon.Passes.Cursorize.html#giveStarts"><span class="hs-identifier hs-var hs-var">giveStarts</span></a></span></span><span> </span><span id="local-6989586621680961717"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961717"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680961718"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961718"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1554"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961717"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1555"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961718"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1556"></span><span>    </span><span class="hs-comment">-- NOTE : mkProj . MkProdE == id</span><span>
</span><span id="line-1557"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680961719"><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680961719"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp3] -&gt; Exp3) -&gt; [Exp3] -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; Int -&gt; Exp3) -&gt; [UrTy Var] -&gt; [Int] -&gt; [Exp3]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680961720"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961720"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span id="local-6989586621680961721"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961721"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Exp3 -&gt; Exp3
</span><a href="Gibbon.Passes.Cursorize.html#giveStarts"><span class="hs-identifier hs-var">giveStarts</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680961720"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961721"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961718"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680961719"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-1558"></span><span>    </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961718"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1559"></span><span>
</span><span id="line-1560"></span><span>
</span><span id="line-1561"></span><span id="local-6989586621680959825"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#projValTy"><span class="hs-identifier hs-type">projValTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-type">Out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959825"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959825"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1562"></span><span id="projValTy"><span class="annot"><span class="annottext">projValTy :: forall a. Out a =&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Passes.Cursorize.html#projValTy"><span class="hs-identifier hs-var hs-var">projValTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; UrTy a -&gt; UrTy a
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1563"></span><span>
</span><span id="line-1564"></span><span id="local-6989586621680961724"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#projEndsTy"><span class="hs-identifier hs-type">projEndsTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-type">Out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680961724"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680961724"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680961724"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1565"></span><span id="projEndsTy"><span class="annot"><span class="annottext">projEndsTy :: forall a. Out a =&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Passes.Cursorize.html#projEndsTy"><span class="hs-identifier hs-var hs-var">projEndsTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; UrTy a -&gt; UrTy a
forall a. Out a =&gt; Int -&gt; UrTy a -&gt; UrTy a
</span><a href="Gibbon.Language.html#projTy"><span class="hs-identifier hs-var">projTy</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1566"></span><span>
</span><span id="line-1567"></span><span>
</span><span id="line-1568"></span><span class="annot"><span class="hs-comment">-- | Bindings for a letregion</span></span><span>
</span><span id="line-1569"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#regionToBinds"><span class="hs-identifier hs-type">regionToBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#RegionSize"><span class="hs-identifier hs-type">RegionSize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1570"></span><span id="regionToBinds"><span class="annot"><span class="annottext">regionToBinds :: Bool -&gt; Region -&gt; RegionSize -&gt; [(Var, [()], Ty3, Exp3)]
</span><a href="Gibbon.Passes.Cursorize.html#regionToBinds"><span class="hs-identifier hs-var hs-var">regionToBinds</span></a></span></span><span> </span><span id="local-6989586621680961735"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961735"><span class="hs-identifier hs-var">for_parallel_allocs</span></a></span></span><span> </span><span id="local-6989586621680961736"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680961736"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680961737"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680961737"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1571"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680961736"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1572"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#VarR"><span class="hs-identifier hs-type">VarR</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [(Var, [()], Ty3, Exp3)]
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [(Var, [()], Ty3, Exp3)])
-&gt; [Char] -&gt; [(Var, [()], Ty3, Exp3)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unexpected VarR in Cursorize.&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680961736"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1573"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#GlobR"><span class="hs-identifier hs-type">GlobR</span></a></span><span> </span><span id="local-6989586621680961738"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961738"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680961739"><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961739"><span class="hs-identifier hs-var">mul</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961740"><span class="annot"><span class="annottext">mul' :: Multiplicity
</span><a href="#local-6989586621680961740"><span class="hs-identifier hs-var hs-var">mul'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; Multiplicity
</span><a href="#local-6989586621680961741"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961739"><span class="hs-identifier hs-var">mul</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1574"></span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961735"><span class="hs-identifier hs-var">for_parallel_allocs</span></a></span><span>
</span><span id="line-1575"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961738"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; E3Ext () Ty3
forall loc dec. Multiplicity -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#NewParBuffer"><span class="hs-identifier hs-var">NewParBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961740"><span class="hs-identifier hs-var">mul'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1576"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961738"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; E3Ext () Ty3
forall loc dec. Multiplicity -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#EndOfBuffer"><span class="hs-identifier hs-var">EndOfBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961740"><span class="hs-identifier hs-var">mul'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1577"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961738"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; E3Ext () Ty3
forall loc dec. Multiplicity -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#NewBuffer"><span class="hs-identifier hs-var">NewBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961740"><span class="hs-identifier hs-var">mul'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961738"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; E3Ext () Ty3
forall loc dec. Multiplicity -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#EndOfBuffer"><span class="hs-identifier hs-var">EndOfBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961740"><span class="hs-identifier hs-var">mul'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1579"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#DynR"><span class="hs-identifier hs-type">DynR</span></a></span><span> </span><span id="local-6989586621680961745"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961745"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680961746"><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961746"><span class="hs-identifier hs-var">mul</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680961747"><span class="annot"><span class="annottext">mul' :: Multiplicity
</span><a href="#local-6989586621680961747"><span class="hs-identifier hs-var hs-var">mul'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; Multiplicity
</span><a href="#local-6989586621680961741"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961746"><span class="hs-identifier hs-var">mul</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1580"></span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680961735"><span class="hs-identifier hs-var">for_parallel_allocs</span></a></span><span>
</span><span id="line-1581"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961745"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; E3Ext () Ty3
forall loc dec. Multiplicity -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ScopedParBuffer"><span class="hs-identifier hs-var">ScopedParBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961747"><span class="hs-identifier hs-var">mul'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1582"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961745"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; E3Ext () Ty3
forall loc dec. Multiplicity -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#EndOfBuffer"><span class="hs-identifier hs-var">EndOfBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961747"><span class="hs-identifier hs-var">mul'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1583"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961745"><span class="hs-identifier hs-var">v</span></a></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; E3Ext () Ty3
forall loc dec. Multiplicity -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#ScopedBuffer"><span class="hs-identifier hs-var">ScopedBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961747"><span class="hs-identifier hs-var">mul'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1584"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961745"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E3Ext () Ty3 -&gt; Exp3) -&gt; E3Ext () Ty3 -&gt; Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity -&gt; E3Ext () Ty3
forall loc dec. Multiplicity -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#EndOfBuffer"><span class="hs-identifier hs-var">EndOfBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961747"><span class="hs-identifier hs-var">mul'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1585"></span><span>    </span><span class="hs-comment">-- TODO: docs</span><span>
</span><span id="line-1586"></span><span>    </span><span class="annot"><a href="Gibbon.L2.Syntax.html#MMapR"><span class="hs-identifier hs-type">MMapR</span></a></span><span> </span><span id="local-6989586621680961750"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680961750"><span class="hs-identifier hs-var">_v</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1587"></span><span>
</span><span id="line-1588"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1589"></span><span>  </span><span id="local-6989586621680961741"><span class="annot"><span class="annottext">go :: Multiplicity -&gt; Multiplicity
</span><a href="#local-6989586621680961741"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680961751"><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961751"><span class="hs-identifier hs-var">mul</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1590"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680961737"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1591"></span><span>      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundedSize"><span class="hs-identifier hs-type">BoundedSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961751"><span class="hs-identifier hs-var">mul</span></a></span><span>
</span><span id="line-1592"></span><span>      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundedSize"><span class="hs-identifier hs-type">BoundedSize</span></a></span><span> </span><span id="local-6989586621680961753"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961753"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Multiplicity
</span><a href="Gibbon.L2.Syntax.html#Bounded"><span class="hs-identifier hs-var">Bounded</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680961753"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1593"></span><span>      </span><span class="annot"><span class="annottext">RegionSize
</span><a href="Gibbon.L2.Syntax.html#Undefined"><span class="hs-identifier hs-var">Undefined</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680961751"><span class="hs-identifier hs-var">mul</span></a></span><span>
</span><span id="line-1594"></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#isBound"><span class="hs-identifier hs-type">isBound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1597"></span><span id="isBound"><span class="annot"><span class="annottext">isBound :: Var -&gt; TyEnv Ty2 -&gt; Bool
</span><a href="Gibbon.Passes.Cursorize.html#isBound"><span class="hs-identifier hs-var hs-var">isBound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span>
</span><span id="line-1598"></span><span>
</span><span id="line-1599"></span><span class="hs-comment">-- ================================================================================</span><span>
</span><span id="line-1600"></span><span class="hs-comment">--                         Dilation Conventions</span><span>
</span><span id="line-1601"></span><span class="hs-comment">-- ================================================================================</span><span>
</span><span id="line-1602"></span><span class="hs-comment">-- Everything to do with dilation.  It should be possible to change</span><span>
</span><span id="line-1603"></span><span class="hs-comment">-- the dilated format by changing only this section.</span><span>
</span><span id="line-1604"></span><span>
</span><span id="line-1605"></span><span>
</span><span id="line-1606"></span><span class="hs-comment">-- | If an expression `e` returns type `T`, then a dilated version of</span><span>
</span><span id="line-1607"></span><span class="hs-comment">-- `e` returns a tuple (T,Cursors), where cursors contains a flat</span><span>
</span><span id="line-1608"></span><span class="hs-comment">-- record of end-cursors corresponding exactly to all the components</span><span>
</span><span id="line-1609"></span><span class="hs-comment">-- of T which are PackedTy.</span><span>
</span><span id="line-1610"></span><span class="hs-comment">--</span><span>
</span><span id="line-1611"></span><span class="hs-keyword">newtype</span><span> </span><span id="DiExp"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-var">DiExp</span></a></span></span><span> </span><span id="local-6989586621680961758"><span class="annot"><a href="#local-6989586621680961758"><span class="hs-identifier hs-type">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Di"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680961758"><span class="hs-identifier hs-type">ex</span></a></span><span>
</span><span id="line-1612"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680961760"><span id="local-6989586621680961762"><span class="annot"><span class="annottext">(forall x. DiExp ex -&gt; Rep (DiExp ex) x)
-&gt; (forall x. Rep (DiExp ex) x -&gt; DiExp ex) -&gt; Generic (DiExp ex)
forall x. Rep (DiExp ex) x -&gt; DiExp ex
forall x. DiExp ex -&gt; Rep (DiExp ex) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall ex x. Rep (DiExp ex) x -&gt; DiExp ex
forall ex x. DiExp ex -&gt; Rep (DiExp ex) x
$cfrom :: forall ex x. DiExp ex -&gt; Rep (DiExp ex) x
from :: forall x. DiExp ex -&gt; Rep (DiExp ex) x
$cto :: forall ex x. Rep (DiExp ex) x -&gt; DiExp ex
to :: forall x. Rep (DiExp ex) x -&gt; DiExp ex
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961767"><span id="local-6989586621680961772"><span id="local-6989586621680961776"><span class="annot"><span class="annottext">Int -&gt; DiExp ex -&gt; [Char] -&gt; [Char]
[DiExp ex] -&gt; [Char] -&gt; [Char]
DiExp ex -&gt; [Char]
(Int -&gt; DiExp ex -&gt; [Char] -&gt; [Char])
-&gt; (DiExp ex -&gt; [Char])
-&gt; ([DiExp ex] -&gt; [Char] -&gt; [Char])
-&gt; Show (DiExp ex)
forall ex. Show ex =&gt; Int -&gt; DiExp ex -&gt; [Char] -&gt; [Char]
forall ex. Show ex =&gt; [DiExp ex] -&gt; [Char] -&gt; [Char]
forall ex. Show ex =&gt; DiExp ex -&gt; [Char]
forall a.
(Int -&gt; a -&gt; [Char] -&gt; [Char])
-&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; [Char] -&gt; [Char]) -&gt; Show a
$cshowsPrec :: forall ex. Show ex =&gt; Int -&gt; DiExp ex -&gt; [Char] -&gt; [Char]
showsPrec :: Int -&gt; DiExp ex -&gt; [Char] -&gt; [Char]
$cshow :: forall ex. Show ex =&gt; DiExp ex -&gt; [Char]
show :: DiExp ex -&gt; [Char]
$cshowList :: forall ex. Show ex =&gt; [DiExp ex] -&gt; [Char] -&gt; [Char]
showList :: [DiExp ex] -&gt; [Char] -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961781"><span id="local-6989586621680961785"><span id="local-6989586621680961788"><span id="local-6989586621680961795"><span class="annot"><span class="annottext">ReadPrec [DiExp ex]
ReadPrec (DiExp ex)
Int -&gt; ReadS (DiExp ex)
ReadS [DiExp ex]
(Int -&gt; ReadS (DiExp ex))
-&gt; ReadS [DiExp ex]
-&gt; ReadPrec (DiExp ex)
-&gt; ReadPrec [DiExp ex]
-&gt; Read (DiExp ex)
forall ex. Read ex =&gt; ReadPrec [DiExp ex]
forall ex. Read ex =&gt; ReadPrec (DiExp ex)
forall ex. Read ex =&gt; Int -&gt; ReadS (DiExp ex)
forall ex. Read ex =&gt; ReadS [DiExp ex]
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
$creadsPrec :: forall ex. Read ex =&gt; Int -&gt; ReadS (DiExp ex)
readsPrec :: Int -&gt; ReadS (DiExp ex)
$creadList :: forall ex. Read ex =&gt; ReadS [DiExp ex]
readList :: ReadS [DiExp ex]
$creadPrec :: forall ex. Read ex =&gt; ReadPrec (DiExp ex)
readPrec :: ReadPrec (DiExp ex)
$creadListPrec :: forall ex. Read ex =&gt; ReadPrec [DiExp ex]
readListPrec :: ReadPrec [DiExp ex]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961800"><span id="local-6989586621680961804"><span class="annot"><span class="annottext">DiExp ex -&gt; DiExp ex -&gt; Bool
(DiExp ex -&gt; DiExp ex -&gt; Bool)
-&gt; (DiExp ex -&gt; DiExp ex -&gt; Bool) -&gt; Eq (DiExp ex)
forall ex. Eq ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall ex. Eq ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Bool
== :: DiExp ex -&gt; DiExp ex -&gt; Bool
$c/= :: forall ex. Eq ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Bool
/= :: DiExp ex -&gt; DiExp ex -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680961814"><span id="local-6989586621680961818"><span id="local-6989586621680961822"><span id="local-6989586621680961826"><span id="local-6989586621680961830"><span id="local-6989586621680961834"><span id="local-6989586621680961838"><span class="annot"><span class="annottext">Eq (DiExp ex)
Eq (DiExp ex)
-&gt; (DiExp ex -&gt; DiExp ex -&gt; Ordering)
-&gt; (DiExp ex -&gt; DiExp ex -&gt; Bool)
-&gt; (DiExp ex -&gt; DiExp ex -&gt; Bool)
-&gt; (DiExp ex -&gt; DiExp ex -&gt; Bool)
-&gt; (DiExp ex -&gt; DiExp ex -&gt; Bool)
-&gt; (DiExp ex -&gt; DiExp ex -&gt; DiExp ex)
-&gt; (DiExp ex -&gt; DiExp ex -&gt; DiExp ex)
-&gt; Ord (DiExp ex)
DiExp ex -&gt; DiExp ex -&gt; Bool
DiExp ex -&gt; DiExp ex -&gt; Ordering
DiExp ex -&gt; DiExp ex -&gt; DiExp ex
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall {ex}. Ord ex =&gt; Eq (DiExp ex)
forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Bool
forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Ordering
forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; DiExp ex
$ccompare :: forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Ordering
compare :: DiExp ex -&gt; DiExp ex -&gt; Ordering
$c&lt; :: forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Bool
&lt; :: DiExp ex -&gt; DiExp ex -&gt; Bool
$c&lt;= :: forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Bool
&lt;= :: DiExp ex -&gt; DiExp ex -&gt; Bool
$c&gt; :: forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Bool
&gt; :: DiExp ex -&gt; DiExp ex -&gt; Bool
$c&gt;= :: forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; Bool
&gt;= :: DiExp ex -&gt; DiExp ex -&gt; Bool
$cmax :: forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; DiExp ex
max :: DiExp ex -&gt; DiExp ex -&gt; DiExp ex
$cmin :: forall ex. Ord ex =&gt; DiExp ex -&gt; DiExp ex -&gt; DiExp ex
min :: DiExp ex -&gt; DiExp ex -&gt; DiExp ex
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1613"></span><span class="hs-comment">--type DiExp = Exp</span><span>
</span><span id="line-1614"></span><span>
</span><span id="line-1615"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680959904"><span id="local-6989586621680961846"><span id="local-6989586621680961853"><span id="local-6989586621680961859"><span class="hs-special">(</span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-type">Out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959904"><span class="hs-identifier hs-type">ex</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-type">Out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-type">DiExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959904"><span class="hs-identifier hs-type">ex</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1616"></span><span>
</span><span id="line-1617"></span><span id="local-6989586621680959792"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-type">onDi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680959792"><span class="hs-identifier hs-type">ex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680959792"><span class="hs-identifier hs-type">ex</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-type">DiExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959792"><span class="hs-identifier hs-type">ex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-type">DiExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959792"><span class="hs-identifier hs-type">ex</span></a></span></span><span>
</span><span id="line-1618"></span><span id="onDi"><span class="annot"><span class="annottext">onDi :: forall ex. (ex -&gt; ex) -&gt; DiExp ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#onDi"><span class="hs-identifier hs-var hs-var">onDi</span></a></span></span><span> </span><span id="local-6989586621680961910"><span class="annot"><span class="annottext">ex -&gt; ex
</span><a href="#local-6989586621680961910"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-type">Di</span></a></span><span> </span><span id="local-6989586621680961911"><span class="annot"><span class="annottext">ex
</span><a href="#local-6989586621680961911"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ex -&gt; DiExp ex
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ex -&gt; ex
</span><a href="#local-6989586621680961910"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ex
</span><a href="#local-6989586621680961911"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1619"></span><span>
</span><span id="line-1620"></span><span id="local-6989586621680959691"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-type">fromDi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-type">DiExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680959691"><span class="hs-identifier hs-type">ex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680959691"><span class="hs-identifier hs-type">ex</span></a></span></span><span>
</span><span id="line-1621"></span><span id="fromDi"><span class="annot"><span class="annottext">fromDi :: forall ex. DiExp ex -&gt; ex
</span><a href="Gibbon.Passes.Cursorize.html#fromDi"><span class="hs-identifier hs-var hs-var">fromDi</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-type">Di</span></a></span><span> </span><span id="local-6989586621680961912"><span class="annot"><span class="annottext">ex
</span><a href="#local-6989586621680961912"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ex
</span><a href="#local-6989586621680961912"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1622"></span><span>
</span><span id="line-1623"></span><span>
</span><span id="line-1624"></span><span class="hs-comment">-- | Project the cursor package from a dilated expression, contains pointers</span><span>
</span><span id="line-1625"></span><span class="hs-comment">-- to all the ENDs.</span><span>
</span><span id="line-1626"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#projEnds"><span class="hs-identifier hs-type">projEnds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-type">DiExp</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1627"></span><span id="projEnds"><span class="annot"><span class="annottext">projEnds :: DiExp Exp3 -&gt; Exp3
</span><a href="Gibbon.Passes.Cursorize.html#projEnds"><span class="hs-identifier hs-var hs-var">projEnds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-type">Di</span></a></span><span> </span><span id="local-6989586621680961913"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961913"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961913"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1628"></span><span>
</span><span id="line-1629"></span><span class="annot"><span class="hs-comment">-- | Project the original value from a dilated expression.</span></span><span>
</span><span id="line-1630"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#projVal"><span class="hs-identifier hs-type">projVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-type">DiExp</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1631"></span><span id="projVal"><span class="annot"><span class="annottext">projVal :: DiExp Exp3 -&gt; Exp3
</span><a href="Gibbon.Passes.Cursorize.html#projVal"><span class="hs-identifier hs-var hs-var">projVal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-type">Di</span></a></span><span> </span><span id="local-6989586621680961914"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961914"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp3 -&gt; Exp3
forall (e :: * -&gt; * -&gt; *) l d. Int -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961914"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span class="hs-comment">-- | Constructor that combines a regular expression with a list of</span><span>
</span><span id="line-1634"></span><span class="hs-comment">-- corresponding end cursors.</span><span>
</span><span id="line-1635"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#mkDi"><span class="hs-identifier hs-type">mkDi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#DiExp"><span class="hs-identifier hs-type">DiExp</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1636"></span><span id="mkDi"><span class="annot"><span class="annottext">mkDi :: Exp3 -&gt; [Exp3] -&gt; DiExp Exp3
</span><a href="Gibbon.Passes.Cursorize.html#mkDi"><span class="hs-identifier hs-var hs-var">mkDi</span></a></span></span><span> </span><span id="local-6989586621680961915"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961915"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961915"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1637"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#mkDi"><span class="hs-identifier hs-var">mkDi</span></a></span><span> </span><span id="local-6989586621680961916"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961916"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621680961917"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961917"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961916"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961917"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1638"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#mkDi"><span class="hs-identifier hs-var">mkDi</span></a></span><span> </span><span id="local-6989586621680961918"><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961918"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680961919"><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961919"><span class="hs-identifier hs-var">ls</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp3 -&gt; DiExp Exp3
forall {ex}. ex -&gt; DiExp ex
</span><a href="Gibbon.Passes.Cursorize.html#Di"><span class="hs-identifier hs-var">Di</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp3 -&gt; DiExp Exp3) -&gt; Exp3 -&gt; DiExp Exp3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp3
</span><a href="#local-6989586621680961918"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Exp3] -&gt; Exp3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp3]
</span><a href="#local-6989586621680961919"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span id="local-6989586621680961920"><span class="annot"><a href="Gibbon.Passes.Cursorize.html#curDict"><span class="hs-identifier hs-type">curDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680961920"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680961920"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1641"></span><span id="curDict"><span class="annot"><span class="annottext">curDict :: forall loc. UrTy loc -&gt; UrTy loc
</span><a href="Gibbon.Passes.Cursorize.html#curDict"><span class="hs-identifier hs-var hs-var">curDict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span id="local-6989586621680961921"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680961921"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span id="local-6989586621680961922"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680961922"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Var -&gt; Ty3 -&gt; UrTy a
forall loc. Maybe Var -&gt; Ty3 -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-var">SymDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680961921"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span>
</span><span id="line-1642"></span><span class="annot"><a href="Gibbon.Passes.Cursorize.html#curDict"><span class="hs-identifier hs-var">curDict</span></a></span><span> </span><span id="local-6989586621680961923"><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680961923"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680961923"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1643"></span></pre></body></html>