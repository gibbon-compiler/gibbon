<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-name-shadowing #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="annot"><span class="hs-comment">-- | Lowering L3 to the target language.</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.Passes.Lower</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.Passes.Lower.html#lower"><span class="hs-identifier">lower</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Passes.Lower.html#getTagOfDataCon"><span class="hs-identifier">getTagOfDataCon</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier">tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Int.html"><span class="hs-identifier">Data.Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier">Word16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html"><span class="hs-identifier">Data.Tuple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#swap"><span class="hs-identifier">swap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier">tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html"><span class="hs-identifier">Text.PrettyPrint.GenericPretty</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.DynFlags.html"><span class="hs-identifier">Gibbon.DynFlags</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.L3.Syntax.html"><span class="hs-identifier">Gibbon.L3.Syntax</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html"><span class="hs-identifier">Gibbon.L3.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L3</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html"><span class="hs-identifier">Gibbon.L4.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- Generating unpack functions from Packed-&gt;Pointer representation:</span><span>
</span><span id="line-34"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-type">genDcons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L4.Syntax.html#Ty"><span class="hs-identifier hs-type">T.Ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Triv"><span class="hs-identifier hs-type">T.Triv</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span>
</span><span id="line-37"></span><span id="genDcons"><span class="annot"><span class="annottext">genDcons :: [Ty3] -&gt; Var -&gt; [(Ty, Triv)] -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-var hs-var">genDcons</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680968209"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968209"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680968210"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968210"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680968211"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968211"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621680968212"><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680968212"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968209"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680968214"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968214"><span class="hs-identifier hs-var">tyCons</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-39"></span><span>    </span><span id="local-6989586621680968215"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968215"><span class="hs-identifier hs-var">ptr</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span>  </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;ptr&quot;</span></span><span>
</span><span id="line-40"></span><span>    </span><span id="local-6989586621680968217"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968217"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span>  </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tail&quot;</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; [(Var, Ty)] -&gt; Var -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetCallT"><span class="hs-identifier hs-var">T.LetCallT</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968215"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#PtrTy"><span class="hs-identifier hs-var">T.PtrTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968217"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Language.Constants.html#mkUnpackerName"><span class="hs-identifier hs-var">mkUnpackerName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968214"><span class="hs-identifier hs-var">tyCons</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968211"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-42"></span><span>      </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Var -&gt; [(Ty, Triv)] -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-var">genDcons</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968210"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968217"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680968212"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ty, Triv)] -&gt; [(Ty, Triv)] -&gt; [(Ty, Triv)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968215"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-comment">-- Int, Float, Sym or Bool</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isScalarTy"><span class="hs-identifier hs-var">isScalarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968209"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-46"></span><span>    </span><span id="local-6989586621680968225"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968225"><span class="hs-identifier hs-var">val</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;val&quot;</span></span><span>
</span><span id="line-47"></span><span>    </span><span id="local-6989586621680968226"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968226"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tail&quot;</span></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968227"><span class="annot"><span class="annottext">l4_ty :: Ty
</span><a href="#local-6989586621680968227"><span class="hs-identifier hs-var hs-var">l4_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#fromL3Ty"><span class="hs-identifier hs-var">T.fromL3Ty</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968209"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968225"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="#local-6989586621680968227"><span class="hs-identifier hs-var">l4_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968226"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scalar -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#ReadScalar"><span class="hs-identifier hs-var">T.ReadScalar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Scalar
forall a. Out a =&gt; UrTy a -&gt; Scalar
</span><a href="Gibbon.L3.Syntax.html#mkScalar"><span class="hs-identifier hs-var">mkScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968209"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968211"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-50"></span><span>      </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Var -&gt; [(Ty, Triv)] -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-var">genDcons</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968210"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968226"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680968212"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ty, Triv)] -&gt; [(Ty, Triv)] -&gt; [(Ty, Triv)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty
</span><a href="#local-6989586621680968227"><span class="hs-identifier hs-var">l4_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968225"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-type">VectorTy</span></a></span><span> </span><span id="local-6989586621680968233"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968233"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-53"></span><span>    </span><span id="local-6989586621680968234"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968234"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;val&quot;</span></span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621680968235"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968235"><span class="hs-identifier hs-var">t</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tail&quot;</span></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968236"><span class="annot"><span class="annottext">l4_ty :: Ty
</span><a href="#local-6989586621680968236"><span class="hs-identifier hs-var hs-var">l4_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#fromL3Ty"><span class="hs-identifier hs-var">T.fromL3Ty</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968233"><span class="hs-identifier hs-var">el_ty</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968234"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#VectorTy"><span class="hs-identifier hs-var">T.VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="#local-6989586621680968236"><span class="hs-identifier hs-var">l4_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968235"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadVector"><span class="hs-identifier hs-var">T.ReadVector</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968211"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-57"></span><span>      </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Var -&gt; [(Ty, Triv)] -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-var">genDcons</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968210"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968235"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680968212"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ty, Triv)] -&gt; [(Ty, Triv)] -&gt; [(Ty, Triv)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#VectorTy"><span class="hs-identifier hs-var">T.VectorTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="#local-6989586621680968236"><span class="hs-identifier hs-var">l4_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968234"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-type">ListTy</span></a></span><span> </span><span id="local-6989586621680968240"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968240"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-60"></span><span>    </span><span id="local-6989586621680968241"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968241"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;val&quot;</span></span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621680968242"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968242"><span class="hs-identifier hs-var">t</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tail&quot;</span></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968243"><span class="annot"><span class="annottext">l4_ty :: Ty
</span><a href="#local-6989586621680968243"><span class="hs-identifier hs-var hs-var">l4_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#fromL3Ty"><span class="hs-identifier hs-var">T.fromL3Ty</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968240"><span class="hs-identifier hs-var">el_ty</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968241"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#ListTy"><span class="hs-identifier hs-var">T.ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="#local-6989586621680968243"><span class="hs-identifier hs-var">l4_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968242"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadList"><span class="hs-identifier hs-var">T.ReadList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968211"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-64"></span><span>      </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Var -&gt; [(Ty, Triv)] -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-var">genDcons</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968210"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968242"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680968212"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ty, Triv)] -&gt; [(Ty, Triv)] -&gt; [(Ty, Triv)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#ListTy"><span class="hs-identifier hs-var">T.ListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="#local-6989586621680968243"><span class="hs-identifier hs-var">l4_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968241"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-comment">-- Indirection or redirection pointer</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621680968247"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968247"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;next&quot;</span></span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621680968248"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968248"><span class="hs-identifier hs-var">afternext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;afternext&quot;</span></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968249"><span class="annot"><span class="annottext">l4_ty :: Ty
</span><a href="#local-6989586621680968249"><span class="hs-identifier hs-var hs-var">l4_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#fromL3Ty"><span class="hs-identifier hs-var">T.fromL3Ty</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968209"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968247"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968248"><span class="hs-identifier hs-var">afternext</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadCursor"><span class="hs-identifier hs-var">T.ReadCursor</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968211"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-72"></span><span>      </span><span class="annot"><span class="annottext">[Ty3] -&gt; Var -&gt; [(Ty, Triv)] -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-var">genDcons</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968210"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968248"><span class="hs-identifier hs-var">afternext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680968212"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ty, Triv)] -&gt; [(Ty, Triv)] -&gt; [(Ty, Triv)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty
</span><a href="#local-6989586621680968249"><span class="hs-identifier hs-var">l4_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968247"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;genDcons: FIXME &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968209"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-var">genDcons</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680968253"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968253"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621680968254"><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680968254"><span class="hs-identifier hs-var">fields</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-77"></span><span>  </span><span id="local-6989586621680968255"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968255"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;ptr&quot;</span></span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Ty, Triv)] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetAllocT"><span class="hs-identifier hs-var">T.LetAllocT</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968255"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680968254"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#RetValsT"><span class="hs-identifier hs-var">T.RetValsT</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968255"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968253"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#genAlts"><span class="hs-identifier hs-type">genAlts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#IsBoxed"><span class="hs-identifier hs-type">IsBoxed</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Alts"><span class="hs-identifier hs-type">T.Alts</span></a></span><span>
</span><span id="line-81"></span><span id="genAlts"><span class="annot"><span class="annottext">genAlts :: [([Char], [(Bool, Ty3)])] -&gt; Var -&gt; Var -&gt; Int64 -&gt; PassM Alts
</span><a href="Gibbon.Passes.Lower.html#genAlts"><span class="hs-identifier hs-var hs-var">genAlts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680968273"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968273"><span class="hs-identifier hs-var">_dcons</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680968274"><span class="annot"><span class="annottext">[(Bool, Ty3)]
</span><a href="#local-6989586621680968274"><span class="hs-identifier hs-var">typs</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680968275"><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])]
</span><a href="#local-6989586621680968275"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680968276"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968276"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621680968277"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968277"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680968278"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621680968278"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680968279"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968279"><span class="hs-identifier hs-var">typs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Bool, Ty3)] -&gt; ([Bool], [Ty3])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, Ty3)]
</span><a href="#local-6989586621680968274"><span class="hs-identifier hs-var">typs</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-comment">-- WARNING: IsBoxed ignored here</span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621680968281"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968281"><span class="hs-identifier hs-var">curTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Var -&gt; [(Ty, Triv)] -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#genDcons"><span class="hs-identifier hs-var">genDcons</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968279"><span class="hs-identifier hs-var">typs'</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968276"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#TagTyPacked"><span class="hs-identifier hs-var">T.TagTyPacked</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968277"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span>  </span><span id="local-6989586621680968283"><span class="annot"><span class="annottext">Alts
</span><a href="#local-6989586621680968283"><span class="hs-identifier hs-var">alts</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])] -&gt; Var -&gt; Var -&gt; Int64 -&gt; PassM Alts
</span><a href="Gibbon.Passes.Lower.html#genAlts"><span class="hs-identifier hs-var">genAlts</span></a></span><span> </span><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])]
</span><a href="#local-6989586621680968275"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968276"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968277"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621680968278"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968285"><span class="annot"><span class="annottext">alt :: Int64
</span><a href="#local-6989586621680968285"><span class="hs-identifier hs-var hs-var">alt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621680968278"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Alts
</span><a href="#local-6989586621680968283"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="Gibbon.L4.Syntax.html#IntAlts"><span class="hs-identifier hs-type">T.IntAlts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Alts -&gt; PassM Alts
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Alts -&gt; PassM Alts) -&gt; Alts -&gt; PassM Alts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int64, Tail)] -&gt; Alts
</span><a href="Gibbon.L4.Syntax.html#IntAlts"><span class="hs-identifier hs-var">T.IntAlts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621680968285"><span class="hs-identifier hs-var">alt</span></a></span><span class="hs-glyph">::</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968281"><span class="hs-identifier hs-var">curTail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-comment">-- T.TagAlts []   -&gt; return $ T.TagAlts [(n::Word8, curTail)]</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><a href="Gibbon.L4.Syntax.html#IntAlts"><span class="hs-identifier hs-type">T.IntAlts</span></a></span><span> </span><span id="local-6989586621680968287"><span class="annot"><span class="annottext">[(Int64, Tail)]
</span><a href="#local-6989586621680968287"><span class="hs-identifier hs-var">tags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Alts -&gt; PassM Alts
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Alts -&gt; PassM Alts) -&gt; Alts -&gt; PassM Alts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int64, Tail)] -&gt; Alts
</span><a href="Gibbon.L4.Syntax.html#IntAlts"><span class="hs-identifier hs-var">T.IntAlts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621680968285"><span class="hs-identifier hs-var">alt</span></a></span><span class="hs-glyph">::</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968281"><span class="hs-identifier hs-var">curTail</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int64, Tail) -&gt; [(Int64, Tail)] -&gt; [(Int64, Tail)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int64, Tail)]
</span><a href="#local-6989586621680968287"><span class="hs-identifier hs-var">tags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-comment">-- T.TagAlts tags -&gt; return $ T.TagAlts ((n::Word8, curTail) : tags)</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">Alts
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Alts
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Alts) -&gt; [Char] -&gt; PassM Alts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Invalid case statement type.&quot;</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#genAlts"><span class="hs-identifier hs-var">genAlts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alts -&gt; PassM Alts
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Alts -&gt; PassM Alts) -&gt; Alts -&gt; PassM Alts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int64, Tail)] -&gt; Alts
</span><a href="Gibbon.L4.Syntax.html#IntAlts"><span class="hs-identifier hs-var">T.IntAlts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#genUnpacker"><span class="hs-identifier hs-type">genUnpacker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDef"><span class="hs-identifier hs-type">DDef</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#FunDecl"><span class="hs-identifier hs-type">T.FunDecl</span></a></span><span>
</span><span id="line-97"></span><span id="genUnpacker"><span class="annot"><span class="annottext">genUnpacker :: DDef Ty3 -&gt; PassM FunDecl
</span><a href="Gibbon.Passes.Lower.html#genUnpacker"><span class="hs-identifier hs-var hs-var">genUnpacker</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDef"><span class="hs-identifier hs-type">DDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680968309"><span class="annot"><span class="annottext">Var
tyName :: Var
tyName :: forall a. DDef a -&gt; Var
</span><a href="#local-6989586621680968309"><span class="hs-identifier hs-var hs-var">tyName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680968311"><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])]
dataCons :: [([Char], [(Bool, Ty3)])]
dataCons :: forall a. DDef a -&gt; [([Char], [(Bool, a)])]
</span><a href="#local-6989586621680968311"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621680968313"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968313"><span class="hs-identifier hs-var">p</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;p&quot;</span></span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621680968314"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968314"><span class="hs-identifier hs-var">tag</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tag&quot;</span></span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621680968315"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968315"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tail&quot;</span></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621680968316"><span class="annot"><span class="annottext">Alts
</span><a href="#local-6989586621680968316"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])] -&gt; Var -&gt; Var -&gt; Int64 -&gt; PassM Alts
</span><a href="Gibbon.Passes.Lower.html#genAlts"><span class="hs-identifier hs-var">genAlts</span></a></span><span> </span><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])]
</span><a href="#local-6989586621680968311"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968315"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968314"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621680968317"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968317"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;switch&quot;</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968318"><span class="annot"><span class="annottext">def_alt :: Tail
</span><a href="#local-6989586621680968318"><span class="hs-identifier hs-var hs-var">def_alt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#ErrT"><span class="hs-identifier hs-var">T.ErrT</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Tail) -&gt; [Char] -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unknown tag in: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968317"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621680968321"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968321"><span class="hs-identifier hs-var">bod</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968314"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#TagTyPacked"><span class="hs-identifier hs-var">T.TagTyPacked</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968315"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadTag"><span class="hs-identifier hs-var">T.ReadTag</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968313"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-105"></span><span>                   </span><span class="annot"><span class="annottext">Var -&gt; Triv -&gt; Alts -&gt; Maybe Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#Switch"><span class="hs-identifier hs-var">T.Switch</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968317"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968314"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Alts
</span><a href="#local-6989586621680968316"><span class="hs-identifier hs-var">alts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tail -&gt; Maybe Tail
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968318"><span class="hs-identifier hs-var">def_alt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="annottext">FunDecl -&gt; PassM FunDecl
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#FunDecl"><span class="hs-identifier hs-type">T.FunDecl</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funName :: Var
</span><a href="Gibbon.L4.Syntax.html#funName"><span class="hs-identifier hs-var">T.funName</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Language.Constants.html#mkUnpackerName"><span class="hs-identifier hs-var">mkUnpackerName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968309"><span class="hs-identifier hs-var">tyName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>                    </span><span class="annot"><span class="annottext">funArgs :: [(Var, Ty)]
</span><a href="Gibbon.L4.Syntax.html#funArgs"><span class="hs-identifier hs-var">T.funArgs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968313"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>                    </span><span class="annot"><span class="annottext">funRetTy :: Ty
</span><a href="Gibbon.L4.Syntax.html#funRetTy"><span class="hs-identifier hs-var">T.funRetTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty] -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#ProdTy"><span class="hs-identifier hs-var">T.ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#PtrTy"><span class="hs-identifier hs-var">T.PtrTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>                    </span><span class="annot"><span class="annottext">funBody :: Tail
</span><a href="Gibbon.L4.Syntax.html#funBody"><span class="hs-identifier hs-var">T.funBody</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968321"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>                    </span><span class="annot"><span class="annottext">isPure :: Bool
</span><a href="Gibbon.L4.Syntax.html#isPure"><span class="hs-identifier hs-var">T.isPure</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-111"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><span class="hs-comment">-- | Modify a Tail to *print* its return value and then</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- Utility functions</span><span>
</span><span id="line-117"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#printString"><span class="hs-identifier hs-type">printString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span id="printString"><span class="annot"><span class="annottext">printString :: [Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printString"><span class="hs-identifier hs-var hs-var">printString</span></a></span></span><span> </span><span id="local-6989586621680968332"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968332"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PrintString"><span class="hs-identifier hs-var">T.PrintString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968332"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#openParen"><span class="hs-identifier hs-type">openParen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span id="openParen"><span class="annot"><span class="annottext">openParen :: [Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#openParen"><span class="hs-identifier hs-var hs-var">openParen</span></a></span></span><span> </span><span id="local-6989586621680968338"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968338"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printString"><span class="hs-identifier hs-var">printString</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Tail -&gt; Tail) -&gt; [Char] -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968338"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#closeParen"><span class="hs-identifier hs-type">closeParen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span>
</span><span id="line-124"></span><span id="closeParen"><span class="annot"><span class="annottext">closeParen :: Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#closeParen"><span class="hs-identifier hs-var hs-var">closeParen</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printString"><span class="hs-identifier hs-var">printString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#printSpace"><span class="hs-identifier hs-type">printSpace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span>
</span><span id="line-127"></span><span id="printSpace"><span class="annot"><span class="annottext">printSpace :: Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printSpace"><span class="hs-identifier hs-var hs-var">printSpace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printString"><span class="hs-identifier hs-var">printString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#sandwich"><span class="hs-identifier hs-type">sandwich</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span>
</span><span id="line-130"></span><span id="sandwich"><span class="annot"><span class="annottext">sandwich :: (Tail -&gt; Tail) -&gt; [Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#sandwich"><span class="hs-identifier hs-var hs-var">sandwich</span></a></span></span><span> </span><span id="local-6989586621680968342"><span class="annot"><span class="annottext">Tail -&gt; Tail
</span><a href="#local-6989586621680968342"><span class="hs-identifier hs-var">mid</span></a></span></span><span> </span><span id="local-6989586621680968343"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968343"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680968344"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968344"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#openParen"><span class="hs-identifier hs-var">openParen</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968343"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tail -&gt; Tail
</span><a href="#local-6989586621680968342"><span class="hs-identifier hs-var">mid</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#closeParen"><span class="hs-identifier hs-var">closeParen</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968344"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- -- Generate printing functions</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- genDconsPrinter :: [Ty3] -&gt; Var -&gt; PassM T.Tail</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- genDconsPrinter (x:xs) tail =</span><span>
</span><span id="line-135"></span><span class="hs-comment">--   case x of</span><span>
</span><span id="line-136"></span><span class="hs-comment">--     L3.PackedTy tyCons _ -&gt; do</span><span>
</span><span id="line-137"></span><span class="hs-comment">--       dflags &lt;- getDynFlags</span><span>
</span><span id="line-138"></span><span class="hs-comment">--       if gopt Opt_Packed dflags</span><span>
</span><span id="line-139"></span><span class="hs-comment">--       then do</span><span>
</span><span id="line-140"></span><span class="hs-comment">--         t    &lt;- gensym &quot;tail&quot;</span><span>
</span><span id="line-141"></span><span class="hs-comment">--         T.LetCallT False [(t, T.CursorTy)] (mkPrinterName tyCons) [(T.VarTriv tail)] &lt;$&gt;</span><span>
</span><span id="line-142"></span><span class="hs-comment">--            maybeSpace &lt;$&gt; genDconsPrinter xs t</span><span>
</span><span id="line-143"></span><span class="hs-comment">--       else do</span><span>
</span><span id="line-144"></span><span class="hs-comment">--         val  &lt;- gensym &quot;val&quot;</span><span>
</span><span id="line-145"></span><span class="hs-comment">--         t    &lt;- gensym &quot;tail&quot;</span><span>
</span><span id="line-146"></span><span class="hs-comment">--         tmp  &lt;- gensym &quot;temp&quot;</span><span>
</span><span id="line-147"></span><span class="hs-comment">--         valc &lt;- gensym &quot;valcur&quot;</span><span>
</span><span id="line-148"></span><span class="hs-comment">--         T.LetPrimCallT [(val, T.IntTy), (t, T.CursorTy)] (T.ReadScalar IntS) [(T.VarTriv tail)] &lt;$&gt;</span><span>
</span><span id="line-149"></span><span class="hs-comment">--           T.LetTrivT (valc, T.CursorTy, T.VarTriv val) &lt;$&gt;</span><span>
</span><span id="line-150"></span><span class="hs-comment">--           T.LetCallT False [(tmp, T.CursorTy)] (mkPrinterName tyCons) [(T.VarTriv valc)] &lt;$&gt;</span><span>
</span><span id="line-151"></span><span class="hs-comment">--             maybeSpace &lt;$&gt; genDconsPrinter xs t</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-comment">--     L3.CursorTy -&gt; do</span><span>
</span><span id="line-154"></span><span class="hs-comment">--       dflags &lt;- getDynFlags</span><span>
</span><span id="line-155"></span><span class="hs-comment">--       if gopt Opt_Packed dflags</span><span>
</span><span id="line-156"></span><span class="hs-comment">--       then do</span><span>
</span><span id="line-157"></span><span class="hs-comment">--         tail2 &lt;- gensym &quot;tail&quot;</span><span>
</span><span id="line-158"></span><span class="hs-comment">--         T.LetPrimCallT [(tail2, T.CursorTy)] T.AddP [T.VarTriv tail, T.IntTriv 8] &lt;$&gt;</span><span>
</span><span id="line-159"></span><span class="hs-comment">--           genDconsPrinter xs tail2</span><span>
</span><span id="line-160"></span><span class="hs-comment">--       else genDconsPrinter xs tail</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">--     _ | isScalarTy x -&gt;  do</span><span>
</span><span id="line-163"></span><span class="hs-comment">--       val  &lt;- gensym &quot;val&quot;</span><span>
</span><span id="line-164"></span><span class="hs-comment">--       t    &lt;- gensym &quot;tail&quot;</span><span>
</span><span id="line-165"></span><span class="hs-comment">--       let l4_ty = T.fromL3Ty x</span><span>
</span><span id="line-166"></span><span class="hs-comment">--       T.LetPrimCallT [(val, l4_ty), (t, T.CursorTy)] (T.ReadScalar (mkScalar x)) [(T.VarTriv tail)] &lt;$&gt;</span><span>
</span><span id="line-167"></span><span class="hs-comment">--         printTy False x [T.VarTriv val] &lt;$&gt;</span><span>
</span><span id="line-168"></span><span class="hs-comment">--          maybeSpace &lt;$&gt;</span><span>
</span><span id="line-169"></span><span class="hs-comment">--           genDconsPrinter xs t</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">--     VectorTy el_ty -&gt;  do</span><span>
</span><span id="line-172"></span><span class="hs-comment">--       val  &lt;- gensym &quot;val&quot;</span><span>
</span><span id="line-173"></span><span class="hs-comment">--       t    &lt;- gensym &quot;tail&quot;</span><span>
</span><span id="line-174"></span><span class="hs-comment">--       let l4_ty = T.fromL3Ty el_ty</span><span>
</span><span id="line-175"></span><span class="hs-comment">--       T.LetPrimCallT [(val, T.VectorTy l4_ty), (t, T.CursorTy)] T.ReadVector [(T.VarTriv tail)] &lt;$&gt;</span><span>
</span><span id="line-176"></span><span class="hs-comment">--         printTy False x [T.VarTriv val] &lt;$&gt;</span><span>
</span><span id="line-177"></span><span class="hs-comment">--          maybeSpace &lt;$&gt;</span><span>
</span><span id="line-178"></span><span class="hs-comment">--           genDconsPrinter xs t</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">--     ListTy el_ty -&gt;  do</span><span>
</span><span id="line-181"></span><span class="hs-comment">--       val  &lt;- gensym &quot;val&quot;</span><span>
</span><span id="line-182"></span><span class="hs-comment">--       t    &lt;- gensym &quot;tail&quot;</span><span>
</span><span id="line-183"></span><span class="hs-comment">--       let l4_ty = T.fromL3Ty el_ty</span><span>
</span><span id="line-184"></span><span class="hs-comment">--       T.LetPrimCallT [(val, T.ListTy l4_ty), (t, T.CursorTy)] T.ReadList [(T.VarTriv tail)] &lt;$&gt;</span><span>
</span><span id="line-185"></span><span class="hs-comment">--         printTy False x [T.VarTriv val] &lt;$&gt;</span><span>
</span><span id="line-186"></span><span class="hs-comment">--          maybeSpace &lt;$&gt;</span><span>
</span><span id="line-187"></span><span class="hs-comment">--           genDconsPrinter xs t</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">--     _ -&gt; error &quot;FINISHME: genDconsPrinter&quot;</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">--  where</span><span>
</span><span id="line-192"></span><span class="hs-comment">--   maybeSpace = if L.null xs</span><span>
</span><span id="line-193"></span><span class="hs-comment">--                then id</span><span>
</span><span id="line-194"></span><span class="hs-comment">--                else printSpace</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- genDconsPrinter [] tail = do</span><span>
</span><span id="line-197"></span><span class="hs-comment">--   return $ closeParen $ T.RetValsT [(T.VarTriv tail)]</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- genAltPrinter :: [(DataCon,[(IsBoxed, Ty3)])] -&gt; Var -&gt; Int64 -&gt; PassM T.Alts</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- -- Don' do anything for indirections. Let 'followRedirects' take care of it.</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- genAltPrinter ((dcons, _):rst) tail n | isIndirectionTag dcons = genAltPrinter rst tail n</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- genAltPrinter ((dcons, typs):xs) tail n = do</span><span>
</span><span id="line-203"></span><span class="hs-comment">--   let (_,typs') = unzip typs</span><span>
</span><span id="line-204"></span><span class="hs-comment">--   -- WARNING: IsBoxed ignored here</span><span>
</span><span id="line-205"></span><span class="hs-comment">--   curTail &lt;- (openParen dcons) &lt;$&gt; genDconsPrinter typs' tail</span><span>
</span><span id="line-206"></span><span class="hs-comment">--   alts    &lt;- genAltPrinter xs tail (n+1)</span><span>
</span><span id="line-207"></span><span class="hs-comment">--   let alt = n</span><span>
</span><span id="line-208"></span><span class="hs-comment">--   case alts of</span><span>
</span><span id="line-209"></span><span class="hs-comment">--     T.IntAlts []   -&gt; return $ T.IntAlts [(alt::Int64, curTail)]</span><span>
</span><span id="line-210"></span><span class="hs-comment">--     -- T.TagAlts []   -&gt; return $ T.TagAlts [(n::Word8, curTail)]</span><span>
</span><span id="line-211"></span><span class="hs-comment">--     T.IntAlts tags -&gt; return $ T.IntAlts ((alt::Int64, curTail) : tags)</span><span>
</span><span id="line-212"></span><span class="hs-comment">--     -- T.TagAlts tags -&gt; return $ T.TagAlts ((n::Word8, curTail) : tags)</span><span>
</span><span id="line-213"></span><span class="hs-comment">--     _              -&gt; error $ &quot;Invalid case statement type.&quot;</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- genAltPrinter [] _ _                = return $ T.IntAlts []</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- genPrinter  :: DDef Ty3 -&gt; PassM T.FunDecl</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- genPrinter DDef{tyName, dataCons} = do</span><span>
</span><span id="line-218"></span><span class="hs-comment">--   p    &lt;- gensym &quot;p&quot;</span><span>
</span><span id="line-219"></span><span class="hs-comment">--   tag  &lt;- gensym &quot;tag&quot;</span><span>
</span><span id="line-220"></span><span class="hs-comment">--   tail &lt;- gensym &quot;tail&quot;</span><span>
</span><span id="line-221"></span><span class="hs-comment">--   alts &lt;- genAltPrinter dataCons tail 0</span><span>
</span><span id="line-222"></span><span class="hs-comment">--   lbl  &lt;- gensym &quot;switch&quot;</span><span>
</span><span id="line-223"></span><span class="hs-comment">--   dflags &lt;- getDynFlags</span><span>
</span><span id="line-224"></span><span class="hs-comment">--   let def_alt = T.ErrT $ &quot;Unknown tag in: &quot; ++ fromVar lbl</span><span>
</span><span id="line-225"></span><span class="hs-comment">--   let bod = if gopt Opt_Packed dflags</span><span>
</span><span id="line-226"></span><span class="hs-comment">--             then T.LetPrimCallT [(tag, T.TagTyPacked), (tail, T.CursorTy)] (T.ReadTag) [(T.VarTriv p)] $</span><span>
</span><span id="line-227"></span><span class="hs-comment">--                  T.Switch lbl (T.VarTriv tag) alts (Just def_alt)</span><span>
</span><span id="line-228"></span><span class="hs-comment">--             else T.LetPrimCallT [(tag, T.TagTyPacked), (tail, T.CursorTy)] (T.ReadScalar IntS) [(T.VarTriv p)] $</span><span>
</span><span id="line-229"></span><span class="hs-comment">--                  T.Switch lbl (T.VarTriv tag) alts (Just def_alt)</span><span>
</span><span id="line-230"></span><span class="hs-comment">--   return T.FunDecl{ T.funName  = mkPrinterName (fromVar tyName),</span><span>
</span><span id="line-231"></span><span class="hs-comment">--                     T.funArgs  = [(p, T.CursorTy)],</span><span>
</span><span id="line-232"></span><span class="hs-comment">--                     T.funRetTy = T.CursorTy,</span><span>
</span><span id="line-233"></span><span class="hs-comment">--                     T.funBody  = bod,</span><span>
</span><span id="line-234"></span><span class="hs-comment">--                     T.isPure   = False</span><span>
</span><span id="line-235"></span><span class="hs-comment">--                   }</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#printTy"><span class="hs-identifier hs-type">printTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L4.Syntax.html#Triv"><span class="hs-identifier hs-type">T.Triv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span id="printTy"><span class="annot"><span class="annottext">printTy :: Bool -&gt; Ty3 -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printTy"><span class="hs-identifier hs-var hs-var">printTy</span></a></span></span><span> </span><span id="local-6989586621680968370"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968370"><span class="hs-identifier hs-var">pkd</span></a></span></span><span> </span><span id="local-6989586621680968371"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968371"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680968372"><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968371"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968374"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968374"><span class="hs-identifier hs-var">_one</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintInt"><span class="hs-identifier hs-var">T.PrintInt</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CharTy"><span class="hs-identifier hs-var">CharTy</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968377"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968377"><span class="hs-identifier hs-var">_one</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintChar"><span class="hs-identifier hs-var">T.PrintChar</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968380"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968380"><span class="hs-identifier hs-var">_one</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintFloat"><span class="hs-identifier hs-var">T.PrintFloat</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968383"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968383"><span class="hs-identifier hs-var">_one</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintSym"><span class="hs-identifier hs-var">T.PrintSym</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680968386"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968386"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968387"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968387"><span class="hs-identifier hs-var">_one</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; [Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#sandwich"><span class="hs-identifier hs-var">sandwich</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Ty3 -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printTy"><span class="hs-identifier hs-var">printTy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968370"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968386"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Dict&quot;</span></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680968388"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968388"><span class="hs-identifier hs-var">constr</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968389"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968389"><span class="hs-identifier hs-var">one</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- HACK: Using varAppend here was the simplest way to get</span><span>
</span><span id="line-246"></span><span>                                  </span><span class="hs-comment">-- unique names without using the PassM monad.</span><span>
</span><span id="line-247"></span><span>                                  </span><span class="hs-comment">-- ASSUMPTION: Argument (one) is always a variable reference.</span><span>
</span><span id="line-248"></span><span>                                  </span><span class="hs-comment">-- This is reasonable because the AST is always flattened before</span><span>
</span><span id="line-249"></span><span>                                  </span><span class="hs-comment">-- we try to lower it.</span><span>
</span><span id="line-250"></span><span>                                  </span><span class="hs-comment">-- But we should change this to use gensym anyways..</span><span>
</span><span id="line-251"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-type">T.VarTriv</span></a></span><span> </span><span id="local-6989586621680968390"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968390"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968389"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-252"></span><span>                                      </span><span id="local-6989586621680968391"><span class="annot"><span class="annottext">unpkd :: Var
</span><a href="#local-6989586621680968391"><span class="hs-identifier hs-var hs-var">unpkd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Var
</span><a href="Gibbon.Common.html#varAppend"><span class="hs-identifier hs-var">varAppend</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;unpkd_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968390"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-253"></span><span>                                      </span><span id="local-6989586621680968393"><span class="annot"><span class="annottext">ignre :: Var
</span><a href="#local-6989586621680968393"><span class="hs-identifier hs-var hs-var">ignre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Var
</span><a href="Gibbon.Common.html#varAppend"><span class="hs-identifier hs-var">varAppend</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;ignre_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968390"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-254"></span><span>                                  </span><span class="hs-keyword">in</span><span>
</span><span id="line-255"></span><span>                                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968370"><span class="hs-identifier hs-var">pkd</span></a></span><span>
</span><span id="line-256"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680968394"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968394"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [(Var, Ty)] -&gt; Var -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetCallT"><span class="hs-identifier hs-var">T.LetCallT</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968391"><span class="hs-identifier hs-var">unpkd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#PtrTy"><span class="hs-identifier hs-var">T.PtrTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968393"><span class="hs-identifier hs-var">ignre</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-257"></span><span>                                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Language.Constants.html#mkUnpackerName"><span class="hs-identifier hs-var">mkUnpackerName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968388"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-258"></span><span>                                                 </span><span class="annot"><span class="annottext">Bool -&gt; [(Var, Ty)] -&gt; Var -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetCallT"><span class="hs-identifier hs-var">T.LetCallT</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Language.Constants.html#mkPrinterName"><span class="hs-identifier hs-var">mkPrinterName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968388"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968391"><span class="hs-identifier hs-var">unpkd</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968394"><span class="hs-identifier hs-var">tl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [(Var, Ty)] -&gt; Var -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetCallT"><span class="hs-identifier hs-var">T.LetCallT</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Language.Constants.html#mkPrinterName"><span class="hs-identifier hs-var">mkPrinterName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968388"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-type">VectorTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968396"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968396"><span class="hs-identifier hs-var">_one</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PrintString"><span class="hs-identifier hs-var">T.PrintString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;vector&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-type">ListTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968397"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968397"><span class="hs-identifier hs-var">_one</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PrintString"><span class="hs-identifier hs-var">T.PrintString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;list&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680968399"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968399"><span class="hs-identifier hs-var">trv</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968400"><span class="annot"><span class="annottext">prntBool :: [Char] -&gt; Tail -&gt; Tail
</span><a href="#local-6989586621680968400"><span class="hs-identifier hs-var hs-var">prntBool</span></a></span></span><span> </span><span id="local-6989586621680968401"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968401"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PrintString"><span class="hs-identifier hs-var">T.PrintString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968401"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680968402"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968402"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Triv -&gt; Tail -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#IfT"><span class="hs-identifier hs-var">T.IfT</span></a></span><span> </span><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968399"><span class="hs-identifier hs-var">trv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
</span><a href="#local-6989586621680968400"><span class="hs-identifier hs-var">prntBool</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="Gibbon.Common.html#truePrinted"><span class="hs-identifier hs-var">truePrinted</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968402"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
</span><a href="#local-6989586621680968400"><span class="hs-identifier hs-var">prntBool</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="Gibbon.Common.html#falsePrinted"><span class="hs-identifier hs-var">falsePrinted</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968402"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printString"><span class="hs-identifier hs-var">printString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;'#()&quot;</span></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L4.Syntax.html#ProdTriv"><span class="hs-identifier hs-type">T.ProdTriv</span></a></span><span> </span><span id="local-6989586621680968408"><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968408"><span class="hs-identifier hs-var">trvs</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Ty3 -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printTy"><span class="hs-identifier hs-var">printTy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968370"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968371"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968408"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680968409"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968409"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-270"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968410"><span class="annot"><span class="annottext">printTupStart :: Tail -&gt; Tail
</span><a href="#local-6989586621680968410"><span class="hs-identifier hs-var hs-var">printTupStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printString"><span class="hs-identifier hs-var">printString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;'#(&quot;</span></span><span>
</span><span id="line-271"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680968411"><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968411"><span class="hs-identifier hs-var">bltrvs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968412"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968412"><span class="hs-identifier hs-var">ltrv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Triv] -&gt; [Triv]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Triv] -&gt; Triv
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680968415"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968415"><span class="hs-identifier hs-var">bltys</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968416"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968416"><span class="hs-identifier hs-var">lty</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty3] -&gt; [Ty3]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968409"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Ty3
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968409"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680968417"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968417"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">Tail -&gt; Tail
</span><a href="#local-6989586621680968410"><span class="hs-identifier hs-var">printTupStart</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">((Ty3, Triv) -&gt; Tail -&gt; Tail) -&gt; Tail -&gt; [(Ty3, Triv)] -&gt; Tail
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680968419"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968419"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968420"><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968420"><span class="hs-identifier hs-var">trv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680968421"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968421"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Ty3 -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printTy"><span class="hs-identifier hs-var">printTy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968370"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968419"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968420"><span class="hs-identifier hs-var">trv</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printSpace"><span class="hs-identifier hs-var">printSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968421"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Ty3 -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printTy"><span class="hs-identifier hs-var">printTy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968370"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968416"><span class="hs-identifier hs-var">lty</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680968412"><span class="hs-identifier hs-var">ltrv</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#closeParen"><span class="hs-identifier hs-var">closeParen</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968417"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty3] -&gt; [Triv] -&gt; [(Ty3, Triv)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968415"><span class="hs-identifier hs-var">bltys</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968411"><span class="hs-identifier hs-var">bltrvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><span class="annottext">(Ty3, [Triv])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail -&gt; Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Tail -&gt; Tail) -&gt; [Char] -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;printTy: unexpected: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty3, [Triv]) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968371"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968372"><span class="hs-identifier hs-var">trvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- | In packed mode, keep only the start cursors for packed values</span><span>
</span><span id="line-282"></span><span class="hs-comment">--</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- &gt;&gt;&gt; properTrivs True  (Packedty Tree _) [start,end]</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- [start]</span><span>
</span><span id="line-285"></span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- &gt;&gt;&gt; properTrivs True (ProdTy [IntTy, PackedTy &quot;Tree&quot; _]) [val1, start_cursor_1, end_cursor_1]</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- [val1, start_cursor_1]</span><span>
</span><span id="line-288"></span><span class="hs-comment">--</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- &gt;&gt;&gt; properTrivs True (ProdTy [IntTy,PackedTy &quot;Tree&quot; _, IntTy, PackedTy &quot;Tree _&quot;])</span><span>
</span><span id="line-290"></span><span class="hs-comment">--                 [val1, sc1, ec1, val2, sc2, ec2]</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- [val1, sc1, val2, sc2]</span><span>
</span><span id="line-292"></span><span class="hs-comment">--</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- &gt;&gt;&gt; properTrivs False (Packedty Tree _) [cur]</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- [cur]</span><span>
</span><span id="line-295"></span><span class="hs-comment">--</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- &gt;&gt;&gt; properTrivs False [IntTy,PackedTy &quot;Tree&quot; _, IntTy, PackedTy &quot;Tree _&quot;] [val1, c1, val2, c2]</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- [val1, c1, val2, c2]</span><span>
</span><span id="line-298"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#properTrivs"><span class="hs-identifier hs-type">properTrivs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L4.Syntax.html#Triv"><span class="hs-identifier hs-type">T.Triv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L4.Syntax.html#Triv"><span class="hs-identifier hs-type">T.Triv</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span id="properTrivs"><span class="annot"><span class="annottext">properTrivs :: Bool -&gt; Ty3 -&gt; [Triv] -&gt; [Triv]
</span><a href="Gibbon.Passes.Lower.html#properTrivs"><span class="hs-identifier hs-var hs-var">properTrivs</span></a></span></span><span> </span><span id="local-6989586621680968428"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968428"><span class="hs-identifier hs-var">pkd</span></a></span></span><span> </span><span id="local-6989586621680968429"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968429"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680968430"><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968430"><span class="hs-identifier hs-var">trvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968428"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968430"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-keyword">else</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968429"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680968432"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968432"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Triv] -&gt; [Ty3] -&gt; [Triv] -&gt; [Triv]
forall {a} {a}. (Out a, Out a) =&gt; [a] -&gt; [UrTy a] -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680968433"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968432"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968430"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Triv] -&gt; [Triv]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968430"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968430"><span class="hs-identifier hs-var">trvs</span></a></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621680968433"><span class="annot"><span class="annottext">go :: [a] -&gt; [UrTy a] -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680968433"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680968450"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968450"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680968451"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968451"><span class="hs-identifier hs-var">_trvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968450"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="#local-6989586621680968433"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680968452"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968452"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680968453"><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680968453"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680968454"><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680968454"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680968455"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680968455"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680968456"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968456"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-309"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy a -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a
</span><a href="#local-6989586621680968453"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [UrTy a] -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680968433"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968452"><span class="hs-identifier hs-var">acc</span></a></span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680968455"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680968454"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">L.tail</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968456"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [UrTy a] -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680968433"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968452"><span class="hs-identifier hs-var">acc</span></a></span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680968455"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680968454"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968456"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><a href="#local-6989586621680968433"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680968458"><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680968458"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621680968459"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968459"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [a]
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; [a]) -&gt; [Char] -&gt; [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;properTrivs: unexpected tys and trvs: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy a] -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680968458"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680968459"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-comment">-- printTy ty trvs = error $ &quot;Invalid L3 data type; &quot; ++ show ty ++ &quot; &quot; ++ show trvs</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#addPrintToTail"><span class="hs-identifier hs-type">addPrintToTail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span>
</span><span id="line-317"></span><span id="addPrintToTail"><span class="annot"><span class="annottext">addPrintToTail :: Ty3 -&gt; Tail -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#addPrintToTail"><span class="hs-identifier hs-var hs-var">addPrintToTail</span></a></span></span><span> </span><span id="local-6989586621680968466"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968466"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680968467"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968467"><span class="hs-identifier hs-var">tl0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621680968468"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680968468"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968470"><span class="annot"><span class="annottext">pkd :: Bool
</span><a href="#local-6989586621680968470"><span class="hs-identifier hs-var hs-var">pkd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_Packed"><span class="hs-identifier hs-var">Opt_Packed</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680968468"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-320"></span><span>        </span><span id="local-6989586621680968473"><span class="annot"><span class="annottext">ty' :: Ty
</span><a href="#local-6989586621680968473"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968470"><span class="hs-identifier hs-var">pkd</span></a></span><span>
</span><span id="line-321"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span>
</span><span id="line-322"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#fromL3Ty"><span class="hs-identifier hs-var">T.fromL3Ty</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968466"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">(Tail, Ty) -&gt; ([Triv] -&gt; Tail) -&gt; PassM Tail
forall (m :: * -&gt; *).
MonadState Int m =&gt;
(Tail, Ty) -&gt; ([Triv] -&gt; Tail) -&gt; m Tail
</span><a href="Gibbon.L4.Syntax.html#withTail"><span class="hs-identifier hs-var">T.withTail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968467"><span class="hs-identifier hs-var">tl0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="#local-6989586621680968473"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Triv] -&gt; Tail) -&gt; PassM Tail) -&gt; ([Triv] -&gt; Tail) -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680968476"><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968476"><span class="hs-identifier hs-var">trvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-324"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Ty3 -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.Passes.Lower.html#printTy"><span class="hs-identifier hs-var">printTy</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968470"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968466"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Ty3 -&gt; [Triv] -&gt; [Triv]
</span><a href="Gibbon.Passes.Lower.html#properTrivs"><span class="hs-identifier hs-var">properTrivs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680968470"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968466"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680968476"><span class="hs-identifier hs-var">trvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-comment">-- Always print a trailing newline at the end of execution:</span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PrintString"><span class="hs-identifier hs-var">T.PrintString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-327"></span><span>          </span><span class="hs-comment">-- T.LetPrimCallT [] T.FreeSymTable [] $</span><span>
</span><span id="line-328"></span><span>          </span><span class="annot"><span class="annottext">Tail
</span><a href="Gibbon.L4.Syntax.html#EndOfMain"><span class="hs-identifier hs-var">T.EndOfMain</span></a></span><span>  </span><span class="hs-comment">-- marker of the end of main expression</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="annot"><span class="hs-comment">-- | Look up the numeric tag for a dataCon</span></span><span>
</span><span id="line-331"></span><span id="local-6989586621680967973"><span class="annot"><a href="Gibbon.Passes.Lower.html#getTagOfDataCon"><span class="hs-identifier hs-type">getTagOfDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-type">Out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680967973"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680967973"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span></span><span>
</span><span id="line-332"></span><span id="getTagOfDataCon"><span class="annot"><span class="annottext">getTagOfDataCon :: forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; Tag
</span><a href="Gibbon.Passes.Lower.html#getTagOfDataCon"><span class="hs-identifier hs-var hs-var">getTagOfDataCon</span></a></span></span><span> </span><span id="local-6989586621680968495"><span class="annot"><span class="annottext">DDefs a
</span><a href="#local-6989586621680968495"><span class="hs-identifier hs-var">dds</span></a></span></span><span> </span><span id="local-6989586621680968496"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968496"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isIndirectionTag"><span class="hs-identifier hs-var">isIndirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968496"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Tag
forall a. Num a =&gt; a
</span><a href="Gibbon.Language.Constants.html#indirectionAlt"><span class="hs-identifier hs-var">indirectionAlt</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRedirectionTag"><span class="hs-identifier hs-var">isRedirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968496"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Tag
forall a. Num a =&gt; a
</span><a href="Gibbon.Language.Constants.html#redirectionAlt"><span class="hs-identifier hs-var">redirectionAlt</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRelRANDataCon"><span class="hs-identifier hs-var">isRelRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968496"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-comment">-- So that is_big in the RTS can identify which nodes have size information.</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Tag
</span><span class="hs-number">150</span></span><span> </span><span class="annot"><span class="annottext">Tag -&gt; Tag -&gt; Tag
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Tag
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968502"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Tag
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968502"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680968502"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968502"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968496"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; Maybe Int) -&gt; [[Char]] -&gt; Maybe Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs a -&gt; [Char] -&gt; [[Char]]
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; [[Char]]
</span><a href="Gibbon.Language.Syntax.html#getConOrdering"><span class="hs-identifier hs-var">getConOrdering</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs a
</span><a href="#local-6989586621680968495"><span class="hs-identifier hs-var">dds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968505"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680968505"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968505"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">([Char], [(Bool, a)])
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs a -&gt; [Char] -&gt; (Var, ([Char], [(Bool, a)]))
forall a.
Out a =&gt;
DDefs a -&gt; [Char] -&gt; (Var, ([Char], [(Bool, a)]))
</span><a href="Gibbon.Language.Syntax.html#lkp"><span class="hs-identifier hs-var">lkp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs a
</span><a href="#local-6989586621680968495"><span class="hs-identifier hs-var">dds</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968496"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">-- The compiler pass</span><span>
</span><span id="line-346"></span><span class="hs-comment">-------------------------------------------------------------------------------a</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- | Convert into the target language.  This does not make much of a</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- change, but it checks the changes that have already occurred.</span><span>
</span><span id="line-350"></span><span class="hs-comment">--</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- The only substantitive conversion here is of tupled arguments to</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- multiple argument functions.</span><span>
</span><span id="line-353"></span><span class="hs-comment">--</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- First argument indicates (1) whether we're inpacked mode, and (2)</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- the pre-cursorize type of the mainExp, if there is a mainExp.</span><span>
</span><span id="line-356"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#lower"><span class="hs-identifier hs-type">lower</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Prog3"><span class="hs-identifier hs-type">Prog3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Prog"><span class="hs-identifier hs-type">T.Prog</span></a></span><span>
</span><span id="line-357"></span><span id="lower"><span class="annot"><span class="annottext">lower :: Prog3 -&gt; PassM Prog
</span><a href="Gibbon.Passes.Lower.html#lower"><span class="hs-identifier hs-var hs-var">lower</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680968902"><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3)
fundefs :: FunDefs (PreExp E3Ext () Ty3)
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
</span><a href="#local-6989586621680968902"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968904"><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
ddefs :: DDefs (TyOf (PreExp E3Ext () Ty3))
ddefs :: forall ex. Prog ex -&gt; DDefs (TyOf ex)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var hs-var">ddefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968906"><span class="annot"><span class="annottext">Maybe (PreExp E3Ext () Ty3, TyOf (PreExp E3Ext () Ty3))
mainExp :: Maybe (PreExp E3Ext () Ty3, TyOf (PreExp E3Ext () Ty3))
mainExp :: forall ex. Prog ex -&gt; Maybe (ex, TyOf ex)
</span><a href="#local-6989586621680968906"><span class="hs-identifier hs-var hs-var">mainExp</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-comment">-- In Lower, we want to replace LitSymE's with the corresponding index into</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-comment">-- the symbol table. That's why we build a map from String's to Int64's.</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- However, all the subsequent lookup's will be on the index, to get to the</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-comment">-- String. So we store an inverse of this map in a L4 program. Because we've</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-comment">-- built the map with `gensym`, it's safe to assume that the indices are</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-comment">-- unique.</span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-comment">-- inv_sym_tbl :: M.Map String Word16</span><span>
</span><span id="line-365"></span><span>  </span><span id="local-6989586621680968908"><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680968908"><span class="hs-identifier hs-var">inv_sym_tbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM (Map [Char] Word16)
</span><a href="#local-6989586621680968909"><span class="hs-identifier hs-var">build_inv_symbol_table</span></a></span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-comment">-- sym_tbl :: M.Map Int64 String</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968910"><span class="annot"><span class="annottext">sym_tbl :: Map Word16 [Char]
</span><a href="#local-6989586621680968910"><span class="hs-identifier hs-var hs-var">sym_tbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Word16, [Char])] -&gt; Map Word16 [Char]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Word16, [Char])] -&gt; Map Word16 [Char])
-&gt; [(Word16, [Char])] -&gt; Map Word16 [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(([Char], Word16) -&gt; (Word16, [Char]))
-&gt; [([Char], Word16)] -&gt; [(Word16, [Char])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">([Char], Word16) -&gt; (Word16, [Char])
forall a b. (a, b) -&gt; (b, a)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#swap"><span class="hs-identifier hs-var">swap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [([Char], Word16)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680968908"><span class="hs-identifier hs-var">inv_sym_tbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968913"><span class="annot"><span class="annottext">info_tbl :: InfoTable
</span><a href="#local-6989586621680968913"><span class="hs-identifier hs-var hs-var">info_tbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InfoTable
</span><a href="#local-6989586621680968914"><span class="hs-identifier hs-var">build_info_table</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>  </span><span id="local-6989586621680968915"><span class="annot"><span class="annottext">Maybe MainExp
</span><a href="#local-6989586621680968915"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (PreExp E3Ext () Ty3, TyOf (PreExp E3Ext () Ty3))
</span><a href="#local-6989586621680968906"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>          </span><span class="annot"><span class="annottext">Maybe (PreExp E3Ext () Ty3, TyOf (PreExp E3Ext () Ty3))
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe MainExp -&gt; PassM (Maybe MainExp)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MainExp
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-373"></span><span>          </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680968916"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968916"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968917"><span class="annot"><span class="annottext">TyOf (PreExp E3Ext () Ty3)
</span><a href="#local-6989586621680968917"><span class="hs-identifier hs-var">mty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MainExp -&gt; Maybe MainExp
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(MainExp -&gt; Maybe MainExp)
-&gt; (Tail -&gt; MainExp) -&gt; Tail -&gt; Maybe MainExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Tail -&gt; MainExp
</span><a href="Gibbon.L4.Syntax.html#PrintExp"><span class="hs-identifier hs-var">T.PrintExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Maybe MainExp) -&gt; PassM Tail -&gt; PassM (Maybe MainExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-374"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Tail -&gt; PassM Tail
</span><a href="Gibbon.Passes.Lower.html#addPrintToTail"><span class="hs-identifier hs-var">addPrintToTail</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf (PreExp E3Ext () Ty3)
Ty3
</span><a href="#local-6989586621680968917"><span class="hs-identifier hs-var">mty</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680968908"><span class="hs-identifier hs-var">inv_sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968916"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>  </span><span id="local-6989586621680968922"><span class="annot"><span class="annottext">[FunDecl]
</span><a href="#local-6989586621680968922"><span class="hs-identifier hs-var">funs</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FunDef (PreExp E3Ext () Ty3) -&gt; PassM FunDecl)
-&gt; [FunDef (PreExp E3Ext () Ty3)] -&gt; PassM [FunDecl]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; FunDef (PreExp E3Ext () Ty3) -&gt; PassM FunDecl
</span><a href="#local-6989586621680968924"><span class="hs-identifier hs-var">fund</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680968908"><span class="hs-identifier hs-var">inv_sym_tbl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3) -&gt; [FunDef (PreExp E3Ext () Ty3)]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3)
</span><a href="#local-6989586621680968902"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>  </span><span id="local-6989586621680968926"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680968926"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-377"></span><span>  </span><span id="local-6989586621680968927"><span class="annot"><span class="annottext">[FunDecl]
</span><a href="#local-6989586621680968927"><span class="hs-identifier hs-var">unpackers</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_Pointer"><span class="hs-identifier hs-var">Opt_Pointer</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680968926"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-378"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(DDef Ty3 -&gt; PassM FunDecl) -&gt; [DDef Ty3] -&gt; PassM [FunDecl]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">DDef Ty3 -&gt; PassM FunDecl
</span><a href="Gibbon.Passes.Lower.html#genUnpacker"><span class="hs-identifier hs-var">genUnpacker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DDef Ty3 -&gt; Bool) -&gt; [DDef Ty3] -&gt; [DDef Ty3]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">L.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (DDef Ty3 -&gt; Bool) -&gt; DDef Ty3 -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DDef Ty3 -&gt; Bool
forall a. DDef a -&gt; Bool
</span><a href="Gibbon.Language.Syntax.html#isVoidDDef"><span class="hs-identifier hs-var">isVoidDDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [DDef Ty3]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[FunDecl] -&gt; PassM [FunDecl]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InfoTable
-&gt; Map Word16 [Char] -&gt; [FunDecl] -&gt; Maybe MainExp -&gt; Prog
</span><a href="Gibbon.L4.Syntax.html#Prog"><span class="hs-identifier hs-var">T.Prog</span></a></span><span> </span><span class="annot"><span class="annottext">InfoTable
</span><a href="#local-6989586621680968913"><span class="hs-identifier hs-var">info_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word16 [Char]
</span><a href="#local-6989586621680968910"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FunDecl] -&gt; Maybe MainExp -&gt; Prog)
-&gt; PassM [FunDecl] -&gt; PassM (Maybe MainExp -&gt; Prog)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDecl] -&gt; PassM [FunDecl]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FunDecl]
</span><a href="#local-6989586621680968922"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDecl] -&gt; [FunDecl] -&gt; [FunDecl]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDecl]
</span><a href="#local-6989586621680968927"><span class="hs-identifier hs-var">unpackers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PassM (Maybe MainExp -&gt; Prog)
-&gt; PassM (Maybe MainExp) -&gt; PassM Prog
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MainExp -&gt; PassM (Maybe MainExp)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MainExp
</span><a href="#local-6989586621680968915"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-381"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-382"></span><span>  </span><span class="annot"><a href="#local-6989586621680968924"><span class="hs-identifier hs-type">fund</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#FunDef3"><span class="hs-identifier hs-type">FunDef3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#FunDecl"><span class="hs-identifier hs-type">T.FunDecl</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621680968924"><span class="annot"><span class="annottext">fund :: Map [Char] Word16 -&gt; FunDef (PreExp E3Ext () Ty3) -&gt; PassM FunDecl
</span><a href="#local-6989586621680968924"><span class="hs-identifier hs-var hs-var">fund</span></a></span></span><span> </span><span id="local-6989586621680968932"><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680968932"><span class="hs-identifier hs-var">sym_tbl</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680968934"><span class="annot"><span class="annottext">Var
funName :: Var
funName :: forall ex. FunDef ex -&gt; Var
</span><a href="#local-6989586621680968934"><span class="hs-identifier hs-var hs-var">funName</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968936"><span class="annot"><span class="annottext">ArrowTy (TyOf (PreExp E3Ext () Ty3))
funTy :: ArrowTy (TyOf (PreExp E3Ext () Ty3))
funTy :: forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="#local-6989586621680968936"><span class="hs-identifier hs-var hs-var">funTy</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968938"><span class="annot"><span class="annottext">[Var]
funArgs :: [Var]
funArgs :: forall ex. FunDef ex -&gt; [Var]
</span><a href="#local-6989586621680968938"><span class="hs-identifier hs-var hs-var">funArgs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968940"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
funBody :: PreExp E3Ext () Ty3
funBody :: forall ex. FunDef ex -&gt; ex
</span><a href="#local-6989586621680968940"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680968942"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968942"><span class="hs-identifier hs-var">intys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680968943"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968943"><span class="hs-identifier hs-var">outty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf (PreExp E3Ext () Ty3))
</span><a href="#local-6989586621680968936"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-385"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680968944"><span class="annot"><span class="annottext">[(Var, Ty)]
</span><a href="#local-6989586621680968944"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680968945"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968945"><span class="hs-identifier hs-var">bod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty] -&gt; [(Var, Ty)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680968938"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968942"><span class="hs-identifier hs-var">intys</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968940"><span class="hs-identifier hs-var">funBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>      </span><span id="local-6989586621680968947"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968947"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Bool
</span><a href="#local-6989586621680968948"><span class="hs-identifier hs-var">hasCursorTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968943"><span class="hs-identifier hs-var">outty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680968932"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968945"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-387"></span><span>      </span><span class="annot"><span class="annottext">FunDecl -&gt; PassM FunDecl
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#FunDecl"><span class="hs-identifier hs-type">T.FunDecl</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funName :: Var
</span><a href="Gibbon.L4.Syntax.html#funName"><span class="hs-identifier hs-var">T.funName</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968934"><span class="hs-identifier hs-var">funName</span></a></span><span>
</span><span id="line-388"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funArgs :: [(Var, Ty)]
</span><a href="Gibbon.L4.Syntax.html#funArgs"><span class="hs-identifier hs-var">T.funArgs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)]
</span><a href="#local-6989586621680968944"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-389"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funRetTy :: Ty
</span><a href="Gibbon.L4.Syntax.html#funRetTy"><span class="hs-identifier hs-var">T.funRetTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968943"><span class="hs-identifier hs-var">outty</span></a></span><span>
</span><span id="line-390"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funBody :: Tail
</span><a href="Gibbon.L4.Syntax.html#funBody"><span class="hs-identifier hs-var">T.funBody</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680968947"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-391"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">isPure :: Bool
</span><a href="Gibbon.L4.Syntax.html#isPure"><span class="hs-identifier hs-var">T.isPure</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="#local-6989586621680968949"><span class="hs-identifier hs-var">ispure</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968940"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-392"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><a href="#local-6989586621680968914"><span class="hs-identifier hs-type">build_info_table</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#InfoTable"><span class="hs-identifier hs-type">T.InfoTable</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span id="local-6989586621680968914"><span class="annot"><span class="annottext">build_info_table :: InfoTable
</span><a href="#local-6989586621680968914"><span class="hs-identifier hs-var hs-var">build_info_table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-396"></span><span>      </span><span class="annot"><span class="annottext">(DDef Ty3 -&gt; InfoTable -&gt; InfoTable)
-&gt; InfoTable -&gt; Map Var (DDef Ty3) -&gt; InfoTable
forall a b k. (a -&gt; b -&gt; b) -&gt; b -&gt; Map k a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldr"><span class="hs-identifier hs-var">M.foldr</span></a></span><span>
</span><span id="line-397"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDef"><span class="hs-identifier hs-type">DDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680968951"><span class="annot"><span class="annottext">Var
tyName :: forall a. DDef a -&gt; Var
tyName :: Var
</span><a href="Gibbon.Language.Syntax.html#tyName"><span class="hs-identifier hs-var hs-var">tyName</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968952"><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])]
dataCons :: forall a. DDef a -&gt; [([Char], [(Bool, a)])]
dataCons :: [([Char], [(Bool, Ty3)])]
</span><a href="Gibbon.Language.Syntax.html#dataCons"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680968953"><span class="annot"><span class="annottext">InfoTable
</span><a href="#local-6989586621680968953"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-398"></span><span>               </span><span class="annot"><span class="annottext">[Char] -&gt; TyConInfo -&gt; InfoTable -&gt; InfoTable
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span>
</span><span id="line-399"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680968951"><span class="hs-identifier hs-var">tyName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([Char], [(Bool, Ty3)]) -&gt; TyConInfo -&gt; TyConInfo)
-&gt; TyConInfo -&gt; [([Char], [(Bool, Ty3)])] -&gt; TyConInfo
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680968955"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968955"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968956"><span class="annot"><span class="annottext">[(Bool, Ty3)]
</span><a href="#local-6989586621680968956"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680968957"><span class="annot"><span class="annottext">TyConInfo
</span><a href="#local-6989586621680968957"><span class="hs-identifier hs-var">dcon_acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>                             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isIndirectionTag"><span class="hs-identifier hs-var">isIndirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968955"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRedirectionTag"><span class="hs-identifier hs-var">isRedirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968955"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-402"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TyConInfo
</span><a href="#local-6989586621680968957"><span class="hs-identifier hs-var">dcon_acc</span></a></span><span>
</span><span id="line-403"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; DataConInfo -&gt; TyConInfo -&gt; TyConInfo
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968955"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [(Bool, Ty3)] -&gt; DataConInfo
</span><a href="#local-6989586621680968959"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968955"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, Ty3)]
</span><a href="#local-6989586621680968956"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyConInfo
</span><a href="#local-6989586621680968957"><span class="hs-identifier hs-var">dcon_acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>                          </span><span class="annot"><span class="annottext">TyConInfo
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-405"></span><span>                          </span><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])]
</span><a href="#local-6989586621680968952"><span class="hs-identifier hs-var">dataCons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>                   </span><span class="annot"><span class="annottext">InfoTable
</span><a href="#local-6989586621680968953"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>          </span><span class="annot"><span class="annottext">InfoTable
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-408"></span><span>          </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-410"></span><span>        </span><span id="local-6989586621680968959"><span class="annot"><span class="annottext">go :: [Char] -&gt; [(Bool, Ty3)] -&gt; DataConInfo
</span><a href="#local-6989586621680968959"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680968961"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968961"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621680968962"><span class="annot"><span class="annottext">[(Bool, Ty3)]
</span><a href="#local-6989586621680968962"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968963"><span class="annot"><span class="annottext">field_tys :: [Ty3]
</span><a href="#local-6989586621680968963"><span class="hs-identifier hs-var hs-var">field_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Bool, Ty3) -&gt; Ty3) -&gt; [(Bool, Ty3)] -&gt; [Ty3]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool, Ty3) -&gt; Ty3
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, Ty3)]
</span><a href="#local-6989586621680968962"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-412"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621680968965"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968965"><span class="hs-identifier hs-var">num_packed</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968966"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968966"><span class="hs-identifier hs-var">num_scalars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680968967"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968967"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968968"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968968"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-413"></span><span>                                              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680968969"><span class="annot"><span class="annottext">b' :: [Ty3]
</span><a href="#local-6989586621680968969"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Bool) -&gt; [Ty3] -&gt; [Ty3]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680968970"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968970"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968970"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-414"></span><span>                                                                       </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-415"></span><span>                                                                       </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>                                                              </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968968"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-417"></span><span>                                              </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty3] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968967"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968969"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Ty3], [Ty3]) -&gt; (Int, Int)) -&gt; ([Ty3], [Ty3]) -&gt; (Int, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-418"></span><span>                                           </span><span class="annot"><span class="annottext">(Ty3 -&gt; Bool) -&gt; [Ty3] -&gt; ([Ty3], [Ty3])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#partition"><span class="hs-identifier hs-var">L.partition</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968963"><span class="hs-identifier hs-var">field_tys</span></a></span><span>
</span><span id="line-419"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621680968973"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968973"><span class="hs-identifier hs-var">scalar_bytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680968974"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968974"><span class="hs-identifier hs-var">num_shortcut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-420"></span><span>                               </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Ty3 -&gt; (Int, Int))
-&gt; (Int, Int) -&gt; [Ty3] -&gt; (Int, Int)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680968976"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968976"><span class="hs-identifier hs-var">acc1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680968977"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968977"><span class="hs-identifier hs-var">acc2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680968978"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968978"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-421"></span><span>                                          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968978"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-422"></span><span>                                            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968976"><span class="hs-identifier hs-var">acc1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968977"><span class="hs-identifier hs-var">acc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>                                            </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968976"><span class="hs-identifier hs-var">acc1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968977"><span class="hs-identifier hs-var">acc2</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>                                            </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968976"><span class="hs-identifier hs-var">acc1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680968978"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968977"><span class="hs-identifier hs-var">acc2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968963"><span class="hs-identifier hs-var">field_tys</span></a></span><span>
</span><span id="line-426"></span><span>                </span><span id="local-6989586621680968981"><span class="annot"><span class="annottext">dcon_tag :: Tag
</span><a href="#local-6989586621680968981"><span class="hs-identifier hs-var hs-var">dcon_tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; Tag
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; Tag
</span><a href="Gibbon.Passes.Lower.html#getTagOfDataCon"><span class="hs-identifier hs-var">getTagOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680968961"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-427"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tag -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; [Ty3] -&gt; DataConInfo
</span><a href="Gibbon.L4.Syntax.html#DataConInfo"><span class="hs-identifier hs-var">T.DataConInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680968981"><span class="hs-identifier hs-var">dcon_tag</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968973"><span class="hs-identifier hs-var">scalar_bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968974"><span class="hs-identifier hs-var">num_shortcut</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968966"><span class="hs-identifier hs-var">num_scalars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680968965"><span class="hs-identifier hs-var">num_packed</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968963"><span class="hs-identifier hs-var">field_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>  </span><span class="annot"><a href="#local-6989586621680968948"><span class="hs-identifier hs-type">hasCursorTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-431"></span><span>  </span><span id="local-6989586621680968948"><span class="annot"><span class="annottext">hasCursorTy :: Ty3 -&gt; Bool
</span><a href="#local-6989586621680968948"><span class="hs-identifier hs-var hs-var">hasCursorTy</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><a href="#local-6989586621680968948"><span class="hs-identifier hs-var">hasCursorTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680968983"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968983"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Bool) -&gt; [Ty3] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Bool
</span><a href="#local-6989586621680968948"><span class="hs-identifier hs-var">hasCursorTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680968983"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-433"></span><span>  </span><span class="annot"><a href="#local-6989586621680968948"><span class="hs-identifier hs-var">hasCursorTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-comment">-- TimeIt forms are impure because they have print statements after codegen</span><span>
</span><span id="line-436"></span><span>  </span><span class="annot"><a href="#local-6989586621680968949"><span class="hs-identifier hs-type">ispure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span id="local-6989586621680968949"><span class="annot"><span class="annottext">ispure :: PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="#local-6989586621680968949"><span class="hs-identifier hs-var hs-var">ispure</span></a></span></span><span> </span><span id="local-6989586621680968986"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968986"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968986"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-439"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-440"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#Gensym"><span class="hs-identifier hs-var">Gensym</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-441"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#RandP"><span class="hs-identifier hs-var">RandP</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-442"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FRandP"><span class="hs-identifier hs-var">FRandP</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-443"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680968993"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968993"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680968994"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968994"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="#local-6989586621680968949"><span class="hs-identifier hs-var">ispure</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968993"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="#local-6989586621680968949"><span class="hs-identifier hs-var">ispure</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968994"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680968997"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968997"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680968998"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968998"><span class="hs-identifier hs-var">c</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="#local-6989586621680968949"><span class="hs-identifier hs-var">ispure</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968997"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="#local-6989586621680968949"><span class="hs-identifier hs-var">ispure</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680968998"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-445"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969000"><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969000"><span class="hs-identifier hs-var">brs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
forall a. a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(([Char], [(Var, ())], PreExp E3Ext () Ty3) -&gt; Bool)
-&gt; [([Char], [(Var, ())], PreExp E3Ext () Ty3)] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680969003"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969003"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="#local-6989586621680968949"><span class="hs-identifier hs-var">ispure</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969003"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969000"><span class="hs-identifier hs-var">brs</span></a></span><span>
</span><span id="line-446"></span><span>      </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><a href="#local-6989586621680968909"><span class="hs-identifier hs-type">build_inv_symbol_table</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>  </span><span id="local-6989586621680968909"><span class="annot"><span class="annottext">build_inv_symbol_table :: PassM (Map [Char] Word16)
</span><a href="#local-6989586621680968909"><span class="hs-identifier hs-var hs-var">build_inv_symbol_table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Map [Char] Word16 -&gt; PassM (Map [Char] Word16))
-&gt; Map [Char] Word16 -&gt; Set [Char] -&gt; PassM (Map [Char] Word16)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldrM"><span class="hs-identifier hs-var">foldrM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680969005"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969005"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680969006"><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969006"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Map [Char] Word16 -&gt; Maybe Word16
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969005"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969006"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-450"></span><span>                                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; PassM (Map [Char] Word16)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969006"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-451"></span><span>                                           </span><span class="annot"><span class="annottext">Maybe Word16
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-452"></span><span>                                             </span><span id="local-6989586621680969008"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621680969008"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word16) -&gt; PassM Int -&gt; PassM Word16
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PassM Int
forall (m :: * -&gt; *). MonadState Int m =&gt; m Int
</span><a href="Gibbon.Common.html#newUniq"><span class="hs-identifier hs-var">newUniq</span></a></span><span>
</span><span id="line-453"></span><span>                                             </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; PassM (Map [Char] Word16)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Word16 -&gt; Map [Char] Word16 -&gt; Map [Char] Word16
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969005"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621680969008"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969006"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>                              </span><span class="annot"><span class="annottext">Map [Char] Word16
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969010"><span class="hs-identifier hs-var">all_syms</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-456"></span><span>      </span><span class="annot"><a href="#local-6989586621680969010"><span class="hs-identifier hs-type">all_syms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-457"></span><span>      </span><span id="local-6989586621680969010"><span class="annot"><span class="annottext">all_syms :: Set [Char]
</span><a href="#local-6989586621680969010"><span class="hs-identifier hs-var hs-var">all_syms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (PreExp E3Ext () Ty3, TyOf (PreExp E3Ext () Ty3))
</span><a href="#local-6989586621680968906"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-458"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (PreExp E3Ext () Ty3, TyOf (PreExp E3Ext () Ty3))
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-459"></span><span>                    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969012"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969012"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyOf (PreExp E3Ext () Ty3)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969013"><span class="hs-identifier hs-var">collect_syms</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char]
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969012"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; Set [Char] -&gt; Set [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-460"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set [Char] -&gt; FunDef (PreExp E3Ext () Ty3) -&gt; Set [Char])
-&gt; Set [Char] -&gt; FunDefs (PreExp E3Ext () Ty3) -&gt; Set [Char]
forall a b k. (a -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldl"><span class="hs-identifier hs-var">M.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680969015"><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969015"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680969016"><span class="annot"><span class="annottext">FunDef (PreExp E3Ext () Ty3)
</span><a href="#local-6989586621680969016"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969013"><span class="hs-identifier hs-var">collect_syms</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969015"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef (PreExp E3Ext () Ty3) -&gt; PreExp E3Ext () Ty3
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp E3Ext () Ty3)
</span><a href="#local-6989586621680969016"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set [Char]
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3)
</span><a href="#local-6989586621680968902"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><a href="#local-6989586621680969013"><span class="hs-identifier hs-type">collect_syms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span id="local-6989586621680969013"><span class="annot"><span class="annottext">collect_syms :: Set [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969013"><span class="hs-identifier hs-var hs-var">collect_syms</span></a></span></span><span> </span><span id="local-6989586621680969017"><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span></span><span> </span><span id="local-6989586621680969018"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969018"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-465"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969019"><span class="annot"><span class="annottext">go :: PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969013"><span class="hs-identifier hs-var">collect_syms</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-466"></span><span>            </span><span id="local-6989586621680969020"><span class="annot"><span class="annottext">gol :: [PreExp E3Ext () Ty3] -&gt; Set [Char]
</span><a href="#local-6989586621680969020"><span class="hs-identifier hs-var hs-var">gol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Set [Char])
-&gt; Set [Char] -&gt; [PreExp E3Ext () Ty3] -&gt; Set [Char]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969013"><span class="hs-identifier hs-var">collect_syms</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-467"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969018"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-468"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-469"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-470"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-472"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span> </span><span id="local-6989586621680969026"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969026"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Set [Char] -&gt; Set [Char]
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969026"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-473"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969029"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969029"><span class="hs-identifier hs-var">args</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3] -&gt; Set [Char]
</span><a href="#local-6989586621680969020"><span class="hs-identifier hs-var">gol</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969029"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-474"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969030"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969030"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3] -&gt; Set [Char]
</span><a href="#local-6989586621680969020"><span class="hs-identifier hs-var">gol</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969030"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-475"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680969031"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969031"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969032"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969032"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969031"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; Set [Char] -&gt; Set [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969032"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-476"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680969033"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969033"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680969034"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969034"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680969035"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969035"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969033"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; Set [Char] -&gt; Set [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969034"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; Set [Char] -&gt; Set [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969035"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-477"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680969037"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969037"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3] -&gt; Set [Char]
</span><a href="#local-6989586621680969020"><span class="hs-identifier hs-var">gol</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969037"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-478"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969039"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969039"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969039"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-479"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680969040"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969040"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680969041"><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969041"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-480"></span><span>            </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969040"><span class="hs-identifier hs-var">scrt</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; Set [Char] -&gt; Set [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Set [Char]
 -&gt; ([Char], [(Var, ())], PreExp E3Ext () Ty3) -&gt; Set [Char])
-&gt; Set [Char]
-&gt; [([Char], [(Var, ())], PreExp E3Ext () Ty3)]
-&gt; Set [Char]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680969042"><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969042"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680969043"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969043"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969013"><span class="hs-identifier hs-var">collect_syms</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969042"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969043"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span> </span><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969041"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-481"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969045"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969045"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3] -&gt; Set [Char]
</span><a href="#local-6989586621680969020"><span class="hs-identifier hs-var">gol</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969045"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-482"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680969046"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969046"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969046"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-483"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969048"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969048"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969048"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-484"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969050"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969050"><span class="hs-identifier hs-var">ls</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3] -&gt; Set [Char]
</span><a href="#local-6989586621680969020"><span class="hs-identifier hs-var">gol</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969050"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-485"></span><span>          </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-486"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680969053"><span class="annot"><span class="annottext">E3Ext () Ty3
</span><a href="#local-6989586621680969053"><span class="hs-identifier hs-var">ext</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-487"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3
</span><a href="#local-6989586621680969053"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-488"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteScalar"><span class="hs-identifier hs-type">WriteScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969055"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969055"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969055"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-489"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-type">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969057"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969057"><span class="hs-identifier hs-var">ex</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969057"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-490"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#SubPtr"><span class="hs-identifier hs-type">SubPtr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-491"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteCursor"><span class="hs-identifier hs-type">WriteCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969060"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969060"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969060"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-492"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-493"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadScalar"><span class="hs-identifier hs-type">ReadScalar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-494"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadTag"><span class="hs-identifier hs-type">ReadTag</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-495"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteTag"><span class="hs-identifier hs-type">WriteTag</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-496"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadList"><span class="hs-identifier hs-type">ReadList</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-497"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteList"><span class="hs-identifier hs-type">WriteList</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969067"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969067"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969067"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-498"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadVector"><span class="hs-identifier hs-type">ReadVector</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-499"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteVector"><span class="hs-identifier hs-type">WriteVector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969070"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969070"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969070"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-500"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#NewBuffer"><span class="hs-identifier hs-type">NewBuffer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-501"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#NewParBuffer"><span class="hs-identifier hs-type">NewParBuffer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-502"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#ScopedBuffer"><span class="hs-identifier hs-type">ScopedBuffer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-503"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#ScopedParBuffer"><span class="hs-identifier hs-type">ScopedParBuffer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-504"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#EndOfBuffer"><span class="hs-identifier hs-type">EndOfBuffer</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-505"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#MMapFileSize"><span class="hs-identifier hs-type">MMapFileSize</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-506"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#SizeOfPacked"><span class="hs-identifier hs-type">SizeOfPacked</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-507"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#SizeOfScalar"><span class="hs-identifier hs-type">SizeOfScalar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-508"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-509"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadCursor"><span class="hs-identifier hs-type">ReadCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-510"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteTaggedCursor"><span class="hs-identifier hs-type">WriteTaggedCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-511"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadTaggedCursor"><span class="hs-identifier hs-type">ReadTaggedCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-512"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#IndirectionBarrier"><span class="hs-identifier hs-type">IndirectionBarrier</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-513"></span><span>              </span><span class="annot"><span class="annottext">E3Ext () Ty3
</span><a href="Gibbon.L3.Syntax.html#NullCursor"><span class="hs-identifier hs-var">NullCursor</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-514"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#BumpArenaRefCount"><span class="hs-identifier hs-type">BumpArenaRefCount</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Set [Char]
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;collect_syms: BumpArenaRefCount not handled.&quot;</span></span><span>
</span><span id="line-515"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span> </span><span id="local-6989586621680969087"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969087"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3] -&gt; Set [Char]
</span><a href="#local-6989586621680969020"><span class="hs-identifier hs-var">gol</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969087"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-516"></span><span>              </span><span class="annot"><span class="annottext">E3Ext () Ty3
</span><a href="Gibbon.L3.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-517"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969090"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969090"><span class="hs-identifier hs-var">bod</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969013"><span class="hs-identifier hs-var">collect_syms</span></a></span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969090"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-518"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-519"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-520"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#StartTagAllocation"><span class="hs-identifier hs-type">StartTagAllocation</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-521"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#EndTagAllocation"><span class="hs-identifier hs-type">EndTagAllocation</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-522"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#StartScalarsAllocation"><span class="hs-identifier hs-type">StartScalarsAllocation</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-523"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#EndScalarsAllocation"><span class="hs-identifier hs-type">EndScalarsAllocation</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-524"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-525"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-526"></span><span>              </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span id="local-6989586621680969100"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969100"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Set [Char]
</span><a href="#local-6989586621680969019"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969100"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-527"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-528"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680969017"><span class="hs-identifier hs-var">syms</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span>  </span><span class="annot"><a href="#local-6989586621680968921"><span class="hs-identifier hs-type">tail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span>
</span><span id="line-532"></span><span>  </span><span id="local-6989586621680968921"><span class="annot"><span class="annottext">tail :: Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var hs-var">tail</span></a></span></span><span> </span><span id="local-6989586621680969103"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span></span><span> </span><span id="local-6989586621680969104"><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span></span><span> </span><span id="local-6989586621680969105"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969105"><span class="hs-identifier hs-var">ex0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-533"></span><span>   </span><span id="local-6989586621680969106"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680969106"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-534"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969107"><span class="annot"><span class="annottext">pkd :: Bool
</span><a href="#local-6989586621680969107"><span class="hs-identifier hs-var hs-var">pkd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_Packed"><span class="hs-identifier hs-var">Opt_Packed</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680969106"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-535"></span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969105"><span class="hs-identifier hs-var">ex0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-comment">-- HACK! We don't have LetSwitchT yet.  This means potential exponential code duplication:</span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-comment">-- LetE (_,_, CaseE _ _) _ -&gt;</span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-comment">--    error &quot;lower: unfinished, we cannot let-bind the result of a switch yet.&quot;</span><span>
</span><span id="line-540"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969108"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969108"><span class="hs-identifier hs-var">vr</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969109"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680969109"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969110"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969110"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680969111"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969111"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680969112"><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969112"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969113"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969113"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PassM Tail)
-&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-541"></span><span>                                       </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a. Int -&gt; [Char] -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WARNING: Let-bound CasE, code duplication of this body:\n  &quot;</span></span><span>
</span><span id="line-542"></span><span>                                                   </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969113"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-543"></span><span>         </span><span class="hs-comment">-- For now just duplicate code:</span><span>
</span><span id="line-544"></span><span>         </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; [([Char], [(Var, ())], PreExp E3Ext () Ty3)]
-&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [([Char], [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969111"><span class="hs-identifier hs-var">scrt</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969115"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969116"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Var, Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="Gibbon.Passes.Lower.html#mkLet"><span class="hs-identifier hs-var">mkLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969108"><span class="hs-identifier hs-var">vr</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969110"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969118"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969113"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969115"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969115"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969116"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969116"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969118"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969118"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969112"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-comment">-- Aaand... if we're going to push Let's under Case's, we have to repeat this bit of flattening:</span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969119"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969119"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969120"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680969120"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969121"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969121"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969122"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969122"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969123"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680969123"><span class="hs-identifier hs-var">locs2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969124"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969124"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969125"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969125"><span class="hs-identifier hs-var">rhs2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969126"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969126"><span class="hs-identifier hs-var">rhs1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969127"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969127"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-549"></span><span>       </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PassM Tail)
-&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969122"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680969120"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969124"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969125"><span class="hs-identifier hs-var">rhs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969119"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680969123"><span class="hs-identifier hs-var">locs2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969121"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969126"><span class="hs-identifier hs-var">rhs1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969127"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-comment">-- Packed codegen</span><span>
</span><span id="line-553"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>    </span><span class="hs-comment">-- Likewise, Case really means ReadTag.  Argument is a cursor.</span><span>
</span><span id="line-556"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680969128"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969128"><span class="hs-identifier hs-var">scrut</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969129"><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969129"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969107"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>        </span><span id="local-6989586621680969130"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969130"><span class="hs-identifier hs-var">tagtmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpval&quot;</span></span><span>
</span><span id="line-558"></span><span>        </span><span id="local-6989586621680969132"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969132"><span class="hs-identifier hs-var">ctmp</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpcur&quot;</span></span><span>
</span><span id="line-559"></span><span>        </span><span class="hs-comment">-- Here we lamely chase down all the tuple references and make them variables:</span><span>
</span><span id="line-560"></span><span>        </span><span class="hs-comment">-- So that Goto's work properly (See [Modifying switch statements to use redirection nodes]).</span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969133"><span class="annot"><span class="annottext">doalt :: ([Char], [(Var, ())], PreExp E3Ext () Ty3) -&gt; PassM (Tag, Tail)
</span><a href="#local-6989586621680969133"><span class="hs-identifier hs-var hs-var">doalt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969134"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969134"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969135"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969135"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969136"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969136"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969137"><span class="annot"><span class="annottext">rhs' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969137"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3 -&gt; E3Ext () Ty3
forall loc dec. Var -&gt; PreExp E3Ext loc dec -&gt; E3Ext loc dec
</span><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-var">AddCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969128"><span class="hs-identifier hs-var">scrut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969132"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-563"></span><span>                         </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969136"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-564"></span><span>              </span><span class="hs-comment">-- We only need to thread one value through, the cursor resulting from read.</span><span>
</span><span id="line-565"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; Tag
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; Tag
</span><a href="Gibbon.Passes.Lower.html#getTagOfDataCon"><span class="hs-identifier hs-var">getTagOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969134"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; (Tag, Tail)) -&gt; PassM Tail -&gt; PassM (Tag, Tail)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-566"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969135"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-567"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969137"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-comment">-- AUDITME -- is this legit, or should it have one cursor param anyway?</span><span>
</span><span id="line-568"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621680969139"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969139"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
Var -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969139"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969132"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969137"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>                  </span><span id="local-6989586621680969141"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969141"><span class="hs-identifier hs-var">oth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower.tail.CaseE: unexpected pattern&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, ())] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969141"><span class="hs-identifier hs-var">oth</span></a></span><span>
</span><span id="line-570"></span><span>        </span><span id="local-6989586621680969142"><span class="annot"><span class="annottext">[(Tag, Tail)]
</span><a href="#local-6989586621680969142"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(([Char], [(Var, ())], PreExp E3Ext () Ty3) -&gt; PassM (Tag, Tail))
-&gt; [([Char], [(Var, ())], PreExp E3Ext () Ty3)]
-&gt; PassM [(Tag, Tail)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">([Char], [(Var, ())], PreExp E3Ext () Ty3) -&gt; PassM (Tag, Tail)
</span><a href="#local-6989586621680969133"><span class="hs-identifier hs-var">doalt</span></a></span><span> </span><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969129"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-571"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969143"><span class="annot"><span class="annottext">def_alt :: Tail
</span><a href="#local-6989586621680969143"><span class="hs-identifier hs-var hs-var">def_alt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#ErrT"><span class="hs-identifier hs-var">T.ErrT</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Tail) -&gt; [Char] -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unknown tag in: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969130"><span class="hs-identifier hs-var">tagtmp</span></a></span><span>
</span><span id="line-572"></span><span>        </span><span id="local-6989586621680969144"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969144"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;switch&quot;</span></span><span>
</span><span id="line-573"></span><span>        </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-574"></span><span>         </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969130"><span class="hs-identifier hs-var">tagtmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#TagTyPacked"><span class="hs-identifier hs-var">T.TagTyPacked</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969132"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadTag"><span class="hs-identifier hs-var">T.ReadTag</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969128"><span class="hs-identifier hs-var">scrut</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-575"></span><span>          </span><span class="annot"><span class="annottext">Var -&gt; Triv -&gt; Alts -&gt; Maybe Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#Switch"><span class="hs-identifier hs-var">T.Switch</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969144"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-576"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969130"><span class="hs-identifier hs-var">tagtmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Tag, Tail)] -&gt; Alts
</span><a href="Gibbon.L4.Syntax.html#TagAlts"><span class="hs-identifier hs-var">T.TagAlts</span></a></span><span> </span><span class="annot"><span class="annottext">[(Tag, Tail)]
</span><a href="#local-6989586621680969142"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tail -&gt; Maybe Tail
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969143"><span class="hs-identifier hs-var">def_alt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-comment">-- Not-packed, pointer-based codegen</span><span>
</span><span id="line-582"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-comment">-- In pointer-based representation we don't use `TagTyPacked`, because it is</span><span>
</span><span id="line-584"></span><span>    </span><span class="hs-comment">-- causing problems.  By default gcc aligns struct fields but we don't</span><span>
</span><span id="line-585"></span><span>    </span><span class="hs-comment">-- take that padding into account in our codegen.</span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-587"></span><span>    </span><span class="hs-comment">-- If we get here that means we're NOT packing trees on this run:</span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-comment">-- Thus this operates on BOXED data:</span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680969146"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969146"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621680969147"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969147"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969148"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969148"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969149"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969149"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969107"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>      </span><span class="hs-comment">-- a product, directly assign the fields</span><span>
</span><span id="line-591"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969150"><span class="annot"><span class="annottext">tys :: [Ty]
</span><a href="#local-6989586621680969150"><span class="hs-identifier hs-var hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; [Ty3]
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969147"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680969152"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969152"><span class="hs-identifier hs-var">bndrs2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, ())] -&gt; ([Var], [()])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969148"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>      </span><span class="hs-comment">-- TODO(osa): enable this</span><span>
</span><span id="line-595"></span><span>      </span><span class="hs-comment">-- ASSERT(length tys == length bndrs)</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-type">T.VarTriv</span></a></span><span> </span><span id="local-6989586621680969153"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969153"><span class="hs-identifier hs-var">e_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;product case scrutinee&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969146"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-598"></span><span>      </span><span id="local-6989586621680969155"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969155"><span class="hs-identifier hs-var">tag_bndr</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tag&quot;</span></span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969156"><span class="annot"><span class="annottext">bndrs' :: [Var]
</span><a href="#local-6989586621680969156"><span class="hs-identifier hs-var hs-var">bndrs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969155"><span class="hs-identifier hs-var">tag_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Var]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969152"><span class="hs-identifier hs-var">bndrs2</span></a></span><span>
</span><span id="line-601"></span><span>          </span><span id="local-6989586621680969157"><span class="annot"><span class="annottext">tys' :: [Ty]
</span><a href="#local-6989586621680969157"><span class="hs-identifier hs-var hs-var">tys'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span>  </span><span class="annot"><span class="annottext">Ty -&gt; [Ty] -&gt; [Ty]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty]
</span><a href="#local-6989586621680969150"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-602"></span><span>      </span><span id="local-6989586621680969158"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969158"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969149"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-603"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Var -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetUnpackT"><span class="hs-identifier hs-var">T.LetUnpackT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty] -&gt; [(Var, Ty)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969156"><span class="hs-identifier hs-var">bndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty]
</span><a href="#local-6989586621680969157"><span class="hs-identifier hs-var">tys'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969153"><span class="hs-identifier hs-var">e_var</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969158"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680969160"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969160"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680969161"><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969161"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969107"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-606"></span><span>      </span><span id="local-6989586621680969162"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969162"><span class="hs-identifier hs-var">tag_bndr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tag&quot;</span></span><span>
</span><span id="line-607"></span><span>      </span><span id="local-6989586621680969163"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969163"><span class="hs-identifier hs-var">tail_bndr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tail&quot;</span></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-610"></span><span>        </span><span id="local-6989586621680969164"><span class="annot"><span class="annottext">e_triv :: Triv
</span><a href="#local-6989586621680969164"><span class="hs-identifier hs-var hs-var">e_triv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;sum case scrutinee&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969160"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>        </span><span class="annot"><a href="#local-6989586621680969165"><span class="hs-identifier hs-type">mk_alt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Int.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Tail"><span class="hs-identifier hs-type">T.Tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>        </span><span id="local-6989586621680969165"><span class="annot"><span class="annottext">mk_alt :: ([Char], [(Var, ())], PreExp E3Ext () Ty3) -&gt; PassM (Int64, Tail)
</span><a href="#local-6989586621680969165"><span class="hs-identifier hs-var hs-var">mk_alt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969166"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969166"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969167"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969167"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969168"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969168"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-614"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-615"></span><span>            </span><span id="local-6989586621680969169"><span class="annot"><span class="annottext">con_tag :: Tag
</span><a href="#local-6989586621680969169"><span class="hs-identifier hs-var hs-var">con_tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; Tag
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; Tag
</span><a href="Gibbon.Passes.Lower.html#getTagOfDataCon"><span class="hs-identifier hs-var">getTagOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969166"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-616"></span><span>            </span><span id="local-6989586621680969170"><span class="annot"><span class="annottext">bndr_tys :: [Ty]
</span><a href="#local-6989586621680969170"><span class="hs-identifier hs-var hs-var">bndr_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; [Ty3]
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969166"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680969171"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969171"><span class="hs-identifier hs-var">bndrs'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, ())] -&gt; ([Var], [()])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680969167"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-618"></span><span>          </span><span id="local-6989586621680969172"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969172"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969168"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-619"></span><span>          </span><span class="annot"><span class="annottext">(Int64, Tail) -&gt; PassM (Int64, Tail)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Tag -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680969169"><span class="hs-identifier hs-var">con_tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Var -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetUnpackT"><span class="hs-identifier hs-var">T.LetUnpackT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty] -&gt; [(Var, Ty)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969171"><span class="hs-identifier hs-var">bndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty]
</span><a href="#local-6989586621680969170"><span class="hs-identifier hs-var">bndr_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969163"><span class="hs-identifier hs-var">tail_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969172"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span>      </span><span id="local-6989586621680969173"><span class="annot"><span class="annottext">[(Int64, Tail)]
</span><a href="#local-6989586621680969173"><span class="hs-identifier hs-var">alts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(([Char], [(Var, ())], PreExp E3Ext () Ty3) -&gt; PassM (Int64, Tail))
-&gt; [([Char], [(Var, ())], PreExp E3Ext () Ty3)]
-&gt; PassM [(Int64, Tail)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">([Char], [(Var, ())], PreExp E3Ext () Ty3) -&gt; PassM (Int64, Tail)
</span><a href="#local-6989586621680969165"><span class="hs-identifier hs-var">mk_alt</span></a></span><span> </span><span class="annot"><span class="annottext">[([Char], [(Var, ())], PreExp E3Ext () Ty3)]
</span><a href="#local-6989586621680969161"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-622"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969174"><span class="annot"><span class="annottext">def_alt :: Tail
</span><a href="#local-6989586621680969174"><span class="hs-identifier hs-var hs-var">def_alt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#ErrT"><span class="hs-identifier hs-var">T.ErrT</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Tail) -&gt; [Char] -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Unknown tag in: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969162"><span class="hs-identifier hs-var">tag_bndr</span></a></span><span>
</span><span id="line-623"></span><span>      </span><span id="local-6989586621680969175"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969175"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;switch&quot;</span></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-626"></span><span>        </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span>
</span><span id="line-627"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969162"><span class="hs-identifier hs-var">tag_bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#TagTyPacked"><span class="hs-identifier hs-var">T.TagTyPacked</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969163"><span class="hs-identifier hs-var">tail_bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-628"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scalar -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#ReadScalar"><span class="hs-identifier hs-var">T.ReadScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Gibbon.L3.Syntax.html#IntS"><span class="hs-identifier hs-var">IntS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680969164"><span class="hs-identifier hs-var">e_triv</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv -&gt; Alts -&gt; Maybe Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#Switch"><span class="hs-identifier hs-var">T.Switch</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969175"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969162"><span class="hs-identifier hs-var">tag_bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int64, Tail)] -&gt; Alts
</span><a href="Gibbon.L4.Syntax.html#IntAlts"><span class="hs-identifier hs-var">T.IntAlts</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int64, Tail)]
</span><a href="#local-6989586621680969173"><span class="hs-identifier hs-var">alts'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tail -&gt; Maybe Tail
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969174"><span class="hs-identifier hs-var">def_alt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-comment">-- Accordingly, constructor allocation becomes an allocation.</span><span>
</span><span id="line-634"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969177"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969177"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969178"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969178"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969179"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969179"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969180"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969180"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969107"><span class="hs-identifier hs-var">pkd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3] -&gt; PassM Tail -&gt; PassM Tail
forall e a. (HasCallStack, Expression e) =&gt; [e] -&gt; a -&gt; a
</span><a href="Gibbon.Language.html#assertTrivs"><span class="hs-identifier hs-var">L3.assertTrivs</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969179"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">(PassM Tail -&gt; PassM Tail) -&gt; PassM Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-635"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969182"><span class="annot"><span class="annottext">tycon :: [Char]
</span><a href="#local-6989586621680969182"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; [Char]
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; [Char]
</span><a href="Gibbon.Language.Syntax.html#getTyOfDataCon"><span class="hs-identifier hs-var">getTyOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969178"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-636"></span><span>          </span><span id="local-6989586621680969184"><span class="annot"><span class="annottext">all_cons :: [([Char], [(Bool, Ty3)])]
</span><a href="#local-6989586621680969184"><span class="hs-identifier hs-var hs-var">all_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDef Ty3 -&gt; [([Char], [(Bool, Ty3)])]
forall a. DDef a -&gt; [([Char], [(Bool, a)])]
</span><a href="Gibbon.Language.Syntax.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; DDef Ty3
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; DDef a
</span><a href="Gibbon.Language.Syntax.html#lookupDDef"><span class="hs-identifier hs-var">lookupDDef</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969182"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>          </span><span id="local-6989586621680969186"><span class="annot"><span class="annottext">tag :: Int
</span><a href="#local-6989586621680969186"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([Char], [(Bool, Ty3)]) -&gt; Bool)
-&gt; [([Char], [(Bool, Ty3)])] -&gt; Maybe Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#findIndex"><span class="hs-identifier hs-var">L.findIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">(==)</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969178"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool)
-&gt; (([Char], [(Bool, Ty3)]) -&gt; [Char])
-&gt; ([Char], [(Bool, Ty3)])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([Char], [(Bool, Ty3)]) -&gt; [Char]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Char], [(Bool, Ty3)])]
</span><a href="#local-6989586621680969184"><span class="hs-identifier hs-var">all_cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>          </span><span id="local-6989586621680969189"><span class="annot"><span class="annottext">field_tys :: [Ty]
</span><a href="#local-6989586621680969189"><span class="hs-identifier hs-var hs-var">field_tys</span></a></span></span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; [Ty3]
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969178"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>          </span><span id="local-6989586621680969190"><span class="annot"><span class="annottext">fields0 :: [(Ty, Triv)]
</span><a href="#local-6989586621680969190"><span class="hs-identifier hs-var hs-var">fields0</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty] -&gt; [Triv] -&gt; [(Ty, Triv)]
forall a b.
(Show a, Show b, HasCallStack) =&gt;
[a] -&gt; [b] -&gt; [(a, b)]
</span><a href="Gibbon.Common.html#fragileZip"><span class="hs-identifier hs-var">fragileZip</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty]
</span><a href="#local-6989586621680969189"><span class="hs-identifier hs-var">field_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; Triv) -&gt; [PreExp E3Ext () Ty3] -&gt; [Triv]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;DataConE args&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969179"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>          </span><span id="local-6989586621680969192"><span class="annot"><span class="annottext">fields :: [(Ty, Triv)]
</span><a href="#local-6989586621680969192"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#IntTriv"><span class="hs-identifier hs-var">T.IntTriv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969186"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ty, Triv) -&gt; [(Ty, Triv)] -&gt; [(Ty, Triv)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680969190"><span class="hs-identifier hs-var">fields0</span></a></span><span>
</span><span id="line-642"></span><span>          </span><span class="hs-comment">--  | is_prod   = fields0</span><span>
</span><span id="line-643"></span><span>          </span><span class="hs-comment">--  | otherwise = (T.IntTy, T.IntTriv (fromIntegral tag)) : fields0</span><span>
</span><span id="line-644"></span><span>      </span><span id="local-6989586621680969194"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969194"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969180"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-645"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [(Ty, Triv)] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetAllocT"><span class="hs-identifier hs-var">T.LetAllocT</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969177"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[(Ty, Triv)]
</span><a href="#local-6989586621680969192"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969194"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-comment">-- This is legitimately flattened, but we need to move it off the spine:</span><span>
</span><span id="line-649"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969195"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969195"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969196"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969196"><span class="hs-identifier hs-var">_ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-650"></span><span>       </span><span id="local-6989586621680969197"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969197"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tailift&quot;</span></span><span>
</span><span id="line-651"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969198"><span class="annot"><span class="annottext">ty :: Ty3
</span><a href="#local-6989586621680969198"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; () -&gt; Ty3
forall loc. [Char] -&gt; loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-var">L3.PackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; [Char]
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; [Char]
</span><a href="Gibbon.Language.Syntax.html#getTyOfDataCon"><span class="hs-identifier hs-var">getTyOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969195"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>       </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PassM Tail)
-&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969197"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969198"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969105"><span class="hs-identifier hs-var">ex0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969197"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>    </span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>    </span><span class="hs-comment">-- Ext (RetE ls)   -&gt; pure$ T.RetValsT (L.map (triv sym_tbl &quot;returned element of tuple&quot;) ls)</span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-658"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680969199"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969199"><span class="hs-identifier hs-var">ls</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#RetValsT"><span class="hs-identifier hs-var">T.RetValsT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; Triv) -&gt; [PreExp E3Ext () Ty3] -&gt; [Triv]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;returned element of tuple&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969199"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>    </span><span id="local-6989586621680969200"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969200"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
forall e. Expression e =&gt; e -&gt; Bool
</span><a href="Gibbon.Language.Syntax.html#isTrivial"><span class="hs-identifier hs-var">isTrivial</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969200"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#RetValsT"><span class="hs-identifier hs-var">T.RetValsT</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;internal error1&gt;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969200"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span>    </span><span class="hs-comment">-- We could eliminate these ahead of time (unariser):</span><span>
</span><span id="line-662"></span><span>    </span><span class="hs-comment">-- FIXME: Remove this when that is done a priori:</span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969202"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969202"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680969203"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969203"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680969204"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969204"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969205"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969205"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-664"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680969206"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969206"><span class="hs-identifier hs-var">tmps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969207"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969207"><span class="hs-identifier hs-var">bod'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [Ty3]
-&gt; PreExp E3Ext () Ty3
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
</span><a href="Gibbon.Passes.Lower.html#eliminateProjs"><span class="hs-identifier hs-var">eliminateProjs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969202"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969203"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969205"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-665"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969209"><span class="annot"><span class="annottext">bod'' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969209"><span class="hs-identifier hs-var hs-var">bod''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="Gibbon.L3.Syntax.html#updateAvailVars"><span class="hs-identifier hs-var">updateAvailVars</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969202"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969206"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969207"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-comment">-- Bind tmps individually:a</span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969211"><span class="annot"><span class="annottext">go :: [(Var, dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680969211"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680969212"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680969212"><span class="hs-identifier hs-var">acc</span></a></span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680969212"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-668"></span><span>          </span><span class="annot"><a href="#local-6989586621680969211"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680969213"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969213"><span class="hs-identifier hs-var">pvr</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969214"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680969214"><span class="hs-identifier hs-var">pty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969215"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680969215"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680969216"><span class="annot"><span class="annottext">[(Var, dec, PreExp ext loc dec)]
</span><a href="#local-6989586621680969216"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969217"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680969217"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680969211"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, dec, PreExp ext loc dec)]
</span><a href="#local-6989586621680969216"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969213"><span class="hs-identifier hs-var">pvr</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680969214"><span class="hs-identifier hs-var">pty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680969215"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680969217"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>      </span><span class="hs-comment">-- Finally reprocess the whole thing</span><span>
</span><span id="line-670"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty3, PreExp E3Ext () Ty3)]
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall {dec} {ext :: * -&gt; * -&gt; *} {loc}.
[(Var, dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680969211"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
-&gt; [Ty3]
-&gt; [PreExp E3Ext () Ty3]
-&gt; [(Var, Ty3, PreExp E3Ext () Ty3)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969206"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969203"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969204"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969209"><span class="hs-identifier hs-var">bod''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969219"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969219"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969220"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969220"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969221"><span class="annot"><span class="annottext">rhs :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969221"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969222"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969222"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969223"><span class="annot"><span class="annottext">trv :: Triv
</span><a href="#local-6989586621680969223"><span class="hs-identifier hs-var hs-var">trv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ProjE&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969221"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-674"></span><span>      </span><span id="local-6989586621680969224"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969224"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969222"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-675"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Ty, Triv) -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetTrivT"><span class="hs-identifier hs-var">T.LetTrivT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969219"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969220"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680969223"><span class="hs-identifier hs-var">trv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969224"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680969226"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969226"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680969227"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969227"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-678"></span><span>      </span><span id="local-6989586621680969228"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969228"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969227"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-679"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetArenaT"><span class="hs-identifier hs-var">T.LetArenaT</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969226"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969228"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>    </span><span class="hs-comment">-- We could eliminate these ahead of time:</span><span>
</span><span id="line-682"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969230"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969230"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680969231"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969231"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969232"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969232"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969233"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969233"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="Gibbon.Passes.Lower.html#isTrivial%27"><span class="hs-identifier hs-var">isTrivial'</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969232"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-683"></span><span>      </span><span class="annot"><span class="annottext">(Var, Ty, Triv) -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetTrivT"><span class="hs-identifier hs-var">T.LetTrivT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969230"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969231"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&lt;internal error2&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969232"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969233"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680969235"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969235"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680969236"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969236"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680969237"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969237"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680969238"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969238"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969236"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-686"></span><span>                    </span><span id="local-6989586621680969239"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969239"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969237"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-687"></span><span>                    </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Triv -&gt; Tail -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#IfT"><span class="hs-identifier hs-var">T.IfT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;if test&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969235"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969238"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969239"><span class="hs-identifier hs-var">c'</span></a></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969240"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969240"><span class="hs-identifier hs-var">vr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969241"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969241"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">L3.TimeIt</span></a></span><span> </span><span id="local-6989586621680969242"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969242"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969243"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969243"><span class="hs-identifier hs-var">flg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969244"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969244"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680969245"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969245"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969242"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-691"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969241"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-692"></span><span>             </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680969246"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969246"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-693"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969247"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969247"><span class="hs-identifier hs-var">tmps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969248"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969248"><span class="hs-identifier hs-var">bod'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [Ty3]
-&gt; PreExp E3Ext () Ty3
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
</span><a href="Gibbon.Passes.Lower.html#eliminateProjs"><span class="hs-identifier hs-var">eliminateProjs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969240"><span class="hs-identifier hs-var">vr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969246"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969244"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-694"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969249"><span class="annot"><span class="annottext">bod'' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969249"><span class="hs-identifier hs-var hs-var">bod''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="Gibbon.L3.Syntax.html#updateAvailVars"><span class="hs-identifier hs-var">updateAvailVars</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969240"><span class="hs-identifier hs-var">vr</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969247"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969248"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-695"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; [(Var, Ty)] -&gt; Tail -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetTimedT"><span class="hs-identifier hs-var">T.LetTimedT</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969243"><span class="hs-identifier hs-var">flg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty] -&gt; [(Var, Ty)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969247"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969246"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969245"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969249"><span class="hs-identifier hs-var">bod''</span></a></span><span>
</span><span id="line-696"></span><span>             </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [(Var, Ty)] -&gt; Tail -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetTimedT"><span class="hs-identifier hs-var">T.LetTimedT</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969243"><span class="hs-identifier hs-var">flg</span></a></span><span>   </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969240"><span class="hs-identifier hs-var">vr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969241"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>          </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969245"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969244"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>    </span><span class="hs-comment">--------------------------------Start PrimApps----------------------------------</span><span>
</span><span id="line-700"></span><span>    </span><span class="hs-comment">-- (1) Primapps that become Tails:</span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span>    </span><span class="hs-comment">-- FIXME: No reason errors can't stay primitive at Target:</span><span>
</span><span id="line-703"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ErrorP"><span class="hs-identifier hs-type">ErrorP</span></a></span><span> </span><span id="local-6989586621680969252"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969252"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621680969253"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969253"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-704"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#ErrT"><span class="hs-identifier hs-var">T.ErrT</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969252"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ErrorP"><span class="hs-identifier hs-type">L3.ErrorP</span></a></span><span> </span><span id="local-6989586621680969254"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969254"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-707"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#ErrT"><span class="hs-identifier hs-var">T.ErrT</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969254"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>    </span><span class="hs-comment">-- Whatever... a little just-in-time flattening.  Should obsolete this:</span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictEmptyP"><span class="hs-identifier hs-type">DictEmptyP</span></a></span><span> </span><span id="local-6989586621680969256"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969256"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680969257"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969257"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680969258"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969258"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-711"></span><span>      </span><span id="local-6989586621680969259"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969259"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;flt&quot;</span></span><span>
</span><span id="line-712"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969259"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Var -&gt; Ty3 -&gt; Ty3
forall loc. Maybe Var -&gt; Ty3 -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-var">SymDictTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Maybe Var
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969257"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969256"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [PreExp E3Ext () Ty3] -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Prim Ty3
forall ty. ty -&gt; Prim ty
</span><a href="Gibbon.Language.Syntax.html#DictEmptyP"><span class="hs-identifier hs-var">DictEmptyP</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969256"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969257"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; [PreExp E3Ext () Ty3] -&gt; [PreExp E3Ext () Ty3]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969258"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969259"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictInsertP"><span class="hs-identifier hs-type">DictInsertP</span></a></span><span> </span><span id="local-6989586621680969261"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969261"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680969262"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969262"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680969263"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969263"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>      </span><span id="local-6989586621680969264"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969264"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;flt&quot;</span></span><span>
</span><span id="line-716"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969264"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Var -&gt; Ty3 -&gt; Ty3
forall loc. Maybe Var -&gt; Ty3 -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-var">SymDictTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Maybe Var
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969262"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969261"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [PreExp E3Ext () Ty3] -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Prim Ty3
forall ty. ty -&gt; Prim ty
</span><a href="Gibbon.Language.Syntax.html#DictInsertP"><span class="hs-identifier hs-var">DictInsertP</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969261"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969262"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; [PreExp E3Ext () Ty3] -&gt; [PreExp E3Ext () Ty3]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969263"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969264"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680969265"><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969265"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680969266"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969266"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-719"></span><span>      </span><span id="local-6989586621680969267"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969267"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;flt&quot;</span></span><span>
</span><span id="line-720"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969267"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Prim Ty3 -&gt; Ty3
forall a. Prim (UrTy a) -&gt; UrTy a
</span><a href="Gibbon.Language.html#primRetTy"><span class="hs-identifier hs-var">primRetTy</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969265"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [PreExp E3Ext () Ty3] -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969265"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969266"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969267"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span>    </span><span class="hs-comment">---------------------</span><span>
</span><span id="line-723"></span><span>    </span><span class="hs-comment">-- (2) Next FAKE Primapps.  These could be added to L3 if we wanted to pollute it.</span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969269"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969269"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadScalar"><span class="hs-identifier hs-type">ReadScalar</span></a></span><span> </span><span id="local-6989586621680969270"><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680969270"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680969271"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969271"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969272"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969272"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-726"></span><span>      </span><span id="local-6989586621680969273"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969273"><span class="hs-identifier hs-var">vtmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpval&quot;</span></span><span>
</span><span id="line-727"></span><span>      </span><span id="local-6989586621680969274"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969274"><span class="hs-identifier hs-var">ctmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpcur&quot;</span></span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span>      </span><span class="hs-comment">-- Here we lamely chase down all the tuple references and make them variables:</span><span>
</span><span id="line-730"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969275"><span class="annot"><span class="annottext">bod' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969275"><span class="hs-identifier hs-var hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969269"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969273"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-731"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969269"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969274"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969272"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; Tail -&gt; Tail
forall a. Int -&gt; [Char] -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; [lower] ReadInt, after substing references to &quot;</span></span><span>
</span><span id="line-735"></span><span>                  </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969269"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;:\n  &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969275"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; (Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-736"></span><span>        </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969273"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scalar -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#scalarToTy"><span class="hs-identifier hs-var">T.scalarToTy</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680969270"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969274"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scalar -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#ReadScalar"><span class="hs-identifier hs-var">T.ReadScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680969270"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969271"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-737"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969275"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969277"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969277"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteScalar"><span class="hs-identifier hs-type">WriteScalar</span></a></span><span> </span><span id="local-6989586621680969278"><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680969278"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680969279"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969279"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680969280"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969280"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969281"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969281"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-740"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969277"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scalar -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#WriteScalar"><span class="hs-identifier hs-var">T.WriteScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680969278"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WriteTag arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969280"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969279"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-741"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969281"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span>    </span><span class="hs-comment">-- In Target, AddP is overloaded still:</span><span>
</span><span id="line-745"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969283"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969283"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-type">AddCursor</span></a></span><span> </span><span id="local-6989586621680969284"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969284"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#MMapFileSize"><span class="hs-identifier hs-type">MMapFileSize</span></a></span><span> </span><span id="local-6989586621680969285"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969285"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969286"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969286"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-746"></span><span>      </span><span id="local-6989586621680969287"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969287"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Var
</span><a href="Gibbon.Common.html#varAppend"><span class="hs-identifier hs-var">varAppend</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;sizeof_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969283"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969287"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#MMapFileSize"><span class="hs-identifier hs-var">T.MMapFileSize</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969285"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; (Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-748"></span><span>        </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969283"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#AddP"><span class="hs-identifier hs-var">T.AddP</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addCursor base&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969284"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>                                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addCursor offset&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969287"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-750"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969286"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969290"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969290"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#AddCursor"><span class="hs-identifier hs-type">AddCursor</span></a></span><span> </span><span id="local-6989586621680969291"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969291"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680969292"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969292"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969293"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969293"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-753"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969290"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#AddP"><span class="hs-identifier hs-var">T.AddP</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addCursor base&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969291"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addCursor offset&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969292"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-755"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969293"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969294"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969294"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#SubPtr"><span class="hs-identifier hs-type">SubPtr</span></a></span><span> </span><span id="local-6989586621680969295"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969295"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680969296"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969296"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969297"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969297"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-758"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969294"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SubP"><span class="hs-identifier hs-var">T.SubP</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;subCursor base&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969295"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;subCursor offset&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969296"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-760"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969297"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969299"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969299"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadTag"><span class="hs-identifier hs-type">ReadTag</span></a></span><span> </span><span id="local-6989586621680969300"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969300"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969301"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969301"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-763"></span><span>      </span><span id="local-6989586621680969302"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969302"><span class="hs-identifier hs-var">vtmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmptag&quot;</span></span><span>
</span><span id="line-764"></span><span>      </span><span id="local-6989586621680969303"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969303"><span class="hs-identifier hs-var">ctmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpcur&quot;</span></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span>      </span><span class="hs-comment">-- Here we lamely chase down all the tuple references and make them variables:</span><span>
</span><span id="line-767"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969304"><span class="annot"><span class="annottext">bod' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969304"><span class="hs-identifier hs-var hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969299"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969302"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-768"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969299"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969303"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969301"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; Tail -&gt; Tail
forall a. Int -&gt; [Char] -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; [lower] ReadTag, after substing references to &quot;</span></span><span>
</span><span id="line-772"></span><span>                  </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969299"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;:\n  &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969304"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; (Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-773"></span><span>        </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969302"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#TagTyPacked"><span class="hs-identifier hs-var">T.TagTyPacked</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969303"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadTag"><span class="hs-identifier hs-var">T.ReadTag</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969300"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-774"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969304"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-775"></span><span>      </span><span class="hs-comment">-- error $ &quot;lower: ReadTag not handled yet.&quot;</span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969305"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969305"><span class="hs-identifier hs-var">cursOut</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteTag"><span class="hs-identifier hs-type">WriteTag</span></a></span><span> </span><span id="local-6989586621680969306"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969306"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621680969307"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969307"><span class="hs-identifier hs-var">cursIn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969308"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969308"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-779"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969305"><span class="hs-identifier hs-var">cursOut</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#WriteTag"><span class="hs-identifier hs-var">T.WriteTag</span></a></span><span>
</span><span id="line-780"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Tag -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#TagTriv"><span class="hs-identifier hs-var">T.TagTriv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var (DDef Ty3) -&gt; [Char] -&gt; Tag
forall a. Out a =&gt; DDefs a -&gt; [Char] -&gt; Tag
</span><a href="Gibbon.Passes.Lower.html#getTagOfDataCon"><span class="hs-identifier hs-var">getTagOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf (PreExp E3Ext () Ty3))
Map Var (DDef Ty3)
</span><a href="#local-6989586621680968904"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969306"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WriteTag cursor&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969307"><span class="hs-identifier hs-var">cursIn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969308"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969311"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969311"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#NewBuffer"><span class="hs-identifier hs-type">NewBuffer</span></a></span><span> </span><span id="local-6989586621680969312"><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969312"><span class="hs-identifier hs-var">mul</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969313"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969313"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-784"></span><span>      </span><span id="local-6989586621680969314"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969314"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;region&quot;</span></span><span>
</span><span id="line-785"></span><span>      </span><span id="local-6989586621680969315"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969315"><span class="hs-identifier hs-var">tl'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969314"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969311"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969311"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Multiplicity -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#NewBuffer"><span class="hs-identifier hs-var">T.NewBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969312"><span class="hs-identifier hs-var">mul</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-786"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969313"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-787"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_DisableGC"><span class="hs-identifier hs-var">Opt_DisableGC</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680969106"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-comment">-- -- || not free_reg</span><span>
</span><span id="line-788"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969315"><span class="hs-identifier hs-var">tl'</span></a></span><span>
</span><span id="line-789"></span><span>         </span><span class="hs-keyword">else</span><span>
</span><span id="line-790"></span><span>           </span><span class="hs-comment">-- The type shouldn't matter. PtrTy is not used often in current programs,</span><span>
</span><span id="line-791"></span><span>           </span><span class="hs-comment">-- and would be easy to spot.</span><span>
</span><span id="line-792"></span><span>           </span><span class="annot"><span class="annottext">(Tail, Ty) -&gt; ([Triv] -&gt; Tail) -&gt; PassM Tail
forall (m :: * -&gt; *).
MonadState Int m =&gt;
(Tail, Ty) -&gt; ([Triv] -&gt; Tail) -&gt; m Tail
</span><a href="Gibbon.L4.Syntax.html#withTail"><span class="hs-identifier hs-var">T.withTail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969315"><span class="hs-identifier hs-var">tl'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#PtrTy"><span class="hs-identifier hs-var">T.PtrTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Triv] -&gt; Tail) -&gt; PassM Tail) -&gt; ([Triv] -&gt; Tail) -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680969319"><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680969319"><span class="hs-identifier hs-var">trvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-793"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#FreeBuffer"><span class="hs-identifier hs-var">T.FreeBuffer</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969314"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969311"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969311"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-794"></span><span>                 </span><span class="annot"><span class="annottext">[Triv] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#RetValsT"><span class="hs-identifier hs-var">T.RetValsT</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680969319"><span class="hs-identifier hs-var">trvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969321"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969321"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#NewParBuffer"><span class="hs-identifier hs-type">NewParBuffer</span></a></span><span> </span><span id="local-6989586621680969322"><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969322"><span class="hs-identifier hs-var">mul</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969323"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969323"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-797"></span><span>      </span><span id="local-6989586621680969324"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969324"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;region&quot;</span></span><span>
</span><span id="line-798"></span><span>      </span><span id="local-6989586621680969325"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969325"><span class="hs-identifier hs-var">tl'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969324"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969321"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969321"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Multiplicity -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#NewParBuffer"><span class="hs-identifier hs-var">T.NewParBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969322"><span class="hs-identifier hs-var">mul</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-799"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969323"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-800"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_DisableGC"><span class="hs-identifier hs-var">Opt_DisableGC</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680969106"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-comment">-- || not free_reg</span><span>
</span><span id="line-801"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969325"><span class="hs-identifier hs-var">tl'</span></a></span><span>
</span><span id="line-802"></span><span>         </span><span class="hs-keyword">else</span><span>
</span><span id="line-803"></span><span>           </span><span class="hs-comment">-- The type shouldn't matter. PtrTy is not used often in current programs,</span><span>
</span><span id="line-804"></span><span>           </span><span class="hs-comment">-- and would be easy to spot.</span><span>
</span><span id="line-805"></span><span>           </span><span class="annot"><span class="annottext">(Tail, Ty) -&gt; ([Triv] -&gt; Tail) -&gt; PassM Tail
forall (m :: * -&gt; *).
MonadState Int m =&gt;
(Tail, Ty) -&gt; ([Triv] -&gt; Tail) -&gt; m Tail
</span><a href="Gibbon.L4.Syntax.html#withTail"><span class="hs-identifier hs-var">T.withTail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969325"><span class="hs-identifier hs-var">tl'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#PtrTy"><span class="hs-identifier hs-var">T.PtrTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Triv] -&gt; Tail) -&gt; PassM Tail) -&gt; ([Triv] -&gt; Tail) -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680969327"><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680969327"><span class="hs-identifier hs-var">trvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-806"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#FreeBuffer"><span class="hs-identifier hs-var">T.FreeBuffer</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969324"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969321"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969321"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; Tail -&gt; Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-807"></span><span>                 </span><span class="annot"><span class="annottext">[Triv] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#RetValsT"><span class="hs-identifier hs-var">T.RetValsT</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680969327"><span class="hs-identifier hs-var">trvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969328"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969328"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#ScopedBuffer"><span class="hs-identifier hs-type">ScopedBuffer</span></a></span><span> </span><span id="local-6989586621680969329"><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969329"><span class="hs-identifier hs-var">mul</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969330"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969330"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-810"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969328"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Multiplicity -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#ScopedBuffer"><span class="hs-identifier hs-var">T.ScopedBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969329"><span class="hs-identifier hs-var">mul</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-811"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969330"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969332"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969332"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#ScopedParBuffer"><span class="hs-identifier hs-type">ScopedParBuffer</span></a></span><span> </span><span id="local-6989586621680969333"><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969333"><span class="hs-identifier hs-var">mul</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969334"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969334"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-814"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969332"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Multiplicity -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#ScopedParBuffer"><span class="hs-identifier hs-var">T.ScopedParBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969333"><span class="hs-identifier hs-var">mul</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-815"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969334"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969336"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969336"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#EndOfBuffer"><span class="hs-identifier hs-type">EndOfBuffer</span></a></span><span> </span><span id="local-6989586621680969337"><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969337"><span class="hs-identifier hs-var">mul</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969338"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969338"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-818"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969336"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Multiplicity -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#EndOfBuffer"><span class="hs-identifier hs-var">T.EndOfBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680969337"><span class="hs-identifier hs-var">mul</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-819"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969338"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969340"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969340"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#SizeOfPacked"><span class="hs-identifier hs-type">SizeOfPacked</span></a></span><span> </span><span id="local-6989586621680969341"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969341"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621680969342"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969342"><span class="hs-identifier hs-var">end</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969343"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969343"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-822"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969340"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SizeOfPacked"><span class="hs-identifier hs-var">T.SizeOfPacked</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969341"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969342"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-823"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969343"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969345"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969345"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#SizeOfScalar"><span class="hs-identifier hs-type">SizeOfScalar</span></a></span><span> </span><span id="local-6989586621680969346"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969346"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969347"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969347"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-826"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969345"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SizeOfScalar"><span class="hs-identifier hs-var">T.SizeOfScalar</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969346"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-827"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969347"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-comment">-- Just a side effect</span><span>
</span><span id="line-830"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span> </span><span id="local-6989586621680969349"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969349"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680969350"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969350"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621680969351"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969351"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969352"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969352"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-831"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969353"><span class="annot"><span class="annottext">args :: [Triv]
</span><a href="#local-6989586621680969353"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int64 -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#IntTriv"><span class="hs-identifier hs-var">T.IntTriv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969349"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969350"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969351"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-832"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#BoundsCheck"><span class="hs-identifier hs-var">T.BoundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">[Triv]
</span><a href="#local-6989586621680969353"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969352"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span class="hs-special">(</span><span id="local-6989586621680969355"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969355"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span> </span><span id="local-6989586621680969356"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969356"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680969357"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969357"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969358"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969358"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-835"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969355"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#TagCursor"><span class="hs-identifier hs-var">T.TagCursor</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969356"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969357"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-836"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969358"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span class="hs-special">(</span><span id="local-6989586621680969360"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969360"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadTaggedCursor"><span class="hs-identifier hs-type">ReadTaggedCursor</span></a></span><span> </span><span id="local-6989586621680969361"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969361"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969362"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969362"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-839"></span><span>      </span><span id="local-6989586621680969363"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969363"><span class="hs-identifier hs-var">vtmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpcur&quot;</span></span><span>
</span><span id="line-840"></span><span>      </span><span id="local-6989586621680969364"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969364"><span class="hs-identifier hs-var">ctmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpaftercur&quot;</span></span><span>
</span><span id="line-841"></span><span>      </span><span id="local-6989586621680969365"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969365"><span class="hs-identifier hs-var">tagtmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmptag&quot;</span></span><span>
</span><span id="line-842"></span><span>      </span><span class="hs-comment">-- Here we lamely chase down all the tuple references and make them variables:</span><span>
</span><span id="line-843"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969366"><span class="annot"><span class="annottext">bod' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969366"><span class="hs-identifier hs-var hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969360"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969363"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-844"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969360"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969364"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-845"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969360"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969365"><span class="hs-identifier hs-var">tagtmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-846"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969362"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-847"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969363"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969364"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969365"><span class="hs-identifier hs-var">tagtmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadTaggedCursor"><span class="hs-identifier hs-var">T.ReadTaggedCursor</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969361"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-848"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969366"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969368"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969368"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteTaggedCursor"><span class="hs-identifier hs-type">WriteTaggedCursor</span></a></span><span> </span><span id="local-6989586621680969369"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969369"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621680969370"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969370"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969371"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969371"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969368"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#WriteTaggedCursor"><span class="hs-identifier hs-var">T.WriteTaggedCursor</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WriteTaggedCursor arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969370"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969369"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-852"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969371"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span class="hs-special">(</span><span id="local-6989586621680969373"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969373"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadCursor"><span class="hs-identifier hs-type">ReadCursor</span></a></span><span> </span><span id="local-6989586621680969374"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969374"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969375"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969375"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-855"></span><span>      </span><span id="local-6989586621680969376"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969376"><span class="hs-identifier hs-var">vtmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpcur&quot;</span></span><span>
</span><span id="line-856"></span><span>      </span><span id="local-6989586621680969377"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969377"><span class="hs-identifier hs-var">ctmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpaftercur&quot;</span></span><span>
</span><span id="line-857"></span><span>      </span><span class="hs-comment">-- Here we lamely chase down all the tuple references and make them variables:</span><span>
</span><span id="line-858"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969378"><span class="annot"><span class="annottext">bod' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969378"><span class="hs-identifier hs-var hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969373"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969376"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-859"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969373"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969377"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969375"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-861"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969376"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969377"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadCursor"><span class="hs-identifier hs-var">T.ReadCursor</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969374"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-862"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969378"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span class="hs-special">(</span><span id="local-6989586621680969379"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969379"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadList"><span class="hs-identifier hs-type">ReadList</span></a></span><span> </span><span id="local-6989586621680969380"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969380"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680969381"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969381"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969382"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969382"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-865"></span><span>      </span><span id="local-6989586621680969383"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969383"><span class="hs-identifier hs-var">vtmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmplist&quot;</span></span><span>
</span><span id="line-866"></span><span>      </span><span id="local-6989586621680969384"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969384"><span class="hs-identifier hs-var">ctmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpafterlist&quot;</span></span><span>
</span><span id="line-867"></span><span>      </span><span class="hs-comment">-- Here we lamely chase down all the tuple references and make them variables:</span><span>
</span><span id="line-868"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969385"><span class="annot"><span class="annottext">bod' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969385"><span class="hs-identifier hs-var hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969379"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969383"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-869"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969379"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969384"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969382"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-871"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969383"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#ListTy"><span class="hs-identifier hs-var">T.ListTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#fromL3Ty"><span class="hs-identifier hs-var">T.fromL3Ty</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969381"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969384"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadList"><span class="hs-identifier hs-var">T.ReadList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969380"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-872"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969385"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-873"></span><span>
</span><span id="line-874"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969386"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969386"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteList"><span class="hs-identifier hs-type">WriteList</span></a></span><span> </span><span id="local-6989586621680969387"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969387"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621680969388"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969388"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680969389"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969389"><span class="hs-identifier hs-var">_el_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969390"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969390"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-875"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969386"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#WriteList"><span class="hs-identifier hs-var">T.WriteList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WriteList arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969388"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969387"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-876"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969390"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span class="hs-special">(</span><span id="local-6989586621680969392"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969392"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#ReadVector"><span class="hs-identifier hs-type">ReadVector</span></a></span><span> </span><span id="local-6989586621680969393"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969393"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680969394"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969394"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969395"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969395"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-880"></span><span>      </span><span id="local-6989586621680969396"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969396"><span class="hs-identifier hs-var">vtmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmplist&quot;</span></span><span>
</span><span id="line-881"></span><span>      </span><span id="local-6989586621680969397"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969397"><span class="hs-identifier hs-var">ctmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tmpafterlist&quot;</span></span><span>
</span><span id="line-882"></span><span>      </span><span class="hs-comment">-- Here we lamely chase down all the tuple references and make them variables:</span><span>
</span><span id="line-883"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969398"><span class="annot"><span class="annottext">bod' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969398"><span class="hs-identifier hs-var hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969392"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969396"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-884"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969392"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969397"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-885"></span><span>                 </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969395"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-886"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969396"><span class="hs-identifier hs-var">vtmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#VectorTy"><span class="hs-identifier hs-var">T.VectorTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#fromL3Ty"><span class="hs-identifier hs-var">T.fromL3Ty</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969394"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969397"><span class="hs-identifier hs-var">ctmp</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadVector"><span class="hs-identifier hs-var">T.ReadVector</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969393"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-887"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969398"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969399"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969399"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteVector"><span class="hs-identifier hs-type">WriteVector</span></a></span><span> </span><span id="local-6989586621680969400"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969400"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621680969401"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969401"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680969402"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969402"><span class="hs-identifier hs-var">_el_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969403"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969403"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-890"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969399"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#WriteVector"><span class="hs-identifier hs-var">T.WriteVector</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WriteVector arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969401"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969400"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-891"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969403"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969405"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969405"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#WriteCursor"><span class="hs-identifier hs-type">WriteCursor</span></a></span><span> </span><span id="local-6989586621680969406"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969406"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span id="local-6989586621680969407"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969407"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969408"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969408"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-894"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969405"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#WriteCursor"><span class="hs-identifier hs-var">T.WriteCursor</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;WriteCursor arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969407"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969406"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-895"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969408"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#IndirectionBarrier"><span class="hs-identifier hs-type">IndirectionBarrier</span></a></span><span> </span><span id="local-6989586621680969410"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969410"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969411"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969411"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969412"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969412"><span class="hs-identifier hs-var">end_r1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969413"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969413"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969414"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969414"><span class="hs-identifier hs-var">end_r2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969415"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969415"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-898"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#IndirectionBarrier"><span class="hs-identifier hs-var">T.IndirectionBarrier</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969410"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969411"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969412"><span class="hs-identifier hs-var">end_r1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969413"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969414"><span class="hs-identifier hs-var">end_r2</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-899"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969415"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#BumpArenaRefCount"><span class="hs-identifier hs-type">BumpArenaRefCount</span></a></span><span> </span><span id="local-6989586621680969417"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969417"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span id="local-6989586621680969418"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969418"><span class="hs-identifier hs-var">end_r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969419"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969419"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-902"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#BumpArenaRefCount"><span class="hs-identifier hs-var">T.BumpArenaRefCount</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969417"><span class="hs-identifier hs-var">ar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969418"><span class="hs-identifier hs-var">end_r</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-903"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969419"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969421"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969421"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3
</span><a href="Gibbon.L3.Syntax.html#NullCursor"><span class="hs-identifier hs-var">NullCursor</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969422"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969422"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-906"></span><span>      </span><span class="annot"><span class="annottext">(Var, Ty, Triv) -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetTrivT"><span class="hs-identifier hs-var">T.LetTrivT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969421"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int64 -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#IntTriv"><span class="hs-identifier hs-var">T.IntTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969422"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969423"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969423"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969424"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969424"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3
</span><a href="Gibbon.L3.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969425"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969425"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-909"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969423"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969424"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">T.GetCilkWorkerNum</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969425"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969427"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969427"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969428"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969428"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span> </span><span id="local-6989586621680969429"><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680969429"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680969430"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969430"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680969431"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969431"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680969432"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969432"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969433"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969433"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-912"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SSModality -&gt; [Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#SSPush"><span class="hs-identifier hs-var">T.SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680969429"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969432"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969430"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969431"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969433"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969435"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969435"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969436"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969436"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span> </span><span id="local-6989586621680969437"><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680969437"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680969438"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969438"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680969439"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969439"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969440"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969440"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-915"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SSModality -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#SSPop"><span class="hs-identifier hs-var">T.SSPop</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680969437"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969438"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969439"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969440"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-916"></span><span>
</span><span id="line-917"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969442"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969442"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969443"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969443"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span id="local-6989586621680969444"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969444"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969445"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969445"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-918"></span><span>      </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#Assert"><span class="hs-identifier hs-var">T.Assert</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Assert arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969444"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969445"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969447"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969447"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969448"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969448"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969449"><span class="annot"><span class="annottext">rhs :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969449"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969450"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969450"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969449"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-922"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969451"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969451"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969452"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969452"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969453"><span class="annot"><span class="annottext">rhs :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969453"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969454"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969454"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969453"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-923"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969455"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969455"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969456"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969456"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969457"><span class="annot"><span class="annottext">rhs :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969457"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#StartTagAllocation"><span class="hs-identifier hs-type">StartTagAllocation</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969458"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969458"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969457"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-924"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969459"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969459"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969460"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969460"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969461"><span class="annot"><span class="annottext">rhs :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969461"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#StartScalarsAllocation"><span class="hs-identifier hs-type">StartScalarsAllocation</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969462"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969462"><span class="hs-identifier hs-var">_bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969461"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-comment">-- [2023.04.19]: be forgiving about an earlier pass not removing these.</span><span>
</span><span id="line-926"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969463"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969463"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969464"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969464"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#EndTagAllocation"><span class="hs-identifier hs-type">EndTagAllocation</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969465"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969465"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969465"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-927"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969466"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969466"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969467"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969467"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#EndScalarsAllocation"><span class="hs-identifier hs-type">EndScalarsAllocation</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969468"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969468"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969468"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L3.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span id="local-6989586621680969469"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969469"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621680969470"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969470"><span class="hs-identifier hs-var">bod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-930"></span><span>      </span><span class="annot"><span class="annottext">[Var] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetAvailT"><span class="hs-identifier hs-var">T.LetAvailT</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969469"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969470"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: unexpected extension&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969105"><span class="hs-identifier hs-var">ex0</span></a></span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span>    </span><span class="hs-comment">---------------------</span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-comment">-- (3) Proper primapps.</span><span>
</span><span id="line-936"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969472"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969472"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680969473"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969473"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680969474"><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969474"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680969475"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969475"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969476"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969476"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; PassM Tail -&gt; PassM Tail
forall a. Int -&gt; [Char] -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969472"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; : &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969473"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PassM Tail -&gt; PassM Tail) -&gt; PassM Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-937"></span><span>        </span><span class="hs-comment">-- No tuple-valued prims here:</span><span>
</span><span id="line-938"></span><span>        </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969472"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969473"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-939"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prim Ty3 -&gt; Prim
</span><a href="Gibbon.Passes.Lower.html#prim"><span class="hs-keyword hs-var">prim</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969474"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-940"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; Triv) -&gt; [PreExp E3Ext () Ty3] -&gt; [Triv]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv)
-&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;prim rand &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969474"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969475"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-941"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969476"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-comment">--------------------------------End PrimApps----------------------------------</span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680969478"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969478"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969479"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969479"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Triv] -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#TailCall"><span class="hs-identifier hs-var">T.TailCall</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969478"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; Triv) -&gt; [PreExp E3Ext () Ty3] -&gt; [Triv]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;operand&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969479"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: Unbound SpanwnE&quot;</span></span><span>
</span><span id="line-947"></span><span>    </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: Unbound SpanwnE&quot;</span></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>    </span><span class="hs-comment">-- Tail calls are just an optimization, if we have a Proj/App it cannot be tail:</span><span>
</span><span id="line-950"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680969481"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969481"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680969482"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969482"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969483"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969483"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char] -&gt; PassM Tail -&gt; PassM Tail
forall a. Int -&gt; [Char] -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ProjE&quot;</span></span><span> </span><span class="annot"><span class="annottext">(PassM Tail -&gt; PassM Tail) -&gt; PassM Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-951"></span><span>        </span><span id="local-6989586621680969484"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969484"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;prjapp&quot;</span></span><span>
</span><span id="line-952"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969485"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969485"><span class="hs-identifier hs-var">inTs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp E3Ext () Ty3)
-&gt; ArrowTy (TyOf (PreExp E3Ext () Ty3))
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3)
</span><a href="#local-6989586621680968902"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3)
-&gt; Var -&gt; FunDef (PreExp E3Ext () Ty3)
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969482"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PassM Tail)
-&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-954"></span><span>          </span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969484"><span class="hs-identifier hs-var">tmp</span></a></span><span>
</span><span id="line-955"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-956"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(() -&gt; ()) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; UrTy a -&gt; UrTy b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969485"><span class="hs-identifier hs-var">inTs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; Int -&gt; Ty3
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969481"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969481"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [PreExp E3Ext () Ty3] -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969482"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969483"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969484"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">L3.AppE</span></a></span><span> </span><span id="local-6989586621680969489"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969489"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-961"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs (PreExp E3Ext () Ty3) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#notMember"><span class="hs-identifier hs-var">M.notMember</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969489"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3)
</span><a href="#local-6989586621680968902"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Application of unbound function: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969489"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span>    </span><span class="hs-comment">-- Non-tail free_reg call:</span><span>
</span><span id="line-964"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969491"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969491"><span class="hs-identifier hs-var">vr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680969492"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969492"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; ([Int], PreExp E3Ext () Ty3)
</span><a href="Gibbon.Passes.Lower.html#projOf"><span class="hs-identifier hs-var">projOf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969494"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680969494"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">L3.AppE</span></a></span><span> </span><span id="local-6989586621680969495"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969495"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680969496"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969496"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969497"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969497"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-965"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty3]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969498"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969498"><span class="hs-identifier hs-var">outTy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp E3Ext () Ty3)
-&gt; ArrowTy (TyOf (PreExp E3Ext () Ty3))
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3)
</span><a href="#local-6989586621680968902"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs (PreExp E3Ext () Ty3)
-&gt; Var -&gt; FunDef (PreExp E3Ext () Ty3)
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969495"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969499"><span class="annot"><span class="annottext">f' :: Var
</span><a href="#local-6989586621680969499"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#cleanFunName"><span class="hs-identifier hs-var">cleanFunName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969495"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-967"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680969501"><span class="annot"><span class="annottext">[(Var, Ty)]
</span><a href="#local-6989586621680969501"><span class="hs-identifier hs-var">vsts</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969502"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969502"><span class="hs-identifier hs-var">bod'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969498"><span class="hs-identifier hs-var">outTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-968"></span><span>                        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">L3.ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([(Var, Ty)], PreExp E3Ext () Ty3)
-&gt; PassM ([(Var, Ty)], PreExp E3Ext () Ty3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969491"><span class="hs-identifier hs-var">vr</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969492"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969497"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>                        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">L3.ProdTy</span></a></span><span> </span><span id="local-6989586621680969503"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969503"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-970"></span><span>                          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680969494"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-971"></span><span>                            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969504"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969504"><span class="hs-identifier hs-var">tmps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969505"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969505"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [Ty3]
-&gt; PreExp E3Ext () Ty3
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
</span><a href="Gibbon.Passes.Lower.html#eliminateProjs"><span class="hs-identifier hs-var">eliminateProjs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969491"><span class="hs-identifier hs-var">vr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty3) -&gt; [Ty3] -&gt; [Ty3]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; ()) -&gt; Ty3 -&gt; Ty3
forall a b. (a -&gt; b) -&gt; UrTy a -&gt; UrTy b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969503"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969497"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-972"></span><span>                                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969506"><span class="annot"><span class="annottext">e' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969506"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="Gibbon.L3.Syntax.html#updateAvailVars"><span class="hs-identifier hs-var">updateAvailVars</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969491"><span class="hs-identifier hs-var">vr</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969504"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969505"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-973"></span><span>                                     </span><span class="annot"><span class="annottext">([(Var, Ty)], PreExp E3Ext () Ty3)
-&gt; PassM ([(Var, Ty)], PreExp E3Ext () Ty3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty] -&gt; [(Var, Ty)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969504"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969503"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969506"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>                            </span><span class="hs-comment">-- More than one should not currently be</span><span>
</span><span id="line-975"></span><span>                            </span><span class="hs-comment">-- possible (no nested tuple returns):</span><span>
</span><span id="line-976"></span><span>                            </span><span class="hs-special">[</span><span id="local-6989586621680969507"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969507"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680969508"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969508"><span class="hs-identifier hs-var">garbages</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PassM Var] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;garbage&quot;</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ty3] -&gt; [Ty3]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">L.tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969503"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-977"></span><span>                                       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969510"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969510"><span class="hs-identifier hs-var">lead</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969511"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969511"><span class="hs-identifier hs-var">trail</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; ([Var], [Var])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#splitAt"><span class="hs-identifier hs-var">L.splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969507"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969508"><span class="hs-identifier hs-var">garbages</span></a></span><span>
</span><span id="line-978"></span><span>                                       </span><span class="annot"><span class="annottext">([(Var, Ty)], PreExp E3Ext () Ty3)
-&gt; PassM ([(Var, Ty)], PreExp E3Ext () Ty3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Ty] -&gt; [(Var, Ty)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969510"><span class="hs-identifier hs-var">lead</span></a></span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969491"><span class="hs-identifier hs-var">vr</span></a></span><span class="hs-special">]</span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969511"><span class="hs-identifier hs-var">trail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>                                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969503"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>                                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969497"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>                            </span><span id="local-6989586621680969513"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680969513"><span class="hs-identifier hs-var">oth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM ([(Var, Ty)], PreExp E3Ext () Ty3)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM ([(Var, Ty)], PreExp E3Ext () Ty3))
-&gt; [Char] -&gt; PassM ([(Var, Ty)], PreExp E3Ext () Ty3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower.tail.LetE: unexpected pattern&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680969513"><span class="hs-identifier hs-var">oth</span></a></span><span>
</span><span id="line-982"></span><span>                        </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([(Var, Ty)], PreExp E3Ext () Ty3)
-&gt; PassM ([(Var, Ty)], PreExp E3Ext () Ty3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969491"><span class="hs-identifier hs-var">vr</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969492"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969497"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; [(Var, Ty)] -&gt; Var -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetCallT"><span class="hs-identifier hs-var">T.LetCallT</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)]
</span><a href="#local-6989586621680969501"><span class="hs-identifier hs-var">vsts</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969499"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; Triv) -&gt; [PreExp E3Ext () Ty3] -&gt; [Triv]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;one of app rands&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969496"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969502"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969514"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969514"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680969515"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969515"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">L3.SpawnE</span></a></span><span> </span><span id="local-6989586621680969516"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969516"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621680969517"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680969517"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680969518"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969518"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969519"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969519"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-986"></span><span>      </span><span class="annot"><a href="Gibbon.L4.Syntax.html#LetCallT"><span class="hs-identifier hs-type">T.LetCallT</span></a></span><span class="hs-special">{</span><span id="local-6989586621680969520"><span id="local-6989586621680969521"><span id="local-6989586621680969522"><span id="local-6989586621680969523"><span id="local-6989586621680969524"><span class="annot"><span class="annottext">Bool
[(Var, Ty)]
[Triv]
Var
Tail
async :: Bool
binds :: [(Var, Ty)]
rator :: Var
rands :: [Triv]
bod :: Tail
async :: Tail -&gt; Bool
binds :: Tail -&gt; [(Var, Ty)]
rator :: Tail -&gt; Var
rands :: Tail -&gt; [Triv]
bod :: Tail -&gt; Tail
</span><a href="#local-6989586621680969520"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969514"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969515"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [PreExp E3Ext () Ty3] -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969516"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680969517"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969518"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969519"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#LetCallT"><span class="hs-identifier hs-type">T.LetCallT</span></a></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">async :: Bool
</span><a href="Gibbon.L4.Syntax.html#async"><span class="hs-identifier hs-var">T.async</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)]
[Triv]
Var
Tail
binds :: [(Var, Ty)]
rator :: Var
rands :: [Triv]
bod :: Tail
binds :: [(Var, Ty)]
rator :: Var
rands :: [Triv]
bod :: Tail
</span><a href="#local-6989586621680969521"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969530"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969530"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-990"></span><span>      </span><span id="local-6989586621680969531"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969531"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969530"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-991"></span><span>      </span><span class="annot"><span class="annottext">Tail -&gt; PassM Tail
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; PassM Tail) -&gt; Tail -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; Prim -&gt; [Triv] -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetPrimCallT"><span class="hs-identifier hs-var">T.LetPrimCallT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ParSync"><span class="hs-identifier hs-var">T.ParSync</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969531"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969533"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969533"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680969534"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969534"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680969535"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969535"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680969536"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969536"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680969537"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969537"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969538"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969538"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-994"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969539"><span class="annot"><span class="annottext">a' :: Triv
</span><a href="#local-6989586621680969539"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;if test&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969535"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-995"></span><span>      </span><span id="local-6989586621680969540"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969540"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969536"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-996"></span><span>      </span><span id="local-6989586621680969541"><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969541"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969537"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-997"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969534"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-998"></span><span>        </span><span class="hs-comment">-- Finilize unarisation:</span><span>
</span><span id="line-999"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680969542"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969542"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1000"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621680969543"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969543"><span class="hs-identifier hs-var">tmps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969544"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969544"><span class="hs-identifier hs-var">bod'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; [Ty3]
-&gt; PreExp E3Ext () Ty3
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
</span><a href="Gibbon.Passes.Lower.html#eliminateProjs"><span class="hs-identifier hs-var">eliminateProjs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969533"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969542"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969538"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1001"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969545"><span class="annot"><span class="annottext">bod'' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969545"><span class="hs-identifier hs-var hs-var">bod''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="Gibbon.L3.Syntax.html#updateAvailVars"><span class="hs-identifier hs-var">updateAvailVars</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969533"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969543"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969544"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-1002"></span><span>             </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; (Triv, Tail, Tail) -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetIfT"><span class="hs-identifier hs-var">T.LetIfT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty] -&gt; [(Var, Ty)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969543"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969542"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680969539"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969540"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969541"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969545"><span class="hs-identifier hs-var">bod''</span></a></span><span>
</span><span id="line-1003"></span><span>        </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty)] -&gt; (Triv, Tail, Tail) -&gt; Tail -&gt; Tail
</span><a href="Gibbon.L4.Syntax.html#LetIfT"><span class="hs-identifier hs-var">T.LetIfT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969533"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969534"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Triv
</span><a href="#local-6989586621680969539"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969540"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tail
</span><a href="#local-6989586621680969541"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tail -&gt; Tail) -&gt; PassM Tail -&gt; PassM Tail
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Map [Char] Word16 -&gt; PreExp E3Ext () Ty3 -&gt; PassM Tail
</span><a href="#local-6989586621680968921"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680969103"><span class="hs-identifier hs-var">free_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969104"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969538"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span>
</span><span id="line-1006"></span><span>    </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Tail
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span class="annot"><span class="annottext">([Char] -&gt; PassM Tail) -&gt; [Char] -&gt; PassM Tail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower: unexpected expression in tail position:\n  &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969105"><span class="hs-identifier hs-var">ex0</span></a></span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span class="hs-comment">-- Helpers</span><span>
</span><span id="line-1010"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span class="annot"><span class="hs-comment">-- | View pattern for matching agaist projections of Foo rather than just Foo.</span></span><span>
</span><span id="line-1013"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#projOf"><span class="hs-identifier hs-type">projOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span id="projOf"><span class="annot"><span class="annottext">projOf :: PreExp E3Ext () Ty3 -&gt; ([Int], PreExp E3Ext () Ty3)
</span><a href="Gibbon.Passes.Lower.html#projOf"><span class="hs-identifier hs-var hs-var">projOf</span></a></span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680969547"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969547"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span id="local-6989586621680969548"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969548"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969549"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680969549"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969550"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969550"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; ([Int], PreExp E3Ext () Ty3)
</span><a href="Gibbon.Passes.Lower.html#projOf"><span class="hs-identifier hs-var">projOf</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969548"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1015"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680969549"><span class="hs-identifier hs-var">stk</span></a></span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969547"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969550"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1016"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#projOf"><span class="hs-identifier hs-var">projOf</span></a></span><span> </span><span id="local-6989586621680969551"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969551"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969551"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span class="annot"><span class="hs-comment">-- | Eliminate projections from a given tuple variable.  INEFFICIENT!</span></span><span>
</span><span id="line-1021"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#eliminateProjs"><span class="hs-identifier hs-type">eliminateProjs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span id="eliminateProjs"><span class="annot"><span class="annottext">eliminateProjs :: Var
-&gt; [Ty3]
-&gt; PreExp E3Ext () Ty3
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
</span><a href="Gibbon.Passes.Lower.html#eliminateProjs"><span class="hs-identifier hs-var hs-var">eliminateProjs</span></a></span></span><span> </span><span id="local-6989586621680969592"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969592"><span class="hs-identifier hs-var">vr</span></a></span></span><span> </span><span id="local-6989586621680969593"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969593"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621680969594"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969594"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1023"></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [Char]
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
forall a. Int -&gt; [Char] -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; [lower] eliminating &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty3] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969593"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1024"></span><span>             </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; projections on variable &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969592"><span class="hs-identifier hs-var">vr</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; in expr with types &quot;</span></span><span>
</span><span id="line-1025"></span><span>                                        </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Ty3] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969593"><span class="hs-identifier hs-var">tys</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;:\n   &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969594"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PassM ([Var], PreExp E3Ext () Ty3)
 -&gt; PassM ([Var], PreExp E3Ext () Ty3))
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
-&gt; PassM ([Var], PreExp E3Ext () Ty3)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1026"></span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680969595"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969595"><span class="hs-identifier hs-var">tmps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PassM Var) -&gt; [Int] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;pvrtmp&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty3] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969593"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1027"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969596"><span class="annot"><span class="annottext">go :: Int -&gt; [(Var, Ty3)] -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969596"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680969597"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969597"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1028"></span><span>            </span><span class="hs-comment">-- If there are ANY references left, we are forced to make the products:</span><span>
</span><span id="line-1029"></span><span>            </span><span class="annot"><span class="annottext">Var
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
Var -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#subst"><span class="hs-identifier hs-var">L3.subst</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969592"><span class="hs-identifier hs-var">vr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3] -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; PreExp E3Ext () Ty3) -&gt; [Var] -&gt; [PreExp E3Ext () Ty3]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969595"><span class="hs-identifier hs-var">tmps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969597"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1030"></span><span>        </span><span class="annot"><a href="#local-6989586621680969596"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680969598"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969598"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680969599"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969599"><span class="hs-identifier hs-var">pvr</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969600"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969600"><span class="hs-identifier hs-var">_pty</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680969601"><span class="annot"><span class="annottext">[(Var, Ty3)]
</span><a href="#local-6989586621680969601"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969602"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969602"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1031"></span><span>           </span><span class="annot"><span class="annottext">Int -&gt; [(Var, Ty3)] -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969596"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969598"><span class="hs-identifier hs-var">ix</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty3)]
</span><a href="#local-6989586621680969601"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-1032"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
-&gt; PreExp E3Ext () Ty3
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">L3.substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969598"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969592"><span class="hs-identifier hs-var">vr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969599"><span class="hs-identifier hs-var">pvr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969602"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1033"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969603"><span class="annot"><span class="annottext">bod' :: PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969603"><span class="hs-identifier hs-var hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Var, Ty3)] -&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969596"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty3] -&gt; [(Var, Ty3)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969595"><span class="hs-identifier hs-var">tmps</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969593"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969594"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1034"></span><span>    </span><span class="annot"><span class="annottext">([Var], PreExp E3Ext () Ty3) -&gt; PassM ([Var], PreExp E3Ext () Ty3)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680969595"><span class="hs-identifier hs-var">tmps</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969603"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#mkLet"><span class="hs-identifier hs-type">mkLet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span>
</span><span id="line-1039"></span><span id="mkLet"><span class="annot"><span class="annottext">mkLet :: (Var, Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
</span><a href="Gibbon.Passes.Lower.html#mkLet"><span class="hs-identifier hs-var hs-var">mkLet</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969604"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969604"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969605"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969605"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969606"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969606"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680969607"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969607"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969608"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969608"><span class="hs-identifier hs-var">rhs2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969609"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969609"><span class="hs-identifier hs-var">bod1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969610"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969610"><span class="hs-identifier hs-var">bod2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969606"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969607"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969608"><span class="hs-identifier hs-var">rhs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1040"></span><span>                                                    </span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969604"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969605"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969609"><span class="hs-identifier hs-var">bod1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969610"><span class="hs-identifier hs-var">bod2</span></a></span><span>
</span><span id="line-1041"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#mkLet"><span class="hs-identifier hs-var">mkLet</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680969611"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969611"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969612"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969612"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680969613"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969613"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969614"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969614"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty3, PreExp E3Ext () Ty3)
-&gt; PreExp E3Ext () Ty3 -&gt; PreExp E3Ext () Ty3
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969611"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969612"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969613"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969614"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span>
</span><span id="line-1045"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-type">triv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Triv"><span class="hs-identifier hs-type">T.Triv</span></a></span><span>
</span><span id="line-1046"></span><span id="triv"><span class="annot"><span class="annottext">triv :: Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var hs-var">triv</span></a></span></span><span> </span><span id="local-6989586621680969649"><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969649"><span class="hs-identifier hs-var">sym_tbl</span></a></span></span><span> </span><span id="local-6989586621680969650"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969650"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621680969651"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969651"><span class="hs-identifier hs-var">e0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1047"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969651"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1048"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680969652"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969652"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#VarTriv"><span class="hs-identifier hs-var">T.VarTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969652"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1049"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span> </span><span id="local-6989586621680969653"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969653"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#IntTriv"><span class="hs-identifier hs-var">T.IntTriv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969653"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- TODO: back propogate Int64 to L1</span><span>
</span><span id="line-1050"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span> </span><span id="local-6989586621680969654"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680969654"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#CharTriv"><span class="hs-identifier hs-var">T.CharTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680969654"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1051"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span> </span><span id="local-6989586621680969656"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680969656"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#FloatTriv"><span class="hs-identifier hs-var">T.FloatTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680969656"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-comment">-- TODO: back propogate Int64 to L1</span><span>
</span><span id="line-1052"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span> </span><span id="local-6989586621680969658"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969658"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680969659"><span class="annot"><span class="annottext">s :: [Char]
</span><a href="#local-6989586621680969659"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969658"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1053"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Map [Char] Word16 -&gt; Maybe Word16
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969659"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969649"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1054"></span><span>                     </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680969660"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621680969660"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#SymTriv"><span class="hs-identifier hs-var">T.SymTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621680969660"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1055"></span><span>                     </span><span class="hs-comment">-- Impossible case, b/c we collect all the symbols in the</span><span>
</span><span id="line-1056"></span><span>                     </span><span class="hs-comment">-- program in the very first step.</span><span>
</span><span id="line-1057"></span><span>                     </span><span class="annot"><span class="annottext">Maybe Word16
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Triv
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Triv) -&gt; [Char] -&gt; Triv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;triv: Symbol not found in table: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969659"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1058"></span><span>    </span><span class="hs-comment">-- Bools become ints:</span><span>
</span><span id="line-1059"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#MkTrue"><span class="hs-identifier hs-var">L3.MkTrue</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#BoolTriv"><span class="hs-identifier hs-var">T.BoolTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1060"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#MkFalse"><span class="hs-identifier hs-var">L3.MkFalse</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#BoolTriv"><span class="hs-identifier hs-var">T.BoolTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1061"></span><span>    </span><span class="hs-comment">-- Heck, let's map Unit onto Int too:</span><span>
</span><span id="line-1062"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#IntTriv"><span class="hs-identifier hs-var">T.IntTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1063"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680969665"><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969665"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Triv] -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#ProdTriv"><span class="hs-identifier hs-var">T.ProdTriv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp E3Ext () Ty3 -&gt; Triv) -&gt; [PreExp E3Ext () Ty3] -&gt; [Triv]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680969666"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969666"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969649"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969666"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969666"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PreExp E3Ext () Ty3]
</span><a href="#local-6989586621680969665"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1064"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680969667"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969667"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span id="local-6989586621680969668"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969668"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Triv -&gt; Triv
</span><a href="Gibbon.L4.Syntax.html#ProjTriv"><span class="hs-identifier hs-var">T.ProjTriv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680969667"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map [Char] Word16 -&gt; [Char] -&gt; PreExp E3Ext () Ty3 -&gt; Triv
</span><a href="Gibbon.Passes.Lower.html#triv"><span class="hs-identifier hs-var">triv</span></a></span><span> </span><span class="annot"><span class="annottext">Map [Char] Word16
</span><a href="#local-6989586621680969649"><span class="hs-identifier hs-var">sym_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;proje argument&quot;</span></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969668"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1065"></span><span>    </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
forall e. Expression e =&gt; e -&gt; Bool
</span><a href="Gibbon.Language.Syntax.html#isTrivial"><span class="hs-identifier hs-var">isTrivial</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969651"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Triv
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Triv) -&gt; [Char] -&gt; Triv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/triv: this function is written wrong.  &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1066"></span><span>                         </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;It won't handle the following, which satisfies 'isTriv':\n &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969651"><span class="hs-identifier hs-var">e0</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1067"></span><span>                         </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\nMessage: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969650"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1068"></span><span>    </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Triv
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Triv) -&gt; [Char] -&gt; Triv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/triv, expected trivial in &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969650"><span class="hs-identifier hs-var">msg</span></a></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;, got &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969651"><span class="hs-identifier hs-var">e0</span></a></span><span>
</span><span id="line-1069"></span><span>
</span><span id="line-1070"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Ty"><span class="hs-identifier hs-type">T.Ty</span></a></span><span>
</span><span id="line-1071"></span><span id="typ"><span class="annot"><span class="annottext">typ :: Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621680969676"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969676"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1072"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969676"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1073"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntTy"><span class="hs-identifier hs-var">T.IntTy</span></a></span><span>
</span><span id="line-1074"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CharTy"><span class="hs-identifier hs-var">CharTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CharTy"><span class="hs-identifier hs-var">T.CharTy</span></a></span><span>
</span><span id="line-1075"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#FloatTy"><span class="hs-identifier hs-var">T.FloatTy</span></a></span><span>
</span><span id="line-1076"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#SymTy"><span class="hs-identifier hs-var">T.SymTy</span></a></span><span>
</span><span id="line-1077"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#BoolTy"><span class="hs-identifier hs-var">BoolTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#BoolTy"><span class="hs-identifier hs-var">T.BoolTy</span></a></span><span>
</span><span id="line-1078"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VectorTy"><span class="hs-identifier hs-type">VectorTy</span></a></span><span> </span><span id="local-6989586621680969681"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969681"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#VectorTy"><span class="hs-identifier hs-var">T.VectorTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969681"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ListTy"><span class="hs-identifier hs-type">ListTy</span></a></span><span> </span><span id="local-6989586621680969682"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969682"><span class="hs-identifier hs-var">el_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#ListTy"><span class="hs-identifier hs-var">T.ListTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969682"><span class="hs-identifier hs-var">el_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictTy"><span class="hs-identifier hs-type">PDictTy</span></a></span><span> </span><span id="local-6989586621680969684"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969684"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969685"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969685"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#PDictTy"><span class="hs-identifier hs-var">T.PDictTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969684"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969685"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680969687"><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969687"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Ty] -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#ProdTy"><span class="hs-identifier hs-var">T.ProdTy</span></a></span><span> </span><span class="annot"><span class="annottext">([Ty] -&gt; Ty) -&gt; [Ty] -&gt; Ty
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty3 -&gt; Ty) -&gt; [Ty3] -&gt; [Ty]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty3]
</span><a href="#local-6989586621680969687"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1082"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680969688"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969688"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680969689"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969689"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty -&gt; Ty
</span><a href="Gibbon.L4.Syntax.html#SymDictTy"><span class="hs-identifier hs-var">T.SymDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680969688"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty -&gt; Ty) -&gt; Ty -&gt; Ty
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969689"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1083"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SymDictTy"><span class="hs-identifier hs-type">SymDictTy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621680969691"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969691"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Ty
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Ty) -&gt; [Char] -&gt; Ty
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/typ: Expected arena annotation on type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969676"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>    </span><span class="hs-comment">-- t | isCursorTy t -&gt; T.CursorTy</span><span>
</span><span id="line-1085"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span>
</span><span id="line-1086"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#CursorTy"><span class="hs-identifier hs-var">T.CursorTy</span></a></span><span> </span><span class="hs-comment">-- Audit me</span><span>
</span><span id="line-1087"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#PtrTy"><span class="hs-identifier hs-var">PtrTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#PtrTy"><span class="hs-identifier hs-var">T.PtrTy</span></a></span><span>
</span><span id="line-1088"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">T.ArenaTy</span></a></span><span>
</span><span id="line-1089"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#SymSetTy"><span class="hs-identifier hs-var">SymSetTy</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#SymSetTy"><span class="hs-identifier hs-var">T.SymSetTy</span></a></span><span>
</span><span id="line-1090"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">SymHashTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#SymHashTy"><span class="hs-identifier hs-var">T.SymHashTy</span></a></span><span>
</span><span id="line-1091"></span><span>    </span><span class="annot"><span class="annottext">Ty3
</span><a href="Gibbon.Language.Syntax.html#IntHashTy"><span class="hs-identifier hs-var">IntHashTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty
</span><a href="Gibbon.L4.Syntax.html#IntHashTy"><span class="hs-identifier hs-var">T.IntHashTy</span></a></span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#typ%27"><span class="hs-identifier hs-type">typ'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Ty"><span class="hs-identifier hs-type">T.Ty</span></a></span><span>
</span><span id="line-1094"></span><span id="typ%27"><span class="annot"><span class="annottext">typ' :: [Char] -&gt; Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ%27"><span class="hs-identifier hs-var hs-var">typ'</span></a></span></span><span> </span><span id="local-6989586621680969702"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969702"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621680969703"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969703"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Ty -&gt; Ty
forall a. [Char] -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTraceIt"><span class="hs-identifier hs-var">dbgTraceIt</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969702"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty -&gt; Ty) -&gt; Ty -&gt; Ty
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969703"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#prim"><span class="hs-keyword hs-type">prim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prim"><span class="hs-identifier hs-type">Prim</span></a></span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Ty3"><span class="hs-identifier hs-type">Ty3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L4.Syntax.html#Prim"><span class="hs-identifier hs-type">T.Prim</span></a></span><span>
</span><span id="line-1097"></span><span id="prim"><span class="annot"><span class="annottext">prim :: Prim Ty3 -&gt; Prim
</span><a href="Gibbon.Passes.Lower.html#prim"><span class="hs-keyword hs-var hs-var">prim</span></a></span></span><span> </span><span id="local-6989586621680969728"><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969728"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1098"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969728"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1099"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#AddP"><span class="hs-identifier hs-var">AddP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#AddP"><span class="hs-identifier hs-var">T.AddP</span></a></span><span>
</span><span id="line-1100"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SubP"><span class="hs-identifier hs-var">SubP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SubP"><span class="hs-identifier hs-var">T.SubP</span></a></span><span>
</span><span id="line-1101"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#MulP"><span class="hs-identifier hs-var">MulP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#MulP"><span class="hs-identifier hs-var">T.MulP</span></a></span><span>
</span><span id="line-1102"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#DivP"><span class="hs-identifier hs-var">DivP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#DivP"><span class="hs-identifier hs-var">T.DivP</span></a></span><span>
</span><span id="line-1103"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#ModP"><span class="hs-identifier hs-var">ModP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ModP"><span class="hs-identifier hs-var">T.ModP</span></a></span><span>
</span><span id="line-1104"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#ExpP"><span class="hs-identifier hs-var">ExpP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ExpP"><span class="hs-identifier hs-var">T.ExpP</span></a></span><span>
</span><span id="line-1105"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FAddP"><span class="hs-identifier hs-var">FAddP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#AddP"><span class="hs-identifier hs-var">T.AddP</span></a></span><span>
</span><span id="line-1106"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FSubP"><span class="hs-identifier hs-var">FSubP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SubP"><span class="hs-identifier hs-var">T.SubP</span></a></span><span>
</span><span id="line-1107"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FMulP"><span class="hs-identifier hs-var">FMulP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#MulP"><span class="hs-identifier hs-var">T.MulP</span></a></span><span>
</span><span id="line-1108"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FDivP"><span class="hs-identifier hs-var">FDivP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#DivP"><span class="hs-identifier hs-var">T.DivP</span></a></span><span>
</span><span id="line-1109"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FExpP"><span class="hs-identifier hs-var">FExpP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ExpP"><span class="hs-identifier hs-var">T.ExpP</span></a></span><span>
</span><span id="line-1110"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FRandP"><span class="hs-identifier hs-var">FRandP</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#FRandP"><span class="hs-identifier hs-var">T.FRandP</span></a></span><span>
</span><span id="line-1111"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FSqrtP"><span class="hs-identifier hs-var">FSqrtP</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#FSqrtP"><span class="hs-identifier hs-var">T.FSqrtP</span></a></span><span>
</span><span id="line-1112"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FTanP"><span class="hs-identifier hs-var">FTanP</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#FTanP"><span class="hs-identifier hs-var">T.FTanP</span></a></span><span>
</span><span id="line-1113"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FloatToIntP"><span class="hs-identifier hs-var">FloatToIntP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#FloatToIntP"><span class="hs-identifier hs-var">T.FloatToIntP</span></a></span><span>
</span><span id="line-1114"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#IntToFloatP"><span class="hs-identifier hs-var">IntToFloatP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#IntToFloatP"><span class="hs-identifier hs-var">T.IntToFloatP</span></a></span><span>
</span><span id="line-1115"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#RandP"><span class="hs-identifier hs-var">RandP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#RandP"><span class="hs-identifier hs-var">T.RandP</span></a></span><span>
</span><span id="line-1116"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#Gensym"><span class="hs-identifier hs-var">Gensym</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#Gensym"><span class="hs-identifier hs-var">T.Gensym</span></a></span><span>
</span><span id="line-1117"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#EqSymP"><span class="hs-identifier hs-var">EqSymP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#EqSymP"><span class="hs-identifier hs-var">T.EqSymP</span></a></span><span>
</span><span id="line-1118"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#EqBenchProgP"><span class="hs-identifier hs-type">EqBenchProgP</span></a></span><span> </span><span id="local-6989586621680969758"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969758"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#EqBenchProgP"><span class="hs-identifier hs-var">T.EqBenchProgP</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969758"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1119"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#EqIntP"><span class="hs-identifier hs-var">EqIntP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#EqP"><span class="hs-identifier hs-var">T.EqP</span></a></span><span>
</span><span id="line-1120"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#EqFloatP"><span class="hs-identifier hs-var">EqFloatP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#EqP"><span class="hs-identifier hs-var">T.EqP</span></a></span><span>
</span><span id="line-1121"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#EqCharP"><span class="hs-identifier hs-var">EqCharP</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#EqP"><span class="hs-identifier hs-var">T.EqP</span></a></span><span>
</span><span id="line-1122"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#LtP"><span class="hs-identifier hs-var">LtP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#LtP"><span class="hs-identifier hs-var">T.LtP</span></a></span><span>
</span><span id="line-1123"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#GtP"><span class="hs-identifier hs-var">GtP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#GtP"><span class="hs-identifier hs-var">T.GtP</span></a></span><span>
</span><span id="line-1124"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#LtEqP"><span class="hs-identifier hs-var">LtEqP</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#LtEqP"><span class="hs-identifier hs-var">T.LtEqP</span></a></span><span>
</span><span id="line-1125"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#GtEqP"><span class="hs-identifier hs-var">GtEqP</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#GtEqP"><span class="hs-identifier hs-var">T.GtEqP</span></a></span><span>
</span><span id="line-1126"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FLtP"><span class="hs-identifier hs-var">FLtP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#LtP"><span class="hs-identifier hs-var">T.LtP</span></a></span><span>
</span><span id="line-1127"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FGtP"><span class="hs-identifier hs-var">FGtP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#GtP"><span class="hs-identifier hs-var">T.GtP</span></a></span><span>
</span><span id="line-1128"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FLtEqP"><span class="hs-identifier hs-var">FLtEqP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#LtEqP"><span class="hs-identifier hs-var">T.LtEqP</span></a></span><span>
</span><span id="line-1129"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#FGtEqP"><span class="hs-identifier hs-var">FGtEqP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#GtEqP"><span class="hs-identifier hs-var">T.GtEqP</span></a></span><span>
</span><span id="line-1130"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#OrP"><span class="hs-identifier hs-var">OrP</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#OrP"><span class="hs-identifier hs-var">T.OrP</span></a></span><span>
</span><span id="line-1131"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#AndP"><span class="hs-identifier hs-var">AndP</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#AndP"><span class="hs-identifier hs-var">T.AndP</span></a></span><span>
</span><span id="line-1132"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SizeParam"><span class="hs-identifier hs-var">SizeParam</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SizeParam"><span class="hs-identifier hs-var">T.SizeParam</span></a></span><span>
</span><span id="line-1133"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#IsBig"><span class="hs-identifier hs-var">IsBig</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#IsBig"><span class="hs-identifier hs-var">T.IsBig</span></a></span><span>
</span><span id="line-1134"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#PrintInt"><span class="hs-identifier hs-var">PrintInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintInt"><span class="hs-identifier hs-var">T.PrintInt</span></a></span><span>
</span><span id="line-1135"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#PrintChar"><span class="hs-identifier hs-var">PrintChar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintChar"><span class="hs-identifier hs-var">T.PrintChar</span></a></span><span>
</span><span id="line-1136"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#PrintFloat"><span class="hs-identifier hs-var">PrintFloat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintFloat"><span class="hs-identifier hs-var">T.PrintFloat</span></a></span><span>
</span><span id="line-1137"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#PrintBool"><span class="hs-identifier hs-var">PrintBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintBool"><span class="hs-identifier hs-var">T.PrintBool</span></a></span><span>
</span><span id="line-1138"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#PrintSym"><span class="hs-identifier hs-var">PrintSym</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#PrintSym"><span class="hs-identifier hs-var">T.PrintSym</span></a></span><span>
</span><span id="line-1139"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#ReadInt"><span class="hs-identifier hs-var">ReadInt</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#ReadInt"><span class="hs-identifier hs-var">T.ReadInt</span></a></span><span>
</span><span id="line-1140"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictInsertP"><span class="hs-identifier hs-type">DictInsertP</span></a></span><span> </span><span id="local-6989586621680969792"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969792"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#DictInsertP"><span class="hs-identifier hs-var">T.DictInsertP</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty -&gt; Prim) -&gt; Ty -&gt; Prim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969792"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1141"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictLookupP"><span class="hs-identifier hs-type">DictLookupP</span></a></span><span> </span><span id="local-6989586621680969795"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969795"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#DictLookupP"><span class="hs-identifier hs-var">T.DictLookupP</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty -&gt; Prim) -&gt; Ty -&gt; Prim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969795"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1142"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictEmptyP"><span class="hs-identifier hs-type">DictEmptyP</span></a></span><span> </span><span id="local-6989586621680969797"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969797"><span class="hs-identifier hs-var">ty</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#DictEmptyP"><span class="hs-identifier hs-var">T.DictEmptyP</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty -&gt; Prim) -&gt; Ty -&gt; Prim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969797"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1143"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DictHasKeyP"><span class="hs-identifier hs-type">DictHasKeyP</span></a></span><span> </span><span id="local-6989586621680969800"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969800"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#DictHasKeyP"><span class="hs-identifier hs-var">T.DictHasKeyP</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty -&gt; Prim) -&gt; Ty -&gt; Prim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969800"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1144"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ReadPackedFile"><span class="hs-identifier hs-type">ReadPackedFile</span></a></span><span> </span><span id="local-6989586621680969803"><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621680969803"><span class="hs-identifier hs-var">mf</span></a></span></span><span> </span><span id="local-6989586621680969804"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969804"><span class="hs-identifier hs-var">tyc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#ReadPackedFile"><span class="hs-identifier hs-var">T.ReadPackedFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621680969803"><span class="hs-identifier hs-var">mf</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969804"><span class="hs-identifier hs-var">tyc</span></a></span><span>
</span><span id="line-1145"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WritePackedFile"><span class="hs-identifier hs-type">WritePackedFile</span></a></span><span> </span><span id="local-6989586621680969807"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969807"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680969808"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969808"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1146"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680969809"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969809"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969808"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#WritePackedFile"><span class="hs-identifier hs-var">T.WritePackedFile</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969807"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680969809"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-1147"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Prim
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Prim) -&gt; [Char] -&gt; Prim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;prim: writePackedFile given a non-packed type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3 -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969808"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1148"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ReadArrayFile"><span class="hs-identifier hs-type">ReadArrayFile</span></a></span><span> </span><span id="local-6989586621680969812"><span class="annot"><span class="annottext">Maybe ([Char], Int)
</span><a href="#local-6989586621680969812"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680969813"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969813"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ([Char], Int) -&gt; Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#ReadArrayFile"><span class="hs-identifier hs-var">T.ReadArrayFile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([Char], Int)
</span><a href="#local-6989586621680969812"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969813"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1149"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VAllocP"><span class="hs-identifier hs-type">VAllocP</span></a></span><span> </span><span id="local-6989586621680969816"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969816"><span class="hs-identifier hs-var">elty</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VAllocP"><span class="hs-identifier hs-var">T.VAllocP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969816"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1150"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VFreeP"><span class="hs-identifier hs-type">VFreeP</span></a></span><span> </span><span id="local-6989586621680969819"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969819"><span class="hs-identifier hs-var">elty</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VFreeP"><span class="hs-identifier hs-var">T.VFreeP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969819"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VFree2P"><span class="hs-identifier hs-type">VFree2P</span></a></span><span> </span><span id="local-6989586621680969822"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969822"><span class="hs-identifier hs-var">elty</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VFree2P"><span class="hs-identifier hs-var">T.VFree2P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969822"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1152"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VLengthP"><span class="hs-identifier hs-type">VLengthP</span></a></span><span> </span><span id="local-6989586621680969825"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969825"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VLengthP"><span class="hs-identifier hs-var">T.VLengthP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969825"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VNthP"><span class="hs-identifier hs-type">VNthP</span></a></span><span> </span><span id="local-6989586621680969828"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969828"><span class="hs-identifier hs-var">elty</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VNthP"><span class="hs-identifier hs-var">T.VNthP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969828"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1154"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VSliceP"><span class="hs-identifier hs-type">VSliceP</span></a></span><span> </span><span id="local-6989586621680969831"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969831"><span class="hs-identifier hs-var">elty</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VSliceP"><span class="hs-identifier hs-var">T.VSliceP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969831"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1155"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#InplaceVUpdateP"><span class="hs-identifier hs-type">InplaceVUpdateP</span></a></span><span> </span><span id="local-6989586621680969834"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969834"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#InplaceVUpdateP"><span class="hs-identifier hs-var">T.InplaceVUpdateP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969834"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1156"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VConcatP"><span class="hs-identifier hs-type">VConcatP</span></a></span><span> </span><span id="local-6989586621680969837"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969837"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VConcatP"><span class="hs-identifier hs-var">T.VConcatP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969837"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VMergeP"><span class="hs-identifier hs-type">VMergeP</span></a></span><span> </span><span id="local-6989586621680969840"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969840"><span class="hs-identifier hs-var">elty</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VMergeP"><span class="hs-identifier hs-var">T.VMergeP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969840"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1158"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VSortP"><span class="hs-identifier hs-type">VSortP</span></a></span><span> </span><span id="local-6989586621680969843"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969843"><span class="hs-identifier hs-var">elty</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#VSortP"><span class="hs-identifier hs-var">T.VSortP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969843"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#InplaceVSortP"><span class="hs-identifier hs-type">InplaceVSortP</span></a></span><span> </span><span id="local-6989586621680969846"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969846"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#InplaceVSortP"><span class="hs-identifier hs-var">T.InplaceVSortP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969846"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1160"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictAllocP"><span class="hs-identifier hs-type">PDictAllocP</span></a></span><span>  </span><span id="local-6989586621680969849"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969849"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969850"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969850"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PDictAllocP"><span class="hs-identifier hs-var">T.PDictAllocP</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969849"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969850"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictInsertP"><span class="hs-identifier hs-type">PDictInsertP</span></a></span><span> </span><span id="local-6989586621680969853"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969853"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969854"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969854"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PDictInsertP"><span class="hs-identifier hs-var">T.PDictInsertP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969853"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969854"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1162"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictLookupP"><span class="hs-identifier hs-type">PDictLookupP</span></a></span><span> </span><span id="local-6989586621680969857"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969857"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969858"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969858"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PDictLookupP"><span class="hs-identifier hs-var">T.PDictLookupP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969857"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969858"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictHasKeyP"><span class="hs-identifier hs-type">PDictHasKeyP</span></a></span><span> </span><span id="local-6989586621680969861"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969861"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969862"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969862"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PDictHasKeyP"><span class="hs-identifier hs-var">T.PDictHasKeyP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969861"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969862"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictForkP"><span class="hs-identifier hs-type">PDictForkP</span></a></span><span> </span><span id="local-6989586621680969865"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969865"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969866"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969866"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PDictForkP"><span class="hs-identifier hs-var">T.PDictForkP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969865"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969866"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PDictJoinP"><span class="hs-identifier hs-type">PDictJoinP</span></a></span><span> </span><span id="local-6989586621680969869"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969869"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680969870"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969870"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#PDictJoinP"><span class="hs-identifier hs-var">T.PDictJoinP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969869"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969870"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1166"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLAllocP"><span class="hs-identifier hs-type">LLAllocP</span></a></span><span> </span><span id="local-6989586621680969873"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969873"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#LLAllocP"><span class="hs-identifier hs-var">T.LLAllocP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969873"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1167"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLIsEmptyP"><span class="hs-identifier hs-type">LLIsEmptyP</span></a></span><span> </span><span id="local-6989586621680969876"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969876"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#LLIsEmptyP"><span class="hs-identifier hs-var">T.LLIsEmptyP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969876"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLConsP"><span class="hs-identifier hs-type">LLConsP</span></a></span><span> </span><span id="local-6989586621680969879"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969879"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#LLConsP"><span class="hs-identifier hs-var">T.LLConsP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969879"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLHeadP"><span class="hs-identifier hs-type">LLHeadP</span></a></span><span> </span><span id="local-6989586621680969882"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969882"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#LLHeadP"><span class="hs-identifier hs-var">T.LLHeadP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969882"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLTailP"><span class="hs-identifier hs-type">LLTailP</span></a></span><span> </span><span id="local-6989586621680969885"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969885"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#LLTailP"><span class="hs-identifier hs-var">T.LLTailP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969885"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1171"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLFreeP"><span class="hs-identifier hs-type">LLFreeP</span></a></span><span> </span><span id="local-6989586621680969888"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969888"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#LLFreeP"><span class="hs-identifier hs-var">T.LLFreeP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969888"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLFree2P"><span class="hs-identifier hs-type">LLFree2P</span></a></span><span> </span><span id="local-6989586621680969891"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969891"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#LLFree2P"><span class="hs-identifier hs-var">T.LLFree2P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969891"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1173"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LLCopyP"><span class="hs-identifier hs-type">LLCopyP</span></a></span><span> </span><span id="local-6989586621680969894"><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969894"><span class="hs-identifier hs-var">elty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty -&gt; Prim
</span><a href="Gibbon.L4.Syntax.html#LLCopyP"><span class="hs-identifier hs-var">T.LLCopyP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty3 -&gt; Ty
</span><a href="Gibbon.Passes.Lower.html#typ"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Ty3
</span><a href="#local-6989586621680969894"><span class="hs-identifier hs-var">elty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1174"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#GetNumProcessors"><span class="hs-identifier hs-var">GetNumProcessors</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#GetNumProcessors"><span class="hs-identifier hs-var">T.GetNumProcessors</span></a></span><span>
</span><span id="line-1175"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SymSetEmpty"><span class="hs-identifier hs-var">SymSetEmpty</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SymSetEmpty"><span class="hs-identifier hs-var">T.SymSetEmpty</span></a></span><span>
</span><span id="line-1176"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SymSetInsert"><span class="hs-identifier hs-var">SymSetInsert</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SymSetInsert"><span class="hs-identifier hs-var">T.SymSetInsert</span></a></span><span>
</span><span id="line-1177"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SymSetContains"><span class="hs-identifier hs-var">SymSetContains</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SymSetContains"><span class="hs-identifier hs-var">T.SymSetContains</span></a></span><span>
</span><span id="line-1178"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SymHashEmpty"><span class="hs-identifier hs-var">SymHashEmpty</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SymHashEmpty"><span class="hs-identifier hs-var">T.SymHashEmpty</span></a></span><span>
</span><span id="line-1179"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SymHashInsert"><span class="hs-identifier hs-var">SymHashInsert</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SymHashInsert"><span class="hs-identifier hs-var">T.SymHashInsert</span></a></span><span>
</span><span id="line-1180"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SymHashLookup"><span class="hs-identifier hs-var">SymHashLookup</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SymHashLookup"><span class="hs-identifier hs-var">T.SymHashLookup</span></a></span><span>
</span><span id="line-1181"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#SymHashContains"><span class="hs-identifier hs-var">SymHashContains</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#SymHashContains"><span class="hs-identifier hs-var">T.SymHashContains</span></a></span><span>
</span><span id="line-1182"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#IntHashEmpty"><span class="hs-identifier hs-var">IntHashEmpty</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#IntHashEmpty"><span class="hs-identifier hs-var">T.IntHashEmpty</span></a></span><span>
</span><span id="line-1183"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#IntHashInsert"><span class="hs-identifier hs-var">IntHashInsert</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#IntHashInsert"><span class="hs-identifier hs-var">T.IntHashInsert</span></a></span><span>
</span><span id="line-1184"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#IntHashLookup"><span class="hs-identifier hs-var">IntHashLookup</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim
</span><a href="Gibbon.L4.Syntax.html#IntHashLookup"><span class="hs-identifier hs-var">T.IntHashLookup</span></a></span><span>
</span><span id="line-1185"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Write3dPpmFile"><span class="hs-identifier hs-type">Write3dPpmFile</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Prim
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span class="annot"><span class="annottext">([Char] -&gt; Prim) -&gt; [Char] -&gt; Prim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/prim: internal error, Write3dPpmFile not handled yet.&quot;</span></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ErrorP"><span class="hs-identifier hs-type">ErrorP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Prim
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span class="annot"><span class="annottext">([Char] -&gt; Prim) -&gt; [Char] -&gt; Prim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/prim: internal error, should not have got to here: &quot;</span></span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">Prim Ty3 -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="#local-6989586621680969728"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1188"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#MkTrue"><span class="hs-identifier hs-var">MkTrue</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Prim
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/prim: internal error. MkTrue should not get here.&quot;</span></span><span>
</span><span id="line-1189"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#MkFalse"><span class="hs-identifier hs-var">MkFalse</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Prim
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/prim: internal error. MkFalse should not get here.&quot;</span></span><span>
</span><span id="line-1190"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#RequestSizeOf"><span class="hs-identifier hs-var">RequestSizeOf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Prim
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/prim: internal error. RequestSizeOf shouldn't be here.&quot;</span></span><span>
</span><span id="line-1191"></span><span>    </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#RequestEndOf"><span class="hs-identifier hs-var">RequestEndOf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Prim
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;lower/prim: internal error. RequestEndOf shouldn't be here.&quot;</span></span><span>
</span><span id="line-1192"></span><span>
</span><span id="line-1193"></span><span class="annot"><a href="Gibbon.Passes.Lower.html#isTrivial%27"><span class="hs-identifier hs-type">isTrivial'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L3.Syntax.html#Exp3"><span class="hs-identifier hs-type">Exp3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1194"></span><span id="isTrivial%27"><span class="annot"><span class="annottext">isTrivial' :: PreExp E3Ext () Ty3 -&gt; Bool
</span><a href="Gibbon.Passes.Lower.html#isTrivial%27"><span class="hs-identifier hs-var hs-var">isTrivial'</span></a></span></span><span> </span><span id="local-6989586621680969927"><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969927"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1195"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969927"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1196"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#MkTrue"><span class="hs-identifier hs-var">L3.MkTrue</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1197"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty3
</span><a href="Gibbon.Language.Syntax.html#MkFalse"><span class="hs-identifier hs-var">L3.MkFalse</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1198"></span><span>      </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3 -&gt; Bool
forall e. Expression e =&gt; e -&gt; Bool
</span><a href="Gibbon.Language.Syntax.html#isTrivial"><span class="hs-identifier hs-var">isTrivial</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp E3Ext () Ty3
</span><a href="#local-6989586621680969927"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1199"></span></pre></body></html>