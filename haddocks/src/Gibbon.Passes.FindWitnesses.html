<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">{-|

With the new location calculus and `inferLocations`, this pass should've been
redundant. But not quite.. We still need it to reorder location variables bound
in case expressions.

For example, after running the add1 program through the pipeline till `RouteEnds`,
this is what the `Node` case looks like:

    (&quot;Node&quot;,
     [(&quot;x9&quot;, &quot;l10&quot;),(&quot;y11&quot;, &quot;l12&quot;)],
        ...)

To &quot;unpack&quot; these fields, `Cursorize` just binds `x9` to `l10` and `y11` to `l12`.
But, the cursor `l12` is not bound (or known) until we call `(add1 x9)` and
get the end_of_read cursor it returns. This happens later in the program.
Thus, `y11` refers to an unbound cursor `l12` here.
FindWitnesses fixes this by moving the `let y11 = l12` binding to its proper place.

Another strategy would be to actually handle this properly in Cursorize.

-}</span></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.Passes.FindWitnesses</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#findWitnesses"><span class="hs-identifier">findWitnesses</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Graph.html"><span class="hs-identifier">Data.Graph</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- import Gibbon.L3.Syntax</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html"><span class="hs-identifier">Gibbon.L2.Syntax</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.html#mapMExprs"><span class="hs-identifier">mapMExprs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">data</span><span> </span><span id="DelayedBind"><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayedBind"><span class="hs-identifier hs-var">DelayedBind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DelayVar"><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayVar"><span class="hs-identifier hs-var">DelayVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="DelayLoc"><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayLoc"><span class="hs-identifier hs-var">DelayLoc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LocExp"><span class="hs-identifier hs-type">LocExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680954769"><span id="local-6989586621680954780"><span class="annot"><span class="annottext">DelayedBind -&gt; DelayedBind -&gt; Bool
(DelayedBind -&gt; DelayedBind -&gt; Bool)
-&gt; (DelayedBind -&gt; DelayedBind -&gt; Bool) -&gt; Eq DelayedBind
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: DelayedBind -&gt; DelayedBind -&gt; Bool
== :: DelayedBind -&gt; DelayedBind -&gt; Bool
$c/= :: DelayedBind -&gt; DelayedBind -&gt; Bool
/= :: DelayedBind -&gt; DelayedBind -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680954792"><span id="local-6989586621680954806"><span id="local-6989586621680954810"><span class="annot"><span class="annottext">Int -&gt; DelayedBind -&gt; ShowS
[DelayedBind] -&gt; ShowS
DelayedBind -&gt; String
(Int -&gt; DelayedBind -&gt; ShowS)
-&gt; (DelayedBind -&gt; String)
-&gt; ([DelayedBind] -&gt; ShowS)
-&gt; Show DelayedBind
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; DelayedBind -&gt; ShowS
showsPrec :: Int -&gt; DelayedBind -&gt; ShowS
$cshow :: DelayedBind -&gt; String
show :: DelayedBind -&gt; String
$cshowList :: [DelayedBind] -&gt; ShowS
showList :: [DelayedBind] -&gt; ShowS
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680954823"><span id="local-6989586621680954834"><span id="local-6989586621680954843"><span id="local-6989586621680954847"><span id="local-6989586621680954850"><span id="local-6989586621680954853"><span id="local-6989586621680954856"><span class="annot"><span class="annottext">Eq DelayedBind
Eq DelayedBind
-&gt; (DelayedBind -&gt; DelayedBind -&gt; Ordering)
-&gt; (DelayedBind -&gt; DelayedBind -&gt; Bool)
-&gt; (DelayedBind -&gt; DelayedBind -&gt; Bool)
-&gt; (DelayedBind -&gt; DelayedBind -&gt; Bool)
-&gt; (DelayedBind -&gt; DelayedBind -&gt; Bool)
-&gt; (DelayedBind -&gt; DelayedBind -&gt; DelayedBind)
-&gt; (DelayedBind -&gt; DelayedBind -&gt; DelayedBind)
-&gt; Ord DelayedBind
DelayedBind -&gt; DelayedBind -&gt; Bool
DelayedBind -&gt; DelayedBind -&gt; Ordering
DelayedBind -&gt; DelayedBind -&gt; DelayedBind
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: DelayedBind -&gt; DelayedBind -&gt; Ordering
compare :: DelayedBind -&gt; DelayedBind -&gt; Ordering
$c&lt; :: DelayedBind -&gt; DelayedBind -&gt; Bool
&lt; :: DelayedBind -&gt; DelayedBind -&gt; Bool
$c&lt;= :: DelayedBind -&gt; DelayedBind -&gt; Bool
&lt;= :: DelayedBind -&gt; DelayedBind -&gt; Bool
$c&gt; :: DelayedBind -&gt; DelayedBind -&gt; Bool
&gt; :: DelayedBind -&gt; DelayedBind -&gt; Bool
$c&gt;= :: DelayedBind -&gt; DelayedBind -&gt; Bool
&gt;= :: DelayedBind -&gt; DelayedBind -&gt; Bool
$cmax :: DelayedBind -&gt; DelayedBind -&gt; DelayedBind
max :: DelayedBind -&gt; DelayedBind -&gt; DelayedBind
$cmin :: DelayedBind -&gt; DelayedBind -&gt; DelayedBind
min :: DelayedBind -&gt; DelayedBind -&gt; DelayedBind
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#bigNumber"><span class="hs-identifier hs-type">bigNumber</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-43"></span><span id="bigNumber"><span class="annot"><span class="annottext">bigNumber :: Int
</span><a href="Gibbon.Passes.FindWitnesses.html#bigNumber"><span class="hs-identifier hs-var hs-var">bigNumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="hs-comment">-- limit number of loops</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- | This pass must find witnesses if they exist in the lexical</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- environment, and it must *reorder* let bindings to bring start/end</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- witnesses into scope.</span><span>
</span><span id="line-48"></span><span class="hs-comment">--</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- Phase Ordering: This must run after flatten.</span><span>
</span><span id="line-50"></span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#findWitnesses"><span class="hs-identifier hs-type">findWitnesses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span>
</span><span id="line-51"></span><span id="findWitnesses"><span class="annot"><span class="annottext">findWitnesses :: Prog2 -&gt; PassM Prog2
</span><a href="Gibbon.Passes.FindWitnesses.html#findWitnesses"><span class="hs-identifier hs-var hs-var">findWitnesses</span></a></span></span><span> </span><span id="local-6989586621680954889"><span class="annot"><span class="annottext">p :: Prog2
</span><a href="#local-6989586621680954889"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680954891"><span class="annot"><span class="annottext">FunDefs Exp2
fundefs :: FunDefs Exp2
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
</span><a href="#local-6989586621680954891"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env2 Ty2 -&gt; Set Var -&gt; Exp2 -&gt; PassM Exp2) -&gt; Prog2 -&gt; PassM Prog2
forall (m :: * -&gt; *).
Monad m =&gt;
(Env2 Ty2 -&gt; Set Var -&gt; Exp2 -&gt; m Exp2) -&gt; Prog2 -&gt; m Prog2
</span><a href="Gibbon.Passes.FindWitnesses.html#mapMExprs"><span class="hs-identifier hs-var">mapMExprs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; Set Var -&gt; Exp2 -&gt; PassM Exp2
forall {m :: * -&gt; *} {a}.
Monad m =&gt;
Env2 a -&gt; Set Var -&gt; Exp2 -&gt; m Exp2
</span><a href="#local-6989586621680954894"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Prog2
</span><a href="#local-6989586621680954889"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-52"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>  </span><span id="local-6989586621680954894"><span class="annot"><span class="annottext">fn :: Env2 a -&gt; Set Var -&gt; Exp2 -&gt; m Exp2
</span><a href="#local-6989586621680954894"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span class="hs-special">{</span><span id="local-6989586621680954910"><span class="annot"><span class="annottext">TyEnv a
vEnv :: TyEnv a
vEnv :: forall a. Env2 a -&gt; TyEnv a
</span><a href="#local-6989586621680954910"><span class="hs-identifier hs-var hs-var">vEnv</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680954912"><span class="annot"><span class="annottext">TyEnv (ArrowTy a)
fEnv :: TyEnv (ArrowTy a)
fEnv :: forall a. Env2 a -&gt; TyEnv (ArrowTy a)
</span><a href="#local-6989586621680954912"><span class="hs-identifier hs-var hs-var">fEnv</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680954914"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954914"><span class="hs-identifier hs-var">boundlocs</span></a></span></span><span> </span><span id="local-6989586621680954915"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954915"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; m Exp2
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; Exp2 -&gt; Int -&gt; Exp2
forall {t}. (Eq t, Num t) =&gt; Set Var -&gt; Exp2 -&gt; t -&gt; Exp2
</span><a href="#local-6989586621680954916"><span class="hs-identifier hs-var">goFix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv a -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv a
</span><a href="#local-6989586621680954910"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy a) -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy a)
</span><a href="#local-6989586621680954912"><span class="hs-identifier hs-var">fEnv</span></a></span><span>
</span><span id="line-54"></span><span>                                                  </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954914"><span class="hs-identifier hs-var">boundlocs</span></a></span><span>
</span><span id="line-55"></span><span>                                                  </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>                                            </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954915"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Gibbon.Passes.FindWitnesses.html#bigNumber"><span class="hs-identifier hs-var">bigNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>  </span><span id="local-6989586621680954916"><span class="annot"><span class="annottext">goFix :: Set Var -&gt; Exp2 -&gt; t -&gt; Exp2
</span><a href="#local-6989586621680954916"><span class="hs-identifier hs-var hs-var">goFix</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><span class="hs-identifier">_</span></span><span>    </span><span id="local-6989586621680954938"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954938"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp2
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Exp2) -&gt; String -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;timeout in findWitness on &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954938"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="#local-6989586621680954916"><span class="hs-identifier hs-var">goFix</span></a></span><span> </span><span id="local-6989586621680954941"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954941"><span class="hs-identifier hs-var">bound0</span></a></span></span><span> </span><span id="local-6989586621680954942"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954942"><span class="hs-identifier hs-var">ex0</span></a></span></span><span> </span><span id="local-6989586621680954943"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680954943"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680954944"><span class="annot"><span class="annottext">ex1 :: Exp2
</span><a href="#local-6989586621680954944"><span class="hs-identifier hs-var hs-var">ex1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954941"><span class="hs-identifier hs-var">bound0</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954942"><span class="hs-identifier hs-var">ex0</span></a></span><span>
</span><span id="line-59"></span><span>                           </span><span id="local-6989586621680954947"><span class="annot"><span class="annottext">ex2 :: Exp2
</span><a href="#local-6989586621680954947"><span class="hs-identifier hs-var hs-var">ex2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954941"><span class="hs-identifier hs-var">bound0</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954944"><span class="hs-identifier hs-var">ex1</span></a></span><span>
</span><span id="line-60"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954944"><span class="hs-identifier hs-var">ex1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954947"><span class="hs-identifier hs-var">ex2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954947"><span class="hs-identifier hs-var">ex2</span></a></span><span>
</span><span id="line-61"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Exp2 -&gt; t -&gt; Exp2
</span><a href="#local-6989586621680954916"><span class="hs-identifier hs-var">goFix</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954941"><span class="hs-identifier hs-var">bound0</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954947"><span class="hs-identifier hs-var">ex2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680954943"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>  </span><span id="local-6989586621680954948"><span class="annot"><span class="annottext">docase :: Set Var
-&gt; Map Var DelayedBind
-&gt; (String, [(Var, Var)], Exp2)
-&gt; (String, [(Var, Var)], Exp2)
</span><a href="#local-6989586621680954948"><span class="hs-identifier hs-var hs-var">docase</span></a></span></span><span> </span><span id="local-6989586621680954949"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954949"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621680954950"><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954950"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680954951"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680954951"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680954952"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680954952"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680954953"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954953"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680954954"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680954954"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680954955"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680954955"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; ([Var], [Var])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680954952"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-65"></span><span>        </span><span id="local-6989586621680954957"><span class="annot"><span class="annottext">bound' :: Set Var
</span><a href="#local-6989586621680954957"><span class="hs-identifier hs-var hs-var">bound'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680954954"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680954955"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954949"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680954951"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680954952"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954957"><span class="hs-identifier hs-var">bound'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954950"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954953"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="#local-6989586621680954945"><span class="hs-identifier hs-type">goE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayedBind"><span class="hs-identifier hs-type">DelayedBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span id="local-6989586621680954945"><span class="annot"><span class="annottext">goE :: Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var hs-var">goE</span></a></span></span><span> </span><span id="local-6989586621680954959"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621680954960"><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621680954961"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954961"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680954962"><span class="annot"><span class="annottext">go :: Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="hs-comment">-- Shorthand.</span><span>
</span><span id="line-71"></span><span>        </span><span id="local-6989586621680954963"><span class="annot"><span class="annottext">goClear :: Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var hs-var">goClear</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-72"></span><span>        </span><span class="hs-comment">-- shorthand for applying (L p)</span><span>
</span><span id="line-73"></span><span>        </span><span id="local-6989586621680954964"><span class="annot"><span class="annottext">handle' :: Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var hs-var">handle'</span></a></span></span><span> </span><span id="local-6989586621680954965"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954965"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; FunDefs Exp2 -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.FindWitnesses.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680954891"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954965"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-75"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954961"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680954968"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954968"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680954969"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680954969"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680954970"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680954970"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680954972"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954972"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680954973"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680954973"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680954974"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680954974"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680954975"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954975"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-77"></span><span>            </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [Var], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954968"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680954969"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680954970"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Ty2 -&gt; Bool -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954972"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680954973"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680954974"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954968"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954975"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680954978"><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><a href="#local-6989586621680954978"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><a href="#local-6989586621680954978"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-82"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680954980"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680954981"><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680954981"><span class="hs-identifier hs-var">locexp</span></a></span></span><span> </span><span id="local-6989586621680954982"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954982"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680954983"><span class="annot"><span class="annottext">freelocs :: Set Var
</span><a href="#local-6989586621680954983"><span class="hs-identifier hs-var hs-var">freelocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocExp -&gt; Set Var
forall a. FreeVars a =&gt; a -&gt; Set Var
</span><a href="Gibbon.Language.Syntax.html#gFreeVars"><span class="hs-identifier hs-var">gFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680954981"><span class="hs-identifier hs-var">locexp</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-84"></span><span>                  </span><span id="local-6989586621680954986"><span class="annot"><span class="annottext">chk :: Bool
</span><a href="#local-6989586621680954986"><span class="hs-identifier hs-var hs-var">chk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954983"><span class="hs-identifier hs-var">freelocs</span></a></span><span>
</span><span id="line-85"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680954986"><span class="hs-identifier hs-var">chk</span></a></span><span>
</span><span id="line-86"></span><span>                 </span><span class="hs-comment">-- dbgTraceIt (if loc == &quot;loc_17052&quot; then (sdoc (loc, locexp, freelocs, chk)) else &quot;&quot;)</span><span>
</span><span id="line-87"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; E2Ext Var Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; LocExp -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680954981"><span class="hs-identifier hs-var">locexp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; E2Ext Var Ty2) -&gt; Exp2 -&gt; E2Ext Var Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954982"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-88"></span><span>                 </span><span class="hs-keyword">else</span><span>
</span><span id="line-89"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680954981"><span class="hs-identifier hs-var">locexp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-90"></span><span>                     </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterVariableLE"><span class="hs-identifier hs-type">AfterVariableLE</span></a></span><span> </span><span id="local-6989586621680954989"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954989"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680954990"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954990"><span class="hs-identifier hs-var">loc2</span></a></span></span><span> </span><span id="local-6989586621680954991"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680954991"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-91"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; DelayedBind -&gt; Map Var DelayedBind -&gt; Map Var DelayedBind
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, LocExp) -&gt; DelayedBind
</span><a href="Gibbon.Passes.FindWitnesses.html#DelayLoc"><span class="hs-identifier hs-var">DelayLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool -&gt; LocExp
forall loc. Var -&gt; loc -&gt; Bool -&gt; PreLocExp loc
</span><a href="Gibbon.L2.Syntax.html#AfterVariableLE"><span class="hs-identifier hs-var">AfterVariableLE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954989"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954990"><span class="hs-identifier hs-var">loc2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680954991"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954982"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>                     </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterConstantLE"><span class="hs-identifier hs-type">AfterConstantLE</span></a></span><span> </span><span id="local-6989586621680954994"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680954994"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680954995"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954995"><span class="hs-identifier hs-var">loc2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-93"></span><span>                       </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; DelayedBind -&gt; Map Var DelayedBind -&gt; Map Var DelayedBind
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, LocExp) -&gt; DelayedBind
</span><a href="Gibbon.Passes.FindWitnesses.html#DelayLoc"><span class="hs-identifier hs-var">DelayLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Var -&gt; LocExp
forall loc. Int -&gt; loc -&gt; PreLocExp loc
</span><a href="Gibbon.L2.Syntax.html#AfterConstantLE"><span class="hs-identifier hs-var">AfterConstantLE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680954994"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954995"><span class="hs-identifier hs-var">loc2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954982"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-94"></span><span>                     </span><span class="annot"><span class="annottext">LocExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; E2Ext Var Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; LocExp -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680954981"><span class="hs-identifier hs-var">locexp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; E2Ext Var Ty2) -&gt; Exp2 -&gt; E2Ext Var Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680954980"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954982"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-95"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680954997"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680954997"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680954998"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680954998"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680954999"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680954999"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680955000"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955000"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; E2Ext Var Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-var">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680954997"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680954998"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680954999"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; E2Ext Var Ty2) -&gt; Exp2 -&gt; E2Ext Var Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955000"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-96"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680955002"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680955002"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680955003"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680955003"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680955004"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680955004"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680955005"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955005"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; E2Ext Var Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-var">LetParRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680955002"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680955003"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680955004"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; E2Ext Var Ty2) -&gt; Exp2 -&gt; E2Ext Var Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955005"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-97"></span><span>            </span><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680954961"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955006"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955006"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955007"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955007"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955008"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955008"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955009"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955009"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680955010"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955010"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-100"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680955011"><span class="annot"><span class="annottext">rhs' :: Exp2
</span><a href="#local-6989586621680955011"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955009"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-comment">-- recur on rhs, but flatten makes these pretty boring.</span><span>
</span><span id="line-101"></span><span>              </span><span id="local-6989586621680955012"><span class="annot"><span class="annottext">freelocs :: Set Var
</span><a href="#local-6989586621680955012"><span class="hs-identifier hs-var hs-var">freelocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.FindWitnesses.html#ex_freeVars"><span class="hs-identifier hs-var">ex_freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955011"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span>
</span><span id="line-102"></span><span>              </span><span id="local-6989586621680955014"><span class="annot"><span class="annottext">chk :: Bool
</span><a href="#local-6989586621680955014"><span class="hs-identifier hs-var hs-var">chk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680955012"><span class="hs-identifier hs-var">freelocs</span></a></span><span>
</span><span id="line-103"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680955014"><span class="hs-identifier hs-var">chk</span></a></span><span>
</span><span id="line-104"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Var, [Var], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955006"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955007"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955008"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955011"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954945"><span class="hs-identifier hs-var">goE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955006"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; FunDefs Exp2 -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.FindWitnesses.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955006"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680954891"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955010"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; DelayedBind -&gt; Map Var DelayedBind -&gt; Map Var DelayedBind
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955006"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [Var], Ty2, Exp2) -&gt; DelayedBind
</span><a href="Gibbon.Passes.FindWitnesses.html#DelayVar"><span class="hs-identifier hs-var">DelayVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955006"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955007"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955008"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955011"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955010"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680955016"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955016"><span class="hs-identifier hs-var">v</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955016"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span> </span><span id="local-6989586621680955018"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680955018"><span class="hs-identifier hs-var">n</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680955018"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span> </span><span id="local-6989586621680955020"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680955020"><span class="hs-identifier hs-var">c</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Char -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-var">CharE</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680955020"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span> </span><span id="local-6989586621680955022"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680955022"><span class="hs-identifier hs-var">n</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Double -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-var">FloatE</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680955022"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span> </span><span id="local-6989586621680955024"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955024"><span class="hs-identifier hs-var">v</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-var">LitSymE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955024"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680955026"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955026"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680955027"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955027"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680955028"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955028"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955026"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955027"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955028"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span id="local-6989586621680955030"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955030"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680955031"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955031"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680955032"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955032"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-var">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955030"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955031"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955032"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Exp2
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680955035"><span class="annot"><span class="annottext">Prim Ty2
</span><a href="#local-6989586621680955035"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span id="local-6989586621680955036"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955036"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2 -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2
</span><a href="#local-6989586621680955035"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955036"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680955038"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680955038"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680955039"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955039"><span class="hs-identifier hs-var">e</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680955038"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955039"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>        </span><span class="hs-comment">-- It's ok that we don't go deeper on scrutinees, subexpressions</span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-comment">-- of tuples, and so on, because flatten should have done</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-comment">-- let-lifting out of these contexts:</span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680955041"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955041"><span class="hs-identifier hs-var">ls</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955041"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680955043"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955043"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680955044"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680955044"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680955045"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955045"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; String -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955043"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680955044"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680955045"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680955046"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955046"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680955047"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955047"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680955048"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680955048"><span class="hs-identifier hs-var">b</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Ty2 -&gt; Bool -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955046"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955047"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680955048"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-comment">-- prevent pushing work into timeit</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-comment">-- FIXME: give CaseE a treatment like IfE:</span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680955050"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955050"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680955051"><span class="annot"><span class="annottext">[(String, [(Var, Var)], Exp2)]
</span><a href="#local-6989586621680955051"><span class="hs-identifier hs-var">ls</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [(String, [(Var, Var)], Exp2)] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955050"><span class="hs-identifier hs-var">scrt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, Var)], Exp2) -&gt; (String, [(Var, Var)], Exp2))
-&gt; [(String, [(Var, Var)], Exp2)] -&gt; [(String, [(Var, Var)], Exp2)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var
-&gt; Map Var DelayedBind
-&gt; (String, [(Var, Var)], Exp2)
-&gt; (String, [(Var, Var)], Exp2)
</span><a href="#local-6989586621680954948"><span class="hs-identifier hs-var">docase</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, Var)], Exp2)]
</span><a href="#local-6989586621680955051"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680955053"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955053"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680955054"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955054"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680955055"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955055"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-comment">-- If we have &quot;succeeded&quot; in accumulating all the bindings</span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-comment">-- we need, then we can discharge their topological sort</span><span>
</span><span id="line-133"></span><span>            </span><span class="hs-comment">-- here, without duplicating bindings:</span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Map Var DelayedBind -&gt; Bool
</span><a href="Gibbon.Passes.FindWitnesses.html#closed"><span class="hs-identifier hs-var">closed</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680954959"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-135"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955053"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955054"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955055"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955053"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Otherwise we duplicate...</span><span>
</span><span id="line-137"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955054"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954962"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680954960"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955055"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-comment">-- Like MkProdE</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680955058"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955058"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955059"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955059"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955060"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955060"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680955061"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955061"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-var">MapE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955058"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955059"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955060"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955061"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955063"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955063"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955064"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955064"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955065"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955065"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955066"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955066"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955067"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955067"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955068"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955068"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680955069"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955069"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954964"><span class="hs-identifier hs-var">handle'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Ty2, Exp2) -&gt; (Var, Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, dec, PreExp ext loc dec)
-&gt; (Var, dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-var">FoldE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955063"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955064"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955065"><span class="hs-identifier hs-var">r1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955066"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955067"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955068"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680954963"><span class="hs-identifier hs-var">goClear</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955069"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp2
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;findWitnesses: WithArenaE not handled.&quot;</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- TODO: this needs to preserve any bindings that have TimeIt forms (hasTimeIt).</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- OR we can only match a certain pattern like (Let (_,_,TimeIt _ _) _)</span><span>
</span><span id="line-147"></span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#handle"><span class="hs-identifier hs-type">handle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayedBind"><span class="hs-identifier hs-type">DelayedBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-148"></span><span id="handle"><span class="annot"><span class="annottext">handle :: Set Var -&gt; FunDefs Exp2 -&gt; Map Var DelayedBind -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.FindWitnesses.html#handle"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621680955086"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680955086"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621680955087"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680955087"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680955088"><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955088"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621680955089"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955089"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; Exp2 -&gt; Exp2
forall a. Int -&gt; String -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; [findWitnesses] building lets using vars &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">[Var] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955091"><span class="hs-identifier hs-var">vs</span></a></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; for expr: &quot;</span></span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShowS
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">80</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955089"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">-- dbgTraceIt (if vars /= [] then &quot;binding: &quot; ++ sdoc vars else &quot;&quot;)</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; [Var] -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.FindWitnesses.html#buildLets"><span class="hs-identifier hs-var">buildLets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955088"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955094"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955089"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680955095"><span class="annot"><span class="annottext">freeInBind :: Var -&gt; [Var]
</span><a href="#local-6989586621680955095"><span class="hs-identifier hs-var hs-var">freeInBind</span></a></span></span><span> </span><span id="local-6989586621680955096"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955096"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var DelayedBind -&gt; Maybe DelayedBind
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Passes.FindWitnesses.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955096"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955088"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-153"></span><span>                           </span><span class="annot"><span class="annottext">Maybe DelayedBind
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span>                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayVar"><span class="hs-identifier hs-type">DelayVar</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955099"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955099"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955100"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955100"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955101"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955101"><span class="hs-identifier hs-var">_t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955102"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955102"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; [Var]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Var -&gt; [Var]) -&gt; Set Var -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.FindWitnesses.html#ex_freeVars"><span class="hs-identifier hs-var">ex_freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955102"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680955087"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayLoc"><span class="hs-identifier hs-type">DelayLoc</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955104"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955104"><span class="hs-identifier hs-var">_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680955105"><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680955105"><span class="hs-identifier hs-var">locexp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; [Var]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Var -&gt; [Var]) -&gt; Set Var -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocExp -&gt; Set Var
forall a. FreeVars a =&gt; a -&gt; Set Var
</span><a href="Gibbon.Language.Syntax.html#gFreeVars"><span class="hs-identifier hs-var">gFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680955105"><span class="hs-identifier hs-var">locexp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680955087"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680955106"><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621680955106"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955107"><span class="annot"><span class="annottext">Int -&gt; (Var, Var, [Var])
</span><a href="#local-6989586621680955107"><span class="hs-identifier hs-var">vf</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var -&gt; Maybe Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
-&gt; (Graph, Int -&gt; (Var, Var, [Var]), Var -&gt; Maybe Int)
forall key node.
Ord key =&gt;
[(node, key, [key])]
-&gt; (Graph, Int -&gt; (node, key, [key]), key -&gt; Maybe Int)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Graph.html#graphFromEdges"><span class="hs-identifier hs-var">graphFromEdges</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Var, [Var])]
 -&gt; (Graph, Int -&gt; (Var, Var, [Var]), Var -&gt; Maybe Int))
-&gt; [(Var, Var, [Var])]
-&gt; (Graph, Int -&gt; (Var, Var, [Var]), Var -&gt; Maybe Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [[Var]] -&gt; [(Var, Var, [Var])]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955091"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955091"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">([[Var]] -&gt; [(Var, Var, [Var])]) -&gt; [[Var]] -&gt; [(Var, Var, [Var])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; [Var]) -&gt; [Var] -&gt; [[Var]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var]
</span><a href="#local-6989586621680955095"><span class="hs-identifier hs-var">freeInBind</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955091"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-158"></span><span>          </span><span id="local-6989586621680955094"><span class="annot"><span class="annottext">vars :: [Var]
</span><a href="#local-6989586621680955094"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Var, Var, [Var]) -&gt; Var) -&gt; [(Var, Var, [Var])] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680955111"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955111"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955111"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Var, Var, [Var])] -&gt; [Var]) -&gt; [(Var, Var, [Var])] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Var, Var, [Var])) -&gt; [Int] -&gt; [(Var, Var, [Var])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Var, Var, [Var])
</span><a href="#local-6989586621680955107"><span class="hs-identifier hs-var">vf</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [(Var, Var, [Var])]) -&gt; [Int] -&gt; [(Var, Var, [Var])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Graph -&gt; [Int]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Graph.html#topSort"><span class="hs-identifier hs-var">topSort</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621680955106"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-159"></span><span>          </span><span id="local-6989586621680955091"><span class="annot"><span class="annottext">vs :: [Var]
</span><a href="#local-6989586621680955091"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; [Var]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Var DelayedBind -&gt; [Var]) -&gt; Map Var DelayedBind -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; DelayedBind -&gt; Bool)
-&gt; Map Var DelayedBind -&gt; Map Var DelayedBind
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#filterWithKey"><span class="hs-identifier hs-var">Map.filterWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680955115"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955115"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680955116"><span class="annot"><span class="annottext">DelayedBind
</span><a href="#local-6989586621680955116"><span class="hs-identifier hs-var">_v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">Set.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955115"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680955086"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955088"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- withWitnesses :: [LocVar] -&gt; [LocVar]</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- withWitnesses ls = concatMap f ls</span><span>
</span><span id="line-166"></span><span class="hs-comment">--     where f v = if isWitnessVar v</span><span>
</span><span id="line-167"></span><span class="hs-comment">--                 then [v]</span><span>
</span><span id="line-168"></span><span class="hs-comment">--                 else [v,toWitnessVar v] -- maybe?</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">-- From the point of view of this pass, we &quot;see through&quot; witness markerS:</span><span>
</span><span id="line-171"></span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#view"><span class="hs-identifier hs-type">view</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-172"></span><span id="view"><span class="annot"><span class="annottext">view :: Var -&gt; Var
</span><a href="Gibbon.Passes.FindWitnesses.html#view"><span class="hs-identifier hs-var hs-var">view</span></a></span></span><span> </span><span id="local-6989586621680955118"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955118"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955118"><span class="hs-identifier hs-var">v</span></a></span><span>  </span><span class="hs-comment">-- RRN: actually, coming up with a good policy here is problematic.</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- view v | isWitnessVar v = let Just v' = fromWitnessVar v in v'</span><span>
</span><span id="line-175"></span><span class="hs-comment">--        | otherwise      = v</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#buildLets"><span class="hs-identifier hs-type">buildLets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayedBind"><span class="hs-identifier hs-type">DelayedBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-179"></span><span id="buildLets"><span class="annot"><span class="annottext">buildLets :: Map Var DelayedBind -&gt; [Var] -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.FindWitnesses.html#buildLets"><span class="hs-identifier hs-var hs-var">buildLets</span></a></span></span><span> </span><span id="local-6989586621680955120"><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955120"><span class="hs-identifier hs-var">_mp</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680955121"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955121"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955121"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-180"></span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#buildLets"><span class="hs-identifier hs-var">buildLets</span></a></span><span> </span><span id="local-6989586621680955122"><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955122"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955123"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955123"><span class="hs-identifier hs-var">v</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680955124"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955124"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680955125"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955125"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var DelayedBind -&gt; Maybe DelayedBind
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Passes.FindWitnesses.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955123"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955122"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">Maybe DelayedBind
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; [Var] -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.FindWitnesses.html#buildLets"><span class="hs-identifier hs-var">buildLets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955122"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955124"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955125"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayVar"><span class="hs-identifier hs-type">DelayVar</span></a></span><span> </span><span id="local-6989586621680955126"><span class="annot"><span class="annottext">(Var, [Var], Ty2, Exp2)
</span><a href="#local-6989586621680955126"><span class="hs-identifier hs-var">bnd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [Var], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [Var], Ty2, Exp2)
</span><a href="#local-6989586621680955126"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; [Var] -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.FindWitnesses.html#buildLets"><span class="hs-identifier hs-var">buildLets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955122"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955124"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955125"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayLoc"><span class="hs-identifier hs-type">DelayLoc</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955127"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955127"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680955128"><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680955128"><span class="hs-identifier hs-var">bnd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; E2Ext Var Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; LocExp -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680955127"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680955128"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; [Var] -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.FindWitnesses.html#buildLets"><span class="hs-identifier hs-var">buildLets</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955122"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955124"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955125"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">-- | Are all the free variables currently bound (transitively) in the</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- environment?</span><span>
</span><span id="line-189"></span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#closed"><span class="hs-identifier hs-type">closed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayedBind"><span class="hs-identifier hs-type">DelayedBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-190"></span><span id="closed"><span class="annot"><span class="annottext">closed :: Set Var -&gt; Map Var DelayedBind -&gt; Bool
</span><a href="Gibbon.Passes.FindWitnesses.html#closed"><span class="hs-identifier hs-var hs-var">closed</span></a></span></span><span> </span><span id="local-6989586621680955135"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680955135"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621680955136"><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955136"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680955137"><span class="hs-identifier hs-var">allBound</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680955138"><span class="hs-identifier hs-var">allUsed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>   </span><span id="local-6989586621680955137"><span class="annot"><span class="annottext">allBound :: Set Var
</span><a href="#local-6989586621680955137"><span class="hs-identifier hs-var hs-var">allBound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680955135"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955136"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-193"></span><span>   </span><span class="hs-comment">-- allUsed = Set.unions [ gFreeVars rhs | (_,_,_,rhs) &lt;- Map.elems mp ]</span><span>
</span><span id="line-194"></span><span>   </span><span id="local-6989586621680955138"><span class="annot"><span class="annottext">allUsed :: Set Var
</span><a href="#local-6989586621680955138"><span class="hs-identifier hs-var hs-var">allUsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">Set.unions</span></a></span><span> </span><span class="annot"><span class="annottext">([Set Var] -&gt; Set Var) -&gt; [Set Var] -&gt; Set Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DelayedBind -&gt; Set Var) -&gt; [DelayedBind] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680955140"><span class="annot"><span class="annottext">DelayedBind
</span><a href="#local-6989586621680955140"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DelayedBind
</span><a href="#local-6989586621680955140"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-195"></span><span>                                  </span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayVar"><span class="hs-identifier hs-type">DelayVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680955141"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955141"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.FindWitnesses.html#ex_freeVars"><span class="hs-identifier hs-var">ex_freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955141"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-196"></span><span>                                  </span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#DelayLoc"><span class="hs-identifier hs-type">DelayLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680955142"><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680955142"><span class="hs-identifier hs-var">locexp</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocExp -&gt; Set Var
forall a. FreeVars a =&gt; a -&gt; Set Var
</span><a href="Gibbon.Language.Syntax.html#gFreeVars"><span class="hs-identifier hs-var">gFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">LocExp
</span><a href="#local-6989586621680955142"><span class="hs-identifier hs-var">locexp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var DelayedBind -&gt; [DelayedBind]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var DelayedBind
</span><a href="#local-6989586621680955136"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span id="local-6989586621680954663"><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#mapMExprs"><span class="hs-identifier hs-type">mapMExprs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680954663"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680954663"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680954663"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span></span><span>
</span><span id="line-200"></span><span id="mapMExprs"><span class="annot"><span class="annottext">mapMExprs :: forall (m :: * -&gt; *).
Monad m =&gt;
(Env2 Ty2 -&gt; Set Var -&gt; Exp2 -&gt; m Exp2) -&gt; Prog2 -&gt; m Prog2
</span><a href="Gibbon.Passes.FindWitnesses.html#mapMExprs"><span class="hs-identifier hs-var hs-var">mapMExprs</span></a></span></span><span> </span><span id="local-6989586621680955164"><span class="annot"><span class="annottext">Env2 Ty2 -&gt; Set Var -&gt; Exp2 -&gt; m Exp2
</span><a href="#local-6989586621680955164"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span> </span><span id="local-6989586621680955165"><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
</span><a href="#local-6989586621680955165"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680955166"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680955166"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680955167"><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="#local-6989586621680955167"><span class="hs-identifier hs-var">mainExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
-&gt; FunDefs Exp2 -&gt; Maybe (Exp2, TyOf Exp2) -&gt; Prog2
forall ex.
DDefs (TyOf ex) -&gt; FunDefs ex -&gt; Maybe (ex, TyOf ex) -&gt; Prog ex
</span><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-var">Prog</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
</span><a href="#local-6989586621680955165"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDefs Exp2 -&gt; Maybe (Exp2, Ty2) -&gt; Prog2)
-&gt; m (FunDefs Exp2) -&gt; m (Maybe (Exp2, Ty2) -&gt; Prog2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FunDef Exp2 -&gt; m (FunDef Exp2))
-&gt; FunDefs Exp2 -&gt; m (FunDefs Exp2)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Map Var a -&gt; m (Map Var b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680955170"><span class="annot"><span class="annottext">f :: FunDef Exp2
</span><a href="#local-6989586621680955170"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680955172"><span class="annot"><span class="annottext">[Var]
funArgs :: [Var]
funArgs :: forall ex. FunDef ex -&gt; [Var]
</span><a href="#local-6989586621680955172"><span class="hs-identifier hs-var hs-var">funArgs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955174"><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
funTy :: ArrowTy (TyOf Exp2)
funTy :: forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="#local-6989586621680955174"><span class="hs-identifier hs-var hs-var">funTy</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955176"><span class="annot"><span class="annottext">Exp2
funBody :: Exp2
funBody :: forall ex. FunDef ex -&gt; ex
</span><a href="#local-6989586621680955176"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-203"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680955178"><span class="annot"><span class="annottext">env :: Env2 Ty2
</span><a href="#local-6989586621680955178"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; TyEnv Ty2) -&gt; [(Var, Ty2)] -&gt; TyEnv Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955172"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy Ty2 -&gt; [Ty2]
forall ty. FunctionTy ty =&gt; ArrowTy ty -&gt; [ty]
</span><a href="Gibbon.Language.Syntax.html#inTys"><span class="hs-identifier hs-var">inTys</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy Ty2
</span><a href="#local-6989586621680955174"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy Ty2)
Map Var (ArrowTy2 Ty2)
</span><a href="#local-6989586621680955181"><span class="hs-identifier hs-var">funEnv</span></a></span><span>
</span><span id="line-204"></span><span>                  </span><span id="local-6989586621680955182"><span class="annot"><span class="annottext">boundlocs :: Set Var
</span><a href="#local-6989586621680955182"><span class="hs-identifier hs-var hs-var">boundlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#allLocVars"><span class="hs-identifier hs-var">allLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680955174"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span>
</span><span id="line-205"></span><span>                              </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680955172"><span class="hs-identifier hs-var">funArgs</span></a></span><span>
</span><span id="line-206"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>                </span><span id="local-6989586621680955184"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955184"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; Set Var -&gt; Exp2 -&gt; m Exp2
</span><a href="#local-6989586621680955164"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680955178"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680955182"><span class="hs-identifier hs-var">boundlocs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955176"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-208"></span><span>                </span><span class="annot"><span class="annottext">FunDef Exp2 -&gt; m (FunDef Exp2)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef Exp2 -&gt; m (FunDef Exp2)) -&gt; FunDef Exp2 -&gt; m (FunDef Exp2)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef Exp2
</span><a href="#local-6989586621680955170"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funBody :: Exp2
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955184"><span class="hs-identifier hs-var">bod'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>     </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680955166"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="annottext">m (Maybe (Exp2, Ty2) -&gt; Prog2) -&gt; m (Maybe (Exp2, Ty2)) -&gt; m Prog2
forall a b. m (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Exp2, Ty2) -&gt; m (Exp2, Ty2))
-&gt; Maybe (Exp2, Ty2) -&gt; m (Maybe (Exp2, Ty2))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Maybe a -&gt; m (Maybe b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955185"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955185"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680955186"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955186"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680955186"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; (Exp2, Ty2)) -&gt; m Exp2 -&gt; m (Exp2, Ty2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; Set Var -&gt; Exp2 -&gt; m Exp2
</span><a href="#local-6989586621680955164"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy Ty2)
Map Var (ArrowTy2 Ty2)
</span><a href="#local-6989586621680955181"><span class="hs-identifier hs-var">funEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680955185"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
Maybe (Exp2, Ty2)
</span><a href="#local-6989586621680955167"><span class="hs-identifier hs-var">mainExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680955181"><span class="annot"><span class="annottext">funEnv :: Map Var (ArrowTy2 Ty2)
</span><a href="#local-6989586621680955181"><span class="hs-identifier hs-var hs-var">funEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDef Exp2 -&gt; ArrowTy2 Ty2)
-&gt; FunDefs Exp2 -&gt; Map Var (ArrowTy2 Ty2)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">Map.map</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef Exp2 -&gt; ArrowTy (TyOf Exp2)
FunDef Exp2 -&gt; ArrowTy2 Ty2
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680955166"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="Gibbon.Passes.FindWitnesses.html#ex_freeVars"><span class="hs-identifier hs-type">ex_freeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-215"></span><span id="ex_freeVars"><span class="annot"><span class="annottext">ex_freeVars :: Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.FindWitnesses.html#ex_freeVars"><span class="hs-identifier hs-var hs-var">ex_freeVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.L2.Syntax.html#allFreeVars"><span class="hs-identifier hs-var">allFreeVars</span></a></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- ex_freeVars = gFreeVars</span><span>
</span><span id="line-217"></span></pre></body></html>