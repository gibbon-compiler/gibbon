<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-name-shadowing #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.Passes.AddRAN</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#addRAN"><span class="hs-identifier">addRAN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier">numRANsDataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#needsRAN"><span class="hs-identifier">needsRAN</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#when"><span class="hs-identifier">when</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier">forM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier">fromJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html"><span class="hs-identifier">Text.PrettyPrint.GenericPretty</span></a></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.DynFlags.html"><span class="hs-identifier">Gibbon.DynFlags</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html"><span class="hs-identifier">Gibbon.Passes.AddTraversals</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#needsTraversalCase"><span class="hs-identifier">needsTraversalCase</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.L1.Syntax.html"><span class="hs-identifier">Gibbon.L1.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L1</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Gibbon.L2.Syntax.html"><span class="hs-identifier">Gibbon.L2.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L2</span></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">{-

Adding random access nodes
~~~~~~~~~~~~~~~~~~~~~~~~~~

We cannot add RAN's to an L2 program, as it would distort the locations
inferred by the previous analysis. Instead, (1) we use the old L1 program and
add RAN's to that, (2) then run location inference again.

Adding RAN's requires 3 steps:

(1) Convert DDefs to `WithRAN DDefs` (we don't have a separate type for those yet).

For example,

    ddtree :: DDefs Ty1
    ddtree = fromListDD [DDef (toVar &quot;Tree&quot;)
                          [ (&quot;Leaf&quot;,[(False,IntTy)])
                          , (&quot;Node&quot;,[ (False,PackedTy &quot;Tree&quot; ())
                                    , (False,PackedTy &quot;Tree&quot; ())])
                          ]]

becomes,

    ddtree :: DDefs Ty1
    ddtree = fromListDD [DDef (toVar &quot;Tree&quot;)
                         [ (&quot;Leaf&quot;   ,[(False,IntTy)])
                         , (&quot;Node&quot;,  [ (False,PackedTy &quot;Tree&quot; ())
                                     , (False,PackedTy &quot;Tree&quot; ())])
                         , (&quot;Node^&quot;, [ (False, CursorTy) -- random access node
                                     , (False,PackedTy &quot;Tree&quot; ())
                                     , (False,PackedTy &quot;Tree&quot; ())])
                         ]]

(2) Update all data constructors that now need to write additional random access nodes
    (before all other arguments so that they're written immediately after the tag).

(3) Case expressions are modified to work with these updated data constructors.
    Pattern matches for these constructors now bind the additional
    random access nodes too.


When does a type 'needsRAN'
~~~~~~~~~~~~~~~~~~~~~~~~~~~

If any pattern 'needsTraversalCase' to be able to unpack it, we mark the type of
scrutinee as something that needs RAN's. Also, types of all packed values flowing
into a SpawnE that live in the same region would need random access.


Keeping old case clauses around
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Consider this example datatype.

    data Foo = A Foo Foo | B

Suppose that we want to add random access nodes to Foo. Before [2019.09.15],
step (3) above was a destructive operation. Specifically, addRAN would update
a pattern match on 'A' in place.

    case foo of
      A x y -&gt; ...

would become

    case foo of
      A^ ran x y -&gt; ...


As described in this [Evernote], we'd like to amortize the cost of adding
random access nodes to a datatype i.e below a certain threshold, we'd rather
perform dummy traversals. It's clear that if we want to support this, we
cannot get rid of the old case clause. After [2019.09.15], that's what
addRAN does. And we run addTraversals later in the pipeline so that the
case clause is compilable.

Evernote: https://www.evernote.com/l/AF-jUPTw2lZDS440RgWbgj9RMNkttTaKd3Y

-}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Operates on an L1 program, and updates it to have random access nodes.</span><span>
</span><span id="line-104"></span><span class="hs-comment">--</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- Previous analysis determines which data types require it (needsLRAN).</span><span>
</span><span id="line-106"></span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#addRAN"><span class="hs-identifier hs-type">addRAN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Prog1"><span class="hs-identifier hs-type">Prog1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Prog1"><span class="hs-identifier hs-type">Prog1</span></a></span><span>
</span><span id="line-107"></span><span id="addRAN"><span class="annot"><span class="annottext">addRAN :: Set TyCon -&gt; Prog1 -&gt; PassM Prog1
</span><a href="Gibbon.Passes.AddRAN.html#addRAN"><span class="hs-identifier hs-var hs-var">addRAN</span></a></span></span><span> </span><span id="local-6989586621680958876"><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680958876"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span></span><span> </span><span id="local-6989586621680958877"><span class="annot"><span class="annottext">prg :: Prog1
</span><a href="#local-6989586621680958877"><span class="hs-identifier hs-var">prg</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680958879"><span class="annot"><span class="annottext">DDefs (TyOf Exp1)
ddefs :: DDefs (TyOf Exp1)
ddefs :: forall ex. Prog ex -&gt; DDefs (TyOf ex)
</span><a href="#local-6989586621680958879"><span class="hs-identifier hs-var hs-var">ddefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958881"><span class="annot"><span class="annottext">FunDefs Exp1
fundefs :: FunDefs Exp1
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
</span><a href="#local-6989586621680958881"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958883"><span class="annot"><span class="annottext">Maybe (Exp1, TyOf Exp1)
mainExp :: Maybe (Exp1, TyOf Exp1)
mainExp :: forall ex. Prog ex -&gt; Maybe (ex, TyOf ex)
</span><a href="#local-6989586621680958883"><span class="hs-identifier hs-var hs-var">mainExp</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>  </span><span id="local-6989586621680958885"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680958885"><span class="hs-identifier hs-var">dump_op</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DebugFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#dopt"><span class="hs-identifier hs-var">dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DebugFlag
</span><a href="Gibbon.DynFlags.html#Opt_D_Dump_Repair"><span class="hs-identifier hs-var">Opt_D_Dump_Repair</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Bool) -&gt; PassM DynFlags -&gt; PassM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PassM () -&gt; PassM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680958885"><span class="hs-identifier hs-var">dump_op</span></a></span><span> </span><span class="annot"><span class="annottext">(PassM () -&gt; PassM ()) -&gt; PassM () -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; TyCon -&gt; PassM () -&gt; PassM ()
forall a. Int -&gt; TyCon -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;Adding random access nodes: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; TyCon
forall a. Out a =&gt; a -&gt; TyCon
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set TyCon -&gt; [TyCon]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680958876"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; PassM ()
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958893"><span class="annot"><span class="annottext">iddefs :: DDefs (UrTy ())
</span><a href="#local-6989586621680958893"><span class="hs-identifier hs-var hs-var">iddefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set TyCon -&gt; DDefs (UrTy ()) -&gt; DDefs (UrTy ())
forall a. Out a =&gt; Set TyCon -&gt; DDefs (UrTy a) -&gt; DDefs (UrTy a)
</span><a href="Gibbon.Passes.AddRAN.html#withRANDDefs"><span class="hs-identifier hs-var">withRANDDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680958876"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp1)
DDefs (UrTy ())
</span><a href="#local-6989586621680958879"><span class="hs-identifier hs-var">ddefs</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621680958895"><span class="annot"><span class="annottext">[(Var, FunDef1)]
</span><a href="#local-6989586621680958895"><span class="hs-identifier hs-var">funs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Var, FunDef1) -&gt; PassM (Var, FunDef1))
-&gt; [(Var, FunDef1)] -&gt; PassM [(Var, FunDef1)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680958897"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958897"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958898"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680958898"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958897"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FunDef1 -&gt; (Var, FunDef1))
-&gt; PassM FunDef1 -&gt; PassM (Var, FunDef1)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon -&gt; DDefs (UrTy ()) -&gt; FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.AddRAN.html#addRANFun"><span class="hs-identifier hs-var">addRANFun</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680958876"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680958893"><span class="hs-identifier hs-var">iddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680958898"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs Exp1 -&gt; [(Var, FunDef1)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp1
</span><a href="#local-6989586621680958881"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-comment">-- new_fns &lt;- mapM (genRelOffsetsFunNameFn needRANsTyCons ddefs) (M.elems ddefs)</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958901"><span class="annot"><span class="annottext">funs' :: FunDefs Exp1
</span><a href="#local-6989586621680958901"><span class="hs-identifier hs-var hs-var">funs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, FunDef1)] -&gt; FunDefs Exp1
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, FunDef1)]
</span><a href="#local-6989586621680958895"><span class="hs-identifier hs-var">funs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>              </span><span class="hs-comment">-- `M.union` (M.fromList $ L.map (\f -&gt; (funName f, f)) new_fns)</span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621680958903"><span class="annot"><span class="annottext">Maybe (Exp1, UrTy ())
</span><a href="#local-6989586621680958903"><span class="hs-identifier hs-var">mainExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp1, TyOf Exp1)
</span><a href="#local-6989586621680958883"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958904"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680958904"><span class="hs-identifier hs-var">ex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958905"><span class="annot"><span class="annottext">TyOf Exp1
</span><a href="#local-6989586621680958905"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp1, UrTy ()) -&gt; Maybe (Exp1, UrTy ())
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Exp1, UrTy ()) -&gt; Maybe (Exp1, UrTy ()))
-&gt; (Exp1 -&gt; (Exp1, UrTy ())) -&gt; Exp1 -&gt; Maybe (Exp1, UrTy ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyOf Exp1
UrTy ()
</span><a href="#local-6989586621680958905"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Maybe (Exp1, UrTy ()))
-&gt; PassM Exp1 -&gt; PassM (Maybe (Exp1, UrTy ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set TyCon -&gt; DDefs (UrTy ()) -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.AddRAN.html#addRANExp"><span class="hs-identifier hs-var">addRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680958876"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680958893"><span class="hs-identifier hs-var">iddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680958904"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Exp1, TyOf Exp1)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp1, UrTy ()) -&gt; PassM (Maybe (Exp1, UrTy ()))
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp1, UrTy ())
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958907"><span class="annot"><span class="annottext">l1 :: Prog1
</span><a href="#local-6989586621680958907"><span class="hs-identifier hs-var hs-var">l1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prog1
</span><a href="#local-6989586621680958877"><span class="hs-identifier hs-var">prg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ddefs :: DDefs (TyOf Exp1)
</span><a href="Gibbon.Language.Syntax.html#ddefs"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp1)
DDefs (UrTy ())
</span><a href="#local-6989586621680958893"><span class="hs-identifier hs-var">iddefs</span></a></span><span>
</span><span id="line-121"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fundefs :: FunDefs Exp1
</span><a href="Gibbon.Language.Syntax.html#fundefs"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs Exp1
</span><a href="#local-6989586621680958901"><span class="hs-identifier hs-var">funs'</span></a></span><span>
</span><span id="line-122"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mainExp :: Maybe (Exp1, TyOf Exp1)
</span><a href="Gibbon.Language.Syntax.html#mainExp"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp1, TyOf Exp1)
Maybe (Exp1, UrTy ())
</span><a href="#local-6989586621680958903"><span class="hs-identifier hs-var">mainExp'</span></a></span><span>
</span><span id="line-123"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><span class="annottext">Prog1 -&gt; PassM Prog1
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Prog1
</span><a href="#local-6989586621680958907"><span class="hs-identifier hs-var">l1</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#addRANFun"><span class="hs-identifier hs-type">addRANFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-127"></span><span id="addRANFun"><span class="annot"><span class="annottext">addRANFun :: Set TyCon -&gt; DDefs (UrTy ()) -&gt; FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.AddRAN.html#addRANFun"><span class="hs-identifier hs-var hs-var">addRANFun</span></a></span></span><span> </span><span id="local-6989586621680958911"><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680958911"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span></span><span> </span><span id="local-6989586621680958912"><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680958912"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680958913"><span class="annot"><span class="annottext">fd :: FunDef1
</span><a href="#local-6989586621680958913"><span class="hs-identifier hs-var">fd</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680958915"><span class="annot"><span class="annottext">Var
funName :: Var
funName :: forall ex. FunDef ex -&gt; Var
</span><a href="#local-6989586621680958915"><span class="hs-identifier hs-var hs-var">funName</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958917"><span class="annot"><span class="annottext">Exp1
funBody :: Exp1
funBody :: forall ex. FunDef ex -&gt; ex
</span><a href="#local-6989586621680958917"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958919"><span class="annot"><span class="annottext">dont_change_datacons :: Bool
</span><a href="#local-6989586621680958919"><span class="hs-identifier hs-var hs-var">dont_change_datacons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isCopySansPtrsFunName"><span class="hs-identifier hs-var">isCopySansPtrsFunName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958915"><span class="hs-identifier hs-var">funName</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621680958921"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680958921"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set TyCon -&gt; DDefs (UrTy ()) -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.AddRAN.html#addRANExp"><span class="hs-identifier hs-var">addRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680958919"><span class="hs-identifier hs-var">dont_change_datacons</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680958911"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680958912"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680958917"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef1 -&gt; PassM FunDef1) -&gt; FunDef1 -&gt; PassM FunDef1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680958913"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680958921"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#addRANExp"><span class="hs-identifier hs-type">addRANExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-133"></span><span id="addRANExp"><span class="annot"><span class="annottext">addRANExp :: Bool -&gt; Set TyCon -&gt; DDefs (UrTy ()) -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.AddRAN.html#addRANExp"><span class="hs-identifier hs-var hs-var">addRANExp</span></a></span></span><span> </span><span id="local-6989586621680959015"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959015"><span class="hs-identifier hs-var">dont_change_datacons</span></a></span></span><span> </span><span id="local-6989586621680959016"><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959016"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span></span><span> </span><span id="local-6989586621680959017"><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680959018"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-comment">-- Update a data constructor to produce values with random access nodes.</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">-- N.B. It always uses absolute pointers for random access nodes. We</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- may not always want this. If we know that a region is BigInf, we should</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">-- use relative offsets as pointers. But that's not being done right now.</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680959020"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680959020"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680959021"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959021"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621680959022"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959022"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-140"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959015"><span class="hs-identifier hs-var">dont_change_datacons</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>        </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ()) -&gt; TyCon -&gt; Int
forall a. Out a =&gt; DDefs (UrTy a) -&gt; TyCon -&gt; Int
</span><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier hs-var">numRANsDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959021"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-145"></span><span>        </span><span id="local-6989586621680959023"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959023"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-146"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959024"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621680959024"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ()) -&gt; TyCon -&gt; TyCon
forall a. Out a =&gt; DDefs a -&gt; TyCon -&gt; TyCon
</span><a href="Gibbon.Language.Syntax.html#getTyOfDataCon"><span class="hs-identifier hs-var">getTyOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959021"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-147"></span><span>          </span><span class="hs-comment">-- Only add random access nodes to the data types that need it.</span><span>
</span><span id="line-148"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959024"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Set TyCon -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959016"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-150"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- n elements after the first packed one require RAN's.</span><span>
</span><span id="line-152"></span><span>              </span><span id="local-6989586621680959028"><span class="annot"><span class="annottext">needRANsExp :: [Exp1]
</span><a href="#local-6989586621680959028"><span class="hs-identifier hs-var hs-var">needRANsExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Exp1] -&gt; [Exp1]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#drop"><span class="hs-identifier hs-var">L.drop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959022"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959023"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959022"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>          </span><span id="local-6989586621680959031"><span class="annot"><span class="annottext">[(Var, [()], UrTy (), Exp1)]
</span><a href="#local-6989586621680959031"><span class="hs-identifier hs-var">rans</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; PassM [(Var, [()], UrTy (), Exp1)]
</span><a href="Gibbon.Passes.AddRAN.html#mkRANs"><span class="hs-identifier hs-var">mkRANs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959028"><span class="hs-identifier hs-var">needRANsExp</span></a></span><span>
</span><span id="line-155"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959033"><span class="annot"><span class="annottext">ranArgs :: [Exp1]
</span><a href="#local-6989586621680959033"><span class="hs-identifier hs-var hs-var">ranArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, [()], UrTy (), Exp1) -&gt; Exp1)
-&gt; [(Var, [()], UrTy (), Exp1)] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959034"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959034"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959034"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], UrTy (), Exp1)]
</span><a href="#local-6989586621680959031"><span class="hs-identifier hs-var">rans</span></a></span><span>
</span><span id="line-156"></span><span>          </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], UrTy (), Exp1)] -&gt; Exp1 -&gt; Exp1
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], UrTy (), Exp1)]
</span><a href="#local-6989586621680959031"><span class="hs-identifier hs-var">rans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TyCon -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; TyCon -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680959020"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TyCon
</span><a href="Gibbon.Language.Constants.html#toAbsRANDataCon"><span class="hs-identifier hs-var">toAbsRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959021"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959033"><span class="hs-identifier hs-var">ranArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959022"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">-- standard recursion here</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680959043"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959043"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680959044"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959044"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680959045"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959045"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959043"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959044"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; PassM [Exp1] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; [Exp1] -&gt; PassM [Exp1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959045"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680959048"><span class="annot"><span class="annottext">Prim (UrTy ())
</span><a href="#local-6989586621680959048"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680959049"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959049"><span class="hs-identifier hs-var">args</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ()) -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ())
</span><a href="#local-6989586621680959048"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; PassM [Exp1] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; [Exp1] -&gt; PassM [Exp1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959049"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959051"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959051"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959052"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959052"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959053"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959053"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959054"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959054"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959055"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959055"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>      </span><span class="annot"><span class="annottext">(Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">((Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1)
-&gt; (Exp1 -&gt; (Var, [()], UrTy (), Exp1)) -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959051"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959052"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959053"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1 -&gt; Exp1) -&gt; PassM Exp1 -&gt; PassM (Exp1 -&gt; Exp1)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959054"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp1 -&gt; Exp1) -&gt; PassM Exp1 -&gt; PassM Exp1
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959055"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680959057"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959057"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680959058"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959058"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680959059"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959059"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1)
-&gt; PassM Exp1 -&gt; PassM (Exp1 -&gt; Exp1 -&gt; Exp1)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959057"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp1 -&gt; Exp1 -&gt; Exp1) -&gt; PassM Exp1 -&gt; PassM (Exp1 -&gt; Exp1)
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959058"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp1 -&gt; Exp1) -&gt; PassM Exp1 -&gt; PassM Exp1
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959059"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680959061"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959061"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; PassM [Exp1] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; [Exp1] -&gt; PassM [Exp1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959061"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680959063"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959063"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680959064"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959064"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959063"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; PassM Exp1 -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959064"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680959066"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959066"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680959067"><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680959067"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(TyCon, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(TyCon, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959066"><span class="hs-identifier hs-var">scrt</span></a></span><span> </span><span class="annot"><span class="annottext">([(TyCon, [(Var, ())], Exp1)] -&gt; Exp1)
-&gt; ([[(TyCon, [(Var, ())], Exp1)]] -&gt; [(TyCon, [(Var, ())], Exp1)])
-&gt; [[(TyCon, [(Var, ())], Exp1)]]
-&gt; Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[[(TyCon, [(Var, ())], Exp1)]] -&gt; [(TyCon, [(Var, ())], Exp1)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[(TyCon, [(Var, ())], Exp1)]] -&gt; Exp1)
-&gt; PassM [[(TyCon, [(Var, ())], Exp1)]] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon, [(Var, ())], Exp1) -&gt; PassM [(TyCon, [(Var, ())], Exp1)])
-&gt; [(TyCon, [(Var, ())], Exp1)]
-&gt; PassM [[(TyCon, [(Var, ())], Exp1)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, [(Var, ())], Exp1) -&gt; PassM [(TyCon, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680959069"><span class="hs-identifier hs-var">doalt</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680959067"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680959071"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959071"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680959072"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959072"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680959073"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959073"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>      </span><span id="local-6989586621680959074"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959074"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959071"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; UrTy () -&gt; Bool -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959074"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959072"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959073"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680959076"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959076"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680959077"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959077"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>      </span><span id="local-6989586621680959078"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959078"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959077"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-var">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959076"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959078"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span id="local-6989586621680959080"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959080"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680959081"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959081"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680959082"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959082"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-var">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959080"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959081"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; PassM [Exp1] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; [Exp1] -&gt; PassM [Exp1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959082"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">Exp1
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">E1Ext () (UrTy ())
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959018"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; PassM Exp1
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;addRANExp: TODO MapE&quot;</span></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; PassM Exp1
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;addRANExp: TODO FoldE&quot;</span></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621680959046"><span class="annot"><span class="annottext">go :: Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680959046"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set TyCon -&gt; DDefs (UrTy ()) -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.AddRAN.html#addRANExp"><span class="hs-identifier hs-var">addRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959015"><span class="hs-identifier hs-var">dont_change_datacons</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959016"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="#local-6989586621680959088"><span class="hs-identifier hs-type">changeSpawnToApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621680959088"><span class="annot"><span class="annottext">changeSpawnToApp :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var hs-var">changeSpawnToApp</span></a></span></span><span> </span><span id="local-6989586621680959089"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959089"><span class="hs-identifier hs-var">ex1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959089"><span class="hs-identifier hs-var">ex1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959089"><span class="hs-identifier hs-var">ex1</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959089"><span class="hs-identifier hs-var">ex1</span></a></span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959089"><span class="hs-identifier hs-var">ex1</span></a></span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959089"><span class="hs-identifier hs-var">ex1</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959089"><span class="hs-identifier hs-var">ex1</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680959090"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959090"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680959091"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959091"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680959092"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959092"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959090"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959091"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; [Exp1] -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959092"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680959093"><span class="annot"><span class="annottext">Prim (UrTy ())
</span><a href="#local-6989586621680959093"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680959094"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959094"><span class="hs-identifier hs-var">args</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ()) -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ())
</span><a href="#local-6989586621680959093"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; [Exp1] -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959094"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp1
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959095"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959095"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959095"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959096"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959096"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959097"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959097"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959098"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959098"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959099"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959099"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959100"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959100"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>          </span><span class="annot"><span class="annottext">(Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959096"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959097"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959098"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959099"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959100"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680959101"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959101"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680959102"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959102"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680959103"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959103"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959101"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959102"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959103"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680959104"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959104"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; [Exp1] -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959104"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680959105"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959105"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680959106"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959106"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959105"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959106"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680959107"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680959107"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680959108"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959108"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621680959109"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959109"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TyCon -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; TyCon -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680959107"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959108"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; [Exp1] -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959109"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680959110"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959110"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680959111"><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680959111"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-205"></span><span>          </span><span class="annot"><span class="annottext">Exp1 -&gt; [(TyCon, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(TyCon, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959110"><span class="hs-identifier hs-var">scrt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(TyCon, [(Var, ())], Exp1)] -&gt; Exp1)
-&gt; [(TyCon, [(Var, ())], Exp1)] -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon, [(Var, ())], Exp1) -&gt; (TyCon, [(Var, ())], Exp1))
-&gt; [(TyCon, [(Var, ())], Exp1)] -&gt; [(TyCon, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959112"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959112"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959113"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680959113"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959114"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959114"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959112"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680959113"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959114"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680959111"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680959115"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959115"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680959116"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959116"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680959117"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959117"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; UrTy () -&gt; Bool -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959115"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959116"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959117"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680959118"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959118"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680959119"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959119"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-var">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959118"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959119"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span id="local-6989586621680959120"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959120"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680959121"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959121"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680959122"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959122"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959120"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680959121"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; [Exp1] -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959122"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><span class="annottext">Exp1
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959089"><span class="hs-identifier hs-var">ex1</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Exp1
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;addRANExp: TODO MapE&quot;</span></span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Exp1
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;addRANExp: TODO FoldE&quot;</span></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><a href="#local-6989586621680959069"><span class="hs-identifier hs-type">doalt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621680959069"><span class="annot"><span class="annottext">doalt :: (TyCon, [(Var, ())], Exp1) -&gt; PassM [(TyCon, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680959069"><span class="hs-identifier hs-var hs-var">doalt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959124"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959124"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959125"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680959125"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959126"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959126"><span class="hs-identifier hs-var">bod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-comment">-- Always process the body, because it might have another case expression.</span><span>
</span><span id="line-217"></span><span>      </span><span id="local-6989586621680959127"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959127"><span class="hs-identifier hs-var">bod0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set TyCon -&gt; DDefs (UrTy ()) -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.AddRAN.html#addRANExp"><span class="hs-identifier hs-var">addRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959015"><span class="hs-identifier hs-var">dont_change_datacons</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959016"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959088"><span class="hs-identifier hs-var">changeSpawnToApp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959126"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959128"><span class="annot"><span class="annottext">old_pat :: (TyCon, [(Var, ())], Exp1)
</span><a href="#local-6989586621680959128"><span class="hs-identifier hs-var hs-var">old_pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959124"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680959125"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959127"><span class="hs-identifier hs-var">bod0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ()) -&gt; TyCon -&gt; Int
forall a. Out a =&gt; DDefs (UrTy a) -&gt; TyCon -&gt; Int
</span><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier hs-var">numRANsDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959124"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-220"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)] -&gt; PassM [(TyCon, [(Var, ())], Exp1)]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(TyCon, [(Var, ())], Exp1)
</span><a href="#local-6989586621680959128"><span class="hs-identifier hs-var">old_pat</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span>        </span><span id="local-6989586621680959129"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959129"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959130"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621680959130"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ()) -&gt; TyCon -&gt; TyCon
forall a. Out a =&gt; DDefs a -&gt; TyCon -&gt; TyCon
</span><a href="Gibbon.Language.Syntax.html#getTyOfDataCon"><span class="hs-identifier hs-var">getTyOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959124"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-223"></span><span>          </span><span class="hs-comment">-- Not all types have random access nodes.</span><span>
</span><span id="line-224"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959130"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Set TyCon -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959016"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)] -&gt; PassM [(TyCon, [(Var, ())], Exp1)]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(TyCon, [(Var, ())], Exp1)
</span><a href="#local-6989586621680959128"><span class="hs-identifier hs-var">old_pat</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>            </span><span id="local-6989586621680959131"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959131"><span class="hs-identifier hs-var">absRanVars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PassM Var) -&gt; [Int] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;absran&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959129"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>            </span><span id="local-6989586621680959133"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959133"><span class="hs-identifier hs-var">sizeVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;size&quot;</span></span><span>
</span><span id="line-229"></span><span>            </span><span id="local-6989586621680959134"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959134"><span class="hs-identifier hs-var">relRanVars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PassM Var) -&gt; [Int] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;relran&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959129"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959135"><span class="annot"><span class="annottext">relRanVars' :: [Var]
</span><a href="#local-6989586621680959135"><span class="hs-identifier hs-var hs-var">relRanVars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959133"><span class="hs-identifier hs-var">sizeVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Var]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959134"><span class="hs-identifier hs-var">relRanVars</span></a></span><span>
</span><span id="line-231"></span><span>            </span><span id="local-6989586621680959136"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959136"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set TyCon -&gt; DDefs (UrTy ()) -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.AddRAN.html#addRANExp"><span class="hs-identifier hs-var">addRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959015"><span class="hs-identifier hs-var">dont_change_datacons</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959016"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959126"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-232"></span><span>            </span><span id="local-6989586621680959137"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959137"><span class="hs-identifier hs-var">bod''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set TyCon -&gt; DDefs (UrTy ()) -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.AddRAN.html#addRANExp"><span class="hs-identifier hs-var">addRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680959015"><span class="hs-identifier hs-var">dont_change_datacons</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959016"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959017"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959126"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-233"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959138"><span class="annot"><span class="annottext">abs_ran_clause :: (TyCon, [(Var, ())], Exp1)
</span><a href="#local-6989586621680959138"><span class="hs-identifier hs-var hs-var">abs_ran_clause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TyCon
</span><a href="Gibbon.Language.Constants.html#toAbsRANDataCon"><span class="hs-identifier hs-var">toAbsRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959124"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; (Var, ())) -&gt; [Var] -&gt; [(Var, ())]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959131"><span class="hs-identifier hs-var">absRanVars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, ())] -&gt; [(Var, ())] -&gt; [(Var, ())]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680959125"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959136"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959139"><span class="annot"><span class="annottext">_rel_ran_clause :: (TyCon, [(Var, ())], Exp1)
</span><a href="#local-6989586621680959139"><span class="hs-identifier hs-var hs-var">_rel_ran_clause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TyCon
</span><a href="Gibbon.Language.Constants.html#toRelRANDataCon"><span class="hs-identifier hs-var">toRelRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959124"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; (Var, ())) -&gt; [Var] -&gt; [(Var, ())]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959135"><span class="hs-identifier hs-var">relRanVars'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, ())] -&gt; [(Var, ())] -&gt; [(Var, ())]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680959125"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959137"><span class="hs-identifier hs-var">bod''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>            </span><span class="hs-comment">{- dflags &lt;- getDynFlags
            if gopt Opt_RelativeOffsets dflags
              then pure [abs_ran_clause,rel_ran_clause]
              else pure [abs_ran_clause] -}</span><span>
</span><span id="line-239"></span><span>            </span><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)] -&gt; PassM [(TyCon, [(Var, ())], Exp1)]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(TyCon, [(Var, ())], Exp1)
</span><a href="#local-6989586621680959138"><span class="hs-identifier hs-var">abs_ran_clause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="annot"><span class="hs-comment">-- | Update data type definitions to include random access nodes.</span></span><span>
</span><span id="line-242"></span><span id="local-6989586621680958679"><span class="annot"><a href="Gibbon.Passes.AddRAN.html#withRANDDefs"><span class="hs-identifier hs-type">withRANDDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-type">Out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958679"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958679"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958679"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-243"></span><span id="withRANDDefs"><span class="annot"><span class="annottext">withRANDDefs :: forall a. Out a =&gt; Set TyCon -&gt; DDefs (UrTy a) -&gt; DDefs (UrTy a)
</span><a href="Gibbon.Passes.AddRAN.html#withRANDDefs"><span class="hs-identifier hs-var hs-var">withRANDDefs</span></a></span></span><span> </span><span id="local-6989586621680959153"><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959153"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span></span><span> </span><span id="local-6989586621680959154"><span class="annot"><span class="annottext">DDefs (UrTy a)
</span><a href="#local-6989586621680959154"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DDef (UrTy a) -&gt; DDef (UrTy a))
-&gt; DDefs (UrTy a) -&gt; DDefs (UrTy a)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="annot"><span class="annottext">DDef (UrTy a) -&gt; DDef (UrTy a)
</span><a href="#local-6989586621680959156"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy a)
</span><a href="#local-6989586621680959154"><span class="hs-identifier hs-var">ddfs</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-comment">-- go :: DDef a -&gt; DDef b</span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621680959156"><span class="annot"><span class="annottext">go :: DDef (UrTy a) -&gt; DDef (UrTy a)
</span><a href="#local-6989586621680959156"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680959157"><span class="annot"><span class="annottext">dd :: DDef (UrTy a)
</span><a href="#local-6989586621680959157"><span class="hs-identifier hs-var">dd</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDef"><span class="hs-identifier hs-type">DDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680959159"><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
dataCons :: [(TyCon, [(Bool, UrTy a)])]
dataCons :: forall a. DDef a -&gt; [(TyCon, [(Bool, a)])]
</span><a href="#local-6989586621680959159"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959161"><span class="annot"><span class="annottext">dcons' :: [(TyCon, [(Bool, UrTy a)])]
</span><a href="#local-6989586621680959161"><span class="hs-identifier hs-var hs-var">dcons'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TyCon, [(Bool, UrTy a)])
 -&gt; [(TyCon, [(Bool, UrTy a)])] -&gt; [(TyCon, [(Bool, UrTy a)])])
-&gt; [(TyCon, [(Bool, UrTy a)])]
-&gt; [(TyCon, [(Bool, UrTy a)])]
-&gt; [(TyCon, [(Bool, UrTy a)])]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959163"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959163"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959164"><span class="annot"><span class="annottext">[(Bool, UrTy a)]
</span><a href="#local-6989586621680959164"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959165"><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
</span><a href="#local-6989586621680959165"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>                              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy a) -&gt; TyCon -&gt; Int
forall a. Out a =&gt; DDefs (UrTy a) -&gt; TyCon -&gt; Int
</span><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier hs-var">numRANsDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy a)
</span><a href="#local-6989586621680959154"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959163"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-249"></span><span>                                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
</span><a href="#local-6989586621680959165"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-250"></span><span>                                </span><span id="local-6989586621680959166"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959166"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Not all types have random access nodes.</span><span>
</span><span id="line-251"></span><span>                                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs (UrTy a) -&gt; TyCon -&gt; TyCon
forall a. Out a =&gt; DDefs a -&gt; TyCon -&gt; TyCon
</span><a href="Gibbon.Language.Syntax.html#getTyOfDataCon"><span class="hs-identifier hs-var">getTyOfDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy a)
</span><a href="#local-6989586621680959154"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959163"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Set TyCon -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959153"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>                                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
</span><a href="#local-6989586621680959165"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-253"></span><span>                                     </span><span class="hs-keyword">else</span><span>
</span><span id="line-254"></span><span>                                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959167"><span class="annot"><span class="annottext">tys' :: [(Bool, UrTy a)]
</span><a href="#local-6989586621680959167"><span class="hs-identifier hs-var hs-var">tys'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy a
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959166"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Bool, UrTy a)] -&gt; [(Bool, UrTy a)] -&gt; [(Bool, UrTy a)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, UrTy a)]
</span><a href="#local-6989586621680959164"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-255"></span><span>                                           </span><span id="local-6989586621680959169"><span class="annot"><span class="annottext">dcon' :: TyCon
</span><a href="#local-6989586621680959169"><span class="hs-identifier hs-var hs-var">dcon'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon
</span><a href="Gibbon.Language.Constants.html#toAbsRANDataCon"><span class="hs-identifier hs-var">toAbsRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959163"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>                                           </span><span id="local-6989586621680959170"><span class="annot"><span class="annottext">_tys'' :: [(Bool, UrTy a)]
</span><a href="#local-6989586621680959170"><span class="hs-identifier hs-var hs-var">_tys''</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy a
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool, UrTy a) -&gt; [(Bool, UrTy a)] -&gt; [(Bool, UrTy a)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy a
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959166"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Bool, UrTy a)] -&gt; [(Bool, UrTy a)] -&gt; [(Bool, UrTy a)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, UrTy a)]
</span><a href="#local-6989586621680959164"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-258"></span><span>                                           </span><span class="hs-comment">-- dcon'' = toRelRANDataCon dcon</span><span>
</span><span id="line-259"></span><span>                                       </span><span class="hs-comment">-- in [(dcon',tys'),(dcon'',tys'')] ++ acc)</span><span>
</span><span id="line-260"></span><span>                                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959169"><span class="hs-identifier hs-var">dcon'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Bool, UrTy a)]
</span><a href="#local-6989586621680959167"><span class="hs-identifier hs-var">tys'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
-&gt; [(TyCon, [(Bool, UrTy a)])] -&gt; [(TyCon, [(Bool, UrTy a)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
</span><a href="#local-6989586621680959165"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>                   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
</span><a href="#local-6989586621680959159"><span class="hs-identifier hs-var">dataCons</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-comment">-- Add the new constructors after all the existing constructors.</span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-comment">-- The order of constructors matters when these become numeric tags after codegen.</span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-comment">-- Adding new ones after all the old ones ensures that files that were</span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-comment">-- serialized using a datatype before continue to work even after this datatype</span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-comment">-- is updated to have random access capabilities.</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">DDef (UrTy a)
</span><a href="#local-6989586621680959157"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dataCons :: [(TyCon, [(Bool, UrTy a)])]
</span><a href="Gibbon.Language.Syntax.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
</span><a href="#local-6989586621680959159"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
-&gt; [(TyCon, [(Bool, UrTy a)])] -&gt; [(TyCon, [(Bool, UrTy a)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy a)])]
</span><a href="#local-6989586621680959161"><span class="hs-identifier hs-var">dcons'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-comment">-- | The number of nodes needed by a 'DataCon' for full random access</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- (which is equal the number of arguments occurring after the first packed type).</span><span>
</span><span id="line-272"></span><span class="hs-comment">--</span><span>
</span><span id="line-273"></span><span id="local-6989586621680958700"><span class="annot"><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier hs-type">numRANsDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/GenericPretty-1.2.2-7277c36a966d41cd8e1371a7ee4c855b29a76e94dfe1d95510f68242766a5b82/share/doc/html/src/Text.PrettyPrint.GenericPretty.html#Out"><span class="hs-identifier hs-type">Out</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958700"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#UrTy"><span class="hs-identifier hs-type">UrTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958700"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span></span><span>
</span><span id="line-274"></span><span id="numRANsDataCon"><span class="annot"><span class="annottext">numRANsDataCon :: forall a. Out a =&gt; DDefs (UrTy a) -&gt; TyCon -&gt; Int
</span><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier hs-var hs-var">numRANsDataCon</span></a></span></span><span> </span><span id="local-6989586621680959178"><span class="annot"><span class="annottext">DDefs (UrTy a)
</span><a href="#local-6989586621680959178"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span id="local-6989586621680959179"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959179"><span class="hs-identifier hs-var">dcon</span></a></span></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isAbsRANDataCon"><span class="hs-identifier hs-var">isAbsRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959179"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRelRANDataCon"><span class="hs-identifier hs-var">isRelRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959179"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(UrTy a -&gt; Bool) -&gt; [UrTy a] -&gt; Maybe Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#findIndex"><span class="hs-identifier hs-var">L.findIndex</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680959185"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-278"></span><span>      </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680959186"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959186"><span class="hs-identifier hs-var">firstPacked</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy a] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680959185"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959186"><span class="hs-identifier hs-var">firstPacked</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680959185"><span class="annot"><span class="annottext">tys :: [UrTy a]
</span><a href="#local-6989586621680959185"><span class="hs-identifier hs-var hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy a) -&gt; TyCon -&gt; [UrTy a]
forall a. Out a =&gt; DDefs a -&gt; TyCon -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy a)
</span><a href="#local-6989586621680959178"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959179"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">{-

Given a list of expressions, generate random access nodes for them.
Consider this constructor:

    (B (x : Foo) (y : Int) (z : Foo) ...)

We need two random access nodes here, for y and z.
The RAN for y is the start cursor of y, so we use StartOf as a
placeholder here and have Cursorize replace it with the appropriate cursor.
The RAN for z is (starting address of y + 8). Or, (ran_y + 8). We use
AddFixed for this purpose.

'mb_most_recent_ran' in the fold below tracks most recent random access nodes.

-}</span><span>
</span><span id="line-298"></span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#mkRANs"><span class="hs-identifier hs-type">mkRANs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span id="mkRANs"><span class="annot"><span class="annottext">mkRANs :: [Exp1] -&gt; PassM [(Var, [()], UrTy (), Exp1)]
</span><a href="Gibbon.Passes.AddRAN.html#mkRANs"><span class="hs-identifier hs-var hs-var">mkRANs</span></a></span></span><span> </span><span id="local-6989586621680959217"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959217"><span class="hs-identifier hs-var">needRANsExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><span class="annottext">(Maybe Var, [(Var, [()], UrTy (), Exp1)])
-&gt; [(Var, [()], UrTy (), Exp1)]
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Var, [(Var, [()], UrTy (), Exp1)])
 -&gt; [(Var, [()], UrTy (), Exp1)])
-&gt; PassM (Maybe Var, [(Var, [()], UrTy (), Exp1)])
-&gt; PassM [(Var, [()], UrTy (), Exp1)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Var, [(Var, [()], UrTy (), Exp1)])
 -&gt; Exp1 -&gt; PassM (Maybe Var, [(Var, [()], UrTy (), Exp1)]))
-&gt; (Maybe Var, [(Var, [()], UrTy (), Exp1)])
-&gt; [Exp1]
-&gt; PassM (Maybe Var, [(Var, [()], UrTy (), Exp1)])
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959220"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680959220"><span class="hs-identifier hs-var">mb_most_recent_ran</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680959221"><span class="annot"><span class="annottext">[(Var, [()], UrTy (), Exp1)]
</span><a href="#local-6989586621680959221"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959222"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959222"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>          </span><span id="local-6989586621680959223"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959223"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;ran&quot;</span></span><span>
</span><span id="line-302"></span><span>          </span><span class="hs-comment">-- See Note [Reusing RAN's in case expressions]</span><span>
</span><span id="line-303"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959224"><span class="annot"><span class="annottext">rhs :: Exp1
</span><a href="#local-6989586621680959224"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959222"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-304"></span><span>                      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680959225"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959225"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E1Ext () (UrTy ()) -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; E1Ext () (UrTy ())
forall loc dec. Var -&gt; E1Ext loc dec
</span><a href="Gibbon.L1.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-var">L1.StartOfPkdCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959225"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>                      </span><span class="hs-comment">-- It's safe to use 'fromJust' here b/c we would only</span><span>
</span><span id="line-306"></span><span>                      </span><span class="hs-comment">-- request a RAN for a literal iff it occurs after a</span><span>
</span><span id="line-307"></span><span>                      </span><span class="hs-comment">-- packed datatype. So there has to be random access</span><span>
</span><span id="line-308"></span><span>                      </span><span class="hs-comment">-- node that's generated before this.</span><span>
</span><span id="line-309"></span><span>                      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E1Ext () (UrTy ()) -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Int -&gt; E1Ext () (UrTy ())
forall loc dec. Var -&gt; Int -&gt; E1Ext loc dec
</span><a href="Gibbon.L1.Syntax.html#AddFixed"><span class="hs-identifier hs-var">L1.AddFixed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var -&gt; Var
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680959220"><span class="hs-identifier hs-var">mb_most_recent_ran</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Any -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>                      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E1Ext () (UrTy ()) -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Int -&gt; E1Ext () (UrTy ())
forall loc dec. Var -&gt; Int -&gt; E1Ext loc dec
</span><a href="Gibbon.L1.Syntax.html#AddFixed"><span class="hs-identifier hs-var">L1.AddFixed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var -&gt; Var
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680959220"><span class="hs-identifier hs-var">mb_most_recent_ran</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Any -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#FloatTy"><span class="hs-identifier hs-var">FloatTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>                      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E1Ext () (UrTy ()) -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Int -&gt; E1Ext () (UrTy ())
forall loc dec. Var -&gt; Int -&gt; E1Ext loc dec
</span><a href="Gibbon.L1.Syntax.html#AddFixed"><span class="hs-identifier hs-var">L1.AddFixed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var -&gt; Var
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680959220"><span class="hs-identifier hs-var">mb_most_recent_ran</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Any -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#SymTy"><span class="hs-identifier hs-var">SymTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>                      </span><span id="local-6989586621680959231"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959231"><span class="hs-identifier hs-var">oth</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Exp1
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Exp1) -&gt; TyCon -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;addRANExp: Expected trivial expression, got: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; TyCon
forall a. Out a =&gt; a -&gt; TyCon
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959231"><span class="hs-identifier hs-var">oth</span></a></span><span>
</span><span id="line-313"></span><span>          </span><span class="annot"><span class="annottext">(Maybe Var, [(Var, [()], UrTy (), Exp1)])
-&gt; PassM (Maybe Var, [(Var, [()], UrTy (), Exp1)])
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Maybe Var
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959223"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, [()], UrTy (), Exp1)]
</span><a href="#local-6989586621680959221"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [()], UrTy (), Exp1)]
-&gt; [(Var, [()], UrTy (), Exp1)] -&gt; [(Var, [()], UrTy (), Exp1)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959223"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959224"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680959217"><span class="hs-identifier hs-var">needRANsExp</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="hs-comment">-- See Note [When does a type needsLRAN]</span><span>
</span><span id="line-319"></span><span class="annot"><span class="hs-comment">-- | Collect all types that need random access nodes to be compiled.</span></span><span>
</span><span id="line-320"></span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#needsRAN"><span class="hs-identifier hs-type">needsRAN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-321"></span><span id="needsRAN"><span class="annot"><span class="annottext">needsRAN :: Prog2 -&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRAN"><span class="hs-identifier hs-var hs-var">needsRAN</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680959242"><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
ddefs :: forall ex. Prog ex -&gt; DDefs (TyOf ex)
ddefs :: DDefs (TyOf Exp2)
</span><a href="Gibbon.Language.Syntax.html#ddefs"><span class="hs-identifier hs-var hs-var">ddefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959243"><span class="annot"><span class="annottext">FunDefs Exp2
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
fundefs :: FunDefs Exp2
</span><a href="Gibbon.Language.Syntax.html#fundefs"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959244"><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
mainExp :: forall ex. Prog ex -&gt; Maybe (ex, TyOf ex)
mainExp :: Maybe (Exp2, TyOf Exp2)
</span><a href="Gibbon.Language.Syntax.html#mainExp"><span class="hs-identifier hs-var hs-var">mainExp</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959245"><span class="annot"><span class="annottext">funenv :: TyEnv (ArrowTy (TyOf Exp2))
</span><a href="#local-6989586621680959245"><span class="hs-identifier hs-var hs-var">funenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; TyEnv (ArrowTy (TyOf Exp2))
forall a. FunDefs a -&gt; TyEnv (ArrowTy (TyOf a))
</span><a href="Gibbon.Language.Syntax.html#initFunEnv"><span class="hs-identifier hs-var">initFunEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959243"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>      </span><span id="local-6989586621680959247"><span class="annot"><span class="annottext">dofun :: FunDef Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959247"><span class="hs-identifier hs-var hs-var">dofun</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680959248"><span class="annot"><span class="annottext">[Var]
funArgs :: [Var]
funArgs :: forall ex. FunDef ex -&gt; [Var]
</span><a href="#local-6989586621680959248"><span class="hs-identifier hs-var hs-var">funArgs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959250"><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
funTy :: ArrowTy (TyOf Exp2)
funTy :: forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="#local-6989586621680959250"><span class="hs-identifier hs-var hs-var">funTy</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959252"><span class="annot"><span class="annottext">Exp2
funBody :: forall ex. FunDef ex -&gt; ex
funBody :: Exp2
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959253"><span class="annot"><span class="annottext">inlocs :: [Var]
</span><a href="#local-6989586621680959253"><span class="hs-identifier hs-var hs-var">inlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#inLocVars"><span class="hs-identifier hs-var">inLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959250"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-326"></span><span>            </span><span id="local-6989586621680959255"><span class="annot"><span class="annottext">eff :: Set Effect
</span><a href="#local-6989586621680959255"><span class="hs-identifier hs-var hs-var">eff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; Set Effect
forall ty2. ArrowTy2 ty2 -&gt; Set Effect
</span><a href="Gibbon.L2.Syntax.html#arrEffs"><span class="hs-identifier hs-var">arrEffs</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959250"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959253"><span class="hs-identifier hs-var">inlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`S.difference`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Effect -&gt; Var) -&gt; Set Effect -&gt; Set Var
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#map"><span class="hs-identifier hs-var">S.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Traverse"><span class="hs-identifier hs-type">Traverse</span></a></span><span> </span><span id="local-6989586621680959262"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959262"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959262"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Effect
</span><a href="#local-6989586621680959255"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; Bool
forall ty2. ArrowTy2 ty2 -&gt; Bool
</span><a href="Gibbon.L2.Syntax.html#hasParallelism"><span class="hs-identifier hs-var">hasParallelism</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959250"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-329"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959266"><span class="annot"><span class="annottext">tyenv :: Map Var Ty2
</span><a href="#local-6989586621680959266"><span class="hs-identifier hs-var hs-var">tyenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; Map Var Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; Map Var Ty2) -&gt; [(Var, Ty2)] -&gt; Map Var Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959248"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy Ty2 -&gt; [Ty2]
forall ty. FunctionTy ty =&gt; ArrowTy ty -&gt; [ty]
</span><a href="Gibbon.Language.Syntax.html#inTys"><span class="hs-identifier hs-var">inTys</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy Ty2
</span><a href="#local-6989586621680959250"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>                      </span><span id="local-6989586621680959268"><span class="annot"><span class="annottext">env2 :: Env2 Ty2
</span><a href="#local-6989586621680959268"><span class="hs-identifier hs-var hs-var">env2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Ty2
</span><a href="#local-6989586621680959266"><span class="hs-identifier hs-var">tyenv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy (TyOf Exp2))
TyEnv (ArrowTy Ty2)
</span><a href="#local-6989586621680959245"><span class="hs-identifier hs-var">funenv</span></a></span><span>
</span><span id="line-331"></span><span>                      </span><span id="local-6989586621680959270"><span class="annot"><span class="annottext">renv :: Map Var Var
</span><a href="#local-6989586621680959270"><span class="hs-identifier hs-var hs-var">renv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; Map Var Var
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Var)] -&gt; Map Var Var) -&gt; [(Var, Var)] -&gt; Map Var Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; (Var, Var)) -&gt; [LRM] -&gt; [(Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680959271"><span class="annot"><span class="annottext">LRM
</span><a href="#local-6989586621680959271"><span class="hs-identifier hs-var">lrm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LRM -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#lrmLoc"><span class="hs-identifier hs-var">lrmLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LRM
</span><a href="#local-6989586621680959271"><span class="hs-identifier hs-var">lrm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LRM -&gt; Region
</span><a href="Gibbon.L2.Syntax.html#lrmReg"><span class="hs-identifier hs-var">lrmReg</span></a></span><span> </span><span class="annot"><span class="annottext">LRM
</span><a href="#local-6989586621680959271"><span class="hs-identifier hs-var">lrm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680959250"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var">needsRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680959242"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959243"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959268"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959270"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959252"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>      </span><span id="local-6989586621680959278"><span class="annot"><span class="annottext">funs :: Set TyCon
</span><a href="#local-6989586621680959278"><span class="hs-identifier hs-var hs-var">funs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDef Exp2 -&gt; Set TyCon -&gt; Set TyCon)
-&gt; Set TyCon -&gt; FunDefs Exp2 -&gt; Set TyCon
forall a b k. (a -&gt; b -&gt; b) -&gt; b -&gt; Map k a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldr"><span class="hs-identifier hs-var">M.foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680959280"><span class="annot"><span class="annottext">FunDef Exp2
</span><a href="#local-6989586621680959280"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680959281"><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959281"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959281"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon -&gt; Set TyCon -&gt; Set TyCon
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959247"><span class="hs-identifier hs-var">dofun</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef Exp2
</span><a href="#local-6989586621680959280"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959243"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>      </span><span id="local-6989586621680959283"><span class="annot"><span class="annottext">mn :: Set TyCon
</span><a href="#local-6989586621680959283"><span class="hs-identifier hs-var hs-var">mn</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="#local-6989586621680959244"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-337"></span><span>               </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-338"></span><span>               </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959284"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959284"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959285"><span class="annot"><span class="annottext">TyOf Exp2
</span><a href="#local-6989586621680959285"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959286"><span class="annot"><span class="annottext">env2 :: Env2 Ty2
</span><a href="#local-6989586621680959286"><span class="hs-identifier hs-var hs-var">env2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Ty2
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy (TyOf Exp2))
TyEnv (ArrowTy Ty2)
</span><a href="#local-6989586621680959245"><span class="hs-identifier hs-var">funenv</span></a></span><span>
</span><span id="line-339"></span><span>                               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var">needsRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680959242"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959243"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959286"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959284"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set TyCon -&gt; Set TyCon -&gt; Set TyCon
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959278"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959283"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-comment">-- Maps a location to a region</span><span>
</span><span id="line-343"></span><span class="hs-keyword">type</span><span> </span><span id="RegEnv"><span class="annot"><a href="Gibbon.Passes.AddRAN.html#RegEnv"><span class="hs-identifier hs-var">RegEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-344"></span><span class="hs-keyword">type</span><span> </span><span id="TyConEnv"><span class="annot"><a href="Gibbon.Passes.AddRAN.html#TyConEnv"><span class="hs-identifier hs-var">TyConEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-type">needsRANExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#RegEnv"><span class="hs-identifier hs-type">RegEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#TyConEnv"><span class="hs-identifier hs-type">TyConEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-347"></span><span id="needsRANExp"><span class="annot"><span class="annottext">needsRANExp :: DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var hs-var">needsRANExp</span></a></span></span><span> </span><span id="local-6989586621680959381"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680959382"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959382"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680959383"><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span></span><span> </span><span id="local-6989586621680959384"><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span></span><span> </span><span id="local-6989586621680959385"><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959385"><span class="hs-identifier hs-var">tcenv</span></a></span></span><span> </span><span id="local-6989586621680959386"><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959386"><span class="hs-identifier hs-var">parlocss</span></a></span></span><span> </span><span id="local-6989586621680959387"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959387"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959387"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680959388"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959388"><span class="hs-identifier hs-var">scrt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959389"><span class="annot"><span class="annottext">[(TyCon, [(Var, Var)], Exp2)]
</span><a href="#local-6989586621680959389"><span class="hs-identifier hs-var">brs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680959391"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959391"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680959392"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959392"><span class="hs-identifier hs-var">tyloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Env2 Ty2 -&gt; Ty2
forall a. Out a =&gt; Var -&gt; Env2 a -&gt; a
</span><a href="Gibbon.Language.Syntax.html#lookupVEnv"><span class="hs-identifier hs-var">lookupVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959388"><span class="hs-identifier hs-var">scrt</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-350"></span><span>                                 </span><span id="local-6989586621680959394"><span class="annot"><span class="annottext">reg :: Var
</span><a href="#local-6989586621680959394"><span class="hs-identifier hs-var hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959392"><span class="hs-identifier hs-var">tyloc</span></a></span><span>
</span><span id="line-351"></span><span>                             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Set TyCon] -&gt; Set TyCon
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="annot"><span class="annottext">([Set TyCon] -&gt; Set TyCon) -&gt; [Set TyCon] -&gt; Set TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon, [(Var, Var)], Exp2) -&gt; Set TyCon)
-&gt; [(TyCon, [(Var, Var)], Exp2)] -&gt; [Set TyCon]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
-&gt; Var
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; (TyCon, [(Var, Var)], Exp2)
-&gt; Set TyCon
</span><a href="#local-6989586621680959397"><span class="hs-identifier hs-var">doalt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959391"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959394"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959385"><span class="hs-identifier hs-var">tcenv</span></a></span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959386"><span class="hs-identifier hs-var">parlocss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, Var)], Exp2)]
</span><a href="#local-6989586621680959389"><span class="hs-identifier hs-var">brs</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680959398"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959398"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, Var)], Exp2)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Set TyCon
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Set TyCon) -&gt; TyCon -&gt; Set TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;needsRANExp: Scrutinee is not flat &quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; TyCon
forall a. Out a =&gt; a -&gt; TyCon
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959398"><span class="hs-identifier hs-var">scrt</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-comment">-- Standard recursion here (ASSUMPTION: everything is flat)</span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-comment">-- We do not process the function body here, assuming that the main analysis does it.</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="hs-comment">{-

If we have an expression:

    case blah of
      C x y z -&gt;
        a = spawn (foo x)
        b = spawn (foo y)
        c = spawn (foo z)
        sync
        ...

we need to be able to access x, y and z in parallel, and thus need random access
for the type 'blah'. To spot these cases, we look at the regions in which
x, y and z live. In this case expression, they would all be in 1 single region.
So we say that if there are any region that is shared among the things in 'par',
we need random access for that type.

-}</span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959399"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959399"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680959400"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680959400"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959401"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680959401"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959402"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959402"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-385"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959403"><span class="annot"><span class="annottext">mp :: TyConEnv
</span><a href="#local-6989586621680959403"><span class="hs-identifier hs-var hs-var">mp</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; Exp2 -&gt; TyConEnv
</span><a href="#local-6989586621680959404"><span class="hs-identifier hs-var">parAppLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959401"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-386"></span><span>          </span><span id="local-6989586621680959405"><span class="annot"><span class="annottext">locs :: [Var]
</span><a href="#local-6989586621680959405"><span class="hs-identifier hs-var hs-var">locs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyConEnv -&gt; [Var]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">M.keys</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959403"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-387"></span><span>          </span><span id="local-6989586621680959407"><span class="annot"><span class="annottext">parlocss' :: [[Var]]
</span><a href="#local-6989586621680959407"><span class="hs-identifier hs-var hs-var">parlocss'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959405"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [[Var]] -&gt; [[Var]]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959386"><span class="hs-identifier hs-var">parlocss</span></a></span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var">needsRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959382"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959399"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680959400"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959403"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv -&gt; TyConEnv -&gt; TyConEnv
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-operator hs-var">`M.union`</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959385"><span class="hs-identifier hs-var">tcenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959407"><span class="hs-identifier hs-var">parlocss'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959402"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959410"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959410"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680959411"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680959411"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959412"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959412"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-391"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959413"><span class="annot"><span class="annottext">s_bod :: Set TyCon
</span><a href="#local-6989586621680959413"><span class="hs-identifier hs-var hs-var">s_bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var">needsRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959382"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959410"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680959411"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959385"><span class="hs-identifier hs-var">tcenv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959412"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-392"></span><span>          </span><span id="local-6989586621680959414"><span class="annot"><span class="annottext">regss :: [[Var]]
</span><a href="#local-6989586621680959414"><span class="hs-identifier hs-var hs-var">regss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; [[Var]] -&gt; [[Var]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959386"><span class="hs-identifier hs-var">parlocss</span></a></span><span>
</span><span id="line-393"></span><span>          </span><span id="local-6989586621680959415"><span class="annot"><span class="annottext">deleteAt :: Int -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680959415"><span class="hs-identifier hs-var hs-var">deleteAt</span></a></span></span><span> </span><span id="local-6989586621680959416"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959416"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621680959417"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680959417"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959418"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680959418"><span class="hs-identifier hs-var">lft</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680959419"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680959419"><span class="hs-identifier hs-var">rgt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [a] -&gt; ([a], [a])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959416"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680959417"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-394"></span><span>                            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680959418"><span class="hs-identifier hs-var">lft</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680959419"><span class="hs-identifier hs-var">rgt</span></a></span><span>
</span><span id="line-395"></span><span>          </span><span id="local-6989586621680959421"><span class="annot"><span class="annottext">common_regs :: Set Var
</span><a href="#local-6989586621680959421"><span class="hs-identifier hs-var hs-var">common_regs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="annot"><span class="annottext">([Set Var] -&gt; Set Var) -&gt; [Set Var] -&gt; Set Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, [Var]) -&gt; Set Var) -&gt; [(Int, [Var])] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span>
</span><span id="line-396"></span><span>                          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959422"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959422"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959423"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959423"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959424"><span class="annot"><span class="annottext">all_other_regs :: [Var]
</span><a href="#local-6989586621680959424"><span class="hs-identifier hs-var hs-var">all_other_regs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Var]] -&gt; [Var]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [[Var]] -&gt; [[Var]]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621680959415"><span class="hs-identifier hs-var">deleteAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959422"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959414"><span class="hs-identifier hs-var">regss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>                                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">S.intersection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959423"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959424"><span class="hs-identifier hs-var">all_other_regs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [[Var]] -&gt; [(Int, [Var])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959414"><span class="hs-identifier hs-var">regss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680959421"><span class="hs-identifier hs-var">common_regs</span></a></span><span>
</span><span id="line-400"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-401"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959426"><span class="annot"><span class="annottext">want_ran_locs :: [Var]
</span><a href="#local-6989586621680959426"><span class="hs-identifier hs-var hs-var">want_ran_locs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Bool) -&gt; [Var] -&gt; [Var]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">L.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680959427"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959427"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959427"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680959421"><span class="hs-identifier hs-var">common_regs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Var]] -&gt; [Var]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959386"><span class="hs-identifier hs-var">parlocss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959413"><span class="hs-identifier hs-var">s_bod</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon -&gt; Set TyCon -&gt; Set TyCon
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon] -&gt; Set TyCon
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([TyCon] -&gt; Set TyCon) -&gt; [TyCon] -&gt; Set TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; TyCon) -&gt; [Var] -&gt; [TyCon]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959385"><span class="hs-identifier hs-var">tcenv</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv -&gt; Var -&gt; TyCon
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959426"><span class="hs-identifier hs-var">want_ran_locs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Set TyCon
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;needsRANExp: Unbound SpawnE&quot;</span></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Set TyCon
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;needsRANExp: Unbound SyncE&quot;</span></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span class="hs-special">(</span><span id="local-6989586621680959428"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959428"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680959429"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680959429"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959430"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959430"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959431"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959431"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959432"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959430"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon -&gt; Set TyCon -&gt; Set TyCon
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span>
</span><span id="line-408"></span><span>                            </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var">needsRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959382"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959428"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680959429"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959385"><span class="hs-identifier hs-var">tcenv</span></a></span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959386"><span class="hs-identifier hs-var">parlocss</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959431"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680959433"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959433"><span class="hs-identifier hs-var">_a</span></a></span></span><span> </span><span id="local-6989586621680959434"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959434"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680959435"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959435"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959432"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959434"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon -&gt; Set TyCon -&gt; Set TyCon
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959432"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959435"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680959436"><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><a href="#local-6989586621680959436"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><a href="#local-6989586621680959436"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680959438"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959438"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959432"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959438"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-419"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680959440"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959440"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959432"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959440"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-420"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">L2.StartOfPkdCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-421"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680959443"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959443"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="Gibbon.L2.Syntax.html#FreeLE"><span class="hs-identifier hs-var">FreeLE</span></a></span><span> </span><span id="local-6989586621680959445"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959445"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959432"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959445"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-422"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680959446"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959446"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680959447"><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680959447"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621680959448"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959448"><span class="hs-identifier hs-var">bod</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-423"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959449"><span class="annot"><span class="annottext">reg :: Var
</span><a href="#local-6989586621680959449"><span class="hs-identifier hs-var hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680959447"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-424"></span><span>                        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfRegionLE"><span class="hs-identifier hs-type">StartOfRegionLE</span></a></span><span> </span><span id="local-6989586621680959451"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680959451"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680959451"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-425"></span><span>                        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#InRegionLE"><span class="hs-identifier hs-type">InRegionLE</span></a></span><span> </span><span id="local-6989586621680959453"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680959453"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680959453"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-426"></span><span>                        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterConstantLE"><span class="hs-identifier hs-type">AfterConstantLE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680959455"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959455"><span class="hs-identifier hs-var">lc</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959455"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-427"></span><span>                        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterVariableLE"><span class="hs-identifier hs-type">AfterVariableLE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680959457"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959457"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959457"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-428"></span><span>                        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndLE"><span class="hs-identifier hs-type">FromEndLE</span></a></span><span> </span><span id="local-6989586621680959459"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959459"><span class="hs-identifier hs-var">lc</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959459"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="hs-comment">-- TODO: This needs to be fixed</span><span>
</span><span id="line-429"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var">needsRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959382"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Map Var Var -&gt; Map Var Var
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959446"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959449"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959385"><span class="hs-identifier hs-var">tcenv</span></a></span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959386"><span class="hs-identifier hs-var">parlocss</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959448"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-430"></span><span>        </span><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621680959432"><span class="annot"><span class="annottext">go :: Exp2 -&gt; Set TyCon
</span><a href="#local-6989586621680959432"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var">needsRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959382"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959384"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959385"><span class="hs-identifier hs-var">tcenv</span></a></span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959386"><span class="hs-identifier hs-var">parlocss</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-comment">-- Collect all the 'Tycon's which might random access nodes</span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621680959397"><span class="annot"><span class="annottext">doalt :: TyCon
-&gt; Var
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; (TyCon, [(Var, Var)], Exp2)
-&gt; Set TyCon
</span><a href="#local-6989586621680959397"><span class="hs-identifier hs-var hs-var">doalt</span></a></span></span><span> </span><span id="local-6989586621680959461"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959461"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680959462"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959462"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680959463"><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959463"><span class="hs-identifier hs-var">env21</span></a></span></span><span> </span><span id="local-6989586621680959464"><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959464"><span class="hs-identifier hs-var">renv1</span></a></span></span><span> </span><span id="local-6989586621680959465"><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959465"><span class="hs-identifier hs-var">tcenv1</span></a></span></span><span> </span><span id="local-6989586621680959466"><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959466"><span class="hs-identifier hs-var">parlocss1</span></a></span></span><span> </span><span id="local-6989586621680959467"><span class="annot"><span class="annottext">br :: (TyCon, [(Var, Var)], Exp2)
</span><a href="#local-6989586621680959467"><span class="hs-identifier hs-var">br</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680959468"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959468"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959469"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680959469"><span class="hs-identifier hs-var">vlocs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959470"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959470"><span class="hs-identifier hs-var">bod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680959471"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959471"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959472"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959472"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; ([Var], [Var])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680959469"><span class="hs-identifier hs-var">vlocs</span></a></span><span>
</span><span id="line-439"></span><span>          </span><span id="local-6989586621680959474"><span class="annot"><span class="annottext">renv' :: Map Var Var
</span><a href="#local-6989586621680959474"><span class="hs-identifier hs-var hs-var">renv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Map Var Var -&gt; Map Var Var)
-&gt; Map Var Var -&gt; [Var] -&gt; Map Var Var
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680959475"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959475"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621680959476"><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959476"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Map Var Var -&gt; Map Var Var
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959475"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959462"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959476"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959464"><span class="hs-identifier hs-var">renv1</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959472"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-440"></span><span>          </span><span id="local-6989586621680959477"><span class="annot"><span class="annottext">env21' :: Env2 Ty2
</span><a href="#local-6989586621680959477"><span class="hs-identifier hs-var hs-var">env21'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
TyCon -&gt; DDefs Ty2 -&gt; [Var] -&gt; [Var] -&gt; Env2 Ty2 -&gt; Env2 Ty2
TyCon -&gt; DDefs Ty2 -&gt; [Var] -&gt; [Var] -&gt; Env2 Ty2 -&gt; Env2 Ty2
</span><a href="Gibbon.L2.Syntax.html#extendPatternMatchEnv"><span class="hs-identifier hs-var">extendPatternMatchEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959468"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959471"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959472"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959463"><span class="hs-identifier hs-var">env21</span></a></span><span>
</span><span id="line-441"></span><span>          </span><span id="local-6989586621680959479"><span class="annot"><span class="annottext">ran_for_scrt :: Set TyCon
</span><a href="#local-6989586621680959479"><span class="hs-identifier hs-var hs-var">ran_for_scrt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; (TyCon, [(Var, Var)], Exp2)
-&gt; Maybe [(Var, Var)]
</span><a href="Gibbon.Passes.AddTraversals.html#needsTraversalCase"><span class="hs-identifier hs-var">needsTraversalCase</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959382"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959383"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, [(Var, Var)], Exp2)
</span><a href="#local-6989586621680959467"><span class="hs-identifier hs-var">br</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-442"></span><span>                           </span><span class="annot"><span class="annottext">Maybe [(Var, Var)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set TyCon
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-443"></span><span>                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Set TyCon
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959461"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959479"><span class="hs-identifier hs-var">ran_for_scrt</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyCon -&gt; Set TyCon -&gt; Set TyCon
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; Map Var Var
-&gt; TyConEnv
-&gt; [[Var]]
-&gt; Exp2
-&gt; Set TyCon
</span><a href="Gibbon.Passes.AddRAN.html#needsRANExp"><span class="hs-identifier hs-var">needsRANExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680959382"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959477"><span class="hs-identifier hs-var">env21'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Var
</span><a href="#local-6989586621680959474"><span class="hs-identifier hs-var">renv'</span></a></span><span> </span><span class="annot"><span class="annottext">TyConEnv
</span><a href="#local-6989586621680959465"><span class="hs-identifier hs-var">tcenv1</span></a></span><span> </span><span class="annot"><span class="annottext">[[Var]]
</span><a href="#local-6989586621680959466"><span class="hs-identifier hs-var">parlocss1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959470"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-comment">-- Return the location and tycon of an argument to a function call.</span><span>
</span><span id="line-447"></span><span>    </span><span class="annot"><a href="#local-6989586621680959404"><span class="hs-identifier hs-type">parAppLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span id="local-6989586621680959404"><span class="annot"><span class="annottext">parAppLoc :: Env2 Ty2 -&gt; Exp2 -&gt; TyConEnv
</span><a href="#local-6989586621680959404"><span class="hs-identifier hs-var hs-var">parAppLoc</span></a></span></span><span> </span><span id="local-6989586621680959481"><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680959481"><span class="hs-identifier hs-var">env21</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680959482"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680959482"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-449"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959484"><span class="annot"><span class="annottext">fn :: UrTy a -&gt; [(a, TyCon)]
</span><a href="#local-6989586621680959484"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680959485"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959485"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621680959486"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680959486"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680959486"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959485"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-450"></span><span>          </span><span class="annot"><a href="#local-6989586621680959484"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680959488"><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680959488"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UrTy a -&gt; [(a, TyCon)]) -&gt; [UrTy a] -&gt; [(a, TyCon)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">L.concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a -&gt; [(a, TyCon)]
</span><a href="#local-6989586621680959484"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy a]
</span><a href="#local-6989586621680959488"><span class="hs-identifier hs-var">tys1</span></a></span><span>
</span><span id="line-451"></span><span>          </span><span class="annot"><a href="#local-6989586621680959484"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>          </span><span id="local-6989586621680959490"><span class="annot"><span class="annottext">tys :: [Ty2]
</span><a href="#local-6989586621680959490"><span class="hs-identifier hs-var hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Ty2) -&gt; [Exp2] -&gt; [Ty2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680959381"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (TyOf Exp2)
Env2 Ty2
</span><a href="#local-6989586621680959481"><span class="hs-identifier hs-var">env21</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680959482"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Var, TyCon)] -&gt; TyConEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty2 -&gt; [(Var, TyCon)]) -&gt; [Ty2] -&gt; [(Var, TyCon)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [(Var, TyCon)]
forall {a}. UrTy a -&gt; [(a, TyCon)]
</span><a href="#local-6989586621680959484"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680959490"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><a href="#local-6989586621680959404"><span class="hs-identifier hs-var">parAppLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680959492"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959492"><span class="hs-identifier hs-var">oth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyConEnv
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; TyConEnv) -&gt; TyCon -&gt; TyConEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;parAppLoc: Cannot handle &quot;</span></span><span>  </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; TyCon
forall a. Out a =&gt; a -&gt; TyCon
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680959492"><span class="hs-identifier hs-var">oth</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="annot"><span class="hs-comment">{-| Given a datatype, generate a copy-like function. But instead of just copying
the input value, it udpates constructors to have size information, and also
relative offsets. Assumes that this function will always be called on a value
written to a contiguous region. Chunked regions are not supported.

For example, for the Tree datatype it'll generate a function like this:

data Tree = Leaf Int | Node Tree Tree | Node* Int Int Tree Tree

_add_size_and_rel_offsets_Tree :: Tree -&gt; Tree
_add_size_and_rel_offsets_Tree tr =
  case tr of
    Leaf i          -&gt; Leaf i
    Node left right -&gt;
      let left'  = _add_size_and_rel_offsets_Tree left
          right' = _add_size_and_rel_offsets_Tree right
          size   = sizeof(left') + sizeof(right') + 1 + 8 + 8
          offset_right = sizeof(left')
      in Node* size offset_right left' right'

For a different datatype;

data Foo = K1 | K2 Foo Foo Foo | K2* Int Int Int Tree Tree Tree

_add_size_and_rel_offsets_Foo :: Foo -&gt; Foo
_add_size_and_rel_offsets_Foo foo =
  case foo of
    K1 -&gt; K1
    K2 a b c -&gt;
      let a' = _add_size_and_rel_offsets_Foo a
          b' = _add_size_and_rel_offsets_Foo b
          c' = _add_size_and_rel_offsets_Foo c
          size = 1 + 8 + 8 + 8 + sizeof(a') + sizeof(b') + sizeof(c')
          offset_b = 8 + sizeof(a')
          offset_c = sizeof(a') + sizeof(b')
      in K2* size offset_b offset_c a' b' c'

-}</span></span><span>
</span><span id="line-497"></span><span class="annot"><a href="Gibbon.Passes.AddRAN.html#genRelOffsetsFunNameFn"><span class="hs-identifier hs-type">genRelOffsetsFunNameFn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDef"><span class="hs-identifier hs-type">DDef</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-498"></span><span id="genRelOffsetsFunNameFn"><span class="annot"><span class="annottext">genRelOffsetsFunNameFn :: Set TyCon -&gt; DDefs (UrTy ()) -&gt; DDef (UrTy ()) -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.AddRAN.html#genRelOffsetsFunNameFn"><span class="hs-identifier hs-var hs-var">genRelOffsetsFunNameFn</span></a></span></span><span> </span><span id="local-6989586621680959566"><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959566"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span></span><span> </span><span id="local-6989586621680959567"><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959567"><span class="hs-identifier hs-var">ddfs</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDef"><span class="hs-identifier hs-type">DDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680959568"><span class="annot"><span class="annottext">Var
tyName :: Var
tyName :: forall a. DDef a -&gt; Var
</span><a href="#local-6989586621680959568"><span class="hs-identifier hs-var hs-var">tyName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680959570"><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy ())])]
dataCons :: forall a. DDef a -&gt; [(TyCon, [(Bool, a)])]
dataCons :: [(TyCon, [(Bool, UrTy ())])]
</span><a href="Gibbon.Language.Syntax.html#dataCons"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>  </span><span id="local-6989586621680959571"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959571"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;arg&quot;</span></span><span>
</span><span id="line-500"></span><span>  </span><span id="local-6989586621680959572"><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680959572"><span class="hs-identifier hs-var">casebod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy ())])]
-&gt; ((TyCon, [(Bool, UrTy ())]) -&gt; PassM (TyCon, [(Var, ())], Exp1))
-&gt; PassM [(TyCon, [(Var, ())], Exp1)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Bool, UrTy ())])]
</span><a href="#local-6989586621680959570"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">(((TyCon, [(Bool, UrTy ())]) -&gt; PassM (TyCon, [(Var, ())], Exp1))
 -&gt; PassM [(TyCon, [(Var, ())], Exp1)])
-&gt; ((TyCon, [(Bool, UrTy ())]) -&gt; PassM (TyCon, [(Var, ())], Exp1))
-&gt; PassM [(TyCon, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959573"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959573"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680959574"><span class="annot"><span class="annottext">[(Bool, UrTy ())]
</span><a href="#local-6989586621680959574"><span class="hs-identifier hs-var">dtys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-501"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959575"><span class="annot"><span class="annottext">tys :: [UrTy ()]
</span><a href="#local-6989586621680959575"><span class="hs-identifier hs-var hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Bool, UrTy ()) -&gt; UrTy ()) -&gt; [(Bool, UrTy ())] -&gt; [UrTy ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool, UrTy ()) -&gt; UrTy ()
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, UrTy ())]
</span><a href="#local-6989586621680959574"><span class="hs-identifier hs-var">dtys</span></a></span><span>
</span><span id="line-502"></span><span>                </span><span id="local-6989586621680959576"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959576"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UrTy () -&gt; PassM Var) -&gt; [UrTy ()] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">UrTy ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UrTy ()]
</span><a href="#local-6989586621680959575"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-503"></span><span>                </span><span id="local-6989586621680959577"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959577"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UrTy () -&gt; PassM Var) -&gt; [UrTy ()] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">UrTy ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;y&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UrTy ()]
</span><a href="#local-6989586621680959575"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-504"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959578"><span class="annot"><span class="annottext">num_offsets :: Int
</span><a href="#local-6989586621680959578"><span class="hs-identifier hs-var hs-var">num_offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ()) -&gt; TyCon -&gt; Int
forall a. Out a =&gt; DDefs (UrTy a) -&gt; TyCon -&gt; Int
</span><a href="Gibbon.Passes.AddRAN.html#numRANsDataCon"><span class="hs-identifier hs-var">numRANsDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (UrTy ())
</span><a href="#local-6989586621680959567"><span class="hs-identifier hs-var">ddfs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959573"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-505"></span><span>                </span><span id="local-6989586621680959579"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959579"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959580"><span class="annot"><span class="annottext">bod0 :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959580"><span class="hs-identifier hs-var hs-var">bod0</span></a></span></span><span> </span><span id="local-6989586621680959581"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959581"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((UrTy (), Var, Var) -&gt; Exp1 -&gt; Exp1)
-&gt; Exp1 -&gt; [(UrTy (), Var, Var)] -&gt; Exp1
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959582"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959582"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959583"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959583"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959584"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959584"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959585"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959585"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-507"></span><span>                                               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy () -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959582"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-508"></span><span>                                               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959584"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959582"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Var
</span><a href="Gibbon.Language.Constants.html#mkRelOffsetsFunName"><span class="hs-identifier hs-var">mkRelOffsetsFunName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy () -&gt; TyCon
forall a. Show a =&gt; UrTy a -&gt; TyCon
</span><a href="Gibbon.Language.html#tyToDataCon"><span class="hs-identifier hs-var">tyToDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959582"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959583"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959585"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-509"></span><span>                                               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959584"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959582"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959583"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959585"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                                            </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959581"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-511"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy ()] -&gt; [Var] -&gt; [Var] -&gt; [(UrTy (), Var, Var)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip3"><span class="hs-identifier hs-var">L.zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy ()]
</span><a href="#local-6989586621680959575"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959576"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959577"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>                       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Set TyCon -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; TyCon
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959568"><span class="hs-identifier hs-var">tyName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set TyCon
</span><a href="#local-6989586621680959566"><span class="hs-identifier hs-var">needRANsTyCons</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959580"><span class="hs-identifier hs-var">bod0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TyCon -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; TyCon -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959573"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Exp1) -&gt; [Var] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959577"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959578"><span class="hs-identifier hs-var">num_offsets</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-514"></span><span>                       </span><span class="hs-comment">-- Nothing much to do. Just recursively process all the packed arguments.</span><span>
</span><span id="line-515"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959580"><span class="hs-identifier hs-var">bod0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TyCon -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; TyCon -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959573"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Exp1) -&gt; [Var] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959577"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>                       </span><span class="hs-comment">-- We have to add a size field, and offsets in addition to recursively processing</span><span>
</span><span id="line-517"></span><span>                       </span><span class="hs-comment">-- the packed arguments.</span><span>
</span><span id="line-518"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-519"></span><span>                         </span><span id="local-6989586621680959590"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959590"><span class="hs-identifier hs-var">size_vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; [Var] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680959591"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959591"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; Var -&gt; PassM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Var) -&gt; TyCon -&gt; Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;sizeof_&quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyCon
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959591"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959577"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-520"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959593"><span class="annot"><span class="annottext">size_binds :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959593"><span class="hs-identifier hs-var hs-var">size_binds</span></a></span></span><span> </span><span id="local-6989586621680959594"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959594"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Var, UrTy ()) -&gt; Exp1 -&gt; Exp1)
-&gt; Exp1 -&gt; [(Var, Var, UrTy ())] -&gt; Exp1
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span>
</span><span id="line-521"></span><span>                                                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959595"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959595"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959596"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959596"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680959597"><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959597"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959598"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959598"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-522"></span><span>                                                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy () -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959597"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-523"></span><span>                                                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959595"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Prim (UrTy ()) -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ())
forall ty. Prim ty
</span><a href="Gibbon.Language.Syntax.html#RequestSizeOf"><span class="hs-identifier hs-var">RequestSizeOf</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959596"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959598"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-524"></span><span>                                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959595"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy () -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy ()
</span><a href="#local-6989586621680959597"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959598"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>                                                </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959594"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [UrTy ()] -&gt; [(Var, Var, UrTy ())]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip3"><span class="hs-identifier hs-var">L.zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959590"><span class="hs-identifier hs-var">size_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959577"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy ()]
</span><a href="#local-6989586621680959575"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>                         </span><span id="local-6989586621680959600"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959600"><span class="hs-identifier hs-var">offset_vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PassM Var) -&gt; [Int] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;offset_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959578"><span class="hs-identifier hs-var">num_offsets</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-527"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959601"><span class="annot"><span class="annottext">need_offsets :: [Var]
</span><a href="#local-6989586621680959601"><span class="hs-identifier hs-var hs-var">need_offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; [Var]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">L.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959578"><span class="hs-identifier hs-var">num_offsets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959576"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959604"><span class="annot"><span class="annottext">addp :: [Var] -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680959604"><span class="hs-identifier hs-var hs-var">addp</span></a></span></span><span> </span><span id="local-6989586621680959605"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959605"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959605"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-529"></span><span>                                         </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-530"></span><span>                                         </span><span class="hs-special">(</span><span id="local-6989586621680959606"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959606"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680959607"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959607"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim dec
forall ty. Prim ty
</span><a href="Gibbon.Language.Syntax.html#AddP"><span class="hs-identifier hs-var">AddP</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959606"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959607"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-531"></span><span>                                         </span><span class="hs-special">(</span><span id="local-6989586621680959609"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959609"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680959610"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959610"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim dec
forall ty. Prim ty
</span><a href="Gibbon.Language.Syntax.html#AddP"><span class="hs-identifier hs-var">AddP</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959609"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680959604"><span class="hs-identifier hs-var">addp</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959610"><span class="hs-identifier hs-var">rst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-532"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959611"><span class="annot"><span class="annottext">offset_binds :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959611"><span class="hs-identifier hs-var hs-var">offset_binds</span></a></span></span><span> </span><span id="local-6989586621680959612"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959612"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Var) -&gt; Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; [(Var, Var)] -&gt; Exp1
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span>
</span><span id="line-533"></span><span>                                                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680959613"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959613"><span class="hs-identifier hs-var">ov</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680959614"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959614"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680959615"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959615"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-534"></span><span>                                                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959616"><span class="annot"><span class="annottext">idx_of_x :: Int
</span><a href="#local-6989586621680959616"><span class="hs-identifier hs-var hs-var">idx_of_x</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959614"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959576"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-535"></span><span>                                                         </span><span id="local-6989586621680959618"><span class="annot"><span class="annottext">idx_of_ov :: Int
</span><a href="#local-6989586621680959618"><span class="hs-identifier hs-var hs-var">idx_of_ov</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959613"><span class="hs-identifier hs-var">ov</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959600"><span class="hs-identifier hs-var">offset_vars</span></a></span><span>
</span><span id="line-536"></span><span>                                                         </span><span id="local-6989586621680959619"><span class="annot"><span class="annottext">offsets_infront :: Int
</span><a href="#local-6989586621680959619"><span class="hs-identifier hs-var hs-var">offsets_infront</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; [Var]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#drop"><span class="hs-identifier hs-var">L.drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959618"><span class="hs-identifier hs-var">idx_of_ov</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959600"><span class="hs-identifier hs-var">offset_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-537"></span><span>                                                         </span><span id="local-6989586621680959620"><span class="annot"><span class="annottext">have_to_add :: [Var]
</span><a href="#local-6989586621680959620"><span class="hs-identifier hs-var hs-var">have_to_add</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; [Var]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">L.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959616"><span class="hs-identifier hs-var">idx_of_x</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959590"><span class="hs-identifier hs-var">size_vars</span></a></span><span>
</span><span id="line-538"></span><span>                                                         </span><span id="local-6989586621680959621"><span class="annot"><span class="annottext">rhs :: Exp1
</span><a href="#local-6989586621680959621"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ()) -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ())
forall ty. Prim ty
</span><a href="Gibbon.Language.Syntax.html#AddP"><span class="hs-identifier hs-var">AddP</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Exp1) -&gt; Int -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Any -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680959619"><span class="hs-identifier hs-var">offsets_infront</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-539"></span><span>                                                                              </span><span class="annot"><span class="annottext">[Var] -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
[Var] -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680959604"><span class="hs-identifier hs-var">addp</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959620"><span class="hs-identifier hs-var">have_to_add</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-540"></span><span>                                                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959613"><span class="hs-identifier hs-var">ov</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959621"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959615"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>                                                  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959612"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [(Var, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959600"><span class="hs-identifier hs-var">offset_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959601"><span class="hs-identifier hs-var">need_offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>                         </span><span id="local-6989586621680959623"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959623"><span class="hs-identifier hs-var">dcon_size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;size_dcon&quot;</span></span><span>
</span><span id="line-543"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680959624"><span class="annot"><span class="annottext">size_offsets :: Exp1
</span><a href="#local-6989586621680959624"><span class="hs-identifier hs-var hs-var">size_offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Int -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-var">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Exp1) -&gt; Int -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Any -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Any
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959600"><span class="hs-identifier hs-var">offset_vars</span></a></span><span>
</span><span id="line-544"></span><span>                             </span><span id="local-6989586621680959626"><span class="annot"><span class="annottext">dcon_size_bind :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959626"><span class="hs-identifier hs-var hs-var">dcon_size_bind</span></a></span></span><span> </span><span id="local-6989586621680959627"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959627"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], UrTy (), Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959623"><span class="hs-identifier hs-var">dcon_size</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy ()
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ()) -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim (UrTy ())
forall ty. Prim ty
</span><a href="Gibbon.Language.Syntax.html#AddP"><span class="hs-identifier hs-var">AddP</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959624"><span class="hs-identifier hs-var">size_offsets</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
[Var] -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680959604"><span class="hs-identifier hs-var">addp</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959590"><span class="hs-identifier hs-var">size_vars</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959627"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-545"></span><span>                             </span><span id="local-6989586621680959628"><span class="annot"><span class="annottext">dcon_args :: [Var]
</span><a href="#local-6989586621680959628"><span class="hs-identifier hs-var hs-var">dcon_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959623"><span class="hs-identifier hs-var">dcon_size</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959600"><span class="hs-identifier hs-var">offset_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>  </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959577"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-546"></span><span>                             </span><span id="local-6989586621680959629"><span class="annot"><span class="annottext">dcon' :: TyCon
</span><a href="#local-6989586621680959629"><span class="hs-identifier hs-var hs-var">dcon'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon
</span><a href="Gibbon.Language.Constants.html#toRelRANDataCon"><span class="hs-identifier hs-var">toRelRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959573"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-547"></span><span>                         </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959580"><span class="hs-identifier hs-var">bod0</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959593"><span class="hs-identifier hs-var">size_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959611"><span class="hs-identifier hs-var">offset_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680959626"><span class="hs-identifier hs-var">dcon_size_bind</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; TyCon -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; TyCon -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959629"><span class="hs-identifier hs-var">dcon'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Exp1) -&gt; [Var] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959628"><span class="hs-identifier hs-var">dcon_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>                </span><span class="annot"><span class="annottext">(TyCon, [(Var, ())], Exp1) -&gt; PassM (TyCon, [(Var, ())], Exp1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680959573"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; (Var, ())) -&gt; [Var] -&gt; [(Var, ())]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680959630"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959630"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959630"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680959576"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680959579"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef1 -&gt; PassM FunDef1) -&gt; FunDef1 -&gt; PassM FunDef1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funName :: Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Var
</span><a href="Gibbon.Language.Constants.html#mkRelOffsetsFunName"><span class="hs-identifier hs-var">mkRelOffsetsFunName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; TyCon
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959568"><span class="hs-identifier hs-var">tyName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funArgs :: [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959571"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-552"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funTy :: ArrowTy (TyOf Exp1)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon -&gt; () -&gt; UrTy ()
forall loc. TyCon -&gt; loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-var">PackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; TyCon
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959568"><span class="hs-identifier hs-var">tyName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; () -&gt; UrTy ()
forall loc. TyCon -&gt; loc -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-var">PackedTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; TyCon
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959568"><span class="hs-identifier hs-var">tyName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(TyCon, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(TyCon, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680959571"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680959572"><span class="hs-identifier hs-var">casebod</span></a></span><span>
</span><span id="line-554"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funMeta :: FunMeta
</span><a href="#local-6989586621680959631"><span class="hs-identifier hs-var">funMeta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunMeta"><span class="hs-identifier hs-type">FunMeta</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funRec :: FunRec
</span><a href="#local-6989586621680959633"><span class="hs-identifier hs-var">funRec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunRec
</span><a href="Gibbon.Language.Syntax.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span>
</span><span id="line-555"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funInline :: FunInline
</span><a href="#local-6989586621680959635"><span class="hs-identifier hs-var">funInline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunInline
</span><a href="Gibbon.Language.Syntax.html#NoInline"><span class="hs-identifier hs-var">NoInline</span></a></span><span>
</span><span id="line-556"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funCanTriggerGC :: Bool
</span><a href="#local-6989586621680959637"><span class="hs-identifier hs-var">funCanTriggerGC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-557"></span><span>                                      </span><span class="hs-special">}</span><span>
</span><span id="line-558"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-559"></span></pre></body></html>