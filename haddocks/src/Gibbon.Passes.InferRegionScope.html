<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Infer region multiplicities</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">--   During inference, regions are merely annotated with a region metavariable.</span><span>
</span><span id="line-4"></span><span class="hs-comment">--   InferRegionScope takes the next step and decides the region scope (global/dynamic)</span><span>
</span><span id="line-5"></span><span class="hs-comment">--   and also assigns it a multiplicity.</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.Passes.InferRegionScope</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.InferRegionScope.html#inferRegScope"><span class="hs-identifier">inferRegScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeExp"><span class="hs-identifier">inferRegScopeExp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Graph.html"><span class="hs-identifier">Data.Graph</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.DynFlags.html"><span class="hs-identifier">Gibbon.DynFlags</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html"><span class="hs-identifier">Gibbon.L2.Syntax</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- All regions are &quot;infinite&quot; right now</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-comment">-- | Infer region scope and multiplicity for a program annotated with regions</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- and locations.</span><span>
</span><span id="line-21"></span><span class="annot"><a href="Gibbon.Passes.InferRegionScope.html#inferRegScope"><span class="hs-identifier hs-type">inferRegScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span>
</span><span id="line-22"></span><span id="inferRegScope"><span class="annot"><span class="annottext">inferRegScope :: Prog2 -&gt; PassM Prog2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScope"><span class="hs-identifier hs-var hs-var">inferRegScope</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680962211"><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
ddefs :: DDefs (TyOf Exp2)
ddefs :: forall ex. Prog ex -&gt; DDefs (TyOf ex)
</span><a href="#local-6989586621680962211"><span class="hs-identifier hs-var hs-var">ddefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962213"><span class="annot"><span class="annottext">FunDefs Exp2
fundefs :: FunDefs Exp2
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
</span><a href="#local-6989586621680962213"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962215"><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
mainExp :: Maybe (Exp2, TyOf Exp2)
mainExp :: forall ex. Prog ex -&gt; Maybe (ex, TyOf ex)
</span><a href="#local-6989586621680962215"><span class="hs-identifier hs-var hs-var">mainExp</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-23"></span><span>  </span><span id="local-6989586621680962217"><span class="annot"><span class="annottext">[FunDef2]
</span><a href="#local-6989586621680962217"><span class="hs-identifier hs-var">fds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; PassM FunDef2) -&gt; [FunDef2] -&gt; PassM [FunDef2]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2 -&gt; PassM FunDef2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeFun"><span class="hs-identifier hs-var">inferRegScopeFun</span></a></span><span> </span><span class="annot"><span class="annottext">([FunDef2] -&gt; PassM [FunDef2]) -&gt; [FunDef2] -&gt; PassM [FunDef2]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; [FunDef2]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680962213"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680962221"><span class="annot"><span class="annottext">fundefs' :: FunDefs Exp2
</span><a href="#local-6989586621680962221"><span class="hs-identifier hs-var hs-var">fundefs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, FunDef2)] -&gt; FunDefs Exp2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, FunDef2)] -&gt; FunDefs Exp2)
-&gt; [(Var, FunDef2)] -&gt; FunDefs Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; (Var, FunDef2)) -&gt; [FunDef2] -&gt; [(Var, FunDef2)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680962223"><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680962223"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef2 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680962223"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680962223"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDef2]
</span><a href="#local-6989586621680962217"><span class="hs-identifier hs-var">fds'</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span id="local-6989586621680962225"><span class="annot"><span class="annottext">Maybe (Exp2, UrTy Var)
</span><a href="#local-6989586621680962225"><span class="hs-identifier hs-var">mainExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="#local-6989586621680962215"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-26"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, UrTy Var) -&gt; PassM (Maybe (Exp2, UrTy Var))
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, UrTy Var)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-27"></span><span>                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962226"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962226"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680962227"><span class="annot"><span class="annottext">TyOf Exp2
</span><a href="#local-6989586621680962227"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp2, UrTy Var) -&gt; Maybe (Exp2, UrTy Var)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Exp2, UrTy Var) -&gt; Maybe (Exp2, UrTy Var))
-&gt; (Exp2 -&gt; (Exp2, UrTy Var)) -&gt; Exp2 -&gt; Maybe (Exp2, UrTy Var)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyOf Exp2
UrTy Var
</span><a href="#local-6989586621680962227"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Maybe (Exp2, UrTy Var))
-&gt; PassM Exp2 -&gt; PassM (Maybe (Exp2, UrTy Var))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map Region Region -&gt; Exp2 -&gt; PassM Exp2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeExp"><span class="hs-identifier hs-var">inferRegScopeExp</span></a></span><span> </span><span class="annot"><span class="annottext">Map Region Region
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962226"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="annottext">Prog2 -&gt; PassM Prog2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog2 -&gt; PassM Prog2) -&gt; Prog2 -&gt; PassM Prog2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
-&gt; FunDefs Exp2 -&gt; Maybe (Exp2, TyOf Exp2) -&gt; Prog2
forall ex.
DDefs (TyOf ex) -&gt; FunDefs ex -&gt; Maybe (ex, TyOf ex) -&gt; Prog ex
</span><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-var">Prog</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
</span><a href="#local-6989586621680962211"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680962221"><span class="hs-identifier hs-var">fundefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
Maybe (Exp2, UrTy Var)
</span><a href="#local-6989586621680962225"><span class="hs-identifier hs-var">mainExp'</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="annot"><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeFun"><span class="hs-identifier hs-type">inferRegScopeFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDef2"><span class="hs-identifier hs-type">FunDef2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDef2"><span class="hs-identifier hs-type">FunDef2</span></a></span><span>
</span><span id="line-31"></span><span id="inferRegScopeFun"><span class="annot"><span class="annottext">inferRegScopeFun :: FunDef2 -&gt; PassM FunDef2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeFun"><span class="hs-identifier hs-var hs-var">inferRegScopeFun</span></a></span></span><span> </span><span id="local-6989586621680962232"><span class="annot"><span class="annottext">f :: FunDef2
</span><a href="#local-6989586621680962232"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680962234"><span class="annot"><span class="annottext">Exp2
funBody :: Exp2
funBody :: forall ex. FunDef ex -&gt; ex
</span><a href="#local-6989586621680962234"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-32"></span><span>  </span><span id="local-6989586621680962236"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962236"><span class="hs-identifier hs-var">funBody'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Region Region -&gt; Exp2 -&gt; PassM Exp2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeExp"><span class="hs-identifier hs-var">inferRegScopeExp</span></a></span><span> </span><span class="annot"><span class="annottext">Map Region Region
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962234"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="annottext">FunDef2 -&gt; PassM FunDef2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; PassM FunDef2) -&gt; FunDef2 -&gt; PassM FunDef2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680962232"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp2
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962236"><span class="hs-identifier hs-var">funBody'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">{- Region scoping rules:
~~~~~~~~~~~~~~~~~~~~~~~~

A region in Gibbon can either be global or dynamic (local). Global regions have a
lifetime equal to that of the whole program. Whereas, dynamic regions can be created &amp;
destroyed on the stack. The scope of the values in the region dictate it's scope.
If the value in the region escapes the context it was created in, it has be global.
Otherwise, a dynamic region would be sufficient. Consider two functions of the form:

    fnA = letregion ra in
          letloc la in
          let x = (Leaf 1) at la
          in x

    fnB = letregion rb in
          letloc lb in
          let y = (Leaf 1) at lb
          in 1

The return value of fnA resides in the region `ra`. Therefore `ra` has to be global.
Whereas, it's safe to mark the region `rb` as dynamic. The fn `inferRegScopeExp` traverses
the AST and transforms all region metavariables to fully scoped region variables.

Whenever it encounters a `letregion`, it builds a graph of dependencies of the
relevant part of the AST. And if there's a path between the region and
the end of the AST, the return value so to speak, the region is marked global.
For example, in fnA, it discovers the path `ra -&gt; la -&gt; x` and hence `ra` is global.
In fnB, there's no path from `rb` to 1.

-}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | Decide if a region should be global or local (dynamic).</span><span>
</span><span id="line-67"></span><span class="hs-comment">--</span><span>
</span><span id="line-68"></span><span class="hs-comment">--  Dynamic regions are stack allocated and automatically freed</span><span>
</span><span id="line-69"></span><span class="annot"><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeExp"><span class="hs-identifier hs-type">inferRegScopeExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-70"></span><span id="inferRegScopeExp"><span class="annot"><span class="annottext">inferRegScopeExp :: Map Region Region -&gt; Exp2 -&gt; PassM Exp2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeExp"><span class="hs-identifier hs-var hs-var">inferRegScopeExp</span></a></span></span><span> </span><span id="local-6989586621680962337"><span class="annot"><span class="annottext">Map Region Region
</span><a href="#local-6989586621680962337"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680962338"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680962340"><span class="annot"><span class="annottext">E2Ext Var (UrTy Var)
</span><a href="#local-6989586621680962340"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-73"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext Var (UrTy Var)
</span><a href="#local-6989586621680962340"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AddFixed"><span class="hs-identifier hs-type">AddFixed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680962343"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962343"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680962344"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680962344"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680962345"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680962345"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680962346"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962346"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962343"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-77"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#MMapR"><span class="hs-identifier hs-type">MMapR</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var (UrTy Var) -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var (UrTy Var) -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext Var (UrTy Var)) -&gt; Exp2 -&gt; Exp2
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext Var (UrTy Var)
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-var">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962343"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680962344"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680962345"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962346"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-78"></span><span>            </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680962350"><span class="annot"><span class="annottext">deps :: [(Var, Var, [Var])]
</span><a href="#local-6989586621680962350"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [(Var, Var, [Var])]
</span><a href="Gibbon.L2.Syntax.html#depList"><span class="hs-identifier hs-var">depList</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-80"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
</span><a href="#local-6989586621680962350"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-81"></span><span>                   </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680962352"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962352"><span class="hs-identifier hs-var">retVar</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-82"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962353"><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621680962353"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Vertex -&gt; (Var, Var, [Var])
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680962354"><span class="annot"><span class="annottext">Var -&gt; Maybe Vertex
</span><a href="#local-6989586621680962354"><span class="hs-identifier hs-var">vtxF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
-&gt; (Graph, Vertex -&gt; (Var, Var, [Var]), Var -&gt; Maybe Vertex)
forall key node.
Ord key =&gt;
[(node, key, [key])]
-&gt; (Graph, Vertex -&gt; (node, key, [key]), key -&gt; Maybe Vertex)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Graph.html#graphFromEdges"><span class="hs-identifier hs-var">graphFromEdges</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
</span><a href="#local-6989586621680962350"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-83"></span><span>                         </span><span id="local-6989586621680962356"><span class="annot"><span class="annottext">regV :: Var
</span><a href="#local-6989586621680962356"><span class="hs-identifier hs-var hs-var">regV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962343"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-84"></span><span>                         </span><span class="hs-comment">-- Vertex of the region variable</span><span>
</span><span id="line-85"></span><span>                         </span><span id="local-6989586621680962358"><span class="annot"><span class="annottext">regVertex :: Vertex
</span><a href="#local-6989586621680962358"><span class="hs-identifier hs-var hs-var">regVertex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Maybe Vertex
</span><a href="#local-6989586621680962354"><span class="hs-identifier hs-var">vtxF</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962356"><span class="hs-identifier hs-var">regV</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-87"></span><span>                             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680962359"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962359"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962359"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-88"></span><span>                             </span><span class="annot"><span class="annottext">Maybe Vertex
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vertex
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Vertex) -&gt; [Char] -&gt; Vertex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No vertex for:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962343"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-89"></span><span>                         </span><span class="hs-comment">-- Vertex of the return value</span><span>
</span><span id="line-90"></span><span>                         </span><span id="local-6989586621680962362"><span class="annot"><span class="annottext">retVertex :: Vertex
</span><a href="#local-6989586621680962362"><span class="hs-identifier hs-var hs-var">retVertex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-91"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Maybe Vertex
</span><a href="#local-6989586621680962354"><span class="hs-identifier hs-var">vtxF</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962352"><span class="hs-identifier hs-var">retVar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-92"></span><span>                             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680962363"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962363"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962363"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-93"></span><span>                             </span><span class="annot"><span class="annottext">Maybe Vertex
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vertex
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Vertex) -&gt; [Char] -&gt; Vertex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No vertex for:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962352"><span class="hs-identifier hs-var">retVar</span></a></span><span>
</span><span id="line-94"></span><span>                         </span><span class="hs-comment">-- The value in the region  escapes the current scope if there's</span><span>
</span><span id="line-95"></span><span>                         </span><span class="hs-comment">-- a path between the region variable and the thing returned.</span><span>
</span><span id="line-96"></span><span>                         </span><span class="hs-comment">-- TODO: Warn the user when this happens in a fn ?</span><span>
</span><span id="line-97"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680962364"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680962364"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-98"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680962366"><span class="annot"><span class="annottext">defaultMul :: Multiplicity
</span><a href="#local-6989586621680962366"><span class="hs-identifier hs-var hs-var">defaultMul</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_BigInfiniteRegions"><span class="hs-identifier hs-var">Opt_BigInfiniteRegions</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680962364"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span>
</span><span id="line-99"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_Gibbon1"><span class="hs-identifier hs-var">Opt_Gibbon1</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680962364"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>                                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="Gibbon.L2.Syntax.html#BigInfinite"><span class="hs-identifier hs-var">BigInfinite</span></a></span><span>
</span><span id="line-101"></span><span>                                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="Gibbon.L2.Syntax.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span>
</span><span id="line-102"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680962373"><span class="annot"><span class="annottext">scoped_reg :: Region
</span><a href="#local-6989586621680962373"><span class="hs-identifier hs-var hs-var">scoped_reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Graph -&gt; Vertex -&gt; Vertex -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Graph.html#path"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621680962353"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962362"><span class="hs-identifier hs-var">retVertex</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962358"><span class="hs-identifier hs-var">regVertex</span></a></span><span>
</span><span id="line-103"></span><span>                                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Multiplicity -&gt; Region
</span><a href="Gibbon.L2.Syntax.html#GlobR"><span class="hs-identifier hs-var">GlobR</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962356"><span class="hs-identifier hs-var">regV</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680962366"><span class="hs-identifier hs-var">defaultMul</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>                                            </span><span class="hs-comment">-- [2018.03.30] - TEMP: Turning off scoped buffers.</span><span>
</span><span id="line-105"></span><span>                                            </span><span class="hs-comment">-- else Ext$ LetRegionE (DynR regV mul) (inferRegScopeExp rhs)</span><span>
</span><span id="line-106"></span><span>                                            </span><span class="hs-comment">-- else (DynR regV mul)</span><span>
</span><span id="line-107"></span><span>                                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Multiplicity -&gt; Region
</span><a href="Gibbon.L2.Syntax.html#GlobR"><span class="hs-identifier hs-var">GlobR</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962356"><span class="hs-identifier hs-var">regV</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680962366"><span class="hs-identifier hs-var">defaultMul</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>                           </span><span class="annot"><span class="annottext">E2Ext Var (UrTy Var) -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var (UrTy Var) -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext Var (UrTy Var)) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-109"></span><span>                             </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext Var (UrTy Var)
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-var">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962373"><span class="hs-identifier hs-var">scoped_reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="Gibbon.L2.Syntax.html#Undefined"><span class="hs-identifier hs-var">Undefined</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-110"></span><span>                             </span><span class="annot"><span class="annottext">Map Region Region -&gt; Exp2 -&gt; PassM Exp2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeExp"><span class="hs-identifier hs-var">inferRegScopeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; Region -&gt; Map Region Region -&gt; Map Region Region
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962343"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962373"><span class="hs-identifier hs-var">scoped_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map Region Region
</span><a href="#local-6989586621680962337"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962346"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-111"></span><span>                   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680962379"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962379"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680962380"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680962380"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680962381"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680962381"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680962382"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962382"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962379"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-115"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#MMapR"><span class="hs-identifier hs-type">MMapR</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var (UrTy Var) -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var (UrTy Var) -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext Var (UrTy Var)) -&gt; Exp2 -&gt; Exp2
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext Var (UrTy Var)
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-var">LetParRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962379"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680962380"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680962381"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962382"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-116"></span><span>            </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-117"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680962383"><span class="annot"><span class="annottext">deps :: [(Var, Var, [Var])]
</span><a href="#local-6989586621680962383"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [(Var, Var, [Var])]
</span><a href="Gibbon.L2.Syntax.html#depList"><span class="hs-identifier hs-var">depList</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-118"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
</span><a href="#local-6989586621680962383"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>                   </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680962384"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962384"><span class="hs-identifier hs-var">retVar</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962385"><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621680962385"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Vertex -&gt; (Var, Var, [Var])
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680962386"><span class="annot"><span class="annottext">Var -&gt; Maybe Vertex
</span><a href="#local-6989586621680962386"><span class="hs-identifier hs-var">vtxF</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
-&gt; (Graph, Vertex -&gt; (Var, Var, [Var]), Var -&gt; Maybe Vertex)
forall key node.
Ord key =&gt;
[(node, key, [key])]
-&gt; (Graph, Vertex -&gt; (node, key, [key]), key -&gt; Maybe Vertex)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Graph.html#graphFromEdges"><span class="hs-identifier hs-var">graphFromEdges</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var, [Var])]
</span><a href="#local-6989586621680962383"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-121"></span><span>                         </span><span id="local-6989586621680962387"><span class="annot"><span class="annottext">regV :: Var
</span><a href="#local-6989586621680962387"><span class="hs-identifier hs-var hs-var">regV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962379"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-122"></span><span>                         </span><span class="hs-comment">-- Vertex of the region variable</span><span>
</span><span id="line-123"></span><span>                         </span><span id="local-6989586621680962388"><span class="annot"><span class="annottext">regVertex :: Vertex
</span><a href="#local-6989586621680962388"><span class="hs-identifier hs-var hs-var">regVertex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Maybe Vertex
</span><a href="#local-6989586621680962386"><span class="hs-identifier hs-var">vtxF</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962387"><span class="hs-identifier hs-var">regV</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>                             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680962389"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962389"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962389"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-126"></span><span>                             </span><span class="annot"><span class="annottext">Maybe Vertex
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vertex
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Vertex) -&gt; [Char] -&gt; Vertex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No vertex for:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962379"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-127"></span><span>                         </span><span class="hs-comment">-- Vertex of the return value</span><span>
</span><span id="line-128"></span><span>                         </span><span id="local-6989586621680962390"><span class="annot"><span class="annottext">retVertex :: Vertex
</span><a href="#local-6989586621680962390"><span class="hs-identifier hs-var hs-var">retVertex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Maybe Vertex
</span><a href="#local-6989586621680962386"><span class="hs-identifier hs-var">vtxF</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962384"><span class="hs-identifier hs-var">retVar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-130"></span><span>                             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680962391"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962391"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962391"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-131"></span><span>                             </span><span class="annot"><span class="annottext">Maybe Vertex
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vertex
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Vertex) -&gt; [Char] -&gt; Vertex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No vertex for:&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Char]
forall a. Out a =&gt; a -&gt; [Char]
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962384"><span class="hs-identifier hs-var">retVar</span></a></span><span>
</span><span id="line-132"></span><span>                         </span><span class="hs-comment">-- The value in the region  escapes the current scope if there's</span><span>
</span><span id="line-133"></span><span>                         </span><span class="hs-comment">-- a path between the region variable and the thing returned.</span><span>
</span><span id="line-134"></span><span>                         </span><span class="hs-comment">-- TODO: Warn the user when this happens in a fn ?</span><span>
</span><span id="line-135"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680962392"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680962392"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-136"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680962393"><span class="annot"><span class="annottext">defaultMul :: Multiplicity
</span><a href="#local-6989586621680962393"><span class="hs-identifier hs-var hs-var">defaultMul</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_BigInfiniteRegions"><span class="hs-identifier hs-var">Opt_BigInfiniteRegions</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680962392"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span>
</span><span id="line-137"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_Gibbon1"><span class="hs-identifier hs-var">Opt_Gibbon1</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680962392"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>                                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="Gibbon.L2.Syntax.html#BigInfinite"><span class="hs-identifier hs-var">BigInfinite</span></a></span><span>
</span><span id="line-139"></span><span>                                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="Gibbon.L2.Syntax.html#Infinite"><span class="hs-identifier hs-var">Infinite</span></a></span><span>
</span><span id="line-140"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680962394"><span class="annot"><span class="annottext">scoped_reg :: Region
</span><a href="#local-6989586621680962394"><span class="hs-identifier hs-var hs-var">scoped_reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Graph -&gt; Vertex -&gt; Vertex -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Graph.html#path"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Graph
</span><a href="#local-6989586621680962385"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962390"><span class="hs-identifier hs-var">retVertex</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962388"><span class="hs-identifier hs-var">regVertex</span></a></span><span>
</span><span id="line-141"></span><span>                                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Multiplicity -&gt; Region
</span><a href="Gibbon.L2.Syntax.html#GlobR"><span class="hs-identifier hs-var">GlobR</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962387"><span class="hs-identifier hs-var">regV</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680962393"><span class="hs-identifier hs-var">defaultMul</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>                                            </span><span class="hs-comment">-- [2018.03.30] - TEMP: Turning off scoped buffers.</span><span>
</span><span id="line-143"></span><span>                                            </span><span class="hs-comment">-- else Ext$ LetRegionE (DynR regV mul) (inferRegScopeExp rhs)</span><span>
</span><span id="line-144"></span><span>                                            </span><span class="hs-comment">-- else (DynR regV mul)</span><span>
</span><span id="line-145"></span><span>                                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Multiplicity -&gt; Region
</span><a href="Gibbon.L2.Syntax.html#GlobR"><span class="hs-identifier hs-var">GlobR</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962387"><span class="hs-identifier hs-var">regV</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680962393"><span class="hs-identifier hs-var">defaultMul</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>                           </span><span class="annot"><span class="annottext">E2Ext Var (UrTy Var) -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var (UrTy Var) -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext Var (UrTy Var)) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext Var (UrTy Var)
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-var">LetParRegionE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Multiplicity -&gt; Region
</span><a href="Gibbon.L2.Syntax.html#GlobR"><span class="hs-identifier hs-var">GlobR</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962387"><span class="hs-identifier hs-var">regV</span></a></span><span> </span><span class="annot"><span class="annottext">Multiplicity
</span><a href="#local-6989586621680962393"><span class="hs-identifier hs-var">defaultMul</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="Gibbon.L2.Syntax.html#Undefined"><span class="hs-identifier hs-var">Undefined</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-147"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Region Region -&gt; Exp2 -&gt; PassM Exp2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeExp"><span class="hs-identifier hs-var">inferRegScopeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; Region -&gt; Map Region Region -&gt; Map Region Region
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962379"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962394"><span class="hs-identifier hs-var">scoped_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map Region Region
</span><a href="#local-6989586621680962337"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962382"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>                   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-comment">-- Straightforward recursion</span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680962396"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962396"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680962397"><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680962397"><span class="hs-identifier hs-var">le</span></a></span></span><span> </span><span id="local-6989586621680962398"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962398"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-152"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680962399"><span class="annot"><span class="annottext">le' :: PreLocExp Var
</span><a href="#local-6989586621680962399"><span class="hs-identifier hs-var hs-var">le'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680962397"><span class="hs-identifier hs-var">le</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-153"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfRegionLE"><span class="hs-identifier hs-type">StartOfRegionLE</span></a></span><span> </span><span id="local-6989586621680962401"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962401"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Region -&gt; PreLocExp Var
forall loc. Region -&gt; PreLocExp loc
</span><a href="Gibbon.L2.Syntax.html#StartOfRegionLE"><span class="hs-identifier hs-var">StartOfRegionLE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Region Region
</span><a href="#local-6989586621680962337"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Map Region Region -&gt; Region -&gt; Region
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962401"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#InRegionLE"><span class="hs-identifier hs-type">InRegionLE</span></a></span><span> </span><span id="local-6989586621680962404"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962404"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Region -&gt; PreLocExp Var
forall loc. Region -&gt; PreLocExp loc
</span><a href="Gibbon.L2.Syntax.html#InRegionLE"><span class="hs-identifier hs-var">InRegionLE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Region Region
</span><a href="#local-6989586621680962337"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Map Region Region -&gt; Region -&gt; Region
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680962404"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>                      </span><span class="annot"><span class="annottext">PreLocExp Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680962397"><span class="hs-identifier hs-var">le</span></a></span><span>
</span><span id="line-156"></span><span>          </span><span class="annot"><span class="annottext">E2Ext Var (UrTy Var) -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var (UrTy Var) -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext Var (UrTy Var)) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreLocExp Var -&gt; Exp2 -&gt; E2Ext Var (UrTy Var)
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962396"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680962399"><span class="hs-identifier hs-var">le'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962398"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">StartOfPkdCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-159"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-type">FromEndE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-161"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">E2Ext Var (UrTy Var)
</span><a href="Gibbon.L2.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span id="local-6989586621680962413"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680962413"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621680962414"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962414"><span class="hs-identifier hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var (UrTy Var) -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var (UrTy Var) -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext Var (UrTy Var)) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Exp2 -&gt; E2Ext Var (UrTy Var)
forall loc dec. [Var] -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-var">LetAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680962413"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962414"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-167"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- Straightforward recursion ...</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680962428"><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962428"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680962429"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962429"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vertex -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Vertex -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Vertex
</span><a href="#local-6989586621680962428"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962429"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680962431"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962431"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680962432"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962432"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680962433"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962433"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962431"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962432"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962433"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680962435"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680962435"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp2] -&gt; Exp2) -&gt; PassM [Exp2] -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; [Exp2] -&gt; PassM [Exp2]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680962435"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680962437"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962437"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962438"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680962438"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962439"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680962439"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962440"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962440"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680962441"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962441"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [Var], UrTy Var, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">((Var, [Var], UrTy Var, Exp2) -&gt; Exp2 -&gt; Exp2)
-&gt; (Exp2 -&gt; (Var, [Var], UrTy Var, Exp2)) -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962437"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680962438"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680962439"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962440"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962441"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680962443"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962443"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680962444"><span class="annot"><span class="annottext">[([Char], [(Var, Var)], Exp2)]
</span><a href="#local-6989586621680962444"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; [([Char], [(Var, Var)], Exp2)] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [([Char], [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962443"><span class="hs-identifier hs-var">scrt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([([Char], [(Var, Var)], Exp2)] -&gt; Exp2)
-&gt; PassM [([Char], [(Var, Var)], Exp2)] -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(([Char], [(Var, Var)], Exp2)
 -&gt; PassM ([Char], [(Var, Var)], Exp2))
-&gt; [([Char], [(Var, Var)], Exp2)]
-&gt; PassM [([Char], [(Var, Var)], Exp2)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680962445"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680962445"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962446"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680962446"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680962447"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962447"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680962445"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680962446"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; ([Char], [(Var, Var)], Exp2))
-&gt; PassM Exp2 -&gt; PassM ([Char], [(Var, Var)], Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962447"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([Char], [(Var, Var)], Exp2)]
</span><a href="#local-6989586621680962444"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680962449"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962449"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680962450"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680962450"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680962451"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962451"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-185"></span><span>      </span><span id="local-6989586621680962452"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962452"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962449"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; UrTy Var -&gt; Bool -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962452"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680962450"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680962451"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-type">SyncE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962338"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680962456"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962456"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680962457"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962457"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-var">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680962456"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680962457"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp2
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp2) -&gt; [Char] -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;inferRegScopeExp: TODO MapE&quot;</span></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PassM Exp2
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PassM Exp2) -&gt; [Char] -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;inferRegScopeExp: TODO FoldE&quot;</span></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621680962349"><span class="annot"><span class="annottext">go :: Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680962349"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Region Region -&gt; Exp2 -&gt; PassM Exp2
</span><a href="Gibbon.Passes.InferRegionScope.html#inferRegScopeExp"><span class="hs-identifier hs-var">inferRegScopeExp</span></a></span><span> </span><span class="annot"><span class="annottext">Map Region Region
</span><a href="#local-6989586621680962337"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-194"></span></pre></body></html>