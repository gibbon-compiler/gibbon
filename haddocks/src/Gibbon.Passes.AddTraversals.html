<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.Passes.AddTraversals</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#addTraversals"><span class="hs-identifier">addTraversals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#needsTraversalCase"><span class="hs-identifier">needsTraversalCase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier">forM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#when"><span class="hs-identifier">when</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.DynFlags.html"><span class="hs-identifier">Gibbon.DynFlags</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.Passes.InferEffects.html"><span class="hs-identifier">Gibbon.Passes.InferEffects</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.Passes.InferEffects.html#inferExp"><span class="hs-identifier">inferExp</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html"><span class="hs-identifier">Gibbon.L1.Syntax</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#StartOfPkdCursor"><span class="hs-identifier">StartOfPkdCursor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html"><span class="hs-identifier">Gibbon.L2.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L2</span></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">{- Note [Adding dummy traversals]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

..TODO..

-}</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">type</span><span> </span><span id="Deps"><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#Deps"><span class="hs-identifier hs-var">Deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-- Maps a location to a region</span><span>
</span><span id="line-27"></span><span class="hs-keyword">type</span><span> </span><span id="RegEnv"><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#RegEnv"><span class="hs-identifier hs-var">RegEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#addTraversals"><span class="hs-identifier hs-type">addTraversals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Prog2"><span class="hs-identifier hs-type">Prog2</span></a></span><span>
</span><span id="line-30"></span><span id="addTraversals"><span class="annot"><span class="annottext">addTraversals :: Prog2 -&gt; PassM Prog2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversals"><span class="hs-identifier hs-var hs-var">addTraversals</span></a></span></span><span> </span><span id="local-6989586621680958209"><span class="annot"><span class="annottext">prg :: Prog2
</span><a href="#local-6989586621680958209"><span class="hs-identifier hs-var">prg</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680958211"><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
ddefs :: DDefs (TyOf Exp2)
ddefs :: forall ex. Prog ex -&gt; DDefs (TyOf ex)
</span><a href="#local-6989586621680958211"><span class="hs-identifier hs-var hs-var">ddefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958213"><span class="annot"><span class="annottext">FunDefs Exp2
fundefs :: FunDefs Exp2
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
</span><a href="#local-6989586621680958213"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958215"><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
mainExp :: Maybe (Exp2, TyOf Exp2)
mainExp :: forall ex. Prog ex -&gt; Maybe (ex, TyOf ex)
</span><a href="#local-6989586621680958215"><span class="hs-identifier hs-var hs-var">mainExp</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-31"></span><span>  </span><span id="local-6989586621680958217"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958217"><span class="hs-identifier hs-var">funs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; PassM FunDef2) -&gt; FunDefs Exp2 -&gt; PassM (FunDefs Exp2)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Map Var a -&gt; m (Map Var b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; FunDefs Exp2 -&gt; FunDef2 -&gt; PassM FunDef2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsFn"><span class="hs-identifier hs-var">addTraversalsFn</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680958211"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958213"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958213"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span id="local-6989586621680958220"><span class="annot"><span class="annottext">Maybe (Exp2, Ty2)
</span><a href="#local-6989586621680958220"><span class="hs-identifier hs-var">mainExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="#local-6989586621680958215"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-34"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958221"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958221"><span class="hs-identifier hs-var">ex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958222"><span class="annot"><span class="annottext">TyOf Exp2
</span><a href="#local-6989586621680958222"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp2, Ty2) -&gt; Maybe (Exp2, Ty2)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Exp2, Ty2) -&gt; Maybe (Exp2, Ty2))
-&gt; (Exp2 -&gt; (Exp2, Ty2)) -&gt; Exp2 -&gt; Maybe (Exp2, Ty2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680958222"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Maybe (Exp2, Ty2))
-&gt; PassM Exp2 -&gt; PassM (Maybe (Exp2, Ty2))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var">addTraversalsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680958211"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958213"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
forall a. Env2 a
</span><a href="Gibbon.Language.Syntax.html#emptyEnv2"><span class="hs-identifier hs-var">emptyEnv2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mainExp&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958221"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-35"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, Ty2) -&gt; PassM (Maybe (Exp2, Ty2))
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, Ty2)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="annottext">Prog2 -&gt; PassM Prog2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Prog2
</span><a href="#local-6989586621680958209"><span class="hs-identifier hs-var">prg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ddefs :: DDefs (TyOf Exp2)
</span><a href="Gibbon.Language.Syntax.html#ddefs"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
</span><a href="#local-6989586621680958211"><span class="hs-identifier hs-var">ddefs</span></a></span><span>
</span><span id="line-37"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fundefs :: FunDefs Exp2
</span><a href="Gibbon.Language.Syntax.html#fundefs"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958217"><span class="hs-identifier hs-var">funs</span></a></span><span>
</span><span id="line-38"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mainExp :: Maybe (Exp2, TyOf Exp2)
</span><a href="Gibbon.Language.Syntax.html#mainExp"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
Maybe (Exp2, Ty2)
</span><a href="#local-6989586621680958220"><span class="hs-identifier hs-var">mainExp'</span></a></span><span>
</span><span id="line-39"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#addTraversalsFn"><span class="hs-identifier hs-type">addTraversalsFn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDef2"><span class="hs-identifier hs-type">FunDef2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDef2"><span class="hs-identifier hs-type">FunDef2</span></a></span><span>
</span><span id="line-42"></span><span id="addTraversalsFn"><span class="annot"><span class="annottext">addTraversalsFn :: DDefs Ty2 -&gt; FunDefs Exp2 -&gt; FunDef2 -&gt; PassM FunDef2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsFn"><span class="hs-identifier hs-var hs-var">addTraversalsFn</span></a></span></span><span> </span><span id="local-6989586621680958245"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958245"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680958246"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958246"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680958247"><span class="annot"><span class="annottext">f :: FunDef2
</span><a href="#local-6989586621680958247"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680958249"><span class="annot"><span class="annottext">Var
funName :: Var
funName :: forall ex. FunDef ex -&gt; Var
</span><a href="#local-6989586621680958249"><span class="hs-identifier hs-var hs-var">funName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680958251"><span class="annot"><span class="annottext">[Var]
funArgs :: [Var]
funArgs :: forall ex. FunDef ex -&gt; [Var]
</span><a href="#local-6989586621680958251"><span class="hs-identifier hs-var hs-var">funArgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680958253"><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
funTy :: ArrowTy (TyOf Exp2)
funTy :: forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="#local-6989586621680958253"><span class="hs-identifier hs-var hs-var">funTy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680958255"><span class="annot"><span class="annottext">Exp2
funBody :: Exp2
funBody :: forall ex. FunDef ex -&gt; ex
</span><a href="#local-6989586621680958255"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958257"><span class="annot"><span class="annottext">inlocs :: [Var]
</span><a href="#local-6989586621680958257"><span class="hs-identifier hs-var hs-var">inlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#inLocVars"><span class="hs-identifier hs-var">inLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680958253"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-44"></span><span>        </span><span id="local-6989586621680958259"><span class="annot"><span class="annottext">eff :: Set Effect
</span><a href="#local-6989586621680958259"><span class="hs-identifier hs-var hs-var">eff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; Set Effect
forall ty2. ArrowTy2 ty2 -&gt; Set Effect
</span><a href="Gibbon.L2.Syntax.html#arrEffs"><span class="hs-identifier hs-var">arrEffs</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680958253"><span class="hs-identifier hs-var">funTy</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958257"><span class="hs-identifier hs-var">inlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`S.difference`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Effect -&gt; Var) -&gt; Set Effect -&gt; Set Var
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#map"><span class="hs-identifier hs-var">S.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Traverse"><span class="hs-identifier hs-type">Traverse</span></a></span><span> </span><span id="local-6989586621680958266"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958266"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958266"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Effect
</span><a href="#local-6989586621680958259"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; Bool
forall ty2. ArrowTy2 ty2 -&gt; Bool
</span><a href="Gibbon.L2.Syntax.html#hasParallelism"><span class="hs-identifier hs-var">hasParallelism</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680958253"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FunDef2 -&gt; PassM FunDef2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680958247"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-47"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-48"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958270"><span class="annot"><span class="annottext">funenv :: TyEnv (ArrowTy (TyOf Exp2))
</span><a href="#local-6989586621680958270"><span class="hs-identifier hs-var hs-var">funenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; TyEnv (ArrowTy (TyOf Exp2))
forall a. FunDefs a -&gt; TyEnv (ArrowTy (TyOf a))
</span><a href="Gibbon.Language.Syntax.html#initFunEnv"><span class="hs-identifier hs-var">initFunEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958246"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-49"></span><span>            </span><span id="local-6989586621680958272"><span class="annot"><span class="annottext">tyenv :: Map Var Ty2
</span><a href="#local-6989586621680958272"><span class="hs-identifier hs-var hs-var">tyenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; Map Var Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; Map Var Ty2) -&gt; [(Var, Ty2)] -&gt; Map Var Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b.
(Show a, Show b, HasCallStack) =&gt;
[a] -&gt; [b] -&gt; [(a, b)]
</span><a href="Gibbon.Common.html#fragileZip"><span class="hs-identifier hs-var">fragileZip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958251"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy Ty2 -&gt; [Ty2]
forall ty. FunctionTy ty =&gt; ArrowTy ty -&gt; [ty]
</span><a href="Gibbon.Language.Syntax.html#inTys"><span class="hs-identifier hs-var">inTys</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy Ty2
</span><a href="#local-6989586621680958253"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>            </span><span id="local-6989586621680958276"><span class="annot"><span class="annottext">env2 :: Env2 Ty2
</span><a href="#local-6989586621680958276"><span class="hs-identifier hs-var hs-var">env2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Var Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Ty2
</span><a href="#local-6989586621680958272"><span class="hs-identifier hs-var">tyenv</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv (ArrowTy (TyOf Exp2))
TyEnv (ArrowTy Ty2)
</span><a href="#local-6989586621680958270"><span class="hs-identifier hs-var">funenv</span></a></span><span>
</span><span id="line-51"></span><span>            </span><span id="local-6989586621680958278"><span class="annot"><span class="annottext">renv :: RegEnv
</span><a href="#local-6989586621680958278"><span class="hs-identifier hs-var hs-var">renv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; RegEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Var)] -&gt; RegEnv) -&gt; [(Var, Var)] -&gt; RegEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; (Var, Var)) -&gt; [LRM] -&gt; [(Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680958279"><span class="annot"><span class="annottext">LRM
</span><a href="#local-6989586621680958279"><span class="hs-identifier hs-var">lrm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LRM -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#lrmLoc"><span class="hs-identifier hs-var">lrmLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LRM
</span><a href="#local-6989586621680958279"><span class="hs-identifier hs-var">lrm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LRM -&gt; Region
</span><a href="Gibbon.L2.Syntax.html#lrmReg"><span class="hs-identifier hs-var">lrmReg</span></a></span><span> </span><span class="annot"><span class="annottext">LRM
</span><a href="#local-6989586621680958279"><span class="hs-identifier hs-var">lrm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680958253"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>        </span><span id="local-6989586621680958284"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958284"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var">addTraversalsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958245"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958246"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958276"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958278"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958249"><span class="hs-identifier hs-var">funName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958255"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><span class="annottext">FunDef2 -&gt; PassM FunDef2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; PassM FunDef2) -&gt; FunDef2 -&gt; PassM FunDef2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680958247"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp2
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958284"><span class="hs-identifier hs-var">bod'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- Generate traversals for the first (n-1) packed elements</span><span>
</span><span id="line-57"></span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-type">addTraversalsExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#RegEnv"><span class="hs-identifier hs-type">RegEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-58"></span><span id="addTraversalsExp"><span class="annot"><span class="annottext">addTraversalsExp :: DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var hs-var">addTraversalsExp</span></a></span></span><span> </span><span id="local-6989586621680958390"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680958391"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958391"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680958392"><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958392"><span class="hs-identifier hs-var">env2</span></a></span></span><span> </span><span id="local-6989586621680958393"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span></span><span> </span><span id="local-6989586621680958394"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958394"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621680958395"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680958397"><span class="annot"><span class="annottext">scrt :: Exp2
</span><a href="#local-6989586621680958397"><span class="hs-identifier hs-var">scrt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680958399"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958399"><span class="hs-identifier hs-var">sv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680958400"><span class="annot"><span class="annottext">[(String, [(Var, Var)], Exp2)]
</span><a href="#local-6989586621680958400"><span class="hs-identifier hs-var">brs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680958402"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958402"><span class="hs-identifier hs-var">_tycon</span></a></span></span><span> </span><span id="local-6989586621680958403"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958403"><span class="hs-identifier hs-var">tyloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Env2 Ty2 -&gt; Ty2
forall a. Out a =&gt; Var -&gt; Env2 a -&gt; a
</span><a href="Gibbon.Language.Syntax.html#lookupVEnv"><span class="hs-identifier hs-var">lookupVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958399"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958392"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-62"></span><span>            </span><span id="local-6989586621680958405"><span class="annot"><span class="annottext">reg :: Var
</span><a href="#local-6989586621680958405"><span class="hs-identifier hs-var hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958403"><span class="hs-identifier hs-var">tyloc</span></a></span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><span class="annottext">Exp2 -&gt; [(String, [(Var, Var)], Exp2)] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958397"><span class="hs-identifier hs-var">scrt</span></a></span><span> </span><span class="annot"><span class="annottext">([(String, [(Var, Var)], Exp2)] -&gt; Exp2)
-&gt; PassM [(String, [(Var, Var)], Exp2)] -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((String, [(Var, Var)], Exp2)
 -&gt; PassM (String, [(Var, Var)], Exp2))
-&gt; [(String, [(Var, Var)], Exp2)]
-&gt; PassM [(String, [(Var, Var)], Exp2)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
-&gt; (String, [(Var, Var)], Exp2)
-&gt; PassM (String, [(Var, Var)], Exp2)
</span><a href="#local-6989586621680958407"><span class="hs-identifier hs-var">docase</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958405"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, Var)], Exp2)]
</span><a href="#local-6989586621680958400"><span class="hs-identifier hs-var">brs</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680958408"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958408"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, Var)], Exp2)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM Exp2
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PassM Exp2) -&gt; String -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addTraversalsExp: Scrutinee is not flat &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958408"><span class="hs-identifier hs-var">scrt</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-comment">-- standard recursion here</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680958416"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958416"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680958417"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958417"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680958418"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680958418"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958416"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958417"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp2] -&gt; Exp2) -&gt; PassM [Exp2] -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; [Exp2] -&gt; PassM [Exp2]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680958418"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680958421"><span class="annot"><span class="annottext">Prim Ty2
</span><a href="#local-6989586621680958421"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680958422"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680958422"><span class="hs-identifier hs-var">args</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim Ty2 -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2
</span><a href="#local-6989586621680958421"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp2] -&gt; Exp2) -&gt; PassM [Exp2] -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; [Exp2] -&gt; PassM [Exp2]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680958422"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680958424"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958424"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680958425"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958425"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-var">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958424"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var">addTraversalsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958391"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958424"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958392"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958394"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958425"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958429"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958429"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958430"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958430"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958431"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958431"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958432"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958432"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680958433"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958433"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-77"></span><span>      </span><span class="annot"><span class="annottext">(Var, [Var], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">((Var, [Var], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2)
-&gt; (Exp2 -&gt; (Var, [Var], Ty2, Exp2)) -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958429"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958430"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958431"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958432"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var">addTraversalsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958391"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958429"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958431"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958392"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958394"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958433"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680958435"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958435"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680958436"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958436"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680958437"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958437"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2 -&gt; Exp2 -&gt; Exp2)
-&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2 -&gt; Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958435"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2)
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958436"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958437"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680958439"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680958439"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp2] -&gt; Exp2) -&gt; PassM [Exp2] -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; [Exp2] -&gt; PassM [Exp2]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680958439"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680958441"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680958441"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680958442"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958442"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680958441"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958442"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680958445"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958445"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680958446"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958446"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680958447"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680958447"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>      </span><span id="local-6989586621680958448"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958448"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958445"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Ty2 -&gt; Bool -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958448"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958446"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680958447"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-comment">-- error &quot;addTraversalsExp: Cannot compile SpawnE&quot;</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-comment">-- error &quot;addTraversalsExp: Cannot compile SyncE&quot;</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680958452"><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><a href="#local-6989586621680958452"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-89"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><a href="#local-6989586621680958452"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680958454"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680958454"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680958455"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680958455"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680958456"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680958456"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680958457"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958457"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; (Exp2 -&gt; E2Ext Var Ty2) -&gt; Exp2 -&gt; Exp2
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-var">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680958454"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680958455"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680958456"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958457"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680958460"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680958460"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680958461"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680958461"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680958462"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680958462"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680958463"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958463"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; (Exp2 -&gt; E2Ext Var Ty2) -&gt; Exp2 -&gt; Exp2
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Region -&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-var">LetParRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680958460"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680958461"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680958462"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958463"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">L2.StartOfPkdCursor</span></a></span><span> </span><span id="local-6989586621680958465"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958465"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; E2Ext Var Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; E2Ext Var Ty2
forall loc dec. Var -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-var">L2.StartOfPkdCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958465"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680958467"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958467"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="Gibbon.L2.Syntax.html#FreeLE"><span class="hs-identifier hs-var">FreeLE</span></a></span><span>  </span><span id="local-6989586621680958469"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958469"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-94"></span><span>          </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; (Exp2 -&gt; E2Ext Var Ty2) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreLocExp Var -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958467"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
forall loc. PreLocExp loc
</span><a href="Gibbon.L2.Syntax.html#FreeLE"><span class="hs-identifier hs-var">FreeLE</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-95"></span><span>            </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var">addTraversalsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958391"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958392"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958394"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958469"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680958470"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958470"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680958471"><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680958471"><span class="hs-identifier hs-var">locexp</span></a></span></span><span>  </span><span id="local-6989586621680958472"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958472"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-97"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958473"><span class="annot"><span class="annottext">reg :: Var
</span><a href="#local-6989586621680958473"><span class="hs-identifier hs-var hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680958471"><span class="hs-identifier hs-var">locexp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-98"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfRegionLE"><span class="hs-identifier hs-type">StartOfRegionLE</span></a></span><span> </span><span id="local-6989586621680958475"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680958475"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680958475"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-99"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#InRegionLE"><span class="hs-identifier hs-type">InRegionLE</span></a></span><span> </span><span id="local-6989586621680958477"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680958477"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680958477"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-100"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterConstantLE"><span class="hs-identifier hs-type">AfterConstantLE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680958479"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958479"><span class="hs-identifier hs-var">lc</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958479"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-101"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterVariableLE"><span class="hs-identifier hs-type">AfterVariableLE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680958481"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958481"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958481"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-102"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndLE"><span class="hs-identifier hs-type">FromEndLE</span></a></span><span> </span><span id="local-6989586621680958483"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958483"><span class="hs-identifier hs-var">lc</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958483"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="hs-comment">-- TODO: This needs to be fixed</span><span>
</span><span id="line-103"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">E2Ext Var Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext Var Ty2 -&gt; Exp2) -&gt; (Exp2 -&gt; E2Ext Var Ty2) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreLocExp Var -&gt; Exp2 -&gt; E2Ext Var Ty2
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958470"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp Var
</span><a href="#local-6989586621680958471"><span class="hs-identifier hs-var">locexp</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-104"></span><span>               </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var">addTraversalsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958391"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958392"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958470"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958473"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958394"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958472"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">E2Ext Var Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958395"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM Exp2
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addTraversalsExp: TODO MapE&quot;</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM Exp2
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addTraversalsExp: TODO FoldE&quot;</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621680958419"><span class="annot"><span class="annottext">go :: Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680958419"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var">addTraversalsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958391"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958392"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958394"><span class="hs-identifier hs-var">context</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621680958407"><span class="annot"><span class="annottext">docase :: Var
-&gt; (String, [(Var, Var)], Exp2)
-&gt; PassM (String, [(Var, Var)], Exp2)
</span><a href="#local-6989586621680958407"><span class="hs-identifier hs-var hs-var">docase</span></a></span></span><span> </span><span id="local-6989586621680958487"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958487"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958488"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958488"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958489"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958489"><span class="hs-identifier hs-var">vlocs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958490"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958490"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958491"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958491"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958492"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958492"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; ([Var], [Var])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958489"><span class="hs-identifier hs-var">vlocs</span></a></span><span>
</span><span id="line-114"></span><span>          </span><span id="local-6989586621680958494"><span class="annot"><span class="annottext">env21 :: Env2 Ty2
</span><a href="#local-6989586621680958494"><span class="hs-identifier hs-var hs-var">env21</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
String -&gt; DDefs Ty2 -&gt; [Var] -&gt; [Var] -&gt; Env2 Ty2 -&gt; Env2 Ty2
String -&gt; DDefs Ty2 -&gt; [Var] -&gt; [Var] -&gt; Env2 Ty2 -&gt; Env2 Ty2
</span><a href="Gibbon.L2.Syntax.html#extendPatternMatchEnv"><span class="hs-identifier hs-var">extendPatternMatchEnv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958488"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958491"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958492"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958392"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-115"></span><span>          </span><span id="local-6989586621680958496"><span class="annot"><span class="annottext">renv1 :: RegEnv
</span><a href="#local-6989586621680958496"><span class="hs-identifier hs-var hs-var">renv1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; RegEnv -&gt; RegEnv) -&gt; RegEnv -&gt; [Var] -&gt; RegEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680958498"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958498"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621680958499"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958499"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958498"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958487"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958499"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958393"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958492"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-116"></span><span>          </span><span id="local-6989586621680958500"><span class="annot"><span class="annottext">needs_traversal :: Maybe [(Var, Var)]
</span><a href="#local-6989586621680958500"><span class="hs-identifier hs-var hs-var">needs_traversal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; (String, [(Var, Var)], Exp2)
-&gt; Maybe [(Var, Var)]
</span><a href="Gibbon.Passes.AddTraversals.html#needsTraversalCase"><span class="hs-identifier hs-var">needsTraversalCase</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958391"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958494"><span class="hs-identifier hs-var">env21</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958488"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958489"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958490"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [(Var, Var)]
</span><a href="#local-6989586621680958500"><span class="hs-identifier hs-var">needs_traversal</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">Maybe [(Var, Var)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(String, [(Var, Var)], Exp2) -&gt; PassM (String, [(Var, Var)], Exp2)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958488"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958489"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958490"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680958501"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958501"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>          </span><span id="local-6989586621680958502"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680958502"><span class="hs-identifier hs-var">dump_op</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DebugFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#dopt"><span class="hs-identifier hs-var">dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DebugFlag
</span><a href="Gibbon.DynFlags.html#Opt_D_Dump_Repair"><span class="hs-identifier hs-var">Opt_D_Dump_Repair</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Bool) -&gt; PassM DynFlags -&gt; PassM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; PassM () -&gt; PassM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680958502"><span class="hs-identifier hs-var">dump_op</span></a></span><span> </span><span class="annot"><span class="annottext">(PassM () -&gt; PassM ()) -&gt; PassM () -&gt; PassM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; PassM () -&gt; PassM ()
forall a. Int -&gt; String -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Adding traversals: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Out a =&gt; a -&gt; String
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958394"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; PassM ()
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>          </span><span class="hs-comment">-- Generate traversals: assuming that InferLocs has already generated</span><span>
</span><span id="line-125"></span><span>          </span><span class="hs-comment">-- the traversal functions, we only use it here.</span><span>
</span><span id="line-126"></span><span>          </span><span id="local-6989586621680958507"><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)]
</span><a href="#local-6989586621680958507"><span class="hs-identifier hs-var">trav_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)] -&gt; PassM [(Var, [Var], Ty2, Exp2)]
</span><a href="Gibbon.Passes.AddTraversals.html#genTravBinds"><span class="hs-identifier hs-var">genTravBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Var, Var) -&gt; (Exp2, Ty2)) -&gt; [(Var, Var)] -&gt; [(Exp2, Ty2)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680958509"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958509"><span class="hs-identifier hs-var">p_var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680958510"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958510"><span class="hs-identifier hs-var">_p_loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958509"><span class="hs-identifier hs-var">p_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Env2 Ty2 -&gt; Ty2
forall a. Out a =&gt; Var -&gt; Env2 a -&gt; a
</span><a href="Gibbon.Language.Syntax.html#lookupVEnv"><span class="hs-identifier hs-var">lookupVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958509"><span class="hs-identifier hs-var">p_var</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958494"><span class="hs-identifier hs-var">env21</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958501"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958488"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958489"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; (String, [(Var, Var)], Exp2))
-&gt; (Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; (String, [(Var, Var)], Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)]
</span><a href="#local-6989586621680958507"><span class="hs-identifier hs-var">trav_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; (String, [(Var, Var)], Exp2))
-&gt; PassM Exp2 -&gt; PassM (String, [(Var, Var)], Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-128"></span><span>            </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; String
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.AddTraversals.html#addTraversalsExp"><span class="hs-identifier hs-var">addTraversalsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958390"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958391"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958494"><span class="hs-identifier hs-var">env21</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958496"><span class="hs-identifier hs-var">renv1</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958394"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958490"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">-- | Collect all non-static items that need to be traversed (uses InferEffects).</span><span>
</span><span id="line-132"></span><span class="hs-comment">--</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- If we cannot unpack all the pattern matched variables:</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- (1) Everything after the first packed element should be unused in the RHS</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- (2) Otherwise, we must traverse the first (n-1) packed elements</span><span>
</span><span id="line-136"></span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#needsTraversalCase"><span class="hs-identifier hs-type">needsTraversalCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-137"></span><span id="needsTraversalCase"><span class="annot"><span class="annottext">needsTraversalCase :: DDefs Ty2
-&gt; FunDefs Exp2
-&gt; Env2 Ty2
-&gt; (String, [(Var, Var)], Exp2)
-&gt; Maybe [(Var, Var)]
</span><a href="Gibbon.Passes.AddTraversals.html#needsTraversalCase"><span class="hs-identifier hs-var hs-var">needsTraversalCase</span></a></span></span><span> </span><span id="local-6989586621680958545"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958545"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680958546"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958546"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680958547"><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958547"><span class="hs-identifier hs-var">env2</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958548"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958548"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958549"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958549"><span class="hs-identifier hs-var">vlocs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958550"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958550"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isAbsRANDataCon"><span class="hs-identifier hs-var">isAbsRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958548"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRelRANDataCon"><span class="hs-identifier hs-var">isRelRANDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958548"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe [(Var, Var)]
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958554"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958554"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680958555"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958555"><span class="hs-identifier hs-var">_locs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; ([Var], [Var])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958549"><span class="hs-identifier hs-var">vlocs</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span id="local-6989586621680958556"><span class="annot"><span class="annottext">tys :: [Ty2]
</span><a href="#local-6989586621680958556"><span class="hs-identifier hs-var hs-var">tys</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; String -&gt; [Ty2]
forall a. Out a =&gt; DDefs a -&gt; String -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958545"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958548"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-141"></span><span>      </span><span id="local-6989586621680958558"><span class="annot"><span class="annottext">tyenv :: Map Var Ty2
</span><a href="#local-6989586621680958558"><span class="hs-identifier hs-var hs-var">tyenv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; Map Var Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958554"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680958556"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>      </span><span id="local-6989586621680958559"><span class="annot"><span class="annottext">funenv :: Map Var (ArrowTy2 Ty2)
</span><a href="#local-6989586621680958559"><span class="hs-identifier hs-var hs-var">funenv</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; ArrowTy2 Ty2) -&gt; FunDefs Exp2 -&gt; Map Var (ArrowTy2 Ty2)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2 -&gt; ArrowTy (TyOf Exp2)
FunDef2 -&gt; ArrowTy2 Ty2
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680958546"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-143"></span><span>      </span><span id="local-6989586621680958561"><span class="annot"><span class="annottext">dps :: RegEnv
</span><a href="#local-6989586621680958561"><span class="hs-identifier hs-var hs-var">dps</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; RegEnv
forall {a}. Ord a =&gt; [a] -&gt; Map a a
</span><a href="#local-6989586621680958562"><span class="hs-identifier hs-var">makeDps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Var, Var) -&gt; Var) -&gt; [(Var, Var)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var) -&gt; Var
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958549"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680958565"><span class="annot"><span class="annottext">Set Effect
</span><a href="#local-6989586621680958565"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; Map Var (ArrowTy2 Ty2)
-&gt; Map Var Ty2
-&gt; RegEnv
-&gt; Exp2
-&gt; (Set Effect, Maybe Var)
</span><a href="Gibbon.Passes.InferEffects.html#inferExp"><span class="hs-identifier hs-var">inferExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680958545"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (ArrowTy2 Ty2)
</span><a href="#local-6989586621680958559"><span class="hs-identifier hs-var">funenv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var Ty2 -&gt; Map Var Ty2 -&gt; Map Var Ty2
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var Ty2
</span><a href="#local-6989586621680958558"><span class="hs-identifier hs-var">tyenv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; Map Var Ty2
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680958547"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958561"><span class="hs-identifier hs-var">dps</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958550"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="hs-comment">-- Note: Do not use Data.Map.filter. It changes the order sometimes.</span><span>
</span><span id="line-146"></span><span>      </span><span id="local-6989586621680958568"><span class="annot"><span class="annottext">packedOnly :: [(Var, Ty2)]
</span><a href="#local-6989586621680958568"><span class="hs-identifier hs-var hs-var">packedOnly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; Bool) -&gt; [(Var, Ty2)] -&gt; [(Var, Ty2)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">L.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680958569"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958569"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958569"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958554"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680958556"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>      </span><span id="local-6989586621680958562"><span class="annot"><span class="annottext">makeDps :: [a] -&gt; Map a a
</span><a href="#local-6989586621680958562"><span class="hs-identifier hs-var hs-var">makeDps</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map a a
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-149"></span><span>      </span><span class="annot"><a href="#local-6989586621680958562"><span class="hs-identifier hs-var">makeDps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map a a
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><a href="#local-6989586621680958562"><span class="hs-identifier hs-var">makeDps</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958576"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680958576"><span class="hs-identifier hs-var">v</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680958577"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680958577"><span class="hs-identifier hs-var">v'</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680958578"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680958578"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Map a a -&gt; Map a a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680958576"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680958577"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Map a a
</span><a href="#local-6989586621680958562"><span class="hs-identifier hs-var">makeDps</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680958578"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>      </span><span id="local-6989586621680958579"><span class="annot"><span class="annottext">effToLoc :: Effect -&gt; Var
</span><a href="#local-6989586621680958579"><span class="hs-identifier hs-var hs-var">effToLoc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Traverse"><span class="hs-identifier hs-type">Traverse</span></a></span><span> </span><span id="local-6989586621680958580"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958580"><span class="hs-identifier hs-var">loc_var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958580"><span class="hs-identifier hs-var">loc_var</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>      </span><span id="local-6989586621680958581"><span class="annot"><span class="annottext">not_traversed :: [Var]
</span><a href="#local-6989586621680958581"><span class="hs-identifier hs-var hs-var">not_traversed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)]
</span><a href="#local-6989586621680958568"><span class="hs-identifier hs-var">packedOnly</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-155"></span><span>                        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-156"></span><span>                        </span><span id="local-6989586621680958582"><span class="annot"><span class="annottext">[(Var, Ty2)]
</span><a href="#local-6989586621680958582"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958583"><span class="annot"><span class="annottext">locenv :: RegEnv
</span><a href="#local-6989586621680958583"><span class="hs-identifier hs-var hs-var">locenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; RegEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958549"><span class="hs-identifier hs-var">vlocs</span></a></span><span>
</span><span id="line-157"></span><span>                                  </span><span id="local-6989586621680958584"><span class="annot"><span class="annottext">packedlocs :: [Effect]
</span><a href="#local-6989586621680958584"><span class="hs-identifier hs-var hs-var">packedlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; Effect) -&gt; [(Var, Ty2)] -&gt; [Effect]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680958585"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958585"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Effect
</span><a href="Gibbon.L2.Syntax.html#Traverse"><span class="hs-identifier hs-var">Traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958583"><span class="hs-identifier hs-var">locenv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958585"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)]
</span><a href="#local-6989586621680958582"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-158"></span><span>                                  </span><span class="hs-comment">-- Get the locations of all non-static things which the RHS does not traverse.</span><span>
</span><span id="line-159"></span><span>                                  </span><span class="hs-comment">-- Note: Using Data.Set changes the order of packedlocs, and we would</span><span>
</span><span id="line-160"></span><span>                                  </span><span class="hs-comment">-- like to preserve it.</span><span>
</span><span id="line-161"></span><span>                              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Effect -&gt; Var) -&gt; [Effect] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Effect -&gt; Var
</span><a href="#local-6989586621680958579"><span class="hs-identifier hs-var">effToLoc</span></a></span><span> </span><span class="annot"><span class="annottext">([Effect] -&gt; [Var]) -&gt; [Effect] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Effect]
</span><a href="#local-6989586621680958584"><span class="hs-identifier hs-var">packedlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Effect] -&gt; [Effect] -&gt; [Effect]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#%5C%5C"><span class="hs-operator hs-var">L.\\</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Effect -&gt; [Effect]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set Effect
</span><a href="#local-6989586621680958565"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Ty2 -&gt; Bool) -&gt; [Ty2] -&gt; Maybe Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#findIndex"><span class="hs-identifier hs-var">L.findIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680958556"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [(Var, Var)]
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680958590"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680958590"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958581"><span class="hs-identifier hs-var">not_traversed</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-166"></span><span>                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [(Var, Var)]
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-167"></span><span>                     </span><span id="local-6989586621680958591"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958591"><span class="hs-identifier hs-var">_ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Why (i+1): findIndex is 0-based, and drop is not</span><span>
</span><span id="line-169"></span><span>                           </span><span id="local-6989586621680958592"><span class="annot"><span class="annottext">should_be_unused :: Set Var
</span><a href="#local-6989586621680958592"><span class="hs-identifier hs-var hs-var">should_be_unused</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; Set Var) -&gt; [Var] -&gt; Set Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; [Var]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#drop"><span class="hs-identifier hs-var">L.drop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680958590"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958554"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>                           </span><span class="hs-comment">-- LocVar -&gt; Var</span><span>
</span><span id="line-172"></span><span>                           </span><span id="local-6989586621680958595"><span class="annot"><span class="annottext">loc_var_mp :: RegEnv
</span><a href="#local-6989586621680958595"><span class="hs-identifier hs-var hs-var">loc_var_mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; RegEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Var)] -&gt; RegEnv) -&gt; [(Var, Var)] -&gt; RegEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Var, Var) -&gt; (Var, Var)) -&gt; [(Var, Var)] -&gt; [(Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680958596"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958596"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958597"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958597"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958597"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958596"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958549"><span class="hs-identifier hs-var">vlocs</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>                           </span><span class="hs-comment">-- POLICY: We only traverse the first (n-1) packed elements.</span><span>
</span><span id="line-175"></span><span>                           </span><span class="hs-comment">-- However if (n==1), we traverse that element. Need to audit this.</span><span>
</span><span id="line-176"></span><span>                           </span><span id="local-6989586621680958598"><span class="annot"><span class="annottext">ls :: [(Var, Var)]
</span><a href="#local-6989586621680958598"><span class="hs-identifier hs-var hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; (Var, Var)) -&gt; [Var] -&gt; [(Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680958599"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958599"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680958595"><span class="hs-identifier hs-var">loc_var_mp</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958599"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958599"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680958581"><span class="hs-identifier hs-var">not_traversed</span></a></span><span>
</span><span id="line-177"></span><span>                           </span><span id="local-6989586621680958600"><span class="annot"><span class="annottext">trav :: [(Var, Var)]
</span><a href="#local-6989586621680958600"><span class="hs-identifier hs-var hs-var">trav</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958598"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-178"></span><span>                                  </span><span class="hs-comment">-- [2020.05.01]: CSK, I haven't thought about this change too much. Maybe we need to revisit this.</span><span>
</span><span id="line-179"></span><span>                                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-180"></span><span>                                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; [(Var, Var)]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958598"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>                       </span><span class="hs-comment">-- If the problematic elements are unused, we don't need to add traversals</span><span>
</span><span id="line-183"></span><span>                       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; Exp2 -&gt; Bool
</span><a href="Gibbon.L2.Syntax.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680958592"><span class="hs-identifier hs-var">should_be_unused</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958550"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe [(Var, Var)]
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-185"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; Maybe [(Var, Var)]
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680958600"><span class="hs-identifier hs-var">trav</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="annot"><a href="Gibbon.Passes.AddTraversals.html#genTravBinds"><span class="hs-identifier hs-type">genTravBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-188"></span><span id="genTravBinds"><span class="annot"><span class="annottext">genTravBinds :: [(Exp2, Ty2)] -&gt; PassM [(Var, [Var], Ty2, Exp2)]
</span><a href="Gibbon.Passes.AddTraversals.html#genTravBinds"><span class="hs-identifier hs-var hs-var">genTravBinds</span></a></span></span><span> </span><span id="local-6989586621680958624"><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680958624"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Var, [Var], Ty2, Exp2)]] -&gt; [(Var, [Var], Ty2, Exp2)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[(Var, [Var], Ty2, Exp2)]] -&gt; [(Var, [Var], Ty2, Exp2)])
-&gt; PassM [[(Var, [Var], Ty2, Exp2)]]
-&gt; PassM [(Var, [Var], Ty2, Exp2)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
-&gt; ((Exp2, Ty2) -&gt; PassM [(Var, [Var], Ty2, Exp2)])
-&gt; PassM [[(Var, [Var], Ty2, Exp2)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680958624"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">(((Exp2, Ty2) -&gt; PassM [(Var, [Var], Ty2, Exp2)])
 -&gt; PassM [[(Var, [Var], Ty2, Exp2)]])
-&gt; ((Exp2, Ty2) -&gt; PassM [(Var, [Var], Ty2, Exp2)])
-&gt; PassM [[(Var, [Var], Ty2, Exp2)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680958626"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958626"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958627"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958627"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958627"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680958628"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958628"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680958629"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958629"><span class="hs-identifier hs-var">loc1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>          </span><span id="local-6989586621680958630"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958630"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;trav&quot;</span></span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680958632"><span class="annot"><span class="annottext">fn_name :: Var
</span><a href="#local-6989586621680958632"><span class="hs-identifier hs-var hs-var">fn_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Language.Constants.html#mkTravFunName"><span class="hs-identifier hs-var">mkTravFunName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680958628"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-194"></span><span>          </span><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)] -&gt; PassM [(Var, [Var], Ty2, Exp2)]
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958630"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ty2] -&gt; Ty2
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958632"><span class="hs-identifier hs-var">fn_name</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958629"><span class="hs-identifier hs-var">loc1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958626"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-comment">-- TODO: Write a testcase for this path.</span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680958635"><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680958635"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>          </span><span class="hs-comment">-- So that we don't have to make assumptions about the 'e' being a VarE</span><span>
</span><span id="line-198"></span><span>          </span><span id="local-6989586621680958636"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958636"><span class="hs-identifier hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;tmp_trav&quot;</span></span><span>
</span><span id="line-199"></span><span>          </span><span id="local-6989586621680958637"><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)]
</span><a href="#local-6989586621680958637"><span class="hs-identifier hs-var">proj_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-200"></span><span>            </span><span class="annot"><span class="annottext">[(Exp2, Ty2)] -&gt; PassM [(Var, [Var], Ty2, Exp2)]
</span><a href="Gibbon.Passes.AddTraversals.html#genTravBinds"><span class="hs-identifier hs-var">genTravBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(Exp2, Ty2)] -&gt; (Ty2, Int) -&gt; [(Exp2, Ty2)])
-&gt; [(Exp2, Ty2)] -&gt; [(Ty2, Int)] -&gt; [(Exp2, Ty2)]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680958639"><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680958639"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680958640"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958640"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680958641"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680958641"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-201"></span><span>                                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958640"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-202"></span><span>                                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkProj"><span class="hs-identifier hs-var">mkProj</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680958641"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958636"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958640"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2, Ty2) -&gt; [(Exp2, Ty2)] -&gt; [(Exp2, Ty2)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680958639"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-203"></span><span>                                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(Exp2, Ty2)]
</span><a href="#local-6989586621680958639"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>                                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty2] -&gt; [Int] -&gt; [(Ty2, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680958635"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>          </span><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)] -&gt; PassM [(Var, [Var], Ty2, Exp2)]
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, [Var], Ty2, Exp2)] -&gt; PassM [(Var, [Var], Ty2, Exp2)])
-&gt; [(Var, [Var], Ty2, Exp2)] -&gt; PassM [(Var, [Var], Ty2, Exp2)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680958636"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680958627"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680958626"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)]
-&gt; [(Var, [Var], Ty2, Exp2)] -&gt; [(Var, [Var], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)]
</span><a href="#local-6989586621680958637"><span class="hs-identifier hs-var">proj_binds</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, [Var], Ty2, Exp2)] -&gt; PassM [(Var, [Var], Ty2, Exp2)]
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span></pre></body></html>