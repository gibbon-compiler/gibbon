<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric, DeriveAnyClass #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-all #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.Passes.Fusion2</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#fusion2"><span class="hs-identifier">fusion2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Float.html#exp"><span class="hs-identifier">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Arrow.html#%26%26%26"><span class="hs-operator">(&amp;&amp;&amp;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html"><span class="hs-identifier">Data.Vector</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Unicode.html#toLower"><span class="hs-identifier">toLower</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Debug.Trace.html"><span class="hs-identifier">Debug.Trace</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/deepseq-1.4.8.0/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic1"><span class="hs-identifier">Generic1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.All.html"><span class="hs-identifier">Data.Tuple.All</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.Pretty.html"><span class="hs-identifier">Gibbon.Pretty</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.Passes.Freshen.html"><span class="hs-identifier">Gibbon.Passes.Freshen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Freshen.html#freshExp1"><span class="hs-identifier">freshExp1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html"><span class="hs-identifier">Gibbon.L1.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L1</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/text-2.0.2/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/text-2.0.2/src/Data.Text.html#breakOnAll"><span class="hs-identifier">breakOnAll</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier">pack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/text-2.0.2/src/Data.Text.html#splitOn"><span class="hs-identifier">splitOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">-- countFUS :: String -&gt; Int</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- countFUS str =  length $ breakOnAll (pack &quot;FUS&quot;)  (pack str)</span><span>
</span><span id="line-29"></span><span class="hs-comment">--       --  `debug1` (&quot;opppa&quot; L.++</span><span>
</span><span id="line-30"></span><span class="hs-comment">--       --      (show str) L.++&quot;\nress:\n&quot;</span><span>
</span><span id="line-31"></span><span class="hs-comment">--       --      L.++ (show (breakOnAll (pack str) (pack &quot;FUS&quot;) ))</span><span>
</span><span id="line-32"></span><span class="hs-comment">--       --       )</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#wordCount"><span class="hs-identifier hs-type">wordCount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-36"></span><span id="wordCount"><span class="annot"><span class="annottext">wordCount :: String -&gt; [(String, Int)]
</span><a href="Gibbon.Passes.Fusion2.html#wordCount"><span class="hs-identifier hs-var hs-var">wordCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; (String, Int)) -&gt; [[String]] -&gt; [(String, Int)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; String
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String)
-&gt; ([String] -&gt; Int) -&gt; [String] -&gt; (String, Int)
forall b c c'. (b -&gt; c) -&gt; (b -&gt; c') -&gt; b -&gt; (c, c')
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Arrow.html#%26%26%26"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[String]] -&gt; [(String, Int)])
-&gt; (String -&gt; [[String]]) -&gt; String -&gt; [(String, Int)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [[String]]
forall a. Eq a =&gt; [a] -&gt; [[a]]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#group"><span class="hs-identifier hs-var">L.group</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [[String]])
-&gt; (String -&gt; [String]) -&gt; String -&gt; [[String]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#sort"><span class="hs-identifier hs-var">L.sort</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String])
-&gt; (String -&gt; [String]) -&gt; String -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#words"><span class="hs-identifier hs-var">L.words</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; (String -&gt; String) -&gt; String -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Unicode.html#toLower"><span class="hs-identifier hs-var">toLower</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#countFUS"><span class="hs-identifier hs-type">countFUS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span id="countFUS"><span class="annot"><span class="annottext">countFUS :: String -&gt; (Int, Int)
</span><a href="Gibbon.Passes.Fusion2.html#countFUS"><span class="hs-identifier hs-var hs-var">countFUS</span></a></span></span><span> </span><span id="local-6989586621680982113"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982113"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982114"><span class="annot"><span class="annottext">ls1 :: [Text]
</span><a href="#local-6989586621680982114"><span class="hs-identifier hs-var hs-var">ls1</span></a></span></span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/text-2.0.2/src/Data.Text.html#splitOn"><span class="hs-identifier hs-var">splitOn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_f_&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/text-2.0.2/src/Data.Text.Internal.html#pack"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982113"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-40"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982115"><span class="annot"><span class="annottext">ls2 :: [Text]
</span><a href="#local-6989586621680982115"><span class="hs-identifier hs-var hs-var">ls2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; [Text] -&gt; [Text]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">L.concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680982117"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982117"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/text-2.0.2/src/Data.Text.html#splitOn"><span class="hs-identifier hs-var">splitOn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_FUS&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982117"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680982114"><span class="hs-identifier hs-var">ls1</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-41"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982118"><span class="annot"><span class="annottext">ls3 :: [Text]
</span><a href="#local-6989586621680982118"><span class="hs-identifier hs-var hs-var">ls3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; [Text] -&gt; [Text]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">L.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680982119"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982119"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982119"><span class="hs-identifier hs-var">txt</span></a></span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680982119"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680982115"><span class="hs-identifier hs-var">ls2</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-42"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982122"><span class="annot"><span class="annottext">ls4 :: [[Text]]
</span><a href="#local-6989586621680982122"><span class="hs-identifier hs-var hs-var">ls4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [[Text]]
forall a. Eq a =&gt; [a] -&gt; [[a]]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#group"><span class="hs-identifier hs-var">L.group</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#sort"><span class="hs-identifier hs-var">L.sort</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680982118"><span class="hs-identifier hs-var">ls3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-43"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982123"><span class="annot"><span class="annottext">ls5 :: [Int]
</span><a href="#local-6989586621680982123"><span class="hs-identifier hs-var hs-var">ls5</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Int) -&gt; [[Text]] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680982124"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680982124"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">[Text] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680982124"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621680982122"><span class="hs-identifier hs-var">ls4</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-44"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982125"><span class="annot"><span class="annottext">mx :: Int
</span><a href="#local-6989586621680982125"><span class="hs-identifier hs-var hs-var">mx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#maximum"><span class="hs-identifier hs-var">maximum</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680982123"><span class="hs-identifier hs-var">ls5</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-45"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982125"><span class="hs-identifier hs-var">mx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680982118"><span class="hs-identifier hs-var">ls3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>                  </span><span class="annot"><span class="annottext">(Int, Int) -&gt; String -&gt; (Int, Int)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug1"><span class="hs-operator hs-var">`debug1`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982125"><span class="hs-identifier hs-var">mx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;opppa&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680982123"><span class="hs-identifier hs-var">ls5</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680982118"><span class="hs-identifier hs-var">ls3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982113"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span id="debug"><span class="annot"><span class="annottext">debug :: c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-identifier hs-var hs-var">debug</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(String -&gt; c -&gt; c) -&gt; c -&gt; String -&gt; c
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String -&gt; c -&gt; c
forall a. Int -&gt; String -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span id="debug1"><span class="annot"><span class="annottext">debug1 :: c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug1"><span class="hs-identifier hs-var hs-var">debug1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; c -&gt; c) -&gt; c -&gt; String -&gt; c
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String -&gt; c -&gt; c
forall a. Int -&gt; String -&gt; a -&gt; a
</span><a href="Gibbon.Common.html#dbgTrace"><span class="hs-identifier hs-var">dbgTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-comment">{-

E.g.

    gibbon_main =
      let tinput = generateTree
          t1 = travers1(tinoput)
          t2 = traverse2(tinput)
      in 10

For htis program, the DefTAble looks like:

  {
    tinput -&gt; DefTableEntry { def      = generateTree
                            , fun_uses = [ (traverse1(..), 0 , t1), (traverse2, 0 , t2) ],
                              all_use_count = 2
                            }

    t1 -&gt; DefTableEntry { def      = traverse1(..)
                        , fun_uses = [ ],
                        , all_use_count = 0
                        }
  }

-}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">type</span><span> </span><span id="DefTable"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTable"><span class="hs-identifier hs-var">DefTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">{- There will be one entry for each variable in the table. Each entry consist of
    1)The function application expression.
    2)The index at which the definition  appears at in the argument list.
    3)The defined symbol, if the the consuming expression of the form let x=App.
-}</span><span>
</span><span id="line-86"></span><span class="hs-keyword">data</span><span> </span><span id="DefTableEntry"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-var">DefTableEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DefTableEntry"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-var">DefTableEntry</span></a></span></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="def"><span class="annot"><span class="annottext">DefTableEntry -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#def"><span class="hs-identifier hs-var hs-var">def</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The expression that defines this variable</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="fun_uses"><span class="annot"><span class="annottext">DefTableEntry -&gt; [FunctionUses]
</span><a href="Gibbon.Passes.Fusion2.html#fun_uses"><span class="hs-identifier hs-var hs-var">fun_uses</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FunctionUses"><span class="hs-identifier hs-type">FunctionUses</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ()</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="all_use_count"><span class="annot"><span class="annottext">DefTableEntry -&gt; Int
</span><a href="Gibbon.Passes.Fusion2.html#all_use_count"><span class="hs-identifier hs-var hs-var">all_use_count</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ total number of uses (calls and not)</span></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="varType"><span class="annot"><span class="annottext">DefTableEntry -&gt; Ty1
</span><a href="Gibbon.Passes.Fusion2.html#varType"><span class="hs-identifier hs-var hs-var">varType</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982138"><span id="local-6989586621680982151"><span id="local-6989586621680982155"><span class="annot"><span class="annottext">Int -&gt; DefTableEntry -&gt; String -&gt; String
[DefTableEntry] -&gt; String -&gt; String
DefTableEntry -&gt; String
(Int -&gt; DefTableEntry -&gt; String -&gt; String)
-&gt; (DefTableEntry -&gt; String)
-&gt; ([DefTableEntry] -&gt; String -&gt; String)
-&gt; Show DefTableEntry
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Int -&gt; DefTableEntry -&gt; String -&gt; String
showsPrec :: Int -&gt; DefTableEntry -&gt; String -&gt; String
$cshow :: DefTableEntry -&gt; String
show :: DefTableEntry -&gt; String
$cshowList :: [DefTableEntry] -&gt; String -&gt; String
showList :: [DefTableEntry] -&gt; String -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982167"><span id="local-6989586621680982169"><span class="annot"><span class="annottext">(forall x. DefTableEntry -&gt; Rep DefTableEntry x)
-&gt; (forall x. Rep DefTableEntry x -&gt; DefTableEntry)
-&gt; Generic DefTableEntry
forall x. Rep DefTableEntry x -&gt; DefTableEntry
forall x. DefTableEntry -&gt; Rep DefTableEntry x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. DefTableEntry -&gt; Rep DefTableEntry x
from :: forall x. DefTableEntry -&gt; Rep DefTableEntry x
$cto :: forall x. Rep DefTableEntry x -&gt; DefTableEntry
to :: forall x. Rep DefTableEntry x -&gt; DefTableEntry
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">type</span><span> </span><span id="FunctionUses"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FunctionUses"><span class="hs-identifier hs-var">FunctionUses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-comment">-- The AppE that uses a variable.</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>  </span><span class="hs-comment">-- i where variable V is the i'th argument in this function call.</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="hs-comment">-- The variable that binds this AppE.</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">type</span><span> </span><span id="PotentialPair"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#PotentialPair"><span class="hs-identifier hs-var">PotentialPair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">type</span><span> </span><span id="PotentialsList"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#PotentialsList"><span class="hs-identifier hs-var">PotentialsList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#freshFunction"><span class="hs-identifier hs-type">freshFunction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-105"></span><span id="freshFunction"><span class="annot"><span class="annottext">freshFunction :: FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#freshFunction"><span class="hs-identifier hs-var hs-var">freshFunction</span></a></span></span><span> </span><span id="local-6989586621680982212"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982212"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621680982213"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982213"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarEnv -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.Freshen.html#freshExp1"><span class="hs-identifier hs-var">freshExp1</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982212"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621680982216"><span class="annot"><span class="annottext">f' :: FunDef1
</span><a href="#local-6989586621680982216"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982212"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982213"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982217"><span class="annot"><span class="annottext">argsOld :: [Var]
</span><a href="#local-6989586621680982217"><span class="hs-identifier hs-var hs-var">argsOld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982216"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621680982219"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982219"><span class="hs-identifier hs-var">argsNew</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; [Var] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982217"><span class="hs-identifier hs-var">argsOld</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982222"><span class="annot"><span class="annottext">f'' :: FunDef1
</span><a href="#local-6989586621680982222"><span class="hs-identifier hs-var hs-var">f''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982216"><span class="hs-identifier hs-var">f'</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funArgs :: [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982219"><span class="hs-identifier hs-var">argsNew</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef1 -&gt; PassM FunDef1) -&gt; FunDef1 -&gt; PassM FunDef1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var] -&gt; [Var] -&gt; FunDef1
forall {e :: * -&gt; * -&gt; *} {l} {d}.
(Expression (e l d), SubstitutableExt (PreExp e l d) (e l d), Eq d,
 Eq l, Eq (e l d), Show d, Show l, Out d, Out l) =&gt;
FunDef (PreExp e l d) -&gt; [Var] -&gt; [Var] -&gt; FunDef (PreExp e l d)
</span><a href="#local-6989586621680982223"><span class="hs-identifier hs-var">substArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982222"><span class="hs-identifier hs-var">f''</span></a></span><span>  </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982217"><span class="hs-identifier hs-var">argsOld</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982219"><span class="hs-identifier hs-var">argsNew</span></a></span><span>
</span><span id="line-112"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621680982223"><span class="annot"><span class="annottext">substArgs :: FunDef (PreExp e l d) -&gt; [Var] -&gt; [Var] -&gt; FunDef (PreExp e l d)
</span><a href="#local-6989586621680982223"><span class="hs-identifier hs-var hs-var">substArgs</span></a></span></span><span> </span><span id="local-6989586621680982262"><span class="annot"><span class="annottext">FunDef (PreExp e l d)
</span><a href="#local-6989586621680982262"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp e l d)
</span><a href="#local-6989586621680982262"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><a href="#local-6989586621680982223"><span class="hs-identifier hs-var">substArgs</span></a></span><span> </span><span id="local-6989586621680982263"><span class="annot"><span class="annottext">FunDef (PreExp e l d)
</span><a href="#local-6989586621680982263"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982264"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982264"><span class="hs-identifier hs-var">old</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680982265"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982265"><span class="hs-identifier hs-var">told</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982266"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982266"><span class="hs-identifier hs-var">new</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680982267"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982267"><span class="hs-identifier hs-var">tnew</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982268"><span class="annot"><span class="annottext">f' :: FunDef (PreExp e l d)
</span><a href="#local-6989586621680982268"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp e l d)
</span><a href="#local-6989586621680982263"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: PreExp e l d
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp e l d
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982264"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp e l d
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982266"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef (PreExp e l d) -&gt; PreExp e l d
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp e l d)
</span><a href="#local-6989586621680982263"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp e l d) -&gt; [Var] -&gt; [Var] -&gt; FunDef (PreExp e l d)
</span><a href="#local-6989586621680982223"><span class="hs-identifier hs-var">substArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp e l d)
</span><a href="#local-6989586621680982268"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982265"><span class="hs-identifier hs-var">told</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982267"><span class="hs-identifier hs-var">tnew</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#removeCommonExpressions"><span class="hs-identifier hs-type">removeCommonExpressions</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-119"></span><span id="removeCommonExpressions"><span class="annot"><span class="annottext">removeCommonExpressions :: Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeCommonExpressions"><span class="hs-identifier hs-var hs-var">removeCommonExpressions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
(Expression (ext loc dec),
 SubstitutableExt (PreExp ext loc dec) (ext loc dec), Eq dec,
 Eq loc, Eq (ext loc dec), Show dec, Show loc, Out dec, Out loc) =&gt;
PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-120"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621680982292"><span class="annot"><span class="annottext">go :: PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680982327"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982327"><span class="hs-identifier hs-var">exp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982327"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-122"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982329"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982329"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982330"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982331"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680982331"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982332"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982332"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982333"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982333"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982332"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680982335"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982335"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680982336"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982336"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-125"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982337"><span class="annot"><span class="annottext">oldExp :: PreExp ext loc dec
</span><a href="#local-6989586621680982337"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982329"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-126"></span><span>                  </span><span id="local-6989586621680982338"><span class="annot"><span class="annottext">newExp :: PreExp ext loc dec
</span><a href="#local-6989586621680982338"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982335"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982336"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-127"></span><span>                  </span><span id="local-6989586621680982339"><span class="annot"><span class="annottext">body' :: PreExp ext loc dec
</span><a href="#local-6989586621680982339"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982337"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982338"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982333"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-128"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982339"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-comment">-- `debug` (&quot;replace ::&quot;L.++ (show oldExp) L.++ &quot;with&quot; L.++ (show newExp))</span><span>
</span><span id="line-129"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680982340"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982340"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982341"><span class="annot"><span class="annottext">oldExp :: PreExp ext loc dec
</span><a href="#local-6989586621680982341"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982329"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-131"></span><span>                  </span><span id="local-6989586621680982342"><span class="annot"><span class="annottext">newExp :: PreExp ext loc dec
</span><a href="#local-6989586621680982342"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982340"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-132"></span><span>                  </span><span id="local-6989586621680982343"><span class="annot"><span class="annottext">body' :: PreExp ext loc dec
</span><a href="#local-6989586621680982343"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982341"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982342"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982333"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-133"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982343"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-134"></span><span>            </span><span id="local-6989586621680982344"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982344"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-135"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982345"><span class="annot"><span class="annottext">oldExp :: PreExp ext loc dec
</span><a href="#local-6989586621680982345"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982332"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-136"></span><span>                  </span><span id="local-6989586621680982346"><span class="annot"><span class="annottext">newExp :: PreExp ext loc dec
</span><a href="#local-6989586621680982346"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982329"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-137"></span><span>                  </span><span id="local-6989586621680982347"><span class="annot"><span class="annottext">body' :: PreExp ext loc dec
</span><a href="#local-6989586621680982347"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982345"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982346"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982333"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-comment">--`debug` (&quot;removing duplicates of &quot;L.++ (show oldExp))</span><span>
</span><span id="line-138"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982329"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680982330"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680982331"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982332"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982347"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680982349"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982349"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680982350"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982350"><span class="hs-identifier hs-var">thenBody</span></a></span></span><span> </span><span id="local-6989586621680982351"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982351"><span class="hs-identifier hs-var">elseBody</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982349"><span class="hs-identifier hs-var">cond</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982350"><span class="hs-identifier hs-var">thenBody</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982351"><span class="hs-identifier hs-var">elseBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982353"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982353"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680982354"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982354"><span class="hs-identifier hs-var">ls</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982355"><span class="annot"><span class="annottext">ls' :: [(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982355"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec)
 -&gt; (String, [(Var, loc)], PreExp ext loc dec))
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982356"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982356"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982357"><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680982357"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982358"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982358"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982356"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680982357"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982358"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982354"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-143"></span><span>          </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982353"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982355"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680982360"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982360"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680982361"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680982361"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680982362"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982362"><span class="hs-identifier hs-var">y</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982292"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982360"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680982361"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982362"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-146"></span><span>      </span><span id="local-6989586621680982363"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982363"><span class="hs-identifier hs-var">x</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982363"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#simplifyProjections"><span class="hs-identifier hs-type">simplifyProjections</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-149"></span><span id="simplifyProjections"><span class="annot"><span class="annottext">simplifyProjections :: Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyProjections"><span class="hs-identifier hs-var hs-var">simplifyProjections</span></a></span></span><span> </span><span id="local-6989586621680982390"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982390"><span class="hs-identifier hs-var">expin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeCommonExpressions"><span class="hs-identifier hs-var">removeCommonExpressions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982390"><span class="hs-identifier hs-var">expin</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621680982391"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680982392"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982392"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680982393"><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982392"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982394"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982394"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982395"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982395"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982396"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982396"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982397"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982397"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982398"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982398"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982397"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-154"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680982400"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982400"><span class="hs-identifier hs-var">prodList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982401"><span class="annot"><span class="annottext">bind' :: Exp1
</span><a href="#local-6989586621680982401"><span class="hs-identifier hs-var hs-var">bind'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982397"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-156"></span><span>                  </span><span id="local-6989586621680982402"><span class="annot"><span class="annottext">mp' :: Map Var (Vector Exp1)
</span><a href="#local-6989586621680982402"><span class="hs-identifier hs-var hs-var">mp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
-&gt; Vector Exp1 -&gt; Map Var (Vector Exp1) -&gt; Map Var (Vector Exp1)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982394"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982400"><span class="hs-identifier hs-var">prodList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-157"></span><span>                  </span><span id="local-6989586621680982405"><span class="annot"><span class="annottext">body' :: Exp1
</span><a href="#local-6989586621680982405"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982398"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982402"><span class="hs-identifier hs-var">mp'</span></a></span><span>
</span><span id="line-158"></span><span>              </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982394"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982395"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982396"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982401"><span class="hs-identifier hs-var">bind'</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982405"><span class="hs-identifier hs-var">body'</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; String -&gt; Exp1
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug1"><span class="hs-operator hs-var">`debug1`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;here is one lol&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982390"><span class="hs-identifier hs-var">expin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>            </span><span id="local-6989586621680982408"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982408"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-161"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982409"><span class="annot"><span class="annottext">bind' :: Exp1
</span><a href="#local-6989586621680982409"><span class="hs-identifier hs-var hs-var">bind'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982397"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-162"></span><span>                  </span><span id="local-6989586621680982410"><span class="annot"><span class="annottext">body' :: Exp1
</span><a href="#local-6989586621680982410"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982398"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-163"></span><span>              </span><span class="hs-keyword">in</span><span>   </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982394"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982395"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982396"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982409"><span class="hs-identifier hs-var">bind'</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982410"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680982411"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982411"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680982412"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982412"><span class="hs-identifier hs-var">thenBody</span></a></span></span><span> </span><span id="local-6989586621680982413"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982413"><span class="hs-identifier hs-var">elseBody</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982411"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982412"><span class="hs-identifier hs-var">thenBody</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982413"><span class="hs-identifier hs-var">elseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982414"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982414"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680982415"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982415"><span class="hs-identifier hs-var">ls</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982416"><span class="annot"><span class="annottext">ls' :: [(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982416"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982417"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982417"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982418"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680982418"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982419"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982419"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982417"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680982418"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982419"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982415"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-169"></span><span>          </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982414"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982416"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680982421"><span class="annot"><span class="annottext">Prim Ty1
</span><a href="#local-6989586621680982421"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680982422"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982422"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982423"><span class="annot"><span class="annottext">ls' :: [Exp1]
</span><a href="#local-6989586621680982423"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982422"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Prim Ty1 -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty1
</span><a href="#local-6989586621680982421"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982423"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680982424"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982424"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680982425"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982425"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680982426"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982426"><span class="hs-identifier hs-var">y</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; Ty1 -&gt; Bool -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982424"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982425"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982426"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">L1.ProjE</span></a></span><span> </span><span id="local-6989586621680982427"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982427"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680982428"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982428"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982428"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-179"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680982429"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982429"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-180"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var (Vector Exp1) -&gt; Maybe (Vector Exp1)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982429"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-181"></span><span>               </span><span class="annot"><span class="annottext">Maybe (Vector Exp1)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">L1.ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982427"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982428"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-182"></span><span>               </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680982431"><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680982431"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680982431"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; Int -&gt; Exp1
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982427"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-183"></span><span>          </span><span id="local-6989586621680982433"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982433"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">L1.ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982427"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982428"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680982435"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680982435"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680982436"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982436"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621680982437"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982437"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982438"><span class="annot"><span class="annottext">ls' :: [Exp1]
</span><a href="#local-6989586621680982438"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982437"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">() -&gt; String -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680982435"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982436"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982438"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680982440"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982440"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680982441"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982441"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680982442"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982442"><span class="hs-identifier hs-var">args</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>          </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982440"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982441"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982442"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680982443"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982443"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982444"><span class="annot"><span class="annottext">ls' :: [Exp1]
</span><a href="#local-6989586621680982444"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var (Vector Exp1) -&gt; Exp1
</span><a href="#local-6989586621680982391"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Vector Exp1)
</span><a href="#local-6989586621680982393"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982443"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-keyword">in</span><span>    </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982444"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>      </span><span id="local-6989586621680982445"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982445"><span class="hs-identifier hs-var">x</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982445"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#replaceLeafWithExp"><span class="hs-identifier hs-type">replaceLeafWithExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-196"></span><span id="replaceLeafWithExp"><span class="annot"><span class="annottext">replaceLeafWithExp :: Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#replaceLeafWithExp"><span class="hs-identifier hs-var hs-var">replaceLeafWithExp</span></a></span></span><span> </span><span id="local-6989586621680982447"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982447"><span class="hs-identifier hs-var">exp</span></a></span></span><span>  </span><span id="local-6989586621680982448"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982448"><span class="hs-identifier hs-var">newTail</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982449"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982447"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-198"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>     </span><span id="local-6989586621680982449"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982449"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680982450"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982450"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982450"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-201"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">L1.LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982451"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982451"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680982452"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982452"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680982453"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982453"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982454"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982454"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982455"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982455"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">L1.LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982451"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982452"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982453"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982454"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982449"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982455"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>            </span><span id="local-6989586621680982456"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982456"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982448"><span class="hs-identifier hs-var">newTail</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#replaceLeafWithBind"><span class="hs-identifier hs-type">replaceLeafWithBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-205"></span><span id="replaceLeafWithBind"><span class="annot"><span class="annottext">replaceLeafWithBind :: Exp1 -&gt; (Int -&gt; Var) -&gt; Ty1 -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#replaceLeafWithBind"><span class="hs-identifier hs-var hs-var">replaceLeafWithBind</span></a></span></span><span> </span><span id="local-6989586621680982458"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982458"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680982459"><span class="annot"><span class="annottext">Int -&gt; Var
</span><a href="#local-6989586621680982459"><span class="hs-identifier hs-var">genVar</span></a></span></span><span> </span><span id="local-6989586621680982460"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982460"><span class="hs-identifier hs-var">varType</span></a></span></span><span> </span><span id="local-6989586621680982461"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982461"><span class="hs-identifier hs-var">tailExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982462"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982458"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-207"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>     </span><span id="local-6989586621680982462"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982462"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680982463"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982463"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982463"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-210"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">L1.LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982464"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982464"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680982465"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982465"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680982466"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982466"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982467"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982467"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982468"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982468"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">L1.LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982464"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982465"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982466"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982467"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982462"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982468"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>          </span><span id="local-6989586621680982469"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982469"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982460"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-212"></span><span>              </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680982471"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982471"><span class="hs-identifier hs-var">ls2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-213"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982472"><span class="annot"><span class="annottext">xDestructed :: Vector Exp1
</span><a href="#local-6989586621680982472"><span class="hs-identifier hs-var hs-var">xDestructed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982469"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680982473"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982473"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982473"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>                      </span><span id="local-6989586621680982474"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680982474"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Int -&gt; Ty1 -&gt; Exp1) -&gt; Exp1 -&gt; Vector Ty1 -&gt; Exp1
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-215"></span><span>                              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680982476"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982476"><span class="hs-identifier hs-var">tExp</span></a></span></span><span> </span><span id="local-6989586621680982477"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982477"><span class="hs-identifier hs-var">subscript</span></a></span></span><span> </span><span id="local-6989586621680982478"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982478"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982479"><span class="annot"><span class="annottext">newVar :: Var
</span><a href="#local-6989586621680982479"><span class="hs-identifier hs-var hs-var">newVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Var
</span><a href="#local-6989586621680982459"><span class="hs-identifier hs-var">genVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982477"><span class="hs-identifier hs-var">subscript</span></a></span><span>
</span><span id="line-217"></span><span>                                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">L1.LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982479"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982478"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680982472"><span class="hs-identifier hs-var">xDestructed</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; Int -&gt; Exp1
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982477"><span class="hs-identifier hs-var">subscript</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982476"><span class="hs-identifier hs-var">tExp</span></a></span><span>
</span><span id="line-218"></span><span>                              </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982461"><span class="hs-identifier hs-var">tailExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1] -&gt; Vector Ty1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982471"><span class="hs-identifier hs-var">ls2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982474"><span class="hs-identifier hs-var">newExp</span></a></span><span>
</span><span id="line-220"></span><span>              </span><span id="local-6989586621680982480"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982480"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982481"><span class="annot"><span class="annottext">newVar :: Var
</span><a href="#local-6989586621680982481"><span class="hs-identifier hs-var hs-var">newVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Var
</span><a href="#local-6989586621680982459"><span class="hs-identifier hs-var">genVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-222"></span><span>                </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">L1.LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982481"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982460"><span class="hs-identifier hs-var">varType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982469"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982461"><span class="hs-identifier hs-var">tailExp</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#addOuterTailCall"><span class="hs-identifier hs-type">addOuterTailCall</span></a></span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-225"></span><span id="addOuterTailCall"><span class="annot"><span class="annottext">addOuterTailCall :: Exp1 -&gt; Var -&gt; Var -&gt; Ty1 -&gt; [Exp1] -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#addOuterTailCall"><span class="hs-identifier hs-var hs-var">addOuterTailCall</span></a></span></span><span> </span><span id="local-6989586621680982483"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982483"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680982484"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982484"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680982485"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982485"><span class="hs-identifier hs-var">parName</span></a></span></span><span> </span><span id="local-6989586621680982486"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982486"><span class="hs-identifier hs-var">varType</span></a></span></span><span> </span><span id="local-6989586621680982487"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982487"><span class="hs-identifier hs-var">outerArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeCommonExpressions"><span class="hs-identifier hs-var">removeCommonExpressions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982488"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982483"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-228"></span><span>     </span><span id="local-6989586621680982488"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982488"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680982489"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982489"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982489"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-230"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">L1.LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982490"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982490"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680982491"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982491"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680982492"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982492"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982493"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982493"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982494"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982494"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">L1.LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982490"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680982491"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982492"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982493"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680982488"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982494"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>          </span><span id="local-6989586621680982495"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982495"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982496"><span class="annot"><span class="annottext">newCall :: Exp1
</span><a href="#local-6989586621680982496"><span class="hs-identifier hs-var hs-var">newCall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982484"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982485"><span class="hs-identifier hs-var">parName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [Exp1] -&gt; [Exp1]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982487"><span class="hs-identifier hs-var">outerArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>                </span><span id="local-6989586621680982497"><span class="annot"><span class="annottext">newLet :: Exp1
</span><a href="#local-6989586621680982497"><span class="hs-identifier hs-var hs-var">newLet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982485"><span class="hs-identifier hs-var">parName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982486"><span class="hs-identifier hs-var">varType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982495"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982496"><span class="hs-identifier hs-var">newCall</span></a></span><span>
</span><span id="line-234"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982497"><span class="hs-identifier hs-var">newLet</span></a></span><span>
</span><span id="line-235"></span><span class="hs-comment">{- This function&#8776; collect the following information for each defined variable:
  1) The defining expression. (stored in DefTableEntry::def)
  2) The consumer of the definition that are candidates for fusion;the function
  is consumed in the first argument. (stored in DefTableEntry::fun_uses)
  not: uses mutual exclusive paths are counted by adding them (each is
  considered  a use).
  3) Total number of uses (references) of the defined variable.
-}</span><span>
</span><span id="line-243"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#buildDefTable"><span class="hs-identifier hs-type">buildDefTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a></span><span>
</span><span id="line-244"></span><span id="buildDefTable"><span class="annot"><span class="annottext">buildDefTable :: Exp1 -&gt; DefTable
</span><a href="Gibbon.Passes.Fusion2.html#buildDefTable"><span class="hs-identifier hs-var hs-var">buildDefTable</span></a></span></span><span> </span><span id="local-6989586621680982499"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982499"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982499"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621680982500"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680982522"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982522"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span id="local-6989586621680982523"><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982523"><span class="hs-identifier hs-var">definingSymbol</span></a></span></span><span> </span><span id="local-6989586621680982524"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982522"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680982526"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982526"><span class="hs-identifier hs-var">sym</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DefTableEntry -&gt; Maybe DefTableEntry)
-&gt; Symbol -&gt; DefTable -&gt; DefTable
forall k a. Ord k =&gt; (a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#update"><span class="hs-identifier hs-var">M.update</span></a></span><span> </span><span class="annot"><span class="annottext">DefTableEntry -&gt; Maybe DefTableEntry
</span><a href="#local-6989586621680982528"><span class="hs-identifier hs-var">incrUses</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982526"><span class="hs-identifier hs-var">sym</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680982529"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982529"><span class="hs-identifier hs-var">symLet</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982530"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982530"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982531"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982531"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982532"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982532"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-250"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982533"><span class="annot"><span class="annottext">table' :: DefTable
</span><a href="#local-6989586621680982533"><span class="hs-identifier hs-var hs-var">table'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>                </span><span class="annot"><span class="annottext">Symbol -&gt; DefTableEntry -&gt; DefTable -&gt; DefTable
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span>
</span><span id="line-252"></span><span>                  </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982529"><span class="hs-identifier hs-var">symLet</span></a></span><span>
</span><span id="line-253"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span>
</span><span id="line-254"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">def :: Exp1
</span><a href="Gibbon.Passes.Fusion2.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982531"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-255"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fun_uses :: [FunctionUses]
</span><a href="Gibbon.Passes.Fusion2.html#fun_uses"><span class="hs-identifier hs-var">fun_uses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">all_use_count :: Int
</span><a href="Gibbon.Passes.Fusion2.html#all_use_count"><span class="hs-identifier hs-var">all_use_count</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-257"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">varType :: Ty1
</span><a href="Gibbon.Passes.Fusion2.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982530"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-258"></span><span>                     </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>                  </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-260"></span><span>              </span><span id="local-6989586621680982534"><span class="annot"><span class="annottext">table'' :: DefTable
</span><a href="#local-6989586621680982534"><span class="hs-identifier hs-var hs-var">table''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982531"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Maybe Symbol
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982529"><span class="hs-identifier hs-var">symLet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982533"><span class="hs-identifier hs-var">table'</span></a></span><span>
</span><span id="line-261"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982532"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982523"><span class="hs-identifier hs-var">definingSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982534"><span class="hs-identifier hs-var">table''</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">-- The thing that is traversed is always the first argument.</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- Here, we record a function use for the first argument</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-comment">-- in the DefTable.</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-comment">-- add function uses of interest</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-comment">-- [functions calls traversing tree in first argument]</span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680982535"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982535"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680982536"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982536"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-269"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982537"><span class="annot"><span class="annottext">addFunctionUse :: FunctionUses -&gt; DefTableEntry -&gt; Maybe DefTableEntry
</span><a href="#local-6989586621680982537"><span class="hs-identifier hs-var hs-var">addFunctionUse</span></a></span></span><span> </span><span id="local-6989586621680982538"><span class="annot"><span class="annottext">FunctionUses
</span><a href="#local-6989586621680982538"><span class="hs-identifier hs-var">newUse</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span> </span><span id="local-6989586621680982539"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982539"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621680982540"><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982540"><span class="hs-identifier hs-var">fun_uses</span></a></span></span><span> </span><span id="local-6989586621680982541"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982541"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680982542"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982542"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>                </span><span class="annot"><span class="annottext">DefTableEntry -&gt; Maybe DefTableEntry
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(DefTableEntry -&gt; Maybe DefTableEntry)
-&gt; DefTableEntry -&gt; Maybe DefTableEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [FunctionUses] -&gt; Int -&gt; Ty1 -&gt; DefTableEntry
</span><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-var">DefTableEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982539"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunctionUses
</span><a href="#local-6989586621680982538"><span class="hs-identifier hs-var">newUse</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionUses -&gt; [FunctionUses] -&gt; [FunctionUses]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982540"><span class="hs-identifier hs-var">fun_uses</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982541"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982542"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-271"></span><span>              </span><span id="local-6989586621680982543"><span class="annot"><span class="annottext">table' :: DefTable
</span><a href="#local-6989586621680982543"><span class="hs-identifier hs-var hs-var">table'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982536"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982536"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-274"></span><span>                         </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680982545"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982545"><span class="hs-identifier hs-var">sym</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-275"></span><span>                           </span><span class="annot"><span class="annottext">(DefTableEntry -&gt; Maybe DefTableEntry)
-&gt; Symbol -&gt; DefTable -&gt; DefTable
forall k a. Ord k =&gt; (a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#update"><span class="hs-identifier hs-var">M.update</span></a></span><span>
</span><span id="line-276"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunctionUses -&gt; DefTableEntry -&gt; Maybe DefTableEntry
</span><a href="#local-6989586621680982537"><span class="hs-identifier hs-var">addFunctionUse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982522"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982523"><span class="hs-identifier hs-var">definingSymbol</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>                             </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982545"><span class="hs-identifier hs-var">sym</span></a></span><span>
</span><span id="line-278"></span><span>                             </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-279"></span><span>                              </span><span class="hs-comment">-- If it's anything else, it's not a candidate for fusion, and</span><span>
</span><span id="line-280"></span><span>                             </span><span class="hs-comment">-- we can ignore it.</span><span>
</span><span id="line-281"></span><span>                         </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-282"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-283"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(DefTable -&gt; Exp1 -&gt; DefTable) -&gt; DefTable -&gt; [Exp1] -&gt; DefTable
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680982547"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982547"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621680982548"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982548"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982548"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982547"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982543"><span class="hs-identifier hs-var">table'</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982536"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680982549"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982549"><span class="hs-identifier hs-var">argsList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982550"><span class="hs-identifier hs-var">buildDefTable_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982549"><span class="hs-identifier hs-var">argsList</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-285"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680982550"><span class="annot"><span class="annottext">buildDefTable_args :: [Exp1] -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982550"><span class="hs-identifier hs-var hs-var">buildDefTable_args</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680982551"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982551"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982551"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-286"></span><span>                </span><span class="annot"><a href="#local-6989586621680982550"><span class="hs-identifier hs-var">buildDefTable_args</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982552"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982552"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680982553"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982553"><span class="hs-identifier hs-var">tail</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982554"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982554"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>                  </span><span class="annot"><span class="annottext">[Exp1] -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982550"><span class="hs-identifier hs-var">buildDefTable_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982553"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982552"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982554"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680982555"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982555"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DefTable -&gt; Exp1 -&gt; DefTable) -&gt; DefTable -&gt; [Exp1] -&gt; DefTable
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; DefTable
</span><a href="#local-6989586621680982556"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982555"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680982556"><span class="annot"><span class="annottext">f :: DefTable -&gt; Exp1 -&gt; DefTable
</span><a href="#local-6989586621680982556"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680982557"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982557"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span id="local-6989586621680982558"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982558"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982558"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982557"><span class="hs-identifier hs-var">tbl</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680982559"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982559"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680982560"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982560"><span class="hs-identifier hs-var">thenBody</span></a></span></span><span> </span><span id="local-6989586621680982561"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982561"><span class="hs-identifier hs-var">elseBody</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-291"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982562"><span class="annot"><span class="annottext">table' :: DefTable
</span><a href="#local-6989586621680982562"><span class="hs-identifier hs-var hs-var">table'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982559"><span class="hs-identifier hs-var">cond</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-292"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982563"><span class="annot"><span class="annottext">table'' :: DefTable
</span><a href="#local-6989586621680982563"><span class="hs-identifier hs-var hs-var">table''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982560"><span class="hs-identifier hs-var">thenBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982523"><span class="hs-identifier hs-var">definingSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982562"><span class="hs-identifier hs-var">table'</span></a></span><span>
</span><span id="line-293"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982561"><span class="hs-identifier hs-var">elseBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982523"><span class="hs-identifier hs-var">definingSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982563"><span class="hs-identifier hs-var">table''</span></a></span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982564"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982564"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680982565"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982565"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-295"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982566"><span class="annot"><span class="annottext">table' :: DefTable
</span><a href="#local-6989586621680982566"><span class="hs-identifier hs-var hs-var">table'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982564"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-296"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(DefTable -&gt; (String, [(Var, ())], Exp1) -&gt; DefTable)
-&gt; DefTable -&gt; [(String, [(Var, ())], Exp1)] -&gt; DefTable
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable -&gt; (String, [(Var, ())], Exp1) -&gt; DefTable
</span><a href="#local-6989586621680982567"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982566"><span class="hs-identifier hs-var">table'</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982565"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-297"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680982567"><span class="annot"><span class="annottext">f :: DefTable -&gt; (String, [(Var, ())], Exp1) -&gt; DefTable
</span><a href="#local-6989586621680982567"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680982568"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982568"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982569"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982569"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982569"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982523"><span class="hs-identifier hs-var">definingSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982568"><span class="hs-identifier hs-var">tbl</span></a></span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680982570"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982570"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DefTable -&gt; Exp1 -&gt; DefTable) -&gt; DefTable -&gt; [Exp1] -&gt; DefTable
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; DefTable
</span><a href="#local-6989586621680982571"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680982570"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-299"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680982571"><span class="annot"><span class="annottext">f :: DefTable -&gt; Exp1 -&gt; DefTable
</span><a href="#local-6989586621680982571"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680982572"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982572"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span id="local-6989586621680982573"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982573"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982573"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982572"><span class="hs-identifier hs-var">tbl</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680982574"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982574"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982574"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982523"><span class="hs-identifier hs-var">definingSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680982575"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982575"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680982576"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982576"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Symbol -&gt; DefTable -&gt; DefTable
</span><a href="#local-6989586621680982500"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982576"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-303"></span><span>        </span><span id="local-6989586621680982578"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982578"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982524"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable -&gt; String -&gt; DefTable
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span>
</span><span id="line-305"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;please handle:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982578"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in buildDefTable\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>        </span><span id="local-6989586621680982528"><span class="annot"><span class="annottext">incrUses :: DefTableEntry -&gt; Maybe DefTableEntry
</span><a href="#local-6989586621680982528"><span class="hs-identifier hs-var hs-var">incrUses</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span> </span><span id="local-6989586621680982581"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982581"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621680982582"><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982582"><span class="hs-identifier hs-var">fun_uses</span></a></span></span><span> </span><span id="local-6989586621680982583"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982583"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680982584"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982584"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>          </span><span class="annot"><span class="annottext">DefTableEntry -&gt; Maybe DefTableEntry
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(DefTableEntry -&gt; Maybe DefTableEntry)
-&gt; DefTableEntry -&gt; Maybe DefTableEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [FunctionUses] -&gt; Int -&gt; Ty1 -&gt; DefTableEntry
</span><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-var">DefTableEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982581"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982582"><span class="hs-identifier hs-var">fun_uses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982583"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982584"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#extractAppNameFromLet"><span class="hs-identifier hs-type">extractAppNameFromLet</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-312"></span><span id="extractAppNameFromLet"><span class="annot"><span class="annottext">extractAppNameFromLet :: Exp1 -&gt; Var
</span><a href="Gibbon.Passes.Fusion2.html#extractAppNameFromLet"><span class="hs-identifier hs-var hs-var">extractAppNameFromLet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680982587"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982587"><span class="hs-identifier hs-var">symLet</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680982588"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982588"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982588"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#extractLetSymbolFromLet"><span class="hs-identifier hs-type">extractLetSymbolFromLet</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span>
</span><span id="line-315"></span><span id="extractLetSymbolFromLet"><span class="annot"><span class="annottext">extractLetSymbolFromLet :: Exp1 -&gt; Symbol
</span><a href="Gibbon.Passes.Fusion2.html#extractLetSymbolFromLet"><span class="hs-identifier hs-var hs-var">extractLetSymbolFromLet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680982590"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982590"><span class="hs-identifier hs-var">symLet</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680982591"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982591"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982590"><span class="hs-identifier hs-var">symLet</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-type">extractAppEName</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-318"></span><span id="extractAppEName"><span class="annot"><span class="annottext">extractAppEName :: Exp1 -&gt; Var
</span><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-var hs-var">extractAppEName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680982599"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982599"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982599"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-319"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-var">extractAppEName</span></a></span><span>  </span><span id="local-6989586621680982600"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982600"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Var
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982600"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">-- Takes the table, and candidates which are already processed and</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- return one that isn't.</span><span>
</span><span id="line-323"></span><span class="hs-comment">--</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- returns ((innerFun, outerFun), symbol defined by the outer)</span><span>
</span><span id="line-325"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#findPotential"><span class="hs-identifier hs-type">findPotential</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span id="findPotential"><span class="annot"><span class="annottext">findPotential :: DefTable -&gt; [(Var, Var)] -&gt; Maybe ((Var, Var), Maybe Symbol)
</span><a href="Gibbon.Passes.Fusion2.html#findPotential"><span class="hs-identifier hs-var hs-var">findPotential</span></a></span></span><span> </span><span id="local-6989586621680982622"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982622"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621680982623"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680982623"><span class="hs-identifier hs-var">skipList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">((Symbol, DefTableEntry) -&gt; Bool)
-&gt; [(Symbol, DefTableEntry)] -&gt; Maybe (Symbol, DefTableEntry)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">L.find</span></a></span><span> </span><span class="annot"><span class="annottext">(Symbol, DefTableEntry) -&gt; Bool
</span><a href="#local-6989586621680982625"><span class="hs-identifier hs-var">predicate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; [(Symbol, DefTableEntry)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982622"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Symbol, DefTableEntry)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ((Var, Var), Maybe Symbol)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span> </span><span id="local-6989586621680982627"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982627"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621680982628"><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982628"><span class="hs-identifier hs-var">fun_uses</span></a></span></span><span> </span><span id="local-6989586621680982629"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982629"><span class="hs-identifier hs-var">use_count</span></a></span></span><span> </span><span id="local-6989586621680982630"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982630"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-330"></span><span>      </span><span class="annot"><span class="annottext">((Var, Var), Maybe Symbol) -&gt; Maybe ((Var, Var), Maybe Symbol)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Var
</span><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-var">extractAppEName</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982627"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var
</span><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-var">extractAppEName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunctionUses -&gt; Exp1
forall a b. Sel1 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel1"><span class="hs-identifier hs-var">sel1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FunctionUses] -&gt; FunctionUses
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982628"><span class="hs-identifier hs-var">fun_uses</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunctionUses -&gt; Maybe Symbol
forall a b. Sel3 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel3"><span class="hs-identifier hs-var">sel3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FunctionUses] -&gt; FunctionUses
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982628"><span class="hs-identifier hs-var">fun_uses</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621680982625"><span class="annot"><span class="annottext">predicate :: (Symbol, DefTableEntry) -&gt; Bool
</span><a href="#local-6989586621680982625"><span class="hs-identifier hs-var hs-var">predicate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span> </span><span id="local-6989586621680982633"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982633"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621680982634"><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982634"><span class="hs-identifier hs-var">fun_uses</span></a></span></span><span> </span><span id="local-6989586621680982635"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982635"><span class="hs-identifier hs-var">use_count</span></a></span></span><span> </span><span id="local-6989586621680982636"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982636"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982633"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680982637"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982637"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-337"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FunctionUses] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982634"><span class="hs-identifier hs-var">fun_uses</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-338"></span><span>          </span><span class="annot"><span class="annottext">(Var, Var) -&gt; [(Var, Var)] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">L.notElem</span></a></span><span>
</span><span id="line-339"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Var
</span><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-var">extractAppEName</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982633"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var
</span><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-var">extractAppEName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunctionUses -&gt; Exp1
forall a b. Sel1 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel1"><span class="hs-identifier hs-var">sel1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FunctionUses] -&gt; FunctionUses
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982634"><span class="hs-identifier hs-var">fun_uses</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>            </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680982623"><span class="hs-identifier hs-var">skipList</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#isPotential"><span class="hs-identifier hs-type">isPotential</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-344"></span><span id="isPotential"><span class="annot"><span class="annottext">isPotential :: DefTable -&gt; Maybe Symbol -&gt; [(Var, Var)] -&gt; Bool
</span><a href="Gibbon.Passes.Fusion2.html#isPotential"><span class="hs-identifier hs-var hs-var">isPotential</span></a></span></span><span> </span><span id="local-6989586621680982654"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982654"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621680982655"><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982655"><span class="hs-identifier hs-var">symbol</span></a></span></span><span> </span><span id="local-6989586621680982656"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680982656"><span class="hs-identifier hs-var">skipList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680982655"><span class="hs-identifier hs-var">symbol</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-346"></span><span>    </span><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680982657"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982657"><span class="hs-identifier hs-var">symb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680982654"><span class="hs-identifier hs-var">table</span></a></span><span>  </span><span class="annot"><span class="annottext">DefTable -&gt; Symbol -&gt; Maybe DefTableEntry
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21%3F"><span class="hs-operator hs-var">M.!?</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680982657"><span class="hs-identifier hs-var">symb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-349"></span><span>         </span><span class="annot"><span class="annottext">Maybe DefTableEntry
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-comment">--`debug`  (show skipList)</span><span>
</span><span id="line-350"></span><span>         </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span> </span><span id="local-6989586621680982659"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982659"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621680982660"><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982660"><span class="hs-identifier hs-var">fun_uses</span></a></span></span><span> </span><span id="local-6989586621680982661"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982661"><span class="hs-identifier hs-var">use_count</span></a></span></span><span> </span><span id="local-6989586621680982662"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982662"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-351"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FunctionUses] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982660"><span class="hs-identifier hs-var">fun_uses</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var) -&gt; [(Var, Var)] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">L.notElem</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Var
</span><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-var">extractAppEName</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982659"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-352"></span><span>                </span><span class="annot"><span class="annottext">Exp1 -&gt; Var
</span><a href="Gibbon.Passes.Fusion2.html#extractAppEName"><span class="hs-identifier hs-var">extractAppEName</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunctionUses -&gt; Exp1
forall a b. Sel1 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel1"><span class="hs-identifier hs-var">sel1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FunctionUses] -&gt; FunctionUses
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><a href="#local-6989586621680982660"><span class="hs-identifier hs-var">fun_uses</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680982656"><span class="hs-identifier hs-var">skipList</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#simplifyCases2"><span class="hs-identifier hs-type">simplifyCases2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-355"></span><span id="simplifyCases2"><span class="annot"><span class="annottext">simplifyCases2 :: Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyCases2"><span class="hs-identifier hs-var hs-var">simplifyCases2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
(Expression (ext loc dec),
 SubstitutableExt (PreExp ext loc dec) (ext loc dec), Eq dec,
 Eq loc, Eq (ext loc dec), Show dec, Show loc, Out dec, Out loc) =&gt;
PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621680982684"><span class="annot"><span class="annottext">go :: PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680982727"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982727"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982727"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982728"><span class="annot"><span class="annottext">e1 :: PreExp ext loc dec
</span><a href="#local-6989586621680982728"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982729"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982729"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680982730"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982730"><span class="hs-identifier hs-var">ls2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982731"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982731"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982729"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec)
 -&gt; (String, [(Var, loc)], PreExp ext loc dec))
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982732"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982730"><span class="hs-identifier hs-var">ls2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--`debug` (show &quot;original input was \n&quot; L.++ (show (l (CaseE e2 (L.map f ls2)))))</span><span>
</span><span id="line-360"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680982732"><span class="annot"><span class="annottext">f :: (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982732"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680982733"><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982733"><span class="hs-identifier hs-var">oldItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
forall a b c. Upd3 a b c =&gt; a -&gt; b -&gt; c
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Update.html#upd3"><span class="hs-identifier hs-var">upd3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec) -&gt; PreExp ext loc dec
forall a b. Sel3 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel3"><span class="hs-identifier hs-var">sel3</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982733"><span class="hs-identifier hs-var">oldItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982731"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982733"><span class="hs-identifier hs-var">oldItem</span></a></span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982735"><span class="annot"><span class="annottext">e1 :: PreExp ext loc dec
</span><a href="#local-6989586621680982735"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680982736"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680982736"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680982737"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982737"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680982738"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680982738"><span class="hs-identifier hs-var">constructorVars</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982739"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982739"><span class="hs-identifier hs-var">caseList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-362"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982740"><span class="annot"><span class="annottext">newBody :: Maybe (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982740"><span class="hs-identifier hs-var hs-var">newBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec) -&gt; Bool)
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; Maybe (String, [(Var, loc)], PreExp ext loc dec)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">L.find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680982741"><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982741"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec) -&gt; String
forall a b. Sel1 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel1"><span class="hs-identifier hs-var">sel1</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982741"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982737"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982739"><span class="hs-identifier hs-var">caseList</span></a></span><span>
</span><span id="line-363"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982740"><span class="hs-identifier hs-var">newBody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-364"></span><span>                </span><span class="annot"><span class="annottext">Maybe (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PreExp ext loc dec
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unmatched constructor!&quot;</span></span><span>
</span><span id="line-365"></span><span>                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982742"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982742"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982743"><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680982743"><span class="hs-identifier hs-var">caseVars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982744"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982744"><span class="hs-identifier hs-var">caseExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>                  </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(PreExp ext loc dec -&gt; PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span class="annot"><span class="annottext">[PreExp ext loc dec]
-&gt; [(Var, loc)] -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall {e :: * -&gt; * -&gt; *} {l} {d} {b}.
(Expression (e l d), SubstitutableExt (PreExp e l d) (e l d), Eq d,
 Eq l, Eq (e l d), Show d, Show l, Out d, Out l) =&gt;
[PreExp e l d] -&gt; [(Var, b)] -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680982745"><span class="hs-identifier hs-var">case_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680982738"><span class="hs-identifier hs-var">constructorVars</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680982743"><span class="hs-identifier hs-var">caseVars</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982744"><span class="hs-identifier hs-var">caseExp</span></a></span><span>
</span><span id="line-367"></span><span>                  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680982745"><span class="annot"><span class="annottext">case_subst :: [PreExp e l d] -&gt; [(Var, b)] -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680982745"><span class="hs-identifier hs-var hs-var">case_subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982778"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680982778"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680982779"><span class="annot"><span class="annottext">[PreExp e l d]
</span><a href="#local-6989586621680982779"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982780"><span class="annot"><span class="annottext">(Var, b)
</span><a href="#local-6989586621680982780"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680982781"><span class="annot"><span class="annottext">[(Var, b)]
</span><a href="#local-6989586621680982781"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982782"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680982782"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-368"></span><span>                          </span><span class="annot"><span class="annottext">Var -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
Var -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, b) -&gt; Var
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, b)
</span><a href="#local-6989586621680982780"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680982778"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PreExp e l d] -&gt; [(Var, b)] -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680982745"><span class="hs-identifier hs-var">case_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp e l d]
</span><a href="#local-6989586621680982779"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, b)]
</span><a href="#local-6989586621680982781"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680982782"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>                        </span><span class="annot"><a href="#local-6989586621680982745"><span class="hs-identifier hs-var">case_subst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680982785"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680982785"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680982785"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680982786"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982786"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680982787"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982787"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680982788"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982788"><span class="hs-identifier hs-var">e3</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982789"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982789"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(PreExp ext loc dec -&gt; PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982786"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982787"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982789"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982788"><span class="hs-identifier hs-var">e3</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982789"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982790"><span class="annot"><span class="annottext">e1 :: PreExp ext loc dec
</span><a href="#local-6989586621680982790"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span id="local-6989586621680982791"><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
</span><a href="#local-6989586621680982791"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621680982792"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982792"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982793"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982793"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-373"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982794"><span class="annot"><span class="annottext">body' :: PreExp ext loc dec
</span><a href="#local-6989586621680982794"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982792"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982793"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
</span><a href="#local-6989586621680982791"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982794"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982795"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982795"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680982796"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982796"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982795"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec)
 -&gt; (String, [(Var, loc)], PreExp ext loc dec))
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982797"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680982796"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680982797"><span class="annot"><span class="annottext">f :: (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982797"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680982798"><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982798"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
forall a b c. Upd3 a b c =&gt; a -&gt; b -&gt; c
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Update.html#upd3"><span class="hs-identifier hs-var">upd3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec) -&gt; PreExp ext loc dec
forall a b. Sel3 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel3"><span class="hs-identifier hs-var">sel3</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982798"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680982798"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680982799"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982799"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982800"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680982800"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982801"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680982801"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982802"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982802"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680982803"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982803"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982799"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680982800"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680982801"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982802"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982803"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680982804"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982804"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680982805"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680982805"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680982806"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680982806"><span class="hs-identifier hs-var">expList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982804"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680982805"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp ext loc dec -&gt; PreExp ext loc dec)
-&gt; [PreExp ext loc dec] -&gt; [PreExp ext loc dec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680982806"><span class="hs-identifier hs-var">expList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680982807"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982807"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680982808"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982808"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680982809"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982809"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982807"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982808"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982809"><span class="hs-identifier hs-var">e3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680982810"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982810"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680982811"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680982811"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621680982812"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982812"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680982684"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982810"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680982811"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680982812"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span id="local-6989586621680982813"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982813"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680982813"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#inline2"><span class="hs-identifier hs-type">inline2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-384"></span><span id="inline2"><span class="annot"><span class="annottext">inline2 :: FunDef1 -&gt; FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#inline2"><span class="hs-identifier hs-var hs-var">inline2</span></a></span></span><span> </span><span id="local-6989586621680982881"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span></span><span> </span><span id="local-6989586621680982882"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-385"></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-386"></span><span>  </span><span id="local-6989586621680982883"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982883"><span class="hs-identifier hs-var">newTraversedTreeArg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inputTree&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982885"><span class="annot"><span class="annottext">argTypes_outer :: [Ty1]
</span><a href="#local-6989586621680982885"><span class="hs-identifier hs-var hs-var">argTypes_outer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>      </span><span id="local-6989586621680982887"><span class="annot"><span class="annottext">retType_outer :: Ty1
</span><a href="#local-6989586621680982887"><span class="hs-identifier hs-var hs-var">retType_outer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>      </span><span id="local-6989586621680982889"><span class="annot"><span class="annottext">argVar_outer :: Var
</span><a href="#local-6989586621680982889"><span class="hs-identifier hs-var hs-var">argVar_outer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; Var) -&gt; [Var] -&gt; Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span id="local-6989586621680982890"><span class="annot"><span class="annottext">argTypes_inlined :: [Ty1]
</span><a href="#local-6989586621680982890"><span class="hs-identifier hs-var hs-var">argTypes_inlined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>      </span><span id="local-6989586621680982891"><span class="annot"><span class="annottext">argVar_inlined :: Var
</span><a href="#local-6989586621680982891"><span class="hs-identifier hs-var hs-var">argVar_inlined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; Var) -&gt; [Var] -&gt; Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span>
</span><span id="line-392"></span><span>      </span><span id="local-6989586621680982892"><span class="annot"><span class="annottext">retTypeInlined :: Ty1
</span><a href="#local-6989586621680982892"><span class="hs-identifier hs-var hs-var">retTypeInlined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>      </span><span id="local-6989586621680982893"><span class="annot"><span class="annottext">traversedType :: Ty1
</span><a href="#local-6989586621680982893"><span class="hs-identifier hs-var hs-var">traversedType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Ty1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982890"><span class="hs-identifier hs-var">argTypes_inlined</span></a></span><span>
</span><span id="line-394"></span><span>      </span><span class="hs-comment">-- All arguments except the one that's traversed.</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-comment">-- is it ok that those are swapped lol!</span><span>
</span><span id="line-397"></span><span>      </span><span id="local-6989586621680982894"><span class="annot"><span class="annottext">sideArgsTypesInlined :: [Ty1]
</span><a href="#local-6989586621680982894"><span class="hs-identifier hs-var hs-var">sideArgsTypesInlined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982890"><span class="hs-identifier hs-var">argTypes_inlined</span></a></span><span>
</span><span id="line-398"></span><span>      </span><span id="local-6989586621680982896"><span class="annot"><span class="annottext">sidArgsTypesOuter :: [Ty1]
</span><a href="#local-6989586621680982896"><span class="hs-identifier hs-var hs-var">sidArgsTypesOuter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982885"><span class="hs-identifier hs-var">argTypes_outer</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span id="local-6989586621680982897"><span class="annot"><span class="annottext">newType :: ([Ty1], Ty1)
</span><a href="#local-6989586621680982897"><span class="hs-identifier hs-var hs-var">newType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982893"><span class="hs-identifier hs-var">traversedType</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982894"><span class="hs-identifier hs-var">sideArgsTypesInlined</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982896"><span class="hs-identifier hs-var">sidArgsTypesOuter</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982887"><span class="hs-identifier hs-var">retType_outer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>      </span><span id="local-6989586621680982898"><span class="annot"><span class="annottext">inlinedFunBody :: Exp1
</span><a href="#local-6989586621680982898"><span class="hs-identifier hs-var hs-var">inlinedFunBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982899"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680982899"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982891"><span class="hs-identifier hs-var">argVar_inlined</span></a></span><span>
</span><span id="line-404"></span><span>            </span><span id="local-6989586621680982900"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680982900"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982883"><span class="hs-identifier hs-var">newTraversedTreeArg</span></a></span><span>
</span><span id="line-405"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982899"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982900"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-comment">-- the traversed tree in the outer is replaced with either a call to the inner</span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-comment">-- or the body of the inner</span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982901"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680982901"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982889"><span class="hs-identifier hs-var">argVar_outer</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982902"><span class="annot"><span class="annottext">replaceWithCall :: Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680982902"><span class="hs-identifier hs-var hs-var">replaceWithCall</span></a></span></span><span> </span><span id="local-6989586621680982903"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982903"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span>        </span><span id="local-6989586621680982904"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982904"><span class="hs-identifier hs-var">newVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;innerCall&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982905"><span class="annot"><span class="annottext">rhs :: Exp1
</span><a href="#local-6989586621680982905"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-413"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span>
</span><span id="line-414"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>                   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-416"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Exp1) -&gt; [Var] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982883"><span class="hs-identifier hs-var">newTraversedTreeArg</span></a></span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Var]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>            </span><span id="local-6989586621680982907"><span class="annot"><span class="annottext">body :: Exp1
</span><a href="#local-6989586621680982907"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982901"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982904"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982903"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982904"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982892"><span class="hs-identifier hs-var">retTypeInlined</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982905"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982907"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982908"><span class="annot"><span class="annottext">outerCaseList :: [(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982908"><span class="hs-identifier hs-var hs-var">outerCaseList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-421"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-422"></span><span>           </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982909"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982909"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680982910"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982910"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982910"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>  </span><span id="local-6989586621680982911"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982911"><span class="hs-identifier hs-var">newBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982898"><span class="hs-identifier hs-var">inlinedFunBody</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-426"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680982912"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982912"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680982913"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982913"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>        </span><span id="local-6989586621680982914"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982914"><span class="hs-identifier hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-428"></span><span>          </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; PassM (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)]
-&gt; PassM [(String, [(Var, ())], Exp1)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span>
</span><span id="line-429"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680982915"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982915"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982916"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680982916"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680982917"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982917"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-430"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Bool
</span><a href="Gibbon.Passes.Fusion2.html#hasConstructorTail"><span class="hs-identifier hs-var">hasConstructorTail</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982917"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-431"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-432"></span><span>                 </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982919"><span class="annot"><span class="annottext">exp' :: Exp1
</span><a href="#local-6989586621680982919"><span class="hs-identifier hs-var hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982917"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982908"><span class="hs-identifier hs-var">outerCaseList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>                  </span><span id="local-6989586621680982920"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982920"><span class="hs-identifier hs-var">exp''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680982902"><span class="hs-identifier hs-var">replaceWithCall</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982919"><span class="hs-identifier hs-var">exp'</span></a></span><span>
</span><span id="line-435"></span><span>                  </span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1) -&gt; PassM (String, [(Var, ())], Exp1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982915"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680982916"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982920"><span class="hs-identifier hs-var">exp''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-437"></span><span>                 </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>                  </span><span id="local-6989586621680982921"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982921"><span class="hs-identifier hs-var">newSymbol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outerCall&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982922"><span class="annot"><span class="annottext">exp' :: Exp1
</span><a href="#local-6989586621680982922"><span class="hs-identifier hs-var hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-440"></span><span>                       </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Var -&gt; Ty1 -&gt; [Exp1] -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#addOuterTailCall"><span class="hs-identifier hs-var">addOuterTailCall</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982917"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982921"><span class="hs-identifier hs-var">newSymbol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Exp1) -&gt; [Var] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680982923"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982923"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982923"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>                  </span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1) -&gt; PassM (String, [(Var, ())], Exp1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680982915"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680982916"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982922"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>            </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982913"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982883"><span class="hs-identifier hs-var">newTraversedTreeArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680982914"><span class="hs-identifier hs-var">ls'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>      </span><span id="local-6989586621680982924"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982924"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM Exp1
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982924"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span> </span><span class="hs-comment">--     exp -&gt; replaceWithCall (substE oldExp inlinedFunBody (l exp))</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982925"><span class="annot"><span class="annottext">newArgs :: [Var]
</span><a href="#local-6989586621680982925"><span class="hs-identifier hs-var hs-var">newArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982883"><span class="hs-identifier hs-var">newTraversedTreeArg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">L.tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982881"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span>
</span><span id="line-452"></span><span>        </span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">L.tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>  </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982882"><span class="hs-identifier hs-var">outer_fun</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funArgs :: [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680982925"><span class="hs-identifier hs-var">newArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funTy :: ArrowTy (TyOf Exp1)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1)
ArrowTy (TyOf Exp1)
</span><a href="#local-6989586621680982897"><span class="hs-identifier hs-var">newType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982911"><span class="hs-identifier hs-var">newBody</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="hs-comment">{-
case (case c of D1-&gt; K ,.. -&gt; f)

case c of D1 -&gt;
          D2 -&gt;  f1 (f)
  The type of the new function is defined as the following :
   if
     innerType = TreeX-&gt; Args1... -&gt; RetType1
     outerType = RetType Args2... -&gt; RetType2
  then
     inlinedType = TreeX -&gt; Args1... -&gt;  Args2... -&gt; RetType2

-}</span><span>
</span><span id="line-468"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#inline"><span class="hs-identifier hs-type">inline</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-469"></span><span id="inline"><span class="annot"><span class="annottext">inline :: FunDef1 -&gt; FunDef1 -&gt; Int -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#inline"><span class="hs-identifier hs-var hs-var">inline</span></a></span></span><span> </span><span id="local-6989586621680982977"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982977"><span class="hs-identifier hs-var">inlined_fun</span></a></span></span><span> </span><span id="local-6989586621680982978"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982978"><span class="hs-identifier hs-var">outer_fun</span></a></span></span><span> </span><span id="local-6989586621680982979"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680982979"><span class="hs-identifier hs-var">arg_pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>  </span><span id="local-6989586621680982980"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982980"><span class="hs-identifier hs-var">newTraversedTreeArg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inputTree&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982981"><span class="annot"><span class="annottext">argTypes_outer :: [Ty1]
</span><a href="#local-6989586621680982981"><span class="hs-identifier hs-var hs-var">argTypes_outer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982978"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>      </span><span id="local-6989586621680982982"><span class="annot"><span class="annottext">retType_outer :: Ty1
</span><a href="#local-6989586621680982982"><span class="hs-identifier hs-var hs-var">retType_outer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982978"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>      </span><span id="local-6989586621680982983"><span class="annot"><span class="annottext">argVar_outer :: Var
</span><a href="#local-6989586621680982983"><span class="hs-identifier hs-var hs-var">argVar_outer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; Var) -&gt; [Var] -&gt; Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982978"><span class="hs-identifier hs-var">outer_fun</span></a></span><span>
</span><span id="line-474"></span><span>      </span><span id="local-6989586621680982984"><span class="annot"><span class="annottext">argTypes_inlined :: [Ty1]
</span><a href="#local-6989586621680982984"><span class="hs-identifier hs-var hs-var">argTypes_inlined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982977"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>      </span><span id="local-6989586621680982985"><span class="annot"><span class="annottext">argVar_inlined :: Var
</span><a href="#local-6989586621680982985"><span class="hs-identifier hs-var hs-var">argVar_inlined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; Var) -&gt; [Var] -&gt; Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982977"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span>
</span><span id="line-476"></span><span>      </span><span id="local-6989586621680982986"><span class="annot"><span class="annottext">retTypeInlined :: Ty1
</span><a href="#local-6989586621680982986"><span class="hs-identifier hs-var hs-var">retTypeInlined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982977"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>      </span><span id="local-6989586621680982987"><span class="annot"><span class="annottext">traversedType :: Ty1
</span><a href="#local-6989586621680982987"><span class="hs-identifier hs-var hs-var">traversedType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Ty1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982984"><span class="hs-identifier hs-var">argTypes_inlined</span></a></span><span>
</span><span id="line-478"></span><span>      </span><span class="hs-comment">-- All arguments except the one that's traversed.</span><span>
</span><span id="line-479"></span><span>      </span><span id="local-6989586621680982988"><span class="annot"><span class="annottext">sideArgsTypesInlined :: [Ty1]
</span><a href="#local-6989586621680982988"><span class="hs-identifier hs-var hs-var">sideArgsTypesInlined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982981"><span class="hs-identifier hs-var">argTypes_outer</span></a></span><span>
</span><span id="line-480"></span><span>      </span><span id="local-6989586621680982989"><span class="annot"><span class="annottext">sidArgsTypesOuter :: [Ty1]
</span><a href="#local-6989586621680982989"><span class="hs-identifier hs-var hs-var">sidArgsTypesOuter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982984"><span class="hs-identifier hs-var">argTypes_inlined</span></a></span><span>
</span><span id="line-481"></span><span>      </span><span id="local-6989586621680982990"><span class="annot"><span class="annottext">newType :: ([Ty1], Ty1)
</span><a href="#local-6989586621680982990"><span class="hs-identifier hs-var hs-var">newType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-482"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982987"><span class="hs-identifier hs-var">traversedType</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982988"><span class="hs-identifier hs-var">sideArgsTypesInlined</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680982989"><span class="hs-identifier hs-var">sidArgsTypesOuter</span></a></span><span>
</span><span id="line-483"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982982"><span class="hs-identifier hs-var">retType_outer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>      </span><span id="local-6989586621680982991"><span class="annot"><span class="annottext">inlinedFunBody :: Exp1
</span><a href="#local-6989586621680982991"><span class="hs-identifier hs-var hs-var">inlinedFunBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982992"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680982992"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982985"><span class="hs-identifier hs-var">argVar_inlined</span></a></span><span>
</span><span id="line-486"></span><span>            </span><span id="local-6989586621680982993"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680982993"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982980"><span class="hs-identifier hs-var">newTraversedTreeArg</span></a></span><span>
</span><span id="line-487"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982992"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982993"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982977"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-comment">-- the traversed tree in the outer is replaced with either a call to the inner</span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-comment">-- or the body of the inner</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982994"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680982994"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982983"><span class="hs-identifier hs-var">argVar_outer</span></a></span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982995"><span class="annot"><span class="annottext">replaceWithCall :: Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680982995"><span class="hs-identifier hs-var hs-var">replaceWithCall</span></a></span></span><span> </span><span id="local-6989586621680982996"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982996"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>        </span><span id="local-6989586621680982997"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982997"><span class="hs-identifier hs-var">newVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;innerCall&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680982998"><span class="annot"><span class="annottext">rhs :: Exp1
</span><a href="#local-6989586621680982998"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-495"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span>
</span><span id="line-496"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982977"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>                   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-498"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Exp1) -&gt; [Var] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982977"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>            </span><span id="local-6989586621680982999"><span class="annot"><span class="annottext">body :: Exp1
</span><a href="#local-6989586621680982999"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982994"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982997"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982996"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-500"></span><span>        </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982997"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680982986"><span class="hs-identifier hs-var">retTypeInlined</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982998"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982999"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-501"></span><span>  </span><span id="local-6989586621680983000"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983000"><span class="hs-identifier hs-var">newBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982978"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-503"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983001"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983001"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983002"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983002"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>        </span><span id="local-6989586621680983003"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983003"><span class="hs-identifier hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-505"></span><span>          </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; PassM (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)]
-&gt; PassM [(String, [(Var, ())], Exp1)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span>
</span><span id="line-506"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680983004"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983004"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983005"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983005"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983006"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983006"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-507"></span><span>               </span><span id="local-6989586621680983007"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983007"><span class="hs-identifier hs-var">newInnerExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680982995"><span class="hs-identifier hs-var">replaceWithCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982994"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982991"><span class="hs-identifier hs-var">inlinedFunBody</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983006"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>               </span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1) -&gt; PassM (String, [(Var, ())], Exp1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983004"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983005"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983007"><span class="hs-identifier hs-var">newInnerExp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>            </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983002"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-510"></span><span>        </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982994"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982991"><span class="hs-identifier hs-var">inlinedFunBody</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983001"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983003"><span class="hs-identifier hs-var">ls'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>      </span><span id="local-6989586621680983008"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983008"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
</span><a href="#local-6989586621680982995"><span class="hs-identifier hs-var">replaceWithCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982994"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680982991"><span class="hs-identifier hs-var">inlinedFunBody</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983008"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983009"><span class="annot"><span class="annottext">newArgs :: [Var]
</span><a href="#local-6989586621680983009"><span class="hs-identifier hs-var hs-var">newArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-513"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680982980"><span class="hs-identifier hs-var">newTraversedTreeArg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">L.tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982977"><span class="hs-identifier hs-var">inlined_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span>
</span><span id="line-514"></span><span>        </span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">L.tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982978"><span class="hs-identifier hs-var">outer_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>  </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680982978"><span class="hs-identifier hs-var">outer_fun</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funArgs :: [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983009"><span class="hs-identifier hs-var">newArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funTy :: ArrowTy (TyOf Exp1)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1)
ArrowTy (TyOf Exp1)
</span><a href="#local-6989586621680982990"><span class="hs-identifier hs-var">newType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983000"><span class="hs-identifier hs-var">newBody</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="hs-comment">-- This function simplify the case expression when the matched expression</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- is it self another case expression.</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- In the same way Wadler do it [nested case rule]</span><span>
</span><span id="line-521"></span><span class="hs-comment">-- We only need to simplify the top level case</span><span>
</span><span id="line-522"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#simplifyCases"><span class="hs-identifier hs-type">simplifyCases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-523"></span><span id="simplifyCases"><span class="annot"><span class="annottext">simplifyCases :: FunDef1 -&gt; FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyCases"><span class="hs-identifier hs-var hs-var">simplifyCases</span></a></span></span><span> </span><span id="local-6989586621680983031"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983031"><span class="hs-identifier hs-var">function</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983031"><span class="hs-identifier hs-var">function</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
(Expression (ext loc dec),
 SubstitutableExt (PreExp ext loc dec) (ext loc dec), Eq dec,
 Eq loc, Eq (ext loc dec), Show dec, Show loc, Out dec, Out loc) =&gt;
PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983031"><span class="hs-identifier hs-var">function</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-525"></span><span>    </span><span id="local-6989586621680983032"><span class="annot"><span class="annottext">go :: PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680983074"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983074"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-526"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983074"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983075"><span class="annot"><span class="annottext">e1 :: PreExp ext loc dec
</span><a href="#local-6989586621680983075"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983076"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983076"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680983077"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983077"><span class="hs-identifier hs-var">ls2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983078"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983078"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983076"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec)
 -&gt; (String, [(Var, loc)], PreExp ext loc dec))
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983079"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983077"><span class="hs-identifier hs-var">ls2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--`debug` (show &quot;original input was \n&quot; L.++ (show (l (CaseE e2 (L.map f ls2)))))</span><span>
</span><span id="line-528"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680983079"><span class="annot"><span class="annottext">f :: (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983079"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680983080"><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983080"><span class="hs-identifier hs-var">oldItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
forall a b c. Upd3 a b c =&gt; a -&gt; b -&gt; c
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Update.html#upd3"><span class="hs-identifier hs-var">upd3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec) -&gt; PreExp ext loc dec
forall a b. Sel3 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel3"><span class="hs-identifier hs-var">sel3</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983080"><span class="hs-identifier hs-var">oldItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983078"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983080"><span class="hs-identifier hs-var">oldItem</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983081"><span class="annot"><span class="annottext">e1 :: PreExp ext loc dec
</span><a href="#local-6989586621680983081"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680983082"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680983082"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983083"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983083"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680983084"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680983084"><span class="hs-identifier hs-var">constructorVars</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983085"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983085"><span class="hs-identifier hs-var">caseList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-530"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983086"><span class="annot"><span class="annottext">newBody :: Maybe (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983086"><span class="hs-identifier hs-var hs-var">newBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec) -&gt; Bool)
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; Maybe (String, [(Var, loc)], PreExp ext loc dec)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">L.find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983087"><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983087"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec) -&gt; String
forall a b. Sel1 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel1"><span class="hs-identifier hs-var">sel1</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983087"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983083"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983085"><span class="hs-identifier hs-var">caseList</span></a></span><span>
</span><span id="line-531"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983086"><span class="hs-identifier hs-var">newBody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-532"></span><span>                </span><span class="annot"><span class="annottext">Maybe (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PreExp ext loc dec
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unmatched constructor!&quot;</span></span><span>
</span><span id="line-533"></span><span>                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983088"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983088"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983089"><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680983089"><span class="hs-identifier hs-var">caseVars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983090"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983090"><span class="hs-identifier hs-var">caseExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-534"></span><span>                  </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(PreExp ext loc dec -&gt; PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span class="annot"><span class="annottext">[PreExp ext loc dec]
-&gt; [(Var, loc)] -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall {e :: * -&gt; * -&gt; *} {l} {d} {b}.
(Expression (e l d), SubstitutableExt (PreExp e l d) (e l d), Eq d,
 Eq l, Eq (e l d), Show d, Show l, Out d, Out l) =&gt;
[PreExp e l d] -&gt; [(Var, b)] -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680983091"><span class="hs-identifier hs-var">case_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680983084"><span class="hs-identifier hs-var">constructorVars</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680983089"><span class="hs-identifier hs-var">caseVars</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983090"><span class="hs-identifier hs-var">caseExp</span></a></span><span>
</span><span id="line-535"></span><span>                  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680983091"><span class="annot"><span class="annottext">case_subst :: [PreExp e l d] -&gt; [(Var, b)] -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680983091"><span class="hs-identifier hs-var hs-var">case_subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983124"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983124"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680983125"><span class="annot"><span class="annottext">[PreExp e l d]
</span><a href="#local-6989586621680983125"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983126"><span class="annot"><span class="annottext">(Var, b)
</span><a href="#local-6989586621680983126"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680983127"><span class="annot"><span class="annottext">[(Var, b)]
</span><a href="#local-6989586621680983127"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983128"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983128"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-536"></span><span>                          </span><span class="annot"><span class="annottext">Var -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
Var -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, b) -&gt; Var
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, b)
</span><a href="#local-6989586621680983126"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983124"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PreExp e l d] -&gt; [(Var, b)] -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680983091"><span class="hs-identifier hs-var">case_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp e l d]
</span><a href="#local-6989586621680983125"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, b)]
</span><a href="#local-6989586621680983127"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983128"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>                        </span><span class="annot"><a href="#local-6989586621680983091"><span class="hs-identifier hs-var">case_subst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621680983129"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983129"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983129"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680983130"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983130"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983131"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983131"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680983132"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983132"><span class="hs-identifier hs-var">e3</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983133"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983133"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>          </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(PreExp ext loc dec -&gt; PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983130"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983131"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983133"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983132"><span class="hs-identifier hs-var">e3</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983133"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983134"><span class="annot"><span class="annottext">e1 :: PreExp ext loc dec
</span><a href="#local-6989586621680983134"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span id="local-6989586621680983135"><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
</span><a href="#local-6989586621680983135"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621680983136"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983136"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983137"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983137"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-541"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983138"><span class="annot"><span class="annottext">body' :: PreExp ext loc dec
</span><a href="#local-6989586621680983138"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983136"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983137"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
</span><a href="#local-6989586621680983135"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983138"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-543"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983139"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983139"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983140"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983140"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983139"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec)
 -&gt; (String, [(Var, loc)], PreExp ext loc dec))
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983141"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983140"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680983141"><span class="annot"><span class="annottext">f :: (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983141"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680983142"><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983142"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
forall a b c. Upd3 a b c =&gt; a -&gt; b -&gt; c
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Update.html#upd3"><span class="hs-identifier hs-var">upd3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec) -&gt; PreExp ext loc dec
forall a b. Sel3 a b =&gt; a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/tuple-0.3.0.2-07ffd7383e0763c1fb18d1c8b148b896aaab0e25c2086c9426e4cc93767de7dd/share/doc/html/src/Data.Tuple.Select.html#sel3"><span class="hs-identifier hs-var">sel3</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983142"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983142"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983143"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983143"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983144"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983144"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983145"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983145"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983146"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983146"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983147"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983147"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983143"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983144"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983145"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983146"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983147"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983148"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983148"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680983149"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983149"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983150"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680983150"><span class="hs-identifier hs-var">expList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983148"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983149"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp ext loc dec -&gt; PreExp ext loc dec)
-&gt; [PreExp ext loc dec] -&gt; [PreExp ext loc dec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680983150"><span class="hs-identifier hs-var">expList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680983151"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983151"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983152"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983152"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680983153"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983153"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983151"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983152"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983153"><span class="hs-identifier hs-var">e3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680983154"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983154"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680983155"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983155"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621680983156"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983156"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983032"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983154"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983155"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983156"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-549"></span><span>        </span><span id="local-6989586621680983157"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983157"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983157"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#foldFusedCallsF"><span class="hs-identifier hs-type">foldFusedCallsF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-553"></span><span id="foldFusedCallsF"><span class="annot"><span class="annottext">foldFusedCallsF :: (Var, Var, Int, Var) -&gt; FunDef1 -&gt; FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCallsF"><span class="hs-identifier hs-var hs-var">foldFusedCallsF</span></a></span></span><span> </span><span id="local-6989586621680983159"><span class="annot"><span class="annottext">(Var, Var, Int, Var)
</span><a href="#local-6989586621680983159"><span class="hs-identifier hs-var">rule</span></a></span></span><span> </span><span id="local-6989586621680983160"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983160"><span class="hs-identifier hs-var">function</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983161"><span class="annot"><span class="annottext">funBody' :: Exp1
</span><a href="#local-6989586621680983161"><span class="hs-identifier hs-var hs-var">funBody'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-555"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983160"><span class="hs-identifier hs-var">function</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-556"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983162"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983162"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680983163"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983163"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-557"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983164"><span class="annot"><span class="annottext">ls' :: [(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983164"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680983165"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983165"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983166"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983166"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983167"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983167"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983165"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983166"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var) -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCalls"><span class="hs-identifier hs-var">foldFusedCalls</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var)
</span><a href="#local-6989586621680983159"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983167"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983163"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-558"></span><span>              </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983162"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983164"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983160"><span class="hs-identifier hs-var">function</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983161"><span class="hs-identifier hs-var">funBody'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#foldFusedCalls_Entry"><span class="hs-identifier hs-type">foldFusedCalls_Entry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-563"></span><span id="foldFusedCalls_Entry"><span class="annot"><span class="annottext">foldFusedCalls_Entry :: (Var, Var, Int, Var) -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCalls_Entry"><span class="hs-identifier hs-var hs-var">foldFusedCalls_Entry</span></a></span></span><span> </span><span id="local-6989586621680983170"><span class="annot"><span class="annottext">rule :: (Var, Var, Int, Var)
</span><a href="#local-6989586621680983170"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680983171"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983171"><span class="hs-identifier hs-var">outerName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983172"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983172"><span class="hs-identifier hs-var">innerName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983173"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983173"><span class="hs-identifier hs-var">argPos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983174"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983174"><span class="hs-identifier hs-var">newName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983175"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983175"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-564"></span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983175"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-565"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983176"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983176"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680983177"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983177"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-566"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983178"><span class="annot"><span class="annottext">ls' :: [(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983178"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680983179"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983179"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983180"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983180"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983181"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983181"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983179"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983180"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var) -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCalls"><span class="hs-identifier hs-var">foldFusedCalls</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var)
</span><a href="#local-6989586621680983170"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983181"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983177"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-567"></span><span>              </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983176"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983178"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-568"></span><span>          </span><span id="local-6989586621680983182"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983182"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var) -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCalls"><span class="hs-identifier hs-var">foldFusedCalls</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var)
</span><a href="#local-6989586621680983170"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983175"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#inlineConstructorConsumers"><span class="hs-identifier hs-type">inlineConstructorConsumers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span id="inlineConstructorConsumers"><span class="annot"><span class="annottext">inlineConstructorConsumers :: FunDefs1 -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.Fusion2.html#inlineConstructorConsumers"><span class="hs-identifier hs-var hs-var">inlineConstructorConsumers</span></a></span></span><span> </span><span id="local-6989586621680983233"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680983233"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680983234"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983234"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-573"></span><span>   </span><span class="hs-keyword">do</span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983235"><span class="annot"><span class="annottext">defTable :: DefTable
</span><a href="#local-6989586621680983235"><span class="hs-identifier hs-var hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; DefTable
</span><a href="Gibbon.Passes.Fusion2.html#buildDefTable"><span class="hs-identifier hs-var">buildDefTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983234"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983236"><span class="annot"><span class="annottext">exp2 :: Exp1
</span><a href="#local-6989586621680983236"><span class="hs-identifier hs-var hs-var">exp2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983235"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983234"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>    </span><span class="hs-keyword">if</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983236"><span class="hs-identifier hs-var">exp2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983234"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983236"><span class="hs-identifier hs-var">exp2</span></a></span><span>
</span><span id="line-578"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-keyword">do</span><span>
</span><span id="line-580"></span><span>         </span><span id="local-6989586621680983239"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983239"><span class="hs-identifier hs-var">exp2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarEnv -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.Freshen.html#freshExp1"><span class="hs-identifier hs-var">freshExp1</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983236"><span class="hs-identifier hs-var">exp2</span></a></span><span>
</span><span id="line-581"></span><span>         </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.Fusion2.html#inlineConstructorConsumers"><span class="hs-identifier hs-var">inlineConstructorConsumers</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680983233"><span class="hs-identifier hs-var">fdefs</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983239"><span class="hs-identifier hs-var">exp2'</span></a></span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-583"></span><span>    </span><span id="local-6989586621680983238"><span class="annot"><span class="annottext">go :: DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680983240"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span></span><span> </span><span id="local-6989586621680983241"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983241"><span class="hs-identifier hs-var">ex</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-584"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983241"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-585"></span><span>          </span><span id="local-6989586621680983242"><span class="annot"><span class="annottext">original :: Exp1
</span><a href="#local-6989586621680983242"><span class="hs-identifier hs-var">original</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983243"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983243"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680983244"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983244"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983245"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983245"><span class="hs-identifier hs-var">parList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-586"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983245"><span class="hs-identifier hs-var">parList</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-587"></span><span>                         </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680983246"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983246"><span class="hs-identifier hs-var">symInner</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-588"></span><span>                             </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; DefTable -&gt; Maybe Exp1
forall {k}. Ord k =&gt; k -&gt; Map k DefTableEntry -&gt; Maybe Exp1
</span><a href="#local-6989586621680983247"><span class="hs-identifier hs-var">getDefiningConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983246"><span class="hs-identifier hs-var">symInner</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-589"></span><span>                                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680983248"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983248"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983249"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983249"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span> </span><span id="local-6989586621680983250"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983250"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-590"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983251"><span class="annot"><span class="annottext">calleeBody :: Exp1
</span><a href="#local-6989586621680983251"><span class="hs-identifier hs-var hs-var">calleeBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680983233"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span>  </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983243"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>                                      </span><span id="local-6989586621680983253"><span class="annot"><span class="annottext">calleeArgs :: [Var]
</span><a href="#local-6989586621680983253"><span class="hs-identifier hs-var hs-var">calleeArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680983233"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span>  </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983243"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>                                      </span><span id="local-6989586621680983254"><span class="annot"><span class="annottext">calleeBody' :: Exp1
</span><a href="#local-6989586621680983254"><span class="hs-identifier hs-var hs-var">calleeBody'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [Var] -&gt; [Exp1] -&gt; Exp1
forall {e :: * -&gt; * -&gt; *} {l} {d}.
(Expression (e l d), SubstitutableExt (PreExp e l d) (e l d), Eq d,
 Eq l, Eq (e l d), Show d, Show l, Out d, Out l) =&gt;
PreExp e l d -&gt; [Var] -&gt; [PreExp e l d] -&gt; PreExp e l d
</span><a href="#local-6989586621680983255"><span class="hs-identifier hs-var">replaceArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983251"><span class="hs-identifier hs-var">calleeBody</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983253"><span class="hs-identifier hs-var">calleeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983245"><span class="hs-identifier hs-var">parList</span></a></span><span>
</span><span id="line-593"></span><span>                                      </span><span id="local-6989586621680983256"><span class="annot"><span class="annottext">calleeBody'' :: Exp1
</span><a href="#local-6989586621680983256"><span class="hs-identifier hs-var hs-var">calleeBody''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983257"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680983257"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983245"><span class="hs-identifier hs-var">parList</span></a></span><span>
</span><span id="line-594"></span><span>                                                          </span><span id="local-6989586621680983258"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680983258"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; String -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983248"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983249"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983250"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>                                                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983257"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983258"><span class="hs-identifier hs-var">newExp</span></a></span><span>   </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983254"><span class="hs-identifier hs-var">calleeBody'</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>                                      </span><span id="local-6989586621680983259"><span class="annot"><span class="annottext">calleeBody''' :: Exp1
</span><a href="#local-6989586621680983259"><span class="hs-identifier hs-var hs-var">calleeBody'''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyCases2"><span class="hs-identifier hs-var">simplifyCases2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983256"><span class="hs-identifier hs-var">calleeBody''</span></a></span><span>
</span><span id="line-598"></span><span>                                  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983259"><span class="hs-identifier hs-var">calleeBody'''</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">--`debug1` ( &quot;here we are&quot; L.++show (DataConE loc dataCons args ))</span><span>
</span><span id="line-599"></span><span>                                </span><span class="annot"><span class="annottext">Maybe Exp1
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983242"><span class="hs-identifier hs-var">original</span></a></span><span> </span><span class="hs-comment">--`debug1` ( &quot;norm exit1&quot; L.++show (AppE fName loc parList))</span><span>
</span><span id="line-600"></span><span>                         </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983242"><span class="hs-identifier hs-var">original</span></a></span><span> </span><span class="hs-comment">--`debug1` ( &quot;norm exit2&quot; L.++show (AppE fName loc parList))</span><span>
</span><span id="line-601"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983260"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983260"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983261"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983261"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983262"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983262"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983263"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983263"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983264"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983264"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-602"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983265"><span class="annot"><span class="annottext">normal :: Exp1
</span><a href="#local-6989586621680983265"><span class="hs-identifier hs-var hs-var">normal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983260"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983261"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983262"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983263"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span>  </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983264"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-603"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983263"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-604"></span><span>                  </span><span id="local-6989586621680983266"><span class="annot"><span class="annottext">original :: Exp1
</span><a href="#local-6989586621680983266"><span class="hs-identifier hs-var">original</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983267"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983267"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680983268"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983268"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983269"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983269"><span class="hs-identifier hs-var">parList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-605"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983269"><span class="hs-identifier hs-var">parList</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-606"></span><span>                          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680983270"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983270"><span class="hs-identifier hs-var">symInner</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-607"></span><span>                             </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; DefTable -&gt; Maybe Exp1
forall {k}. Ord k =&gt; k -&gt; Map k DefTableEntry -&gt; Maybe Exp1
</span><a href="#local-6989586621680983247"><span class="hs-identifier hs-var">getDefiningConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983270"><span class="hs-identifier hs-var">symInner</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-608"></span><span>                                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680983271"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983271"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983272"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983272"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span> </span><span id="local-6989586621680983273"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983273"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-609"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983274"><span class="annot"><span class="annottext">calleeBody :: Exp1
</span><a href="#local-6989586621680983274"><span class="hs-identifier hs-var hs-var">calleeBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680983233"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span>  </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983267"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>                                      </span><span id="local-6989586621680983275"><span class="annot"><span class="annottext">calleeArgs :: [Var]
</span><a href="#local-6989586621680983275"><span class="hs-identifier hs-var hs-var">calleeArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680983233"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span>  </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983267"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>                                      </span><span id="local-6989586621680983276"><span class="annot"><span class="annottext">calleeBody' :: Exp1
</span><a href="#local-6989586621680983276"><span class="hs-identifier hs-var hs-var">calleeBody'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [Var] -&gt; [Exp1] -&gt; Exp1
forall {e :: * -&gt; * -&gt; *} {l} {d}.
(Expression (e l d), SubstitutableExt (PreExp e l d) (e l d), Eq d,
 Eq l, Eq (e l d), Show d, Show l, Out d, Out l) =&gt;
PreExp e l d -&gt; [Var] -&gt; [PreExp e l d] -&gt; PreExp e l d
</span><a href="#local-6989586621680983255"><span class="hs-identifier hs-var">replaceArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983274"><span class="hs-identifier hs-var">calleeBody</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983275"><span class="hs-identifier hs-var">calleeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983269"><span class="hs-identifier hs-var">parList</span></a></span><span>
</span><span id="line-612"></span><span>                                      </span><span id="local-6989586621680983277"><span class="annot"><span class="annottext">calleeBody'' :: Exp1
</span><a href="#local-6989586621680983277"><span class="hs-identifier hs-var hs-var">calleeBody''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983278"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680983278"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983269"><span class="hs-identifier hs-var">parList</span></a></span><span>
</span><span id="line-613"></span><span>                                                          </span><span id="local-6989586621680983279"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680983279"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; String -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983271"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983272"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983273"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>                                                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983278"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983279"><span class="hs-identifier hs-var">newExp</span></a></span><span>   </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983276"><span class="hs-identifier hs-var">calleeBody'</span></a></span><span> </span><span class="hs-comment">--`debug1` ( &quot;2here we are&quot; L.++show ((DataConE loc dataCons args)))</span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>                                      </span><span id="local-6989586621680983280"><span class="annot"><span class="annottext">calleeBody''' :: Exp1
</span><a href="#local-6989586621680983280"><span class="hs-identifier hs-var hs-var">calleeBody'''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyCases2"><span class="hs-identifier hs-var">simplifyCases2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983277"><span class="hs-identifier hs-var">calleeBody''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>                                      </span><span id="local-6989586621680983281"><span class="annot"><span class="annottext">leafExp :: Exp1
</span><a href="#local-6989586621680983281"><span class="hs-identifier hs-var hs-var">leafExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#getLeafExpr"><span class="hs-identifier hs-var">getLeafExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983280"><span class="hs-identifier hs-var">calleeBody'''</span></a></span><span>
</span><span id="line-618"></span><span>                                        </span><span class="hs-comment">--       `debug1`(&quot;A&quot;L.++ (show calleeBody'''))</span><span>
</span><span id="line-619"></span><span>                                      </span><span id="local-6989586621680983283"><span class="annot"><span class="annottext">newTail :: Exp1
</span><a href="#local-6989586621680983283"><span class="hs-identifier hs-var hs-var">newTail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983260"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983262"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983281"><span class="hs-identifier hs-var">leafExp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983264"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>                                       </span><span class="hs-comment">--        `debug1`(&quot;A&quot;L.++ (show      leafExp))</span><span>
</span><span id="line-621"></span><span>                                  </span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#replaceLeafWithExp"><span class="hs-identifier hs-var">replaceLeafWithExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983280"><span class="hs-identifier hs-var">calleeBody'''</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983283"><span class="hs-identifier hs-var">newTail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>                                      </span><span class="hs-comment">--debug1`(&quot;A&quot;L.++ (show   newTail))</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span>                                </span><span class="annot"><span class="annottext">Maybe Exp1
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983265"><span class="hs-identifier hs-var">normal</span></a></span><span class="hs-comment">-- `debug1` ( &quot;2norm exit1&quot; L.++show (AppE fName loc   parList))</span><span>
</span><span id="line-625"></span><span>                          </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983265"><span class="hs-identifier hs-var">normal</span></a></span><span class="hs-comment">-- `debug1` ( &quot;2norm exit2&quot; L.++show (AppE fName loc parList))</span><span>
</span><span id="line-626"></span><span>                  </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983265"><span class="hs-identifier hs-var">normal</span></a></span><span>
</span><span id="line-627"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680983284"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983284"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983285"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983285"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680983286"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983286"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983284"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983285"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983286"><span class="hs-identifier hs-var">e3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983287"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983287"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983288"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983288"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983287"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1)
</span><a href="#local-6989586621680983289"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983288"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680983289"><span class="annot"><span class="annottext">f :: (String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1)
</span><a href="#local-6989586621680983289"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983290"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983290"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983291"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983291"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983292"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983292"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983290"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983291"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983292"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680983293"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983293"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680983294"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983294"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621680983295"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983295"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Ty1 -&gt; Bool -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983293"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983294"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983295"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-631"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680983296"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983296"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983297"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983297"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span> </span><span id="local-6989586621680983298"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983298"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; String -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983296"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983297"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTable -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983238"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983240"><span class="hs-identifier hs-var">defTable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983298"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>          </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983241"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span>    </span><span id="local-6989586621680983247"><span class="annot"><span class="annottext">getDefiningConstructor :: k -&gt; Map k DefTableEntry -&gt; Maybe Exp1
</span><a href="#local-6989586621680983247"><span class="hs-identifier hs-var hs-var">getDefiningConstructor</span></a></span></span><span> </span><span id="local-6989586621680983304"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680983304"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680983305"><span class="annot"><span class="annottext">Map k DefTableEntry
</span><a href="#local-6989586621680983305"><span class="hs-identifier hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-635"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k DefTableEntry -&gt; Maybe DefTableEntry
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680983304"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map k DefTableEntry
</span><a href="#local-6989586621680983305"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-636"></span><span>        </span><span class="annot"><span class="annottext">Maybe DefTableEntry
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Exp1
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-comment">-- `debug1` (&quot;not found&quot; L.++ (show x))</span><span>
</span><span id="line-637"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680983306"><span class="annot"><span class="annottext">DefTableEntry
</span><a href="#local-6989586621680983306"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-638"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefTableEntry -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">DefTableEntry
</span><a href="#local-6989586621680983306"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-639"></span><span>            </span><span id="local-6989586621680983307"><span class="annot"><span class="annottext">cons :: Exp1
</span><a href="#local-6989586621680983307"><span class="hs-identifier hs-var">cons</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Maybe Exp1
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983307"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-640"></span><span>            </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Exp1
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-comment">--`debug1` (&quot;defined not as constr&quot; L.++ (show x))</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>    </span><span id="local-6989586621680983255"><span class="annot"><span class="annottext">replaceArgs :: PreExp e l d -&gt; [Var] -&gt; [PreExp e l d] -&gt; PreExp e l d
</span><a href="#local-6989586621680983255"><span class="hs-identifier hs-var hs-var">replaceArgs</span></a></span></span><span> </span><span id="local-6989586621680983340"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983340"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983341"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983341"><span class="hs-identifier hs-var">h1</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680983342"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983342"><span class="hs-identifier hs-var">tailarg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983343"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983343"><span class="hs-identifier hs-var">h2</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680983344"><span class="annot"><span class="annottext">[PreExp e l d]
</span><a href="#local-6989586621680983344"><span class="hs-identifier hs-var">tailPar</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-643"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983345"><span class="annot"><span class="annottext">oldExp :: PreExp e l d
</span><a href="#local-6989586621680983345"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp e l d
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983341"><span class="hs-identifier hs-var">h1</span></a></span><span>
</span><span id="line-644"></span><span>                  </span><span id="local-6989586621680983346"><span class="annot"><span class="annottext">newExp :: PreExp e l d
</span><a href="#local-6989586621680983346"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983343"><span class="hs-identifier hs-var">h2</span></a></span><span>
</span><span id="line-645"></span><span>                  </span><span id="local-6989586621680983347"><span class="annot"><span class="annottext">exp' :: PreExp e l d
</span><a href="#local-6989586621680983347"><span class="hs-identifier hs-var hs-var">exp'</span></a></span></span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983345"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983346"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983340"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-646"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PreExp e l d -&gt; [Var] -&gt; [PreExp e l d] -&gt; PreExp e l d
</span><a href="#local-6989586621680983255"><span class="hs-identifier hs-var">replaceArgs</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983347"><span class="hs-identifier hs-var">exp'</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983342"><span class="hs-identifier hs-var">tailarg</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp e l d]
</span><a href="#local-6989586621680983344"><span class="hs-identifier hs-var">tailPar</span></a></span><span>
</span><span id="line-647"></span><span>    </span><span class="annot"><a href="#local-6989586621680983255"><span class="hs-identifier hs-var">replaceArgs</span></a></span><span> </span><span id="local-6989586621680983348"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983348"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983348"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-comment">-- getArgs x defTable =</span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-comment">--   case M.lookup x defTable of</span><span>
</span><span id="line-650"></span><span>    </span><span class="hs-comment">--     Nothing -&gt; error &quot;error in foldFusedCalls&quot;</span><span>
</span><span id="line-651"></span><span>    </span><span class="hs-comment">--     Just entry -&gt;</span><span>
</span><span id="line-652"></span><span>    </span><span class="hs-comment">--       case def entry of</span><span>
</span><span id="line-653"></span><span>    </span><span class="hs-comment">--         AppE _ _ args -&gt; args</span><span>
</span><span id="line-654"></span><span>    </span><span class="hs-comment">--         _ -&gt; error (&quot;ops&quot; L.++ show (def entry))</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#foldFusedCalls"><span class="hs-identifier hs-type">foldFusedCalls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-657"></span><span id="foldFusedCalls"><span class="annot"><span class="annottext">foldFusedCalls :: (Var, Var, Int, Var) -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCalls"><span class="hs-identifier hs-var hs-var">foldFusedCalls</span></a></span></span><span> </span><span id="local-6989586621680983357"><span class="annot"><span class="annottext">rule :: (Var, Var, Int, Var)
</span><a href="#local-6989586621680983357"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680983358"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983358"><span class="hs-identifier hs-var">outerName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983359"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983359"><span class="hs-identifier hs-var">innerName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983360"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983360"><span class="hs-identifier hs-var">argPos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983361"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983361"><span class="hs-identifier hs-var">newName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983362"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983362"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-658"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983363"><span class="annot"><span class="annottext">defTable :: DefTable
</span><a href="#local-6989586621680983363"><span class="hs-identifier hs-var hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; DefTable
</span><a href="Gibbon.Passes.Fusion2.html#buildDefTable"><span class="hs-identifier hs-var">buildDefTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983362"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>      </span><span id="local-6989586621680983364"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680983365"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983365"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-660"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983365"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-661"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983366"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983366"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680983367"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983367"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983368"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983368"><span class="hs-identifier hs-var">argList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-662"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983369"><span class="annot"><span class="annottext">notFolded :: Exp1
</span><a href="#local-6989586621680983369"><span class="hs-identifier hs-var hs-var">notFolded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983366"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983367"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983368"><span class="hs-identifier hs-var">argList</span></a></span><span>
</span><span id="line-663"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983366"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983358"><span class="hs-identifier hs-var">outerName</span></a></span><span>
</span><span id="line-664"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983368"><span class="hs-identifier hs-var">argList</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-665"></span><span>                         </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680983370"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983370"><span class="hs-identifier hs-var">symInner</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-666"></span><span>                           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983359"><span class="hs-identifier hs-var">innerName</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; DefTable -&gt; Var
forall {k}. Ord k =&gt; k -&gt; Map k DefTableEntry -&gt; Var
</span><a href="#local-6989586621680983371"><span class="hs-identifier hs-var">getDefiningFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983370"><span class="hs-identifier hs-var">symInner</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983363"><span class="hs-identifier hs-var">defTable</span></a></span><span>
</span><span id="line-667"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983372"><span class="annot"><span class="annottext">innerArgs :: [Exp1]
</span><a href="#local-6989586621680983372"><span class="hs-identifier hs-var hs-var">innerArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; DefTable -&gt; [Exp1]
forall {k}. Ord k =&gt; k -&gt; Map k DefTableEntry -&gt; [Exp1]
</span><a href="#local-6989586621680983373"><span class="hs-identifier hs-var">getArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983370"><span class="hs-identifier hs-var">symInner</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983363"><span class="hs-identifier hs-var">defTable</span></a></span><span>
</span><span id="line-668"></span><span>                                      </span><span id="local-6989586621680983374"><span class="annot"><span class="annottext">outerArgs :: [Exp1]
</span><a href="#local-6989586621680983374"><span class="hs-identifier hs-var hs-var">outerArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983368"><span class="hs-identifier hs-var">argList</span></a></span><span>
</span><span id="line-669"></span><span>                                      </span><span id="local-6989586621680983375"><span class="annot"><span class="annottext">newCallArgs :: [Exp1]
</span><a href="#local-6989586621680983375"><span class="hs-identifier hs-var hs-var">newCallArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-670"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983372"><span class="hs-identifier hs-var">innerArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983368"><span class="hs-identifier hs-var">argList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>                                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983361"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983367"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983375"><span class="hs-identifier hs-var">newCallArgs</span></a></span><span>
</span><span id="line-672"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983369"><span class="hs-identifier hs-var">notFolded</span></a></span><span>
</span><span id="line-673"></span><span>                         </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983369"><span class="hs-identifier hs-var">notFolded</span></a></span><span>
</span><span id="line-674"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983369"><span class="hs-identifier hs-var">notFolded</span></a></span><span>
</span><span id="line-675"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983376"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983376"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983377"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983377"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983378"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983378"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983379"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983379"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983380"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983380"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983376"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983377"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983378"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983379"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983380"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680983381"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983381"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983382"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983382"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680983383"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983383"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983381"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983382"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983383"><span class="hs-identifier hs-var">e3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983384"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983384"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983385"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983385"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983384"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1)
</span><a href="#local-6989586621680983386"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983385"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680983386"><span class="annot"><span class="annottext">f :: (String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1)
</span><a href="#local-6989586621680983386"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983387"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983387"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983388"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983388"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983389"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983389"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983387"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983388"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983389"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680983390"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983390"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680983391"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983391"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621680983392"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983392"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Ty1 -&gt; Bool -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983390"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983391"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983392"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-680"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680983393"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983393"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983394"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983394"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span> </span><span id="local-6989586621680983395"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983395"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; String -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983393"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983394"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983395"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>          </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983365"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-682"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983364"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983362"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-684"></span><span>    </span><span id="local-6989586621680983371"><span class="annot"><span class="annottext">getDefiningFunction :: k -&gt; Map k DefTableEntry -&gt; Var
</span><a href="#local-6989586621680983371"><span class="hs-identifier hs-var hs-var">getDefiningFunction</span></a></span></span><span> </span><span id="local-6989586621680983400"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680983400"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680983401"><span class="annot"><span class="annottext">Map k DefTableEntry
</span><a href="#local-6989586621680983401"><span class="hs-identifier hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k DefTableEntry -&gt; Maybe DefTableEntry
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680983400"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map k DefTableEntry
</span><a href="#local-6989586621680983401"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-686"></span><span>        </span><span class="annot"><span class="annottext">Maybe DefTableEntry
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dummy&quot;</span></span><span>
</span><span id="line-687"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680983402"><span class="annot"><span class="annottext">DefTableEntry
</span><a href="#local-6989586621680983402"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-688"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefTableEntry -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">DefTableEntry
</span><a href="#local-6989586621680983402"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-689"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983403"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983403"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983403"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-690"></span><span>            </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dummy&quot;</span></span><span>
</span><span id="line-691"></span><span>    </span><span id="local-6989586621680983373"><span class="annot"><span class="annottext">getArgs :: k -&gt; Map k DefTableEntry -&gt; [Exp1]
</span><a href="#local-6989586621680983373"><span class="hs-identifier hs-var hs-var">getArgs</span></a></span></span><span> </span><span id="local-6989586621680983418"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680983418"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680983419"><span class="annot"><span class="annottext">Map k DefTableEntry
</span><a href="#local-6989586621680983419"><span class="hs-identifier hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-692"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k DefTableEntry -&gt; Maybe DefTableEntry
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680983418"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map k DefTableEntry
</span><a href="#local-6989586621680983419"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-693"></span><span>        </span><span class="annot"><span class="annottext">Maybe DefTableEntry
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Exp1]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;error in foldFusedCalls&quot;</span></span><span>
</span><span id="line-694"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680983420"><span class="annot"><span class="annottext">DefTableEntry
</span><a href="#local-6989586621680983420"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-695"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DefTableEntry -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">DefTableEntry
</span><a href="#local-6989586621680983420"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-696"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680983421"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983421"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983421"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-697"></span><span>            </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Exp1]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ops&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTableEntry -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">DefTableEntry
</span><a href="#local-6989586621680983420"><span class="hs-identifier hs-var">entry</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="hs-comment">-- outputPositions specify for each call i at what index is the corresponding</span><span>
</span><span id="line-700"></span><span class="hs-comment">-- output in the returned tuple</span><span>
</span><span id="line-701"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#foldTupledFunctions"><span class="hs-identifier hs-type">foldTupledFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span>   </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-702"></span><span> </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#Vector"><span class="hs-identifier hs-type">V.Vector</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span id="foldTupledFunctions"><span class="annot"><span class="annottext">foldTupledFunctions :: Exp1
-&gt; FunDef1
-&gt; [Exp1]
-&gt; Vector Int
-&gt; Map (Int, Int) (Int, Int)
-&gt; PassM Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldTupledFunctions"><span class="hs-identifier hs-var hs-var">foldTupledFunctions</span></a></span></span><span> </span><span id="local-6989586621680983489"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983489"><span class="hs-identifier hs-var">bodyM</span></a></span></span><span> </span><span id="local-6989586621680983490"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983490"><span class="hs-identifier hs-var">newFun</span></a></span></span><span> </span><span id="local-6989586621680983491"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983491"><span class="hs-identifier hs-var">oldCalls</span></a></span></span><span>  </span><span id="local-6989586621680983492"><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680983492"><span class="hs-identifier hs-var">outputPositions</span></a></span></span><span> </span><span id="local-6989586621680983493"><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680983493"><span class="hs-identifier hs-var">syncedArgs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-705"></span><span>     </span><span id="local-6989586621680983494"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983494"><span class="hs-identifier hs-var">newVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tupled_output&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>     </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983489"><span class="hs-identifier hs-var">bodyM</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983494"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-708"></span><span>    </span><span id="local-6989586621680983495"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680983496"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983496"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span id="local-6989586621680983497"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span></span><span> </span><span id="local-6989586621680983498"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-709"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983496"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-710"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680983499"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983499"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983500"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983500"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983501"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983501"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983502"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983502"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983503"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983503"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-711"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [Exp1] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983502"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983491"><span class="hs-identifier hs-var">oldCalls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-712"></span><span>              </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-713"></span><span>                </span><span class="hs-keyword">do</span><span>
</span><span id="line-714"></span><span>                  </span><span id="local-6989586621680983505"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983505"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983502"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-715"></span><span>                  </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983499"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983500"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983501"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983505"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; PassM Exp1 -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983503"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-716"></span><span>              </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680983507"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983507"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-717"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-comment">-- not valid af</span><span>
</span><span id="line-718"></span><span>                    </span><span class="hs-keyword">then</span><span>
</span><span id="line-719"></span><span>                      </span><span class="hs-keyword">do</span><span>
</span><span id="line-720"></span><span>                        </span><span id="local-6989586621680983508"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983508"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983503"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-721"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983509"><span class="annot"><span class="annottext">args :: [Exp1]
</span><a href="#local-6989586621680983509"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Int -&gt; Exp1 -&gt; [Exp1])
-&gt; [Exp1] -&gt; Vector Exp1 -&gt; [Exp1]
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Int -&gt; Exp1 -&gt; [Exp1]
</span><a href="#local-6989586621680983510"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983491"><span class="hs-identifier hs-var">oldCalls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>                             </span><span class="hs-keyword">where</span><span>
</span><span id="line-723"></span><span>                              </span><span id="local-6989586621680983510"><span class="annot"><span class="annottext">f :: [Exp1] -&gt; Int -&gt; Exp1 -&gt; [Exp1]
</span><a href="#local-6989586621680983510"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680983511"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983511"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span id="local-6989586621680983512"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983512"><span class="hs-identifier hs-var">fIdx</span></a></span></span><span> </span><span id="local-6989586621680983513"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983513"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983511"><span class="hs-identifier hs-var">ls1</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; [Exp1]
</span><a href="#local-6989586621680983514"><span class="hs-identifier hs-var">extractArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983512"><span class="hs-identifier hs-var">fIdx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983513"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span>                              </span><span id="local-6989586621680983514"><span class="annot"><span class="annottext">extractArgs :: Int -&gt; Exp1 -&gt; [Exp1]
</span><a href="#local-6989586621680983514"><span class="hs-identifier hs-var hs-var">extractArgs</span></a></span></span><span> </span><span id="local-6989586621680983515"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983515"><span class="hs-identifier hs-var">fIdx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680983516"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983516"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680983517"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983517"><span class="hs-identifier hs-var">tail</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-726"></span><span>                                 </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; [Exp1]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Exp1 -&gt; Bool) -&gt; Vector Exp1 -&gt; Vector Exp1
forall a. (Int -&gt; a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifilter"><span class="hs-identifier hs-var">V.ifilter</span></a></span><span> </span><span class="hs-comment">-- argIdx+1 because head is dropped (idx 0)</span><span>
</span><span id="line-727"></span><span>                                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983520"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983520"><span class="hs-identifier hs-var">argIdx</span></a></span></span><span> </span><span id="local-6989586621680983521"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983521"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Map (Int, Int) (Int, Int) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983515"><span class="hs-identifier hs-var">fIdx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983520"><span class="hs-identifier hs-var">argIdx</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680983493"><span class="hs-identifier hs-var">syncedArgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983517"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983523"><span class="annot"><span class="annottext">args' :: [Exp1]
</span><a href="#local-6989586621680983523"><span class="hs-identifier hs-var hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983524"><span class="hs-identifier hs-var">getFirstArg</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983502"><span class="hs-identifier hs-var">rhs</span></a></span><span class="annot"><span class="annottext">Exp1 -&gt; [Exp1] -&gt; [Exp1]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983509"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-731"></span><span>                             </span><span class="hs-keyword">where</span><span>
</span><span id="line-732"></span><span>                              </span><span id="local-6989586621680983524"><span class="annot"><span class="annottext">getFirstArg :: PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983524"><span class="hs-identifier hs-var hs-var">getFirstArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[loc]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983525"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983525"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983525"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-comment">--`debug` (&quot;oldCalls&quot; L.++ (show oldCalls) L.++</span><span>
</span><span id="line-733"></span><span>                                 </span><span class="hs-comment">--(render( pprint bodyM)))</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983526"><span class="annot"><span class="annottext">rhs' :: Exp1
</span><a href="#local-6989586621680983526"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983490"><span class="hs-identifier hs-var">newFun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983523"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-736"></span><span>                            </span><span class="hs-comment">--   `debug` (&quot;new call&quot; L.++ (show (AppE (funName newFun) [] args')))</span><span>
</span><span id="line-737"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983527"><span class="annot"><span class="annottext">bindType :: Ty1
</span><a href="#local-6989586621680983527"><span class="hs-identifier hs-var hs-var">bindType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowTy Ty1 -&gt; Ty1
forall ty. FunctionTy ty =&gt; ArrowTy ty -&gt; ty
</span><a href="Gibbon.Language.Syntax.html#outTy"><span class="hs-identifier hs-var">outTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983490"><span class="hs-identifier hs-var">newFun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983529"><span class="annot"><span class="annottext">rhs'' :: Exp1
</span><a href="#local-6989586621680983529"><span class="hs-identifier hs-var hs-var">rhs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983501"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-739"></span><span>                              </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680983530"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983530"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-740"></span><span>                                </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; [Exp1]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Ty1 -&gt; Exp1) -&gt; Vector Ty1 -&gt; Vector Exp1
forall a b. (Int -&gt; a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#imap"><span class="hs-identifier hs-var">V.imap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983532"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983532"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-741"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983533"><span class="annot"><span class="annottext">idx :: Int
</span><a href="#local-6989586621680983533"><span class="hs-identifier hs-var hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680983492"><span class="hs-identifier hs-var">outputPositions</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983507"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983532"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-742"></span><span>                                  </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983533"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1] -&gt; Vector Ty1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983530"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>                              </span><span id="local-6989586621680983534"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983534"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-745"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983535"><span class="annot"><span class="annottext">idx :: Int
</span><a href="#local-6989586621680983535"><span class="hs-identifier hs-var hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680983492"><span class="hs-identifier hs-var">outputPositions</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983507"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span>                                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983535"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">)</span><span class="hs-comment">-- not complete buggy (i +eps)</span><span>
</span><span id="line-748"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983536"><span class="annot"><span class="annottext">body'' :: Exp1
</span><a href="#local-6989586621680983536"><span class="hs-identifier hs-var hs-var">body''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>    </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983499"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983500"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983501"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983529"><span class="hs-identifier hs-var">rhs''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983508"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-749"></span><span>                            </span><span id="local-6989586621680983537"><span class="annot"><span class="annottext">body3 :: Exp1
</span><a href="#local-6989586621680983537"><span class="hs-identifier hs-var hs-var">body3</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983527"><span class="hs-identifier hs-var">bindType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983526"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983536"><span class="hs-identifier hs-var">body''</span></a></span><span>
</span><span id="line-750"></span><span>                            </span><span id="local-6989586621680983538"><span class="annot"><span class="annottext">body4 :: Exp1
</span><a href="#local-6989586621680983538"><span class="hs-identifier hs-var hs-var">body4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>   </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983539"><span class="hs-identifier hs-var">collectArgsConstruction</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983509"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983537"><span class="hs-identifier hs-var">body3</span></a></span><span>
</span><span id="line-751"></span><span>                        </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983538"><span class="hs-identifier hs-var">body4</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span>                    </span><span class="hs-keyword">else</span><span>
</span><span id="line-754"></span><span>                      </span><span class="hs-keyword">do</span><span>
</span><span id="line-755"></span><span>                        </span><span id="local-6989586621680983540"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983540"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983503"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-comment">--`debug` (&quot;\nhere\n&quot;)</span><span>
</span><span id="line-756"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983541"><span class="annot"><span class="annottext">rhs' :: Exp1
</span><a href="#local-6989586621680983541"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983501"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-757"></span><span>                              </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680983542"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983542"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-758"></span><span>                                </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; [Exp1]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Ty1 -&gt; Exp1) -&gt; Vector Ty1 -&gt; Vector Exp1
forall a b. (Int -&gt; a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#imap"><span class="hs-identifier hs-var">V.imap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983543"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983543"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-759"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983544"><span class="annot"><span class="annottext">idx :: Int
</span><a href="#local-6989586621680983544"><span class="hs-identifier hs-var hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680983492"><span class="hs-identifier hs-var">outputPositions</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983507"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">)</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983543"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span>                                  </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983544"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1] -&gt; Vector Ty1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983542"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span>                              </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-765"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983545"><span class="annot"><span class="annottext">idx :: Int
</span><a href="#local-6989586621680983545"><span class="hs-identifier hs-var hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680983492"><span class="hs-identifier hs-var">outputPositions</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983507"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span>                                  </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983545"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- not complete buggy (i +eps)</span><span>
</span><span id="line-768"></span><span>                        </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983499"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983500"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983501"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983541"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983540"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983546"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983546"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680983547"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983547"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983548"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983548"><span class="hs-identifier hs-var">argList</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-771"></span><span>           </span><span class="hs-keyword">do</span><span>
</span><span id="line-772"></span><span>             </span><span id="local-6989586621680983549"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983549"><span class="hs-identifier hs-var">argList'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; [Exp1] -&gt; PassM [Exp1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983550"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983550"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983550"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983548"><span class="hs-identifier hs-var">argList</span></a></span><span>
</span><span id="line-773"></span><span>             </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983546"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983547"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983549"><span class="hs-identifier hs-var">argList'</span></a></span><span>
</span><span id="line-774"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680983551"><span class="annot"><span class="annottext">Prim Ty1
</span><a href="#local-6989586621680983551"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680983552"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983552"><span class="hs-identifier hs-var">ls</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-775"></span><span>            </span><span class="annot"><span class="annottext">Prim Ty1 -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty1
</span><a href="#local-6989586621680983551"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; PassM [Exp1] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; [Exp1] -&gt; PassM [Exp1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983553"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983553"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983553"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983552"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983554"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983554"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983555"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983555"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983556"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983556"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983557"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983557"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983558"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983558"><span class="hs-identifier hs-var">bod</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-778"></span><span>            </span><span id="local-6989586621680983559"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983559"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983558"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-779"></span><span>            </span><span id="local-6989586621680983560"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983560"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983557"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-780"></span><span>            </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983554"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983555"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983556"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983560"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983559"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680983561"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983561"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983562"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983562"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680983563"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983563"><span class="hs-identifier hs-var">e3</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-782"></span><span>          </span><span id="local-6989586621680983564"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983564"><span class="hs-identifier hs-var">e1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983561"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-783"></span><span>          </span><span id="local-6989586621680983565"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983565"><span class="hs-identifier hs-var">e2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983562"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-784"></span><span>          </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983564"><span class="hs-identifier hs-var">e1'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983565"><span class="hs-identifier hs-var">e2'</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; PassM Exp1 -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983563"><span class="hs-identifier hs-var">e3</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680983566"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983566"><span class="hs-identifier hs-var">ls</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-787"></span><span>          </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; PassM [Exp1] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; [Exp1] -&gt; PassM [Exp1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983567"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983567"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983567"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983566"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-788"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680983568"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983568"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680983569"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983569"><span class="hs-identifier hs-var">exp</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-789"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983568"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; PassM Exp1 -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983569"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983570"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983570"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983571"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983571"><span class="hs-identifier hs-var">ls1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-791"></span><span>        </span><span class="hs-comment">--  e1' &lt;- go e1  newVar first</span><span>
</span><span id="line-792"></span><span>          </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983570"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">([(String, [(Var, ())], Exp1)] -&gt; Exp1)
-&gt; PassM [(String, [(Var, ())], Exp1)] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; PassM (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)]
-&gt; PassM [(String, [(Var, ())], Exp1)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680983572"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983572"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983573"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983573"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983574"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983574"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-793"></span><span>            </span><span class="hs-keyword">do</span><span>
</span><span id="line-794"></span><span>              </span><span id="local-6989586621680983575"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983575"><span class="hs-identifier hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983574"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-795"></span><span>              </span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1) -&gt; PassM (String, [(Var, ())], Exp1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983572"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983573"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983575"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>              </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983571"><span class="hs-identifier hs-var">ls1</span></a></span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680983576"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983576"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983577"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983577"><span class="hs-identifier hs-var">datacons</span></a></span></span><span> </span><span id="local-6989586621680983578"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983578"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-799"></span><span>          </span><span class="annot"><span class="annottext">() -&gt; String -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983576"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983577"><span class="hs-identifier hs-var">datacons</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Exp1) -&gt; PassM [Exp1] -&gt; PassM Exp1
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; [Exp1] -&gt; PassM [Exp1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983579"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983579"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983579"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983578"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-800"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680983580"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983580"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680983581"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983581"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621680983582"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983582"><span class="hs-identifier hs-var">b</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-801"></span><span>          </span><span id="local-6989586621680983583"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983583"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool -&gt; PassM Exp1
</span><a href="#local-6989586621680983495"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983580"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983497"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983498"><span class="hs-identifier hs-var">first</span></a></span><span>
</span><span id="line-802"></span><span>          </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; PassM Exp1) -&gt; Exp1 -&gt; PassM Exp1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Ty1 -&gt; Bool -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983583"><span class="hs-identifier hs-var">e'</span></a></span><span>  </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983581"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983582"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-803"></span><span>        </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-804"></span><span>          </span><span class="annot"><span class="annottext">Exp1 -&gt; PassM Exp1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983496"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>    </span><span id="local-6989586621680983584"><span class="annot"><span class="annottext">defTable :: DefTable
</span><a href="#local-6989586621680983584"><span class="hs-identifier hs-var hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; DefTable
</span><a href="Gibbon.Passes.Fusion2.html#buildDefTable"><span class="hs-identifier hs-var">buildDefTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983489"><span class="hs-identifier hs-var">bodyM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>    </span><span id="local-6989586621680983585"><span class="annot"><span class="annottext">collectRec :: Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var hs-var">collectRec</span></a></span></span><span> </span><span id="local-6989586621680983586"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span></span><span> </span><span id="local-6989586621680983587"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983587"><span class="hs-identifier hs-var">exp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-808"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983587"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-809"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680983588"><span class="annot"><span class="annottext">v :: Var
</span><a href="#local-6989586621680983588"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680983589"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983589"><span class="hs-identifier hs-var">symbol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-810"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; DefTable -&gt; Maybe DefTableEntry
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983589"><span class="hs-identifier hs-var">symbol</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983584"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-811"></span><span>                </span><span class="annot"><span class="annottext">Maybe DefTableEntry
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span>
</span><span id="line-812"></span><span>                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span> </span><span id="local-6989586621680983590"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983590"><span class="hs-identifier hs-var">definingExp</span></a></span></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680983591"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983591"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-813"></span><span>                  </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983588"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983591"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983590"><span class="hs-identifier hs-var">definingExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983590"><span class="hs-identifier hs-var">definingExp</span></a></span><span>
</span><span id="line-814"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983592"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983592"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680983593"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983593"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; [Exp1] -&gt; Exp1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983593"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680983594"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983594"><span class="hs-identifier hs-var">expList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; [Exp1] -&gt; Exp1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983594"><span class="hs-identifier hs-var">expList</span></a></span><span>
</span><span id="line-816"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680983595"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983595"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; [Exp1] -&gt; Exp1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983595"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-817"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680983596"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983596"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680983597"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983597"><span class="hs-identifier hs-var">thenBody</span></a></span></span><span> </span><span id="local-6989586621680983598"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983598"><span class="hs-identifier hs-var">elseBody</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-818"></span><span>           </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; [Exp1] -&gt; Exp1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983596"><span class="hs-identifier hs-var">cond</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983597"><span class="hs-identifier hs-var">thenBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983598"><span class="hs-identifier hs-var">elseBody</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-819"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680983599"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983599"><span class="hs-identifier hs-var">expList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; [Exp1] -&gt; Exp1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983599"><span class="hs-identifier hs-var">expList</span></a></span><span>
</span><span id="line-820"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680983600"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983600"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680983601"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983601"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983601"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-821"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983586"><span class="hs-identifier hs-var">leafExp</span></a></span><span>
</span><span id="line-822"></span><span>        </span><span class="hs-comment">-- LetE (Var s,loc,t,rhs) bod -&gt;</span><span>
</span><span id="line-823"></span><span>        </span><span class="hs-comment">--    L.foldl collectRec leafExp  [rhs,  bod]</span><span>
</span><span id="line-824"></span><span>        </span><span id="local-6989586621680983602"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983602"><span class="hs-identifier hs-var">x</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Exp1
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;please handle me explicitly&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983602"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>    </span><span id="local-6989586621680983539"><span class="annot"><span class="annottext">collectArgsConstruction :: [Exp1] -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983539"><span class="hs-identifier hs-var hs-var">collectArgsConstruction</span></a></span></span><span> </span><span id="local-6989586621680983603"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983603"><span class="hs-identifier hs-var">args</span></a></span></span><span>  </span><span id="local-6989586621680983604"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983604"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; [Exp1] -&gt; Exp1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983585"><span class="hs-identifier hs-var">collectRec</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983604"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983603"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-827"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefs"><span class="hs-identifier hs-type">removeUnusedDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-828"></span><span id="removeUnusedDefs"><span class="annot"><span class="annottext">removeUnusedDefs :: FunDef1 -&gt; FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefs"><span class="hs-identifier hs-var hs-var">removeUnusedDefs</span></a></span></span><span> </span><span id="local-6989586621680983606"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983606"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983606"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983606"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-type">removeUnusedDefsExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-831"></span><span id="removeUnusedDefsExp"><span class="annot"><span class="annottext">removeUnusedDefsExp :: Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var hs-var">removeUnusedDefsExp</span></a></span></span><span> </span><span id="local-6989586621680983607"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983607"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983608"><span class="annot"><span class="annottext">defTable :: DefTable
</span><a href="#local-6989586621680983608"><span class="hs-identifier hs-var hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; DefTable
</span><a href="Gibbon.Passes.Fusion2.html#buildDefTable"><span class="hs-identifier hs-var">buildDefTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983607"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; DefTable -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983607"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983608"><span class="hs-identifier hs-var">defTable</span></a></span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-835"></span><span>      </span><span id="local-6989586621680983609"><span class="annot"><span class="annottext">go :: PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span>  </span><span id="local-6989586621680983613"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983613"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span id="local-6989586621680983614"><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983613"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-836"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680983615"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983615"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983616"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983616"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983617"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983617"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983618"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983618"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983619"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983619"><span class="hs-identifier hs-var">bod</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-837"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; DefTable -&gt; Maybe DefTableEntry
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983615"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-838"></span><span>            </span><span class="annot"><span class="annottext">Maybe DefTableEntry
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983615"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983616"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983617"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983618"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983619"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-839"></span><span>            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621680983620"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983620"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983619"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span>
</span><span id="line-840"></span><span>            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DefTableEntry
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680983615"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983616"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983617"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983618"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983619"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680983621"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983621"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983622"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983622"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680983623"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983623"><span class="hs-identifier hs-var">e3</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-842"></span><span>          </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983621"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983622"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983623"><span class="hs-identifier hs-var">e3</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-843"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983624"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983624"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983625"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983625"><span class="hs-identifier hs-var">ls1</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983624"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec)
 -&gt; (String, [(Var, loc)], PreExp ext loc dec))
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983626"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680983625"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-845"></span><span>            </span><span id="local-6989586621680983626"><span class="annot"><span class="annottext">f :: (String, [(Var, loc)], PreExp ext loc dec)
-&gt; (String, [(Var, loc)], PreExp ext loc dec)
</span><a href="#local-6989586621680983626"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983627"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983627"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983628"><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680983628"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983629"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983629"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983627"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680983628"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983629"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983630"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983630"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680983631"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983631"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983632"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680983632"><span class="hs-identifier hs-var">argList</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-847"></span><span>          </span><span class="annot"><span class="annottext">Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983630"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680983631"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreExp ext loc dec -&gt; PreExp ext loc dec)
-&gt; [PreExp ext loc dec] -&gt; [PreExp ext loc dec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-operator hs-var">`go`</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680983632"><span class="hs-identifier hs-var">argList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680983633"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983633"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680983634"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983634"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680983635"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983635"><span class="hs-identifier hs-var">b</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; DefTable -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680983609"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983633"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680983614"><span class="hs-identifier hs-var">dTable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680983634"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983635"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-849"></span><span>        </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680983613"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#tupleListOfFunctions"><span class="hs-identifier hs-type">tupleListOfFunctions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-852"></span><span>   </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-853"></span><span id="tupleListOfFunctions"><span class="annot"><span class="annottext">tupleListOfFunctions :: DDefs Ty1
-&gt; [FunDef1] -&gt; Var -&gt; Map (Int, Int) (Int, Int) -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#tupleListOfFunctions"><span class="hs-identifier hs-var hs-var">tupleListOfFunctions</span></a></span></span><span>  </span><span id="local-6989586621680983709"><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680983709"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680983710"><span class="annot"><span class="annottext">[FunDef1]
</span><a href="#local-6989586621680983710"><span class="hs-identifier hs-var">funcList</span></a></span></span><span> </span><span id="local-6989586621680983711"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983711"><span class="hs-identifier hs-var">newName</span></a></span></span><span> </span><span id="local-6989586621680983712"><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680983712"><span class="hs-identifier hs-var">syncedArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-854"></span><span>  </span><span id="local-6989586621680983713"><span class="annot"><span class="annottext">[FunDef1]
</span><a href="#local-6989586621680983713"><span class="hs-identifier hs-var">funcBodies</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FunDef1 -&gt; PassM FunDef1) -&gt; [FunDef1] -&gt; PassM [FunDef1]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#freshFunction"><span class="hs-identifier hs-var">freshFunction</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDef1]
</span><a href="#local-6989586621680983710"><span class="hs-identifier hs-var">funcList</span></a></span><span>
</span><span id="line-855"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983714"><span class="annot"><span class="annottext">funcBodiesV :: Vector FunDef1
</span><a href="#local-6989586621680983714"><span class="hs-identifier hs-var hs-var">funcBodiesV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FunDef1] -&gt; Vector FunDef1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDef1]
</span><a href="#local-6989586621680983713"><span class="hs-identifier hs-var">funcBodies</span></a></span><span>
</span><span id="line-856"></span><span>      </span><span id="local-6989586621680983715"><span class="annot"><span class="annottext">retTypes :: Vector Ty1
</span><a href="#local-6989586621680983715"><span class="hs-identifier hs-var hs-var">retTypes</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDef1 -&gt; Ty1) -&gt; Vector FunDef1 -&gt; Vector Ty1
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#map"><span class="hs-identifier hs-var">V.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(([Ty1], Ty1) -&gt; Ty1)
-&gt; (FunDef1 -&gt; ([Ty1], Ty1)) -&gt; FunDef1 -&gt; Ty1
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; ([Ty1], Ty1)
FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector FunDef1
</span><a href="#local-6989586621680983714"><span class="hs-identifier hs-var">funcBodiesV</span></a></span><span>
</span><span id="line-857"></span><span>      </span><span id="local-6989586621680983717"><span class="annot"><span class="annottext">newRetType :: Ty1
</span><a href="#local-6989586621680983717"><span class="hs-identifier hs-var hs-var">newRetType</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Ty1
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ty1] -&gt; Ty1 -&gt; [Ty1]) -&gt; [Ty1] -&gt; Vector Ty1 -&gt; [Ty1]
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#foldl"><span class="hs-identifier hs-var">V.foldl</span></a></span><span>
</span><span id="line-858"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983719"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983719"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680983720"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983720"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-859"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983720"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-860"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680983721"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983721"><span class="hs-identifier hs-var">ls2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983719"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983721"><span class="hs-identifier hs-var">ls2</span></a></span><span>
</span><span id="line-861"></span><span>            </span><span id="local-6989586621680983722"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983722"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983719"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983720"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-862"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Vector Ty1
</span><a href="#local-6989586621680983715"><span class="hs-identifier hs-var">retTypes</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span>      </span><span class="hs-comment">-- we can change this now</span><span>
</span><span id="line-865"></span><span>      </span><span id="local-6989586621680983723"><span class="annot"><span class="annottext">newFuncInputType :: [Ty1]
</span><a href="#local-6989586621680983723"><span class="hs-identifier hs-var hs-var">newFuncInputType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1] -&gt; Int -&gt; FunDef1 -&gt; [Ty1])
-&gt; [Ty1] -&gt; Vector FunDef1 -&gt; [Ty1]
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Int -&gt; FunDef1 -&gt; [Ty1]
</span><a href="#local-6989586621680983724"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Vector FunDef1
</span><a href="#local-6989586621680983714"><span class="hs-identifier hs-var">funcBodiesV</span></a></span><span>
</span><span id="line-866"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-867"></span><span>          </span><span id="local-6989586621680983724"><span class="annot"><span class="annottext">f :: [Ty1] -&gt; Int -&gt; FunDef1 -&gt; [Ty1]
</span><a href="#local-6989586621680983724"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680983725"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983725"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680983726"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983726"><span class="hs-identifier hs-var">fIdx</span></a></span></span><span> </span><span id="local-6989586621680983727"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983727"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-868"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983727"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-869"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621680983728"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983728"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680983729"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983729"><span class="hs-identifier hs-var">tail</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-870"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983730"><span class="annot"><span class="annottext">concreteArgs :: [Ty1]
</span><a href="#local-6989586621680983730"><span class="hs-identifier hs-var hs-var">concreteArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1] -&gt; Int -&gt; Ty1 -&gt; [Ty1]) -&gt; [Ty1] -&gt; Vector Ty1 -&gt; [Ty1]
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Int -&gt; Ty1 -&gt; [Ty1]
</span><a href="#local-6989586621680983731"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1] -&gt; Vector Ty1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983729"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>                     </span><span class="hs-keyword">where</span><span>
</span><span id="line-872"></span><span>                      </span><span id="local-6989586621680983731"><span class="annot"><span class="annottext">f :: [Ty1] -&gt; Int -&gt; Ty1 -&gt; [Ty1]
</span><a href="#local-6989586621680983731"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680983732"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983732"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621680983733"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983733"><span class="hs-identifier hs-var">argIdx</span></a></span></span><span> </span><span id="local-6989586621680983734"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983734"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-873"></span><span>                        </span><span class="hs-comment">-- add one to argIdx becasue head is deleted</span><span>
</span><span id="line-874"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Map (Int, Int) (Int, Int) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983726"><span class="hs-identifier hs-var">fIdx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983733"><span class="hs-identifier hs-var">argIdx</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680983712"><span class="hs-identifier hs-var">syncedArgs</span></a></span><span>
</span><span id="line-875"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983732"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-876"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983732"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983734"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983726"><span class="hs-identifier hs-var">fIdx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-879"></span><span>                    </span><span class="hs-keyword">then</span><span>
</span><span id="line-880"></span><span>                      </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983725"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983728"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983730"><span class="hs-identifier hs-var">concreteArgs</span></a></span><span>
</span><span id="line-881"></span><span>                    </span><span class="hs-keyword">else</span><span>
</span><span id="line-882"></span><span>                      </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983725"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983730"><span class="hs-identifier hs-var">concreteArgs</span></a></span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983735"><span class="annot"><span class="annottext">traversedType :: Ty1
</span><a href="#local-6989586621680983735"><span class="hs-identifier hs-var hs-var">traversedType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Ty1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983723"><span class="hs-identifier hs-var">newFuncInputType</span></a></span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span>  </span><span id="local-6989586621680983736"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983736"><span class="hs-identifier hs-var">traversedTreeArg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;input&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983737"><span class="annot"><span class="annottext">newArgs :: [Var]
</span><a href="#local-6989586621680983737"><span class="hs-identifier hs-var hs-var">newArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983736"><span class="hs-identifier hs-var">traversedTreeArg</span></a></span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Var]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span>
</span><span id="line-888"></span><span>        </span><span class="annot"><span class="annottext">([Var] -&gt; Int -&gt; FunDef1 -&gt; [Var])
-&gt; [Var] -&gt; Vector FunDef1 -&gt; [Var]
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-889"></span><span>         </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983738"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983738"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680983739"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983739"><span class="hs-identifier hs-var">fIdx</span></a></span></span><span> </span><span id="local-6989586621680983740"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983740"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-890"></span><span>            </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983738"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span>
</span><span id="line-891"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Var -&gt; [Var]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span>
</span><span id="line-892"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Var -&gt; Bool) -&gt; Vector Var -&gt; Vector Var
forall a. (Int -&gt; a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifilter"><span class="hs-identifier hs-var">V.ifilter</span></a></span><span>
</span><span id="line-893"></span><span>                     </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983741"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983741"><span class="hs-identifier hs-var">argIdx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; Map (Int, Int) (Int, Int) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983739"><span class="hs-identifier hs-var">fIdx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983741"><span class="hs-identifier hs-var">argIdx</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680983712"><span class="hs-identifier hs-var">syncedArgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-894"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Vector Var
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#tail"><span class="hs-identifier hs-var">L.tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983740"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>          </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Vector FunDef1
</span><a href="#local-6989586621680983714"><span class="hs-identifier hs-var">funcBodiesV</span></a></span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983742"><span class="annot"><span class="annottext">argsLocsToVarMap :: Map (Int, Int) Var
</span><a href="#local-6989586621680983742"><span class="hs-identifier hs-var hs-var">argsLocsToVarMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-899"></span><span>        </span><span class="annot"><span class="annottext">(Map (Int, Int) Var -&gt; Int -&gt; FunDef1 -&gt; Map (Int, Int) Var)
-&gt; Map (Int, Int) Var -&gt; Vector FunDef1 -&gt; Map (Int, Int) Var
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-900"></span><span>         </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983743"><span class="annot"><span class="annottext">Map (Int, Int) Var
</span><a href="#local-6989586621680983743"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621680983744"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983744"><span class="hs-identifier hs-var">fIdx</span></a></span></span><span> </span><span id="local-6989586621680983745"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983745"><span class="hs-identifier hs-var">func</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-901"></span><span>            </span><span class="annot"><span class="annottext">(Map (Int, Int) Var -&gt; Int -&gt; Var -&gt; Map (Int, Int) Var)
-&gt; Map (Int, Int) Var -&gt; Vector Var -&gt; Map (Int, Int) Var
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-902"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983746"><span class="annot"><span class="annottext">Map (Int, Int) Var
</span><a href="#local-6989586621680983746"><span class="hs-identifier hs-var">mpinner</span></a></span></span><span> </span><span id="local-6989586621680983747"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983747"><span class="hs-identifier hs-var">argIdx</span></a></span></span><span> </span><span id="local-6989586621680983748"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983748"><span class="hs-identifier hs-var">argVar</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Var -&gt; Map (Int, Int) Var -&gt; Map (Int, Int) Var
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983744"><span class="hs-identifier hs-var">fIdx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983747"><span class="hs-identifier hs-var">argIdx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983748"><span class="hs-identifier hs-var">argVar</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) Var
</span><a href="#local-6989586621680983746"><span class="hs-identifier hs-var">mpinner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>               </span><span class="annot"><span class="annottext">Map (Int, Int) Var
</span><a href="#local-6989586621680983743"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Vector Var
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983745"><span class="hs-identifier hs-var">func</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>          </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) Var
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Vector FunDef1
</span><a href="#local-6989586621680983714"><span class="hs-identifier hs-var">funcBodiesV</span></a></span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-comment">-- replace the traversed tree variable with the new common one</span><span>
</span><span id="line-907"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983749"><span class="annot"><span class="annottext">functionsBodies' :: [Exp1]
</span><a href="#local-6989586621680983749"><span class="hs-identifier hs-var hs-var">functionsBodies'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; [Exp1]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; FunDef1 -&gt; Exp1) -&gt; Vector FunDef1 -&gt; Vector Exp1
forall a b. (Int -&gt; a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#imap"><span class="hs-identifier hs-var">V.imap</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; FunDef1 -&gt; Exp1
</span><a href="#local-6989586621680983750"><span class="hs-identifier hs-var">getBody</span></a></span><span> </span><span class="annot"><span class="annottext">Vector FunDef1
</span><a href="#local-6989586621680983714"><span class="hs-identifier hs-var">funcBodiesV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-909"></span><span>          </span><span id="local-6989586621680983750"><span class="annot"><span class="annottext">getBody :: Int -&gt; FunDef1 -&gt; Exp1
</span><a href="#local-6989586621680983750"><span class="hs-identifier hs-var hs-var">getBody</span></a></span></span><span> </span><span id="local-6989586621680983751"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983751"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680983752"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983752"><span class="hs-identifier hs-var">func</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-910"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983753"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680983753"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983752"><span class="hs-identifier hs-var">func</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>                </span><span id="local-6989586621680983754"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680983754"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983736"><span class="hs-identifier hs-var">traversedTreeArg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983753"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983754"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983752"><span class="hs-identifier hs-var">func</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span>  </span><span class="hs-comment">-- output of this is a map from dataCons -&gt; [exp'] which are the portions</span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-comment">-- from each functions that map to the constructor</span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983755"><span class="annot"><span class="annottext">step2 :: Map String [Exp1]
</span><a href="#local-6989586621680983755"><span class="hs-identifier hs-var hs-var">step2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map String [Exp1] -&gt; Exp1 -&gt; Map String [Exp1])
-&gt; Map String [Exp1] -&gt; [Exp1] -&gt; Map String [Exp1]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Map String [Exp1] -&gt; Exp1 -&gt; Map String [Exp1]
forall {e :: * -&gt; * -&gt; *} {l} {d}.
(Expression (e l d), SubstitutableExt (PreExp e l d) (e l d), Eq d,
 Eq l, Eq (e l d), Show d, Show l, Out d, Out l) =&gt;
Map String [PreExp e l d]
-&gt; PreExp e l d -&gt; Map String [PreExp e l d]
</span><a href="#local-6989586621680983756"><span class="hs-identifier hs-var">mapAndSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Map String [Exp1]
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983749"><span class="hs-identifier hs-var">functionsBodies'</span></a></span><span>
</span><span id="line-917"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-918"></span><span>          </span><span id="local-6989586621680983756"><span class="annot"><span class="annottext">mapAndSplit :: Map String [PreExp e l d]
-&gt; PreExp e l d -&gt; Map String [PreExp e l d]
</span><a href="#local-6989586621680983756"><span class="hs-identifier hs-var hs-var">mapAndSplit</span></a></span></span><span> </span><span id="local-6989586621680983789"><span class="annot"><span class="annottext">Map String [PreExp e l d]
</span><a href="#local-6989586621680983789"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983790"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983790"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680983791"><span class="annot"><span class="annottext">[(String, [(Var, l)], PreExp e l d)]
</span><a href="#local-6989586621680983791"><span class="hs-identifier hs-var">lsCase</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map String [PreExp e l d]
 -&gt; (String, [(Var, l)], PreExp e l d) -&gt; Map String [PreExp e l d])
-&gt; Map String [PreExp e l d]
-&gt; [(String, [(Var, l)], PreExp e l d)]
-&gt; Map String [PreExp e l d]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Map String [PreExp e l d]
-&gt; (String, [(Var, l)], PreExp e l d) -&gt; Map String [PreExp e l d]
forall {e :: * -&gt; * -&gt; *} {l} {d} {b}.
(Expression (e l d), SubstitutableExt (PreExp e l d) (e l d), Eq d,
 Eq l, Eq (e l d), Show d, Show l, Out d, Out l) =&gt;
Map String [PreExp e l d]
-&gt; (String, [(Var, b)], PreExp e l d) -&gt; Map String [PreExp e l d]
</span><a href="#local-6989586621680983792"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map String [PreExp e l d]
</span><a href="#local-6989586621680983789"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, l)], PreExp e l d)]
</span><a href="#local-6989586621680983791"><span class="hs-identifier hs-var">lsCase</span></a></span><span>
</span><span id="line-919"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680983792"><span class="annot"><span class="annottext">f :: Map String [PreExp e l d]
-&gt; (String, [(Var, b)], PreExp e l d) -&gt; Map String [PreExp e l d]
</span><a href="#local-6989586621680983792"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680983830"><span class="annot"><span class="annottext">Map String [PreExp e l d]
</span><a href="#local-6989586621680983830"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983831"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983831"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983832"><span class="annot"><span class="annottext">[(Var, b)]
</span><a href="#local-6989586621680983832"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983833"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983833"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-920"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983834"><span class="annot"><span class="annottext">exp' :: PreExp e l d
</span><a href="#local-6989586621680983834"><span class="hs-identifier hs-var hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680983835"><span class="hs-identifier hs-var">subsVars</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983833"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-921"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String -&gt; Map String [PreExp e l d] -&gt; Maybe [PreExp e l d]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983831"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">Map String [PreExp e l d]
</span><a href="#local-6989586621680983830"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-922"></span><span>                         </span><span class="annot"><span class="annottext">Maybe [PreExp e l d]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [PreExp e l d]
-&gt; Map String [PreExp e l d]
-&gt; Map String [PreExp e l d]
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983831"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983834"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Map String [PreExp e l d]
</span><a href="#local-6989586621680983830"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-923"></span><span>                         </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680983836"><span class="annot"><span class="annottext">[PreExp e l d]
</span><a href="#local-6989586621680983836"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [PreExp e l d]
-&gt; Map String [PreExp e l d]
-&gt; Map String [PreExp e l d]
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983831"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PreExp e l d]
</span><a href="#local-6989586621680983836"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp e l d] -&gt; [PreExp e l d] -&gt; [PreExp e l d]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983834"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map String [PreExp e l d]
</span><a href="#local-6989586621680983830"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-924"></span><span>                    </span><span class="hs-keyword">where</span><span>
</span><span id="line-925"></span><span>                       </span><span id="local-6989586621680983835"><span class="annot"><span class="annottext">subsVars :: PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680983835"><span class="hs-identifier hs-var hs-var">subsVars</span></a></span></span><span> </span><span id="local-6989586621680983837"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983837"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Var, b) -&gt; PreExp e l d -&gt; PreExp e l d)
-&gt; PreExp e l d -&gt; Vector (Var, b) -&gt; PreExp e l d
forall a b. (Int -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Vector a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldr"><span class="hs-identifier hs-var">V.ifoldr</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Var, b) -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680983839"><span class="hs-identifier hs-var">subsVar</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983837"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, b)] -&gt; Vector (Var, b)
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, b)]
</span><a href="#local-6989586621680983832"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span>                       </span><span id="local-6989586621680983839"><span class="annot"><span class="annottext">subsVar :: Int -&gt; (Var, b) -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="#local-6989586621680983839"><span class="hs-identifier hs-var hs-var">subsVar</span></a></span></span><span> </span><span id="local-6989586621680983840"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983840"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680983841"><span class="annot"><span class="annottext">(Var, b)
</span><a href="#local-6989586621680983841"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680983842"><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983842"><span class="hs-identifier hs-var">ex</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span>
</span><span id="line-927"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983843"><span class="annot"><span class="annottext">oldExp :: PreExp e l d
</span><a href="#local-6989586621680983843"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp e l d
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, b) -&gt; Var
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, b)
</span><a href="#local-6989586621680983841"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span>                              </span><span id="local-6989586621680983844"><span class="annot"><span class="annottext">newExp :: PreExp e l d
</span><a href="#local-6989586621680983844"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; PreExp e l d
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Unicode.html#toLower"><span class="hs-identifier hs-var">toLower</span></a></span><span>
</span><span id="line-929"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983831"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983840"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span>                          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span>  </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983843"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983844"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp e l d
</span><a href="#local-6989586621680983842"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983845"><span class="annot"><span class="annottext">traversedTreeDDef :: DDef Ty1
</span><a href="#local-6989586621680983845"><span class="hs-identifier hs-var hs-var">traversedTreeDDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-934"></span><span>        </span><span class="annot"><span class="annottext">DDefs Ty1 -&gt; String -&gt; DDef Ty1
forall a. Out a =&gt; DDefs a -&gt; String -&gt; DDef a
</span><a href="Gibbon.Language.Syntax.html#lookupDDef"><span class="hs-identifier hs-var">lookupDDef</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680983709"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983735"><span class="hs-identifier hs-var">traversedType</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680983848"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983848"><span class="hs-identifier hs-var">tName</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983848"><span class="hs-identifier hs-var">tName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span>  </span><span class="hs-comment">-- this is the returned tuple (out1_1, out1_2, out2_1 ..etc) those variables</span><span>
</span><span id="line-937"></span><span>  </span><span class="hs-comment">-- stores the result</span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983849"><span class="annot"><span class="annottext">tailExpr :: Exp1
</span><a href="#local-6989586621680983849"><span class="hs-identifier hs-var hs-var">tailExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">([Exp1] -&gt; Int -&gt; Ty1 -&gt; [Exp1]) -&gt; [Exp1] -&gt; Vector Ty1 -&gt; [Exp1]
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-939"></span><span>       </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983850"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983850"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680983851"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983851"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680983852"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983852"><span class="hs-identifier hs-var">ty</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-940"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983852"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-941"></span><span>             </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680983853"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983853"><span class="hs-identifier hs-var">ls2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-942"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983854"><span class="annot"><span class="annottext">newElements :: [Exp1]
</span><a href="#local-6989586621680983854"><span class="hs-identifier hs-var hs-var">newElements</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Vector Exp1 -&gt; [Exp1]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span class="hs-special">(</span><span>
</span><span id="line-943"></span><span>                   </span><span class="annot"><span class="annottext">(Int -&gt; Ty1 -&gt; Exp1) -&gt; Vector Ty1 -&gt; Vector Exp1
forall a b. (Int -&gt; a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#imap"><span class="hs-identifier hs-var">V.imap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983855"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983855"><span class="hs-identifier hs-var">subscript</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Var
forall {a} {a}. (Show a, Show a) =&gt; a -&gt; a -&gt; Var
</span><a href="#local-6989586621680983856"><span class="hs-identifier hs-var">createOutVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983851"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983855"><span class="hs-identifier hs-var">subscript</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1] -&gt; Vector Ty1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983853"><span class="hs-identifier hs-var">ls2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983850"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983854"><span class="hs-identifier hs-var">newElements</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span>             </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-948"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983857"><span class="annot"><span class="annottext">newElement :: Exp1
</span><a href="#local-6989586621680983857"><span class="hs-identifier hs-var hs-var">newElement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer -&gt; Var
forall {a} {a}. (Show a, Show a) =&gt; a -&gt; a -&gt; Var
</span><a href="#local-6989586621680983856"><span class="hs-identifier hs-var">createOutVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983851"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983850"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983857"><span class="hs-identifier hs-var">newElement</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Vector Ty1
</span><a href="#local-6989586621680983715"><span class="hs-identifier hs-var">retTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983858"><span class="annot"><span class="annottext">topLevelExpr :: Exp1
</span><a href="#local-6989586621680983858"><span class="hs-identifier hs-var hs-var">topLevelExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983736"><span class="hs-identifier hs-var">traversedTreeArg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983859"><span class="annot"><span class="annottext">extendedCase :: Exp1
</span><a href="#local-6989586621680983859"><span class="hs-identifier hs-var hs-var">extendedCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Bool, Ty1)]) -&gt; Exp1 -&gt; Exp1)
-&gt; Exp1 -&gt; [(String, [(Bool, Ty1)])] -&gt; Exp1
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Bool, Ty1)]) -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983861"><span class="hs-identifier hs-var">addConstructorBody</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983858"><span class="hs-identifier hs-var">topLevelExpr</span></a></span><span>
</span><span id="line-956"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDef Ty1 -&gt; [(String, [(Bool, Ty1)])]
forall a. DDef a -&gt; [(String, [(Bool, a)])]
</span><a href="Gibbon.Language.Syntax.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">DDef Ty1
</span><a href="#local-6989586621680983845"><span class="hs-identifier hs-var">traversedTreeDDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-958"></span><span>          </span><span id="local-6989586621680983861"><span class="annot"><span class="annottext">addConstructorBody :: (String, [(Bool, Ty1)]) -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983861"><span class="hs-identifier hs-var hs-var">addConstructorBody</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983863"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983863"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680983864"><span class="annot"><span class="annottext">[(Bool, Ty1)]
</span><a href="#local-6989586621680983864"><span class="hs-identifier hs-var">varls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983865"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983865"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983866"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983866"><span class="hs-identifier hs-var">caseList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span>            </span><span class="hs-comment">-- a list of the names of the constructor variables</span><span>
</span><span id="line-961"></span><span>            </span><span class="hs-comment">--  e.g [leaf0, leaf1]  or [inner0, inner1, inner2, inner3]</span><span>
</span><span id="line-962"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983867"><span class="annot"><span class="annottext">newVarsList :: [(Var, ())]
</span><a href="#local-6989586621680983867"><span class="hs-identifier hs-var hs-var">newVarsList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Var, ()) -&gt; [(Var, ())]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Bool, Ty1) -&gt; (Var, ()))
-&gt; Vector (Bool, Ty1) -&gt; Vector (Var, ())
forall a b. (Int -&gt; a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#imap"><span class="hs-identifier hs-var">V.imap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983868"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983868"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="annot"><span class="annottext">(Bool, Ty1)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span>
</span><span id="line-963"></span><span>                  </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Unicode.html#toLower"><span class="hs-identifier hs-var">toLower</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983863"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983868"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Bool, Ty1)] -&gt; Vector (Bool, Ty1)
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, Ty1)]
</span><a href="#local-6989586621680983864"><span class="hs-identifier hs-var">varls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span>                </span><span id="local-6989586621680983869"><span class="annot"><span class="annottext">bodiesOfConst :: Vector Exp1
</span><a href="#local-6989586621680983869"><span class="hs-identifier hs-var hs-var">bodiesOfConst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">L.reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map String [Exp1]
</span><a href="#local-6989586621680983755"><span class="hs-identifier hs-var">step2</span></a></span><span> </span><span class="annot"><span class="annottext">Map String [Exp1] -&gt; String -&gt; [Exp1]
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983863"><span class="hs-identifier hs-var">dataCons</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>                </span><span id="local-6989586621680983871"><span class="annot"><span class="annottext">combinedBodies :: Exp1
</span><a href="#local-6989586621680983871"><span class="hs-identifier hs-var hs-var">combinedBodies</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(Exp1 -&gt; Int -&gt; Exp1 -&gt; Exp1) -&gt; Exp1 -&gt; Vector Exp1 -&gt; Exp1
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Int -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983872"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983849"><span class="hs-identifier hs-var">tailExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680983869"><span class="hs-identifier hs-var">bodiesOfConst</span></a></span><span>
</span><span id="line-967"></span><span>                 </span><span class="hs-keyword">where</span><span>
</span><span id="line-968"></span><span>                  </span><span id="local-6989586621680983872"><span class="annot"><span class="annottext">f :: Exp1 -&gt; Int -&gt; Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983872"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680983873"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983873"><span class="hs-identifier hs-var">tailExp</span></a></span></span><span> </span><span id="local-6989586621680983874"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983874"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680983875"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983875"><span class="hs-identifier hs-var">exp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983876"><span class="annot"><span class="annottext">pos :: Int
</span><a href="#local-6989586621680983876"><span class="hs-identifier hs-var hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector FunDef1 -&gt; Int
forall a. Vector a -&gt; Int
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#length"><span class="hs-identifier hs-var">V.length</span></a></span><span> </span><span class="annot"><span class="annottext">Vector FunDef1
</span><a href="#local-6989586621680983714"><span class="hs-identifier hs-var">funcBodiesV</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983874"><span class="hs-identifier hs-var">index</span></a></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-971"></span><span>                        </span><span id="local-6989586621680983878"><span class="annot"><span class="annottext">newVar :: Int -&gt; Var
</span><a href="#local-6989586621680983878"><span class="hs-identifier hs-var hs-var">newVar</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Var
forall {a} {a}. (Show a, Show a) =&gt; a -&gt; a -&gt; Var
</span><a href="#local-6989586621680983856"><span class="hs-identifier hs-var">createOutVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983876"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-972"></span><span>                        </span><span id="local-6989586621680983879"><span class="annot"><span class="annottext">newVarType :: Ty1
</span><a href="#local-6989586621680983879"><span class="hs-identifier hs-var hs-var">newVarType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector FunDef1
</span><a href="#local-6989586621680983714"><span class="hs-identifier hs-var">funcBodiesV</span></a></span><span> </span><span class="annot"><span class="annottext">Vector FunDef1 -&gt; Int -&gt; FunDef1
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983876"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; (Int -&gt; Var) -&gt; Ty1 -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#replaceLeafWithBind"><span class="hs-identifier hs-var">replaceLeafWithBind</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983875"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Var
</span><a href="#local-6989586621680983878"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983879"><span class="hs-identifier hs-var">newVarType</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983873"><span class="hs-identifier hs-var">tailExp</span></a></span><span>
</span><span id="line-974"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983865"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983863"><span class="hs-identifier hs-var">dataCons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983867"><span class="hs-identifier hs-var">newVarsList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983871"><span class="hs-identifier hs-var">combinedBodies</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1)
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983866"><span class="hs-identifier hs-var">caseList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>  </span><span class="hs-comment">-- replace uses of eliminated synced Input args</span><span>
</span><span id="line-976"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983880"><span class="annot"><span class="annottext">finalBody :: Exp1
</span><a href="#local-6989586621680983880"><span class="hs-identifier hs-var hs-var">finalBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-977"></span><span>       </span><span class="annot"><span class="annottext">(Exp1 -&gt; (Int, Int) -&gt; (Int, Int) -&gt; Exp1)
-&gt; Exp1 -&gt; Map (Int, Int) (Int, Int) -&gt; Exp1
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldlWithKey"><span class="hs-identifier hs-var">M.foldlWithKey</span></a></span><span>
</span><span id="line-978"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983882"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983882"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680983883"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621680983883"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680983884"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621680983884"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-979"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983885"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680983885"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Int, Int) Var
</span><a href="#local-6989586621680983742"><span class="hs-identifier hs-var">argsLocsToVarMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) Var -&gt; (Int, Int) -&gt; Var
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621680983883"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>               </span><span id="local-6989586621680983886"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680983886"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Int, Int) Var
</span><a href="#local-6989586621680983742"><span class="hs-identifier hs-var">argsLocsToVarMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) Var -&gt; (Int, Int) -&gt; Var
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621680983884"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983885"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983886"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983882"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-982"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983859"><span class="hs-identifier hs-var">extendedCase</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680983712"><span class="hs-identifier hs-var">syncedArgs</span></a></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>  </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; ArrowTy (TyOf Exp1) -&gt; Exp1 -&gt; FunMeta -&gt; FunDef1
forall ex.
Var -&gt; [Var] -&gt; ArrowTy (TyOf ex) -&gt; ex -&gt; FunMeta -&gt; FunDef ex
</span><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983711"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983737"><span class="hs-identifier hs-var">newArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680983723"><span class="hs-identifier hs-var">newFuncInputType</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983717"><span class="hs-identifier hs-var">newRetType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983880"><span class="hs-identifier hs-var">finalBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunRec -&gt; FunInline -&gt; Bool -&gt; FunMeta
</span><a href="Gibbon.Language.Syntax.html#FunMeta"><span class="hs-identifier hs-var">FunMeta</span></a></span><span> </span><span class="annot"><span class="annottext">FunRec
</span><a href="Gibbon.Language.Syntax.html#NotRec"><span class="hs-identifier hs-var">NotRec</span></a></span><span> </span><span class="annot"><span class="annottext">FunInline
</span><a href="Gibbon.Language.Syntax.html#NoInline"><span class="hs-identifier hs-var">NoInline</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-985"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-986"></span><span>  </span><span id="local-6989586621680983856"><span class="annot"><span class="annottext">createOutVar :: a -&gt; a -&gt; Var
</span><a href="#local-6989586621680983856"><span class="hs-identifier hs-var hs-var">createOutVar</span></a></span></span><span> </span><span id="local-6989586621680983898"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680983898"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680983899"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680983899"><span class="hs-identifier hs-var">subscript</span></a></span></span><span class="hs-glyph">=</span><span>
</span><span id="line-987"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680983898"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;out&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680983899"><span class="hs-identifier hs-var">subscript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#renameFunction"><span class="hs-identifier hs-type">renameFunction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span>
</span><span id="line-991"></span><span id="renameFunction"><span class="annot"><span class="annottext">renameFunction :: FunDef1 -&gt; Var -&gt; FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#renameFunction"><span class="hs-identifier hs-var hs-var">renameFunction</span></a></span></span><span> </span><span id="local-6989586621680983902"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983902"><span class="hs-identifier hs-var">function</span></a></span></span><span> </span><span id="local-6989586621680983903"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983903"><span class="hs-identifier hs-var">newName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-992"></span><span>   </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983902"><span class="hs-identifier hs-var">function</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funName :: Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983903"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983902"><span class="hs-identifier hs-var">function</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-993"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-994"></span><span>     </span><span id="local-6989586621680983904"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680983905"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983905"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-995"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983906"><span class="annot"><span class="annottext">oldName :: Var
</span><a href="#local-6989586621680983906"><span class="hs-identifier hs-var hs-var">oldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680983902"><span class="hs-identifier hs-var">function</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983905"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-997"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983907"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983907"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680983908"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983908"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983909"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983909"><span class="hs-identifier hs-var">argList</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-998"></span><span>            </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983907"><span class="hs-identifier hs-var">name</span></a></span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983906"><span class="hs-identifier hs-var">oldName</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983903"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983907"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983908"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983909"><span class="hs-identifier hs-var">argList</span></a></span><span>
</span><span id="line-999"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680983910"><span class="annot"><span class="annottext">Prim Ty1
</span><a href="#local-6989586621680983910"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680983911"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983911"><span class="hs-identifier hs-var">ls</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">Prim Ty1 -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty1
</span><a href="#local-6989586621680983910"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983912"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983911"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680983912"><span class="annot"><span class="annottext">f :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983912"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680983913"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983913"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983913"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-1001"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983914"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983914"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983915"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983915"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983916"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983916"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983917"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983917"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983918"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983918"><span class="hs-identifier hs-var">bod</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983914"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680983915"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983916"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983917"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983918"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1002"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680983919"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983919"><span class="hs-identifier hs-var">ls</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983919"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1003"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680983920"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983920"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680983921"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983921"><span class="hs-identifier hs-var">exp</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680983920"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983921"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680983922"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983922"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983923"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983923"><span class="hs-identifier hs-var">ls1</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983922"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1)
</span><a href="#local-6989586621680983924"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680983923"><span class="hs-identifier hs-var">ls1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1005"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680983924"><span class="annot"><span class="annottext">f :: (String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1)
</span><a href="#local-6989586621680983924"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983925"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983925"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983926"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983926"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680983927"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983927"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983925"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680983926"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983927"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680983928"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983928"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680983929"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983929"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span> </span><span id="local-6989586621680983930"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983930"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1007"></span><span>            </span><span class="annot"><span class="annottext">() -&gt; String -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680983928"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680983929"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Exp1) -&gt; [Exp1] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983930"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680983931"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983931"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680983932"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983932"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621680983933"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983933"><span class="hs-identifier hs-var">b</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">Exp1 -&gt; Ty1 -&gt; Bool -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680983904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983931"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680983932"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680983933"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1009"></span><span>          </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span>   </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983905"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-1010"></span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span class="hs-comment">{- We want to search for
the following:
  f1 (x1, v1,v2 ...vn)
  f2 (x1, k1,k2 ...kn)
 such that
body (f1) = case (x1) of {}
body (f2) = case (x1) of {}
and k1..kn do not dependent on the results of f1

the return  format is the following [(x1, [f1, f2])]
-}</span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span class="hs-comment">-- should be a preorder and not a post order OMG!!!</span><span>
</span><span id="line-1026"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#buildTupleCandidatesTable"><span class="hs-identifier hs-type">buildTupleCandidatesTable</span></a></span><span class="hs-glyph">::</span><span>   </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1027"></span><span id="buildTupleCandidatesTable"><span class="annot"><span class="annottext">buildTupleCandidatesTable :: FunDefs1 -&gt; Exp1 -&gt; [Var] -&gt; Map Var [Exp1]
</span><a href="Gibbon.Passes.Fusion2.html#buildTupleCandidatesTable"><span class="hs-identifier hs-var hs-var">buildTupleCandidatesTable</span></a></span></span><span> </span><span id="local-6989586621680983974"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680983974"><span class="hs-identifier hs-var">fDefs</span></a></span></span><span> </span><span id="local-6989586621680983975"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983975"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680983976"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680983976"><span class="hs-identifier hs-var">argsVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1028"></span><span>   </span><span class="annot"><span class="annottext">([(Var, Exp1)] -&gt; [Exp1])
-&gt; Map Var [(Var, Exp1)] -&gt; Map Var [Exp1]
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680983978"><span class="annot"><span class="annottext">[(Var, Exp1)]
</span><a href="#local-6989586621680983978"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((Var, Exp1) -&gt; Exp1) -&gt; [(Var, Exp1)] -&gt; [Exp1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Exp1) -&gt; Exp1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Exp1)]
</span><a href="#local-6989586621680983978"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983979"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983975"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1030"></span><span>  </span><span id="local-6989586621680983979"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983979"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680983980"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983980"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span id="local-6989586621680983981"><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983980"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1031"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1032"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1033"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680983982"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983982"><span class="hs-identifier hs-var">boundedVar</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680983983"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983983"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680983984"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983984"><span class="hs-identifier hs-var">body</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1034"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983985"><span class="annot"><span class="annottext">tb' :: Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983985"><span class="hs-identifier hs-var hs-var">tb'</span></a></span></span><span class="hs-glyph">=</span><span>
</span><span id="line-1035"></span><span>             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983983"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1036"></span><span>                </span><span id="local-6989586621680983986"><span class="annot"><span class="annottext">callExp :: Exp1
</span><a href="#local-6989586621680983986"><span class="hs-identifier hs-var">callExp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680983987"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983987"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680983988"><span class="annot"><span class="annottext">argList :: [Exp1]
</span><a href="#local-6989586621680983988"><span class="hs-identifier hs-var">argList</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680983989"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983989"><span class="hs-identifier hs-var">inputTree</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680983990"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983990"><span class="hs-identifier hs-var">tail</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1037"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983991"><span class="annot"><span class="annottext">otherCalls :: [(Var, Exp1)]
</span><a href="#local-6989586621680983991"><span class="hs-identifier hs-var hs-var">otherCalls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Map Var [(Var, Exp1)] -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983989"><span class="hs-identifier hs-var">inputTree</span></a></span><span>  </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1038"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>  </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)] -&gt; Var -&gt; [(Var, Exp1)]
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983989"><span class="hs-identifier hs-var">inputTree</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1039"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1040"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Bool
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
FunDef (PreExp ext loc dec) -&gt; Bool
</span><a href="#local-6989586621680983992"><span class="hs-identifier hs-var">isTupleable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680983974"><span class="hs-identifier hs-var">fDefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983987"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-1041"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; [(Var, Exp1)] -&gt; Bool
</span><a href="#local-6989586621680983993"><span class="hs-identifier hs-var">haveIndependentArgsNew</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680983990"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Exp1)]
</span><a href="#local-6989586621680983991"><span class="hs-identifier hs-var">otherCalls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>                    </span><span class="hs-keyword">then</span><span>
</span><span id="line-1043"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680983994"><span class="annot"><span class="annottext">addCall :: Maybe [(Var, Exp1)] -&gt; Maybe [(Var, Exp1)]
</span><a href="#local-6989586621680983994"><span class="hs-identifier hs-var hs-var">addCall</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe [(Var, Exp1)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Exp1)] -&gt; Maybe [(Var, Exp1)]
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983982"><span class="hs-identifier hs-var">boundedVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983986"><span class="hs-identifier hs-var">callExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1044"></span><span>                          </span><span class="annot"><a href="#local-6989586621680983994"><span class="hs-identifier hs-var">addCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680983995"><span class="annot"><span class="annottext">[(Var, Exp1)]
</span><a href="#local-6989586621680983995"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Exp1)] -&gt; Maybe [(Var, Exp1)]
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Exp1)] -&gt; Maybe [(Var, Exp1)])
-&gt; [(Var, Exp1)] -&gt; Maybe [(Var, Exp1)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Exp1)] -&gt; [(Var, Exp1)]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#nub"><span class="hs-identifier hs-var">L.nub</span></a></span><span>  </span><span class="annot"><span class="annottext">([(Var, Exp1)] -&gt; [(Var, Exp1)]) -&gt; [(Var, Exp1)] -&gt; [(Var, Exp1)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983982"><span class="hs-identifier hs-var">boundedVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983986"><span class="hs-identifier hs-var">callExp</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Var, Exp1) -&gt; [(Var, Exp1)] -&gt; [(Var, Exp1)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Var, Exp1)]
</span><a href="#local-6989586621680983995"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1045"></span><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Maybe [(Var, Exp1)] -&gt; Maybe [(Var, Exp1)])
-&gt; Var -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#alter"><span class="hs-identifier hs-var">M.alter</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [(Var, Exp1)] -&gt; Maybe [(Var, Exp1)]
</span><a href="#local-6989586621680983994"><span class="hs-identifier hs-var">addCall</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680983989"><span class="hs-identifier hs-var">inputTree</span></a></span><span>  </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1046"></span><span>                    </span><span class="hs-keyword">else</span><span>  </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1047"></span><span>                </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1048"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983979"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983984"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983985"><span class="hs-identifier hs-var">tb'</span></a></span><span>
</span><span id="line-1049"></span><span>
</span><span id="line-1050"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680983998"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983998"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680983999"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983999"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621680984000"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984000"><span class="hs-identifier hs-var">e3</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984001"><span class="annot"><span class="annottext">t1 :: Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680984001"><span class="hs-identifier hs-var hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983979"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983998"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1051"></span><span>                                      </span><span id="local-6989586621680984002"><span class="annot"><span class="annottext">t2 :: Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680984002"><span class="hs-identifier hs-var hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983979"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983999"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680984001"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1052"></span><span>                                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983979"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984000"><span class="hs-identifier hs-var">e3</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680984002"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1053"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680984003"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984003"><span class="hs-identifier hs-var">ls</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1054"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680984004"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984004"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680984005"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984005"><span class="hs-identifier hs-var">exp</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1055"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680984006"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984006"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680984007"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984007"><span class="hs-identifier hs-var">ls1</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Map Var [(Var, Exp1)]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not expected in here &quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680984008"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680984008"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680984009"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984009"><span class="hs-identifier hs-var">datacons</span></a></span></span><span> </span><span id="local-6989586621680984010"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984010"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1057"></span><span>         </span><span class="annot"><span class="annottext">(Map Var [(Var, Exp1)] -&gt; Exp1 -&gt; Map Var [(Var, Exp1)])
-&gt; Map Var [(Var, Exp1)] -&gt; [Exp1] -&gt; Map Var [(Var, Exp1)]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)] -&gt; Exp1 -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680984011"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984010"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680984011"><span class="annot"><span class="annottext">f :: Map Var [(Var, Exp1)] -&gt; Exp1 -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680984011"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680984012"><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680984012"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span id="local-6989586621680984013"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984013"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983979"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984013"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680984012"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-1058"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680984014"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984014"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Map Var [(Var, Exp1)] -&gt; Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983979"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984014"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1059"></span><span>      </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Var [(Var, Exp1)]
</span><a href="#local-6989586621680983981"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-1060"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-1061"></span><span>    </span><span id="local-6989586621680984015"><span class="annot"><span class="annottext">defTable :: DefTable
</span><a href="#local-6989586621680984015"><span class="hs-identifier hs-var hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; DefTable
</span><a href="Gibbon.Passes.Fusion2.html#buildDefTable"><span class="hs-identifier hs-var">buildDefTable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680983975"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span>    </span><span id="local-6989586621680983992"><span class="annot"><span class="annottext">isTupleable :: FunDef (PreExp ext loc dec) -&gt; Bool
</span><a href="#local-6989586621680983992"><span class="hs-identifier hs-var hs-var">isTupleable</span></a></span></span><span> </span><span id="local-6989586621680984019"><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec)
</span><a href="#local-6989586621680984019"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec) -&gt; PreExp ext loc dec
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec)
</span><a href="#local-6989586621680984019"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1064"></span><span>      </span><span class="hs-comment">---add a check that there is no nested case (maybe)</span><span>
</span><span id="line-1065"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680984020"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984020"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984020"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1066"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680984021"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984021"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984021"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec) -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec)
</span><a href="#local-6989586621680984019"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1067"></span><span>            </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1068"></span><span>        </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1069"></span><span>
</span><span id="line-1070"></span><span>    </span><span id="local-6989586621680984023"><span class="annot"><span class="annottext">isTrivial :: FunDef (PreExp ext loc dec) -&gt; Bool
</span><a href="#local-6989586621680984023"><span class="hs-identifier hs-var hs-var">isTrivial</span></a></span></span><span> </span><span id="local-6989586621680984024"><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec)
</span><a href="#local-6989586621680984024"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1071"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec) -&gt; Bool
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
FunDef (PreExp ext loc dec) -&gt; Bool
</span><a href="#local-6989586621680983992"><span class="hs-identifier hs-var">isTupleable</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec)
</span><a href="#local-6989586621680984024"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1073"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1074"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec) -&gt; PreExp ext loc dec
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef (PreExp ext loc dec)
</span><a href="#local-6989586621680984024"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1075"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680984025"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984025"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680984026"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680984026"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1076"></span><span>              </span><span class="annot"><span class="annottext">(Bool -&gt; (String, [(Var, loc)], PreExp ext loc dec) -&gt; Bool)
-&gt; Bool -&gt; [(String, [(Var, loc)], PreExp ext loc dec)] -&gt; Bool
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680984027"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984027"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, loc)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">,</span><span id="local-6989586621680984028"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984028"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984027"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Bool
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}. PreExp ext loc dec -&gt; Bool
</span><a href="#local-6989586621680984029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984028"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680984026"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1077"></span><span>               </span><span class="hs-keyword">where</span><span>
</span><span id="line-1078"></span><span>                </span><span id="local-6989586621680984029"><span class="annot"><span class="annottext">go :: PreExp ext loc dec -&gt; Bool
</span><a href="#local-6989586621680984029"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680984030"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984030"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1079"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984030"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1080"></span><span>                    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984031"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984031"><span class="hs-identifier hs-var">boundedVar</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[loc]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dec
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680984032"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984032"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984033"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984033"><span class="hs-identifier hs-var">body</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1081"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984032"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1082"></span><span>                           </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1083"></span><span>                           </span><span id="local-6989586621680984034"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984034"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Bool
</span><a href="#local-6989586621680984029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984033"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1084"></span><span>                    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1085"></span><span>                    </span><span id="local-6989586621680984035"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984035"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span>    </span><span class="hs-comment">-- we want to make sure that args are independent on &quot;other calls&quot;</span><span>
</span><span id="line-1091"></span><span>    </span><span id="local-6989586621680983993"><span class="annot"><span class="annottext">haveIndependentArgsNew :: [Exp1] -&gt; [(Var, Exp1)] -&gt; Bool
</span><a href="#local-6989586621680983993"><span class="hs-identifier hs-var hs-var">haveIndependentArgsNew</span></a></span></span><span> </span><span id="local-6989586621680984036"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984036"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621680984037"><span class="annot"><span class="annottext">[(Var, Exp1)]
</span><a href="#local-6989586621680984037"><span class="hs-identifier hs-var">otherCalls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1092"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984038"><span class="annot"><span class="annottext">varsToAvoid :: Set Var
</span><a href="#local-6989586621680984038"><span class="hs-identifier hs-var hs-var">varsToAvoid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Var, Exp1) -&gt; Var) -&gt; [(Var, Exp1)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Exp1) -&gt; Var
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Exp1)]
</span><a href="#local-6989586621680984037"><span class="hs-identifier hs-var">otherCalls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1093"></span><span>          </span><span id="local-6989586621680984040"><span class="annot"><span class="annottext">dependentVars :: Set Var
</span><a href="#local-6989586621680984040"><span class="hs-identifier hs-var hs-var">dependentVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Set Var) -&gt; [Exp1] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span>  </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984036"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">S.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680984038"><span class="hs-identifier hs-var">varsToAvoid</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680984040"><span class="hs-identifier hs-var">dependentVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>    </span><span id="local-6989586621680984042"><span class="annot"><span class="annottext">collectDependentVarsExp :: Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var hs-var">collectDependentVarsExp</span></a></span></span><span> </span><span id="local-6989586621680984045"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984045"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1097"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984045"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1098"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680984046"><span class="annot"><span class="annottext">v :: Var
</span><a href="#local-6989586621680984046"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680984047"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984047"><span class="hs-identifier hs-var">symbol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1099"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; DefTable -&gt; Maybe DefTableEntry
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984047"><span class="hs-identifier hs-var">symbol</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680984015"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1100"></span><span>              </span><span class="annot"><span class="annottext">Maybe DefTableEntry
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-1101"></span><span>              </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#DefTableEntry"><span class="hs-identifier hs-type">DefTableEntry</span></a></span><span> </span><span id="local-6989586621680984049"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984049"><span class="hs-identifier hs-var">definingExp</span></a></span></span><span> </span><span class="annot"><span class="annottext">[FunctionUses]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1102"></span><span>                  </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984046"><span class="hs-identifier hs-var">v</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984049"><span class="hs-identifier hs-var">definingExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680984051"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984051"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680984052"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984052"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Set Var) -&gt; [Exp1] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984052"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680984053"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984053"><span class="hs-identifier hs-var">expList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Set Var) -&gt; [Exp1] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984053"><span class="hs-identifier hs-var">expList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680984054"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984054"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Set Var) -&gt; [Exp1] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984054"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680984055"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984055"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680984056"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984056"><span class="hs-identifier hs-var">thenBody</span></a></span></span><span> </span><span id="local-6989586621680984057"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984057"><span class="hs-identifier hs-var">elseBody</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1109"></span><span>         </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span>
</span><span id="line-1110"></span><span>           </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984055"><span class="hs-identifier hs-var">cond</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984056"><span class="hs-identifier hs-var">thenBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1111"></span><span>              </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984057"><span class="hs-identifier hs-var">elseBody</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1112"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680984058"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984058"><span class="hs-identifier hs-var">expList</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1 -&gt; Set Var) -&gt; [Exp1] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984058"><span class="hs-identifier hs-var">expList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1113"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680984059"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984059"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680984060"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984060"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984060"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1114"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-1115"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680984061"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984061"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680984062"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680984062"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680984063"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680984063"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680984064"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984064"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984065"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984065"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1116"></span><span>         </span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984064"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1117"></span><span>           </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="#local-6989586621680984042"><span class="hs-identifier hs-var">collectDependentVarsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984065"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1118"></span><span>       </span><span id="local-6989586621680984066"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984066"><span class="hs-identifier hs-var">x</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Set Var
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;please handle me explicitly&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984066"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1119"></span><span>
</span><span id="line-1120"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#cleanExp"><span class="hs-identifier hs-type">cleanExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-1121"></span><span id="cleanExp"><span class="annot"><span class="annottext">cleanExp :: Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#cleanExp"><span class="hs-identifier hs-var hs-var">cleanExp</span></a></span></span><span> </span><span id="local-6989586621680984068"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984068"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeCommonExpressions"><span class="hs-identifier hs-var">removeCommonExpressions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984068"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#tuple_entry"><span class="hs-identifier hs-type">tuple_entry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span id="tuple_entry"><span class="annot"><span class="annottext">tuple_entry :: DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; [Var] -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tuple_entry"><span class="hs-identifier hs-var hs-var">tuple_entry</span></a></span></span><span> </span><span id="local-6989586621680984094"><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984094"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680984095"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984095"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984096"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984096"><span class="hs-identifier hs-var">oldExp_</span></a></span></span><span> </span><span id="local-6989586621680984097"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680984097"><span class="hs-identifier hs-var">argsVars</span></a></span></span><span> </span><span id="local-6989586621680984098"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984098"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1126"></span><span>  </span><span class="hs-keyword">case</span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984096"><span class="hs-identifier hs-var">oldExp_</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1127"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680984099"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984099"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680984100"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984100"><span class="hs-identifier hs-var">ls</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1128"></span><span>      </span><span class="hs-keyword">do</span><span>
</span><span id="line-1129"></span><span>        </span><span id="local-6989586621680984101"><span class="annot"><span class="annottext">[((String, [(Var, ())], Exp1), FunDefs1)]
</span><a href="#local-6989586621680984101"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1)
 -&gt; PassM ((String, [(Var, ())], Exp1), FunDefs1))
-&gt; [(String, [(Var, ())], Exp1)]
-&gt; PassM [((String, [(Var, ())], Exp1), FunDefs1)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">Prelude.mapM</span></a></span><span>
</span><span id="line-1130"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680984102"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984102"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984103"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680984103"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984104"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984104"><span class="hs-identifier hs-var">ex</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1131"></span><span>                  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1132"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680984105"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984105"><span class="hs-identifier hs-var">ex'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984106"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984106"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; [Var] -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tuple"><span class="hs-identifier hs-var">tuple</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984094"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984095"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984104"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680984097"><span class="hs-identifier hs-var">argsVars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984098"><span class="hs-identifier hs-var">depth</span></a></span><span>
</span><span id="line-1133"></span><span>                    </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1), FunDefs1)
-&gt; PassM ((String, [(Var, ())], Exp1), FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984102"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680984103"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984105"><span class="hs-identifier hs-var">ex'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984106"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span>                </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984100"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1135"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984108"><span class="annot"><span class="annottext">ls' :: [(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984108"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((String, [(Var, ())], Exp1), FunDefs1)
 -&gt; (String, [(Var, ())], Exp1))
-&gt; [((String, [(Var, ())], Exp1), FunDefs1)]
-&gt; [(String, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1), FunDefs1)
-&gt; (String, [(Var, ())], Exp1)
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[((String, [(Var, ())], Exp1), FunDefs1)]
</span><a href="#local-6989586621680984101"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1136"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984109"><span class="annot"><span class="annottext">fdefs' :: FunDefs1
</span><a href="#local-6989586621680984109"><span class="hs-identifier hs-var hs-var">fdefs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FunDefs1] -&gt; FunDefs1
forall (f :: * -&gt; *) k a.
(Foldable f, Ord k) =&gt;
f (Map k a) -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#unions"><span class="hs-identifier hs-var">M.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((String, [(Var, ())], Exp1), FunDefs1) -&gt; FunDefs1)
-&gt; [((String, [(Var, ())], Exp1), FunDefs1)] -&gt; [FunDefs1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1), FunDefs1) -&gt; FunDefs1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[((String, [(Var, ())], Exp1), FunDefs1)]
</span><a href="#local-6989586621680984101"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span>        </span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; PassM (Exp1, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984099"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984108"><span class="hs-identifier hs-var">ls'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984109"><span class="hs-identifier hs-var">fdefs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>    </span><span id="local-6989586621680984111"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984111"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PassM (Exp1, FunDefs1)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984096"><span class="hs-identifier hs-var">oldExp_</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span class="hs-comment">-- argsVars represents the arguments of the function that contains oldExp</span><span>
</span><span id="line-1142"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#tuple"><span class="hs-identifier hs-type">tuple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1143"></span><span id="tuple"><span class="annot"><span class="annottext">tuple :: DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; [Var] -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tuple"><span class="hs-identifier hs-var hs-var">tuple</span></a></span></span><span> </span><span id="local-6989586621680984199"><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984199"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680984200"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984200"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984201"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984201"><span class="hs-identifier hs-var">oldExp_</span></a></span></span><span> </span><span id="local-6989586621680984202"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680984202"><span class="hs-identifier hs-var">argsVars</span></a></span></span><span> </span><span id="local-6989586621680984203"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984203"><span class="hs-identifier hs-var">depth</span></a></span></span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1144"></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984203"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; PassM (Exp1, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984201"><span class="hs-identifier hs-var">oldExp_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984200"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-1146"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1147"></span><span class="hs-comment">--lets pic one at a time only !!</span><span>
</span><span id="line-1148"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984204"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680984204"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#cleanExp"><span class="hs-identifier hs-var">cleanExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984201"><span class="hs-identifier hs-var">oldExp_</span></a></span><span>
</span><span id="line-1149"></span><span>  </span><span class="hs-comment">-- candidates1 : a list of [(fName, CallExpressions)] functions that traverses</span><span>
</span><span id="line-1150"></span><span>  </span><span class="hs-comment">-- same input</span><span>
</span><span id="line-1151"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984205"><span class="annot"><span class="annottext">candidates1 :: [(Var, [Exp1])]
</span><a href="#local-6989586621680984205"><span class="hs-identifier hs-var hs-var">candidates1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, [Exp1]) -&gt; Bool) -&gt; [(Var, [Exp1])] -&gt; [(Var, [Exp1])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">L.filter</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [Exp1]) -&gt; Bool
forall {t :: * -&gt; *} {a} {a}. Foldable t =&gt; (a, t a) -&gt; Bool
</span><a href="#local-6989586621680984206"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Var [Exp1] -&gt; [(Var, [Exp1])]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; [Var] -&gt; Map Var [Exp1]
</span><a href="Gibbon.Passes.Fusion2.html#buildTupleCandidatesTable"><span class="hs-identifier hs-var">buildTupleCandidatesTable</span></a></span><span>
</span><span id="line-1152"></span><span>           </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984200"><span class="hs-identifier hs-var">fdefs</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984204"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680984202"><span class="hs-identifier hs-var">argsVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>         </span><span class="hs-comment">--    `debug` (&quot;looking for candidates for &quot; L.++ render (pprint oldExp))</span><span>
</span><span id="line-1154"></span><span>         </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680984206"><span class="annot"><span class="annottext">f :: (a, t a) -&gt; Bool
</span><a href="#local-6989586621680984206"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984211"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621680984211"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t a -&gt; Int
forall a. t a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621680984211"><span class="hs-identifier hs-var">ls</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span>  </span><span class="hs-comment">-- candidates2: a list  [(tupleName, calls, syncedArgsLocs)]</span><span>
</span><span id="line-1158"></span><span>  </span><span class="hs-comment">-- syncedArgsLocs = [((1,2),(3,4)),..] this means args 4 in f3 is the same as</span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-comment">-- arg 2 in f1</span><span>
</span><span id="line-1160"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984212"><span class="annot"><span class="annottext">candidates2 :: [(Var, [Exp1], Map (Int, Int) (Int, Int))]
</span><a href="#local-6989586621680984212"><span class="hs-identifier hs-var hs-var">candidates2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, [Exp1]) -&gt; (Var, [Exp1], Map (Int, Int) (Int, Int)))
-&gt; [(Var, [Exp1])] -&gt; [(Var, [Exp1], Map (Int, Int) (Int, Int))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680984213"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984213"><span class="hs-identifier hs-var">traversedVar</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984214"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984214"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1161"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984215"><span class="annot"><span class="annottext">sortedCalls :: [Exp1]
</span><a href="#local-6989586621680984215"><span class="hs-identifier hs-var hs-var">sortedCalls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; (Var, Exp1)) -&gt; [Exp1] -&gt; [Exp1]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#sortOn"><span class="hs-identifier hs-var">L.sortOn</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; (Var, Exp1)
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; (Var, PreExp ext loc dec)
</span><a href="#local-6989586621680984217"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984214"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1162"></span><span>                   </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680984217"><span class="annot"><span class="annottext">f :: PreExp ext loc dec -&gt; (Var, PreExp ext loc dec)
</span><a href="#local-6989586621680984217"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680984218"><span class="annot"><span class="annottext">exp :: PreExp ext loc dec
</span><a href="#local-6989586621680984218"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680984219"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984219"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="annot"><span class="annottext">[loc]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984219"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984218"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>                </span><span id="local-6989586621680984220"><span class="annot"><span class="annottext">syncArgsLocs :: Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984220"><span class="hs-identifier hs-var hs-var">syncArgsLocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Map (Int, Int) (Int, Int)
forall {loc} {dec} {ext :: * -&gt; * -&gt; *}.
(Ord loc, Ord dec, Ord (ext loc dec)) =&gt;
[PreExp ext loc dec] -&gt; Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984221"><span class="hs-identifier hs-var">computeSyncedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984215"><span class="hs-identifier hs-var">sortedCalls</span></a></span><span> </span><span class="hs-comment">--`debug` (&quot;done1&quot;)</span><span>
</span><span id="line-1164"></span><span>
</span><span id="line-1165"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; [((Int, Int), (Int, Int))] -&gt; Var
forall {a} {a} {a} {a} {t :: * -&gt; *} {t :: * -&gt; *}
       {ext :: * -&gt; * -&gt; *} {loc} {dec}.
(Show a, Show a, Show a, Show a, Foldable t, Foldable t) =&gt;
t (PreExp ext loc dec) -&gt; t ((a, a), (a, a)) -&gt; Var
</span><a href="#local-6989586621680984222"><span class="hs-identifier hs-var">constructName</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984215"><span class="hs-identifier hs-var">sortedCalls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int) -&gt; [((Int, Int), (Int, Int))]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984220"><span class="hs-identifier hs-var">syncArgsLocs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984215"><span class="hs-identifier hs-var">sortedCalls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1166"></span><span>                 </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984220"><span class="hs-identifier hs-var">syncArgsLocs</span></a></span><span class="hs-special">)</span><span class="hs-comment">--`debug` (&quot;done2&quot;)</span><span>
</span><span id="line-1167"></span><span>               </span><span class="hs-comment">--`debug` (&quot;orgArgs:&quot; L.++ (render (pprint sortedCalls)) L.++ &quot;\nargs&quot; L.++ (show syncArgsLocs))</span><span>
</span><span id="line-1168"></span><span>                </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, [Exp1])]
</span><a href="#local-6989586621680984205"><span class="hs-identifier hs-var">candidates1</span></a></span><span>
</span><span id="line-1169"></span><span>       </span><span class="hs-comment">--  `debug` (&quot;filter candidates for &quot; L.++ render (pprint oldExp))</span><span>
</span><span id="line-1170"></span><span>    </span><span class="hs-comment">--(newExp, fdefs') &lt;-  Control.Monad.foldM go (oldExp, fdefs)  candidates2</span><span>
</span><span id="line-1171"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(Var, [Exp1], Map (Int, Int) (Int, Int))] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [Exp1], Map (Int, Int) (Int, Int))]
</span><a href="#local-6989586621680984212"><span class="hs-identifier hs-var">candidates2</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1172"></span><span>      </span><span class="hs-keyword">then</span><span>
</span><span id="line-1173"></span><span>        </span><span class="hs-keyword">do</span><span>
</span><span id="line-1174"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621680984223"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984223"><span class="hs-identifier hs-var">newExp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984224"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984224"><span class="hs-identifier hs-var">fdefs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Exp1, FunDefs1)
-&gt; (Var, [Exp1], Map (Int, Int) (Int, Int))
-&gt; PassM (Exp1, FunDefs1)
</span><a href="#local-6989586621680984225"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984204"><span class="hs-identifier hs-var">oldExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984200"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [Exp1], Map (Int, Int) (Int, Int))]
-&gt; (Var, [Exp1], Map (Int, Int) (Int, Int))
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [Exp1], Map (Int, Int) (Int, Int))]
</span><a href="#local-6989586621680984212"><span class="hs-identifier hs-var">candidates2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984226"><span class="annot"><span class="annottext">newExp' :: Exp1
</span><a href="#local-6989586621680984226"><span class="hs-identifier hs-var hs-var">newExp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyProjections"><span class="hs-identifier hs-var">simplifyProjections</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984223"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1176"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621680984227"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984227"><span class="hs-identifier hs-var">newExp''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984228"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984228"><span class="hs-identifier hs-var">fdefs''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; [Var] -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tuple"><span class="hs-identifier hs-var">tuple</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984199"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984224"><span class="hs-identifier hs-var">fdefs'</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984226"><span class="hs-identifier hs-var">newExp'</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680984202"><span class="hs-identifier hs-var">argsVars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984203"><span class="hs-identifier hs-var">depth</span></a></span><span>
</span><span id="line-1177"></span><span>           </span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; PassM (Exp1, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984227"><span class="hs-identifier hs-var">newExp''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984228"><span class="hs-identifier hs-var">fdefs''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PassM (Exp1, FunDefs1) -&gt; String -&gt; PassM (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;done one  candidate&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1178"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-1179"></span><span>         </span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; PassM (Exp1, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984204"><span class="hs-identifier hs-var">oldExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984200"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PassM (Exp1, FunDefs1) -&gt; String -&gt; PassM (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no candidates&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-1181"></span><span>    </span><span id="local-6989586621680984225"><span class="annot"><span class="annottext">go :: (Exp1, FunDefs1)
-&gt; (Var, [Exp1], Map (Int, Int) (Int, Int))
-&gt; PassM (Exp1, FunDefs1)
</span><a href="#local-6989586621680984225"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984229"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984229"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984230"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984230"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984231"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984231"><span class="hs-identifier hs-var">tupledFName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984232"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984232"><span class="hs-identifier hs-var">callExpressions</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984233"><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984233"><span class="hs-identifier hs-var">syncArgsLocs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1182"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs1 -&gt; Maybe FunDef1
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984231"><span class="hs-identifier hs-var">tupledFName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984230"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1183"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680984234"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984234"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1184"></span><span>            </span><span id="local-6989586621680984235"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984235"><span class="hs-identifier hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span class="annot"><span class="annottext">Exp1
-&gt; FunDef1
-&gt; [Exp1]
-&gt; Vector Int
-&gt; Map (Int, Int) (Int, Int)
-&gt; PassM Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldTupledFunctions"><span class="hs-identifier hs-var">foldTupledFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984229"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984234"><span class="hs-identifier hs-var">fdef</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984232"><span class="hs-identifier hs-var">callExpressions</span></a></span><span>
</span><span id="line-1185"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1 -&gt; [Exp1] -&gt; Vector Int
</span><a href="Gibbon.Passes.Fusion2.html#getOutputStartPositions"><span class="hs-identifier hs-var">getOutputStartPositions</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984230"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984232"><span class="hs-identifier hs-var">callExpressions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984233"><span class="hs-identifier hs-var">syncArgsLocs</span></a></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984237"><span class="annot"><span class="annottext">exp'' :: Exp1
</span><a href="#local-6989586621680984237"><span class="hs-identifier hs-var hs-var">exp''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyProjections"><span class="hs-identifier hs-var">simplifyProjections</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984235"><span class="hs-identifier hs-var">exp'</span></a></span><span>
</span><span id="line-1188"></span><span>            </span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; PassM (Exp1, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984235"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984230"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PassM (Exp1, FunDefs1) -&gt; String -&gt; PassM (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fold1&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984237"><span class="hs-identifier hs-var">exp''</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1189"></span><span>
</span><span id="line-1190"></span><span>        </span><span class="annot"><span class="annottext">Maybe FunDef1
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1191"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984238"><span class="annot"><span class="annottext">functionsToTuple :: [FunDef1]
</span><a href="#local-6989586621680984238"><span class="hs-identifier hs-var hs-var">functionsToTuple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; FunDef1) -&gt; [Exp1] -&gt; [FunDef1]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; FunDef1
</span><a href="#local-6989586621680984239"><span class="hs-identifier hs-var">getCalledFunDef</span></a></span><span>  </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984232"><span class="hs-identifier hs-var">callExpressions</span></a></span><span>
</span><span id="line-1192"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1193"></span><span>                    </span><span id="local-6989586621680984239"><span class="annot"><span class="annottext">getCalledFunDef :: Exp1 -&gt; FunDef1
</span><a href="#local-6989586621680984239"><span class="hs-identifier hs-var hs-var">getCalledFunDef</span></a></span></span><span> </span><span id="local-6989586621680984240"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984240"><span class="hs-identifier hs-var">callExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984240"><span class="hs-identifier hs-var">callExpr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1194"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680984241"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984241"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs1 -&gt; Maybe FunDef1
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984241"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984230"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1195"></span><span>                             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680984242"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984242"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984242"><span class="hs-identifier hs-var">fdef</span></a></span><span>
</span><span id="line-1196"></span><span>
</span><span id="line-1197"></span><span>            </span><span id="local-6989586621680984243"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984243"><span class="hs-identifier hs-var">tupledFunction_</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1198"></span><span>              </span><span class="annot"><span class="annottext">DDefs Ty1
-&gt; [FunDef1] -&gt; Var -&gt; Map (Int, Int) (Int, Int) -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#tupleListOfFunctions"><span class="hs-identifier hs-var">tupleListOfFunctions</span></a></span><span>
</span><span id="line-1199"></span><span>                 </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984199"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDef1]
</span><a href="#local-6989586621680984238"><span class="hs-identifier hs-var">functionsToTuple</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984231"><span class="hs-identifier hs-var">tupledFName</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984233"><span class="hs-identifier hs-var">syncArgsLocs</span></a></span><span>
</span><span id="line-1200"></span><span>                  </span><span class="annot"><span class="annottext">PassM FunDef1 -&gt; String -&gt; PassM FunDef1
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;funcs to tuple&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FunDef1] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDef1]
</span><a href="#local-6989586621680984238"><span class="hs-identifier hs-var">functionsToTuple</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span>            </span><span id="local-6989586621680984244"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984244"><span class="hs-identifier hs-var">tupledFunction</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#freshFunction"><span class="hs-identifier hs-var">freshFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984243"><span class="hs-identifier hs-var">tupledFunction_</span></a></span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984245"><span class="annot"><span class="annottext">tupledFunction' :: FunDef1
</span><a href="#local-6989586621680984245"><span class="hs-identifier hs-var hs-var">tupledFunction'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1204"></span><span>                  </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984244"><span class="hs-identifier hs-var">tupledFunction</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#cleanExp"><span class="hs-identifier hs-var">cleanExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984244"><span class="hs-identifier hs-var">tupledFunction</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-1205"></span><span>                   </span><span class="annot"><span class="annottext">FunDef1 -&gt; String -&gt; FunDef1
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tupled f is :&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984243"><span class="hs-identifier hs-var">tupledFunction_</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>
</span><span id="line-1207"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984246"><span class="annot"><span class="annottext">fdefs' :: FunDefs1
</span><a href="#local-6989586621680984246"><span class="hs-identifier hs-var hs-var">fdefs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984231"><span class="hs-identifier hs-var">tupledFName</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984245"><span class="hs-identifier hs-var">tupledFunction'</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984230"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1208"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984247"><span class="annot"><span class="annottext">traversedArg :: [Var]
</span><a href="#local-6989586621680984247"><span class="hs-identifier hs-var hs-var">traversedArg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984245"><span class="hs-identifier hs-var">tupledFunction'</span></a></span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680984248"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984248"><span class="hs-identifier hs-var">recTupledBody</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984249"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984249"><span class="hs-identifier hs-var">newDefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1211"></span><span>               </span><span class="annot"><span class="annottext">DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; [Var] -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tuple_entry"><span class="hs-identifier hs-var">tuple_entry</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984199"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984246"><span class="hs-identifier hs-var">fdefs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984245"><span class="hs-identifier hs-var">tupledFunction'</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680984247"><span class="hs-identifier hs-var">traversedArg</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984203"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>                 </span><span class="annot"><span class="annottext">PassM (Exp1, FunDefs1) -&gt; String -&gt; PassM (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n done tupling :&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984231"><span class="hs-identifier hs-var">tupledFName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1213"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984245"><span class="hs-identifier hs-var">tupledFunction'</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>                   </span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span>
</span><span id="line-1216"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984250"><span class="annot"><span class="annottext">tupledFunction'' :: FunDef1
</span><a href="#local-6989586621680984250"><span class="hs-identifier hs-var hs-var">tupledFunction''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984245"><span class="hs-identifier hs-var">tupledFunction'</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984248"><span class="hs-identifier hs-var">recTupledBody</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984251"><span class="annot"><span class="annottext">tupledFunction''' :: FunDef1
</span><a href="#local-6989586621680984251"><span class="hs-identifier hs-var hs-var">tupledFunction'''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1219"></span><span>                  </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984250"><span class="hs-identifier hs-var">tupledFunction''</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span>
</span><span id="line-1220"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyProjections"><span class="hs-identifier hs-var">simplifyProjections</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984250"><span class="hs-identifier hs-var">tupledFunction''</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984252"><span class="annot"><span class="annottext">fdefs'' :: FunDefs1
</span><a href="#local-6989586621680984252"><span class="hs-identifier hs-var hs-var">fdefs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984231"><span class="hs-identifier hs-var">tupledFName</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984251"><span class="hs-identifier hs-var">tupledFunction'''</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984249"><span class="hs-identifier hs-var">newDefs</span></a></span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span>            </span><span id="local-6989586621680984253"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984253"><span class="hs-identifier hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1225"></span><span>              </span><span class="annot"><span class="annottext">Exp1
-&gt; FunDef1
-&gt; [Exp1]
-&gt; Vector Int
-&gt; Map (Int, Int) (Int, Int)
-&gt; PassM Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldTupledFunctions"><span class="hs-identifier hs-var">foldTupledFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984229"><span class="hs-identifier hs-var">exp</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984251"><span class="hs-identifier hs-var">tupledFunction'''</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984232"><span class="hs-identifier hs-var">callExpressions</span></a></span><span>
</span><span id="line-1226"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1 -&gt; [Exp1] -&gt; Vector Int
</span><a href="Gibbon.Passes.Fusion2.html#getOutputStartPositions"><span class="hs-identifier hs-var">getOutputStartPositions</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984252"><span class="hs-identifier hs-var">fdefs''</span></a></span><span>
</span><span id="line-1227"></span><span>                   </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984232"><span class="hs-identifier hs-var">callExpressions</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984233"><span class="hs-identifier hs-var">syncArgsLocs</span></a></span><span>
</span><span id="line-1228"></span><span>                     </span><span class="annot"><span class="annottext">PassM Exp1 -&gt; String -&gt; PassM Exp1
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fold2 before folding&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984229"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1229"></span><span>
</span><span id="line-1230"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984254"><span class="annot"><span class="annottext">exp'' :: Exp1
</span><a href="#local-6989586621680984254"><span class="hs-identifier hs-var hs-var">exp''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyProjections"><span class="hs-identifier hs-var">simplifyProjections</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984253"><span class="hs-identifier hs-var">exp'</span></a></span><span>
</span><span id="line-1231"></span><span>            </span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; PassM (Exp1, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984253"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984252"><span class="hs-identifier hs-var">fdefs''</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">PassM (Exp1, FunDefs1) -&gt; String -&gt; PassM (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fold2&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984253"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span>    </span><span id="local-6989586621680984222"><span class="annot"><span class="annottext">constructName :: t (PreExp ext loc dec) -&gt; t ((a, a), (a, a)) -&gt; Var
</span><a href="#local-6989586621680984222"><span class="hs-identifier hs-var hs-var">constructName</span></a></span></span><span> </span><span id="local-6989586621680984272"><span class="annot"><span class="annottext">t (PreExp ext loc dec)
</span><a href="#local-6989586621680984272"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680984273"><span class="annot"><span class="annottext">t ((a, a), (a, a))
</span><a href="#local-6989586621680984273"><span class="hs-identifier hs-var">syncArgsLocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1234"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984274"><span class="annot"><span class="annottext">syncedArgsText :: String
</span><a href="#local-6989586621680984274"><span class="hs-identifier hs-var hs-var">syncedArgsText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((a, a), (a, a)) -&gt; String -&gt; String)
-&gt; String -&gt; t ((a, a), (a, a)) -&gt; String
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">((a, a), (a, a)) -&gt; String -&gt; String
forall {a} {a} {a} {a}.
(Show a, Show a, Show a, Show a) =&gt;
((a, a), (a, a)) -&gt; String -&gt; String
</span><a href="#local-6989586621680984275"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">t ((a, a), (a, a))
</span><a href="#local-6989586621680984273"><span class="hs-identifier hs-var">syncArgsLocs</span></a></span><span>
</span><span id="line-1235"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-1236"></span><span>            </span><span id="local-6989586621680984275"><span class="annot"><span class="annottext">f :: ((a, a), (a, a)) -&gt; String -&gt; String
</span><a href="#local-6989586621680984275"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680984291"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984291"><span class="hs-identifier hs-var">f1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984292"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984292"><span class="hs-identifier hs-var">id1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984293"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984293"><span class="hs-identifier hs-var">f2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984294"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984294"><span class="hs-identifier hs-var">id2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984295"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984295"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1237"></span><span>              </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984295"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984291"><span class="hs-identifier hs-var">f1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984292"><span class="hs-identifier hs-var">id1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_from_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span>
</span><span id="line-1238"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span>
</span><span id="line-1239"></span><span>              </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984293"><span class="hs-identifier hs-var">f2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span>
</span><span id="line-1240"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span>
</span><span id="line-1241"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984294"><span class="hs-identifier hs-var">id2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span>
</span><span id="line-1242"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_n_&quot;</span></span><span>
</span><span id="line-1243"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span>
</span><span id="line-1244"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_TUP_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PreExp ext loc dec -&gt; String)
-&gt; String -&gt; t (PreExp ext loc dec) -&gt; String
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; PreExp ext loc dec -&gt; String
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
String -&gt; PreExp ext loc dec -&gt; String
</span><a href="#local-6989586621680984296"><span class="hs-identifier hs-var">appendName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">t (PreExp ext loc dec)
</span><a href="#local-6989586621680984272"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984274"><span class="hs-identifier hs-var">syncedArgsText</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_TUP_&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>
</span><span id="line-1246"></span><span>    </span><span id="local-6989586621680984296"><span class="annot"><span class="annottext">appendName :: String -&gt; PreExp ext loc dec -&gt; String
</span><a href="#local-6989586621680984296"><span class="hs-identifier hs-var hs-var">appendName</span></a></span></span><span> </span><span id="local-6989586621680984299"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984299"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680984300"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984300"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="annot"><span class="annottext">[loc]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1247"></span><span>       </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984299"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_t_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984300"><span class="hs-identifier hs-var">fName</span></a></span><span>
</span><span id="line-1248"></span><span>
</span><span id="line-1249"></span><span>    </span><span id="local-6989586621680984221"><span class="annot"><span class="annottext">computeSyncedArgs :: [PreExp ext loc dec] -&gt; Map (Int, Int) (Int, Int)
</span><a href="#local-6989586621680984221"><span class="hs-identifier hs-var hs-var">computeSyncedArgs</span></a></span></span><span> </span><span id="local-6989586621680984318"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680984318"><span class="hs-identifier hs-var">callExpressions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1250"></span><span>     </span><span class="hs-comment">--list of vectors of args [V1, V2 ...]</span><span>
</span><span id="line-1251"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984319"><span class="annot"><span class="annottext">argsLists :: [Vector (PreExp ext loc dec)]
</span><a href="#local-6989586621680984319"><span class="hs-identifier hs-var hs-var">argsLists</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PreExp ext loc dec -&gt; Vector (PreExp ext loc dec))
-&gt; [PreExp ext loc dec] -&gt; [Vector (PreExp ext loc dec)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Vector (PreExp ext loc dec)
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; Vector (PreExp ext loc dec)
</span><a href="#local-6989586621680984320"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680984318"><span class="hs-identifier hs-var">callExpressions</span></a></span><span>
</span><span id="line-1252"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-1253"></span><span>              </span><span id="local-6989586621680984320"><span class="annot"><span class="annottext">f :: PreExp ext loc dec -&gt; Vector (PreExp ext loc dec)
</span><a href="#local-6989586621680984320"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[loc]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984321"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984321"><span class="hs-identifier hs-var">h</span></a></span></span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680984322"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680984322"><span class="hs-identifier hs-var">tail</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec] -&gt; Vector (PreExp ext loc dec)
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680984322"><span class="hs-identifier hs-var">tail</span></a></span><span>
</span><span id="line-1254"></span><span>
</span><span id="line-1255"></span><span>          </span><span class="hs-comment">-- single list of (func-pos, arg-pos, argExp) all args in one list</span><span>
</span><span id="line-1256"></span><span>          </span><span id="local-6989586621680984323"><span class="annot"><span class="annottext">allArgsList :: [(Int, Int, PreExp ext loc dec)]
</span><a href="#local-6989586621680984323"><span class="hs-identifier hs-var hs-var">allArgsList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; Vector (PreExp ext loc dec)
 -&gt; [(Int, Int, PreExp ext loc dec)]
 -&gt; [(Int, Int, PreExp ext loc dec)])
-&gt; [(Int, Int, PreExp ext loc dec)]
-&gt; Vector (Vector (PreExp ext loc dec))
-&gt; [(Int, Int, PreExp ext loc dec)]
forall a b. (Int -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Vector a -&gt; b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldr"><span class="hs-identifier hs-var">V.ifoldr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Vector (PreExp ext loc dec)
-&gt; [(Int, Int, PreExp ext loc dec)]
-&gt; [(Int, Int, PreExp ext loc dec)]
forall {a} {c}. a -&gt; Vector c -&gt; [(a, Int, c)] -&gt; [(a, Int, c)]
</span><a href="#local-6989586621680984324"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Vector (PreExp ext loc dec)]
-&gt; Vector (Vector (PreExp ext loc dec))
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector (PreExp ext loc dec)]
</span><a href="#local-6989586621680984319"><span class="hs-identifier hs-var">argsLists</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-1258"></span><span>              </span><span id="local-6989586621680984324"><span class="annot"><span class="annottext">f :: a -&gt; Vector c -&gt; [(a, Int, c)] -&gt; [(a, Int, c)]
</span><a href="#local-6989586621680984324"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680984327"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984327"><span class="hs-identifier hs-var">idxFunc</span></a></span></span><span> </span><span id="local-6989586621680984328"><span class="annot"><span class="annottext">Vector c
</span><a href="#local-6989586621680984328"><span class="hs-identifier hs-var">argsV</span></a></span></span><span> </span><span id="local-6989586621680984329"><span class="annot"><span class="annottext">[(a, Int, c)]
</span><a href="#local-6989586621680984329"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1259"></span><span>               </span><span class="annot"><span class="annottext">[(a, Int, c)]
</span><a href="#local-6989586621680984329"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Int, c)] -&gt; [(a, Int, c)] -&gt; [(a, Int, c)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (a, Int, c) -&gt; [(a, Int, c)]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span>
</span><span id="line-1260"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; c -&gt; (a, Int, c)) -&gt; Vector c -&gt; Vector (a, Int, c)
forall a b. (Int -&gt; a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#imap"><span class="hs-identifier hs-var">V.imap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680984330"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984330"><span class="hs-identifier hs-var">idxVar</span></a></span></span><span> </span><span id="local-6989586621680984331"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680984331"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984327"><span class="hs-identifier hs-var">idxFunc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984330"><span class="hs-identifier hs-var">idxVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680984331"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector c
</span><a href="#local-6989586621680984328"><span class="hs-identifier hs-var">argsV</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1261"></span><span>          </span><span id="local-6989586621680984332"><span class="annot"><span class="annottext">redundantPositions :: (Map (PreExp ext loc dec) (Int, Int), Map (Int, Int) (Int, Int))
</span><a href="#local-6989586621680984332"><span class="hs-identifier hs-var hs-var">redundantPositions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int, PreExp ext loc dec)
 -&gt; (Map (PreExp ext loc dec) (Int, Int), Map (Int, Int) (Int, Int))
 -&gt; (Map (PreExp ext loc dec) (Int, Int),
     Map (Int, Int) (Int, Int)))
-&gt; (Map (PreExp ext loc dec) (Int, Int), Map (Int, Int) (Int, Int))
-&gt; [(Int, Int, PreExp ext loc dec)]
-&gt; (Map (PreExp ext loc dec) (Int, Int), Map (Int, Int) (Int, Int))
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int, PreExp ext loc dec)
-&gt; (Map (PreExp ext loc dec) (Int, Int), Map (Int, Int) (Int, Int))
-&gt; (Map (PreExp ext loc dec) (Int, Int), Map (Int, Int) (Int, Int))
forall {k} {a} {b}.
(Ord k, Ord a, Ord b) =&gt;
(a, b, k)
-&gt; (Map k (a, b), Map (a, b) (a, b))
-&gt; (Map k (a, b), Map (a, b) (a, b))
</span><a href="#local-6989586621680984333"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (PreExp ext loc dec) (Int, Int)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map (Int, Int) (Int, Int)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, Int, PreExp ext loc dec)]
</span><a href="#local-6989586621680984323"><span class="hs-identifier hs-var">allArgsList</span></a></span><span>
</span><span id="line-1262"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-1263"></span><span>             </span><span id="local-6989586621680984333"><span class="annot"><span class="annottext">f :: (a, b, k)
-&gt; (Map k (a, b), Map (a, b) (a, b))
-&gt; (Map k (a, b), Map (a, b) (a, b))
</span><a href="#local-6989586621680984333"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984349"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984349"><span class="hs-identifier hs-var">funPos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984350"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680984350"><span class="hs-identifier hs-var">argPos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984351"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680984351"><span class="hs-identifier hs-var">argExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984352"><span class="annot"><span class="annottext">Map k (a, b)
</span><a href="#local-6989586621680984352"><span class="hs-identifier hs-var">firstAppear</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984353"><span class="annot"><span class="annottext">Map (a, b) (a, b)
</span><a href="#local-6989586621680984353"><span class="hs-identifier hs-var">redundant</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1264"></span><span>                 </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k (a, b) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680984351"><span class="hs-identifier hs-var">argExp</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (a, b)
</span><a href="#local-6989586621680984352"><span class="hs-identifier hs-var">firstAppear</span></a></span><span>
</span><span id="line-1265"></span><span>                  </span><span class="hs-keyword">then</span><span>
</span><span id="line-1266"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k (a, b)
</span><a href="#local-6989586621680984352"><span class="hs-identifier hs-var">firstAppear</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1267"></span><span>                    </span><span class="annot"><span class="annottext">(a, b) -&gt; (a, b) -&gt; Map (a, b) (a, b) -&gt; Map (a, b) (a, b)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984349"><span class="hs-identifier hs-var">funPos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680984350"><span class="hs-identifier hs-var">argPos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k (a, b)
</span><a href="#local-6989586621680984352"><span class="hs-identifier hs-var">firstAppear</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (a, b) -&gt; k -&gt; (a, b)
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680984351"><span class="hs-identifier hs-var">argExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (a, b) (a, b)
</span><a href="#local-6989586621680984353"><span class="hs-identifier hs-var">redundant</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span>                  </span><span class="hs-keyword">else</span><span>
</span><span id="line-1269"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; (a, b) -&gt; Map k (a, b) -&gt; Map k (a, b)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680984351"><span class="hs-identifier hs-var">argExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984349"><span class="hs-identifier hs-var">funPos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680984350"><span class="hs-identifier hs-var">argPos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map k (a, b)
</span><a href="#local-6989586621680984352"><span class="hs-identifier hs-var">firstAppear</span></a></span><span> </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Map (a, b) (a, b)
</span><a href="#local-6989586621680984353"><span class="hs-identifier hs-var">redundant</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1270"></span><span>
</span><span id="line-1271"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Map (PreExp ext loc dec) (Int, Int), Map (Int, Int) (Int, Int))
-&gt; Map (Int, Int) (Int, Int)
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (PreExp ext loc dec) (Int, Int), Map (Int, Int) (Int, Int))
</span><a href="#local-6989586621680984332"><span class="hs-identifier hs-var">redundantPositions</span></a></span><span>
</span><span id="line-1272"></span><span>
</span><span id="line-1273"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#fixCalls"><span class="hs-identifier hs-type">fixCalls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-1274"></span><span id="fixCalls"><span class="annot"><span class="annottext">fixCalls :: Exp1
-&gt; FunDef1 -&gt; FunDef1 -&gt; Map Int Int -&gt; Map Int Int -&gt; Var -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#fixCalls"><span class="hs-identifier hs-var hs-var">fixCalls</span></a></span></span><span> </span><span id="local-6989586621680984393"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984393"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680984394"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984394"><span class="hs-identifier hs-var">fdefOld</span></a></span></span><span> </span><span id="local-6989586621680984395"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984395"><span class="hs-identifier hs-var">fdefNew</span></a></span></span><span> </span><span id="local-6989586621680984396"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984396"><span class="hs-identifier hs-var">redirectMap</span></a></span></span><span> </span><span id="local-6989586621680984397"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984397"><span class="hs-identifier hs-var">outputFromInput</span></a></span></span><span> </span><span id="local-6989586621680984398"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984398"><span class="hs-identifier hs-var">newName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680984399"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984393"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-1275"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1276"></span><span>      </span><span id="local-6989586621680984399"><span class="annot"><span class="annottext">go :: Exp1 -&gt; Exp1
</span><a href="#local-6989586621680984399"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680984400"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984400"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984400"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1277"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680984401"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984401"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680984402"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984402"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1278"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984403"><span class="annot"><span class="annottext">ls' :: [(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984403"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1))
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680984404"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984404"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984405"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680984405"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984406"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984406"><span class="hs-identifier hs-var">ex</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680984404"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680984405"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680984399"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984406"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984402"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1279"></span><span>          </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984401"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984403"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-1280"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680984407"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984407"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984408"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680984408"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984409"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680984409"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984410"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984410"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984411"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984411"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1281"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984410"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1282"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680984412"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984412"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680984413"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680984413"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680984414"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984414"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1283"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984412"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984394"><span class="hs-identifier hs-var">fdefOld</span></a></span><span>
</span><span id="line-1284"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-1285"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984415"><span class="annot"><span class="annottext">t' :: Ty1
</span><a href="#local-6989586621680984415"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984395"><span class="hs-identifier hs-var">fdefNew</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1286"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984416"><span class="annot"><span class="annottext">rhs' :: Exp1
</span><a href="#local-6989586621680984416"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984398"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680984413"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984414"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1287"></span><span>                  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1288"></span><span>                    </span><span id="local-6989586621680984417"><span class="annot"><span class="annottext">body' :: Exp1
</span><a href="#local-6989586621680984417"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(Exp1 -&gt; (Int, Int) -&gt; Exp1) -&gt; Exp1 -&gt; [(Int, Int)] -&gt; Exp1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span>
</span><span id="line-1289"></span><span>                        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680984418"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984418"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984419"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984419"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984420"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984420"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1290"></span><span>                              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984421"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680984421"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984419"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984407"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1291"></span><span>                                  </span><span id="local-6989586621680984422"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680984422"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Int -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#getExpAtIndex"><span class="hs-identifier hs-var">getExpAtIndex</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984414"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984420"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-1292"></span><span>                              </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984421"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984422"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984418"><span class="hs-identifier hs-var">ex</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; String -&gt; Exp1
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;replacing1&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984421"><span class="hs-identifier hs-var">oldExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984422"><span class="hs-identifier hs-var">newExp</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984397"><span class="hs-identifier hs-var">outputFromInput</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span>                        </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984411"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Int -&gt; [(Int, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984397"><span class="hs-identifier hs-var">outputFromInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1294"></span><span>
</span><span id="line-1295"></span><span>                    </span><span id="local-6989586621680984424"><span class="annot"><span class="annottext">body'' :: Exp1
</span><a href="#local-6989586621680984424"><span class="hs-identifier hs-var hs-var">body''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; (Int, Int) -&gt; Exp1) -&gt; Exp1 -&gt; [(Int, Int)] -&gt; Exp1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span>
</span><span id="line-1296"></span><span>                        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680984425"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984425"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984426"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984426"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984427"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984427"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1297"></span><span>                         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984426"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984427"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-1298"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984425"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-1299"></span><span>                           </span><span class="hs-keyword">else</span><span>
</span><span id="line-1300"></span><span>                              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984428"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680984428"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984426"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984407"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>                                  </span><span id="local-6989586621680984429"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680984429"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984427"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984407"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1302"></span><span>                              </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984428"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984429"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984425"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; String -&gt; Exp1
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;replacing2&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984428"><span class="hs-identifier hs-var">oldExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984429"><span class="hs-identifier hs-var">newExp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1303"></span><span>                        </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984417"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Int -&gt; [(Int, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984396"><span class="hs-identifier hs-var">redirectMap</span></a></span><span class="hs-special">)</span><span class="hs-comment">-- in</span><span>
</span><span id="line-1304"></span><span>
</span><span id="line-1305"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984407"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680984408"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680984415"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984416"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680984399"><span class="hs-identifier hs-var">go</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984424"><span class="hs-identifier hs-var">body''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1306"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-1307"></span><span>                   </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984407"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680984408"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680984409"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984410"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680984399"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984411"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1308"></span><span>            </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1309"></span><span>               </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Var
</span><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621680984407"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680984408"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680984409"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984410"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="#local-6989586621680984399"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984411"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1310"></span><span>        </span><span id="local-6989586621680984430"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984430"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984430"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1311"></span><span>
</span><span id="line-1312"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#getExpAtIndex"><span class="hs-identifier hs-type">getExpAtIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-1313"></span><span id="getExpAtIndex"><span class="annot"><span class="annottext">getExpAtIndex :: [Exp1] -&gt; Int -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#getExpAtIndex"><span class="hs-identifier hs-var hs-var">getExpAtIndex</span></a></span></span><span> </span><span id="local-6989586621680984433"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984433"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680984434"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984434"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984433"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Int -&gt; Exp1
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">L.!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984434"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1314"></span><span>
</span><span id="line-1315"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#getOutputStartPositions"><span class="hs-identifier hs-type">getOutputStartPositions</span></a></span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#Vector"><span class="hs-identifier hs-type">V.Vector</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-1316"></span><span id="getOutputStartPositions"><span class="annot"><span class="annottext">getOutputStartPositions :: FunDefs1 -&gt; [Exp1] -&gt; Vector Int
</span><a href="Gibbon.Passes.Fusion2.html#getOutputStartPositions"><span class="hs-identifier hs-var hs-var">getOutputStartPositions</span></a></span></span><span> </span><span id="local-6989586621680984444"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984444"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984445"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984445"><span class="hs-identifier hs-var">callExpressions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1317"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984446"><span class="annot"><span class="annottext">functionsArgsLengths :: [Int]
</span><a href="#local-6989586621680984446"><span class="hs-identifier hs-var hs-var">functionsArgsLengths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp1 -&gt; Int) -&gt; [Exp1] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Int
</span><a href="#local-6989586621680984447"><span class="hs-identifier hs-var">getCalledFunDef</span></a></span><span>  </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984445"><span class="hs-identifier hs-var">callExpressions</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1318"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984448"><span class="annot"><span class="annottext">ls :: [Int]
</span><a href="#local-6989586621680984448"><span class="hs-identifier hs-var hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int -&gt; [Int]) -&gt; [Int] -&gt; [Int] -&gt; [Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680984449"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680984449"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680984450"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984450"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680984449"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984450"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#last"><span class="hs-identifier hs-var">L.last</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680984449"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-1319"></span><span>          </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680984446"><span class="hs-identifier hs-var">functionsArgsLengths</span></a></span><span>
</span><span id="line-1320"></span><span>     </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">[Int] -&gt; Vector Int
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680984448"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1321"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-1322"></span><span>     </span><span id="local-6989586621680984447"><span class="annot"><span class="annottext">getCalledFunDef :: Exp1 -&gt; Int
</span><a href="#local-6989586621680984447"><span class="hs-identifier hs-var hs-var">getCalledFunDef</span></a></span></span><span> </span><span id="local-6989586621680984452"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984452"><span class="hs-identifier hs-var">callExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984452"><span class="hs-identifier hs-var">callExpr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1323"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680984453"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984453"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1324"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs1 -&gt; Maybe FunDef1
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984453"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984444"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1325"></span><span>              </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680984454"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984454"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984454"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1326"></span><span>                </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680984455"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680984455"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680984455"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1327"></span><span>                </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1328"></span><span>
</span><span id="line-1329"></span><span class="hs-comment">-- the last input argument is a set of already fused functions in the form of</span><span>
</span><span id="line-1330"></span><span class="hs-comment">-- [(outer, inner, 0, fusedFunName)]</span><span>
</span><span id="line-1331"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#fuse"><span class="hs-identifier hs-type">fuse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1332"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1333"></span><span id="fuse"><span class="annot"><span class="annottext">fuse :: DDefs Ty1
-&gt; FunDefs1
-&gt; Var
-&gt; Var
-&gt; [(Var, Var, Int, Var)]
-&gt; PassM (Bool, Var, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#fuse"><span class="hs-identifier hs-var hs-var">fuse</span></a></span></span><span> </span><span id="local-6989586621680984506"><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984506"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680984507"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984507"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span>  </span><span id="local-6989586621680984508"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984508"><span class="hs-identifier hs-var">innerVar</span></a></span></span><span>  </span><span id="local-6989586621680984509"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984509"><span class="hs-identifier hs-var">outerVar</span></a></span></span><span> </span><span id="local-6989586621680984510"><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984510"><span class="hs-identifier hs-var">prevFusedFuncs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1334"></span><span>    </span><span id="local-6989586621680984511"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984511"><span class="hs-identifier hs-var">innerFunc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#freshFunction"><span class="hs-identifier hs-var">freshFunction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984507"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984508"><span class="hs-identifier hs-var">innerVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1335"></span><span>    </span><span id="local-6989586621680984512"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984512"><span class="hs-identifier hs-var">outerFunc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#freshFunction"><span class="hs-identifier hs-var">freshFunction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984507"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984509"><span class="hs-identifier hs-var">outerVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1336"></span><span>
</span><span id="line-1337"></span><span>    </span><span id="local-6989586621680984513"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680984513"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM Config
forall (m :: * -&gt; *). MonadReader Config m =&gt; m Config
</span><a href="Gibbon.Common.html#getGibbonConfig"><span class="hs-identifier hs-var">getGibbonConfig</span></a></span><span>
</span><span id="line-1338"></span><span>    </span><span id="local-6989586621680984515"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984515"><span class="hs-identifier hs-var">newName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Config -&gt; Int
</span><a href="Gibbon.Common.html#verbosity"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621680984513"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1339"></span><span>            </span><span class="hs-keyword">then</span><span>  </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_FUS_f_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984509"><span class="hs-identifier hs-var">outerVar</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_f_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1340"></span><span>                    </span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984508"><span class="hs-identifier hs-var">innerVar</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_FUS_&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;_FUSE_&quot;</span></span><span>
</span><span id="line-1342"></span><span>
</span><span id="line-1343"></span><span>    </span><span id="local-6989586621680984517"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984517"><span class="hs-identifier hs-var">step1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#inline2"><span class="hs-identifier hs-var">inline2</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984511"><span class="hs-identifier hs-var">innerFunc</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984512"><span class="hs-identifier hs-var">outerFunc</span></a></span><span>
</span><span id="line-1344"></span><span>      </span><span class="hs-comment">-- `debug`</span><span>
</span><span id="line-1345"></span><span>      </span><span class="hs-comment">--   (&quot;newName is :&quot; L.++ (show newName)  L.++ &quot;\ninner: &quot; L.++ (render (pprint innerFunc)) L.++ &quot;outer: &quot; L.++ (render (pprint outerFunc)) )</span><span>
</span><span id="line-1346"></span><span>
</span><span id="line-1347"></span><span>    </span><span id="local-6989586621680984518"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984518"><span class="hs-identifier hs-var">step2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; PassM FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#freshFunction"><span class="hs-identifier hs-var">freshFunction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyCases"><span class="hs-identifier hs-var">simplifyCases</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984517"><span class="hs-identifier hs-var">step1</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">{</span><span class="annot"><span class="annottext">funName :: Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984515"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1348"></span><span>                </span><span class="hs-comment">-- `debug` (&quot;newName is :&quot; L.++ (show newName)   L.++ render (pprint step1))</span><span>
</span><span id="line-1349"></span><span>    </span><span id="local-6989586621680984519"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984519"><span class="hs-identifier hs-var">newBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; PassM Exp1
</span><a href="Gibbon.Passes.Fusion2.html#inlineConstructorConsumers"><span class="hs-identifier hs-var">inlineConstructorConsumers</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984507"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984518"><span class="hs-identifier hs-var">step2</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1350"></span><span>                    </span><span class="hs-comment">--  `debug` (&quot;newName is :&quot; L.++ (show newName)   L.++ render (pprint step2))</span><span>
</span><span id="line-1351"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984520"><span class="annot"><span class="annottext">step2' :: FunDef1
</span><a href="#local-6989586621680984520"><span class="hs-identifier hs-var hs-var">step2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984518"><span class="hs-identifier hs-var">step2</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984519"><span class="hs-identifier hs-var">newBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1352"></span><span>                        </span><span class="hs-comment">--  `debug` (&quot;newName is :&quot; L.++ (show newName)   L.++ render (pprint   newBody))</span><span>
</span><span id="line-1353"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984521"><span class="annot"><span class="annottext">step3 :: FunDef1
</span><a href="#local-6989586621680984521"><span class="hs-identifier hs-var hs-var">step3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var) -&gt; FunDef1 -&gt; FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCallsF"><span class="hs-identifier hs-var">foldFusedCallsF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984509"><span class="hs-identifier hs-var">outerVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984508"><span class="hs-identifier hs-var">innerVar</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984515"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984520"><span class="hs-identifier hs-var">step2'</span></a></span><span>
</span><span id="line-1354"></span><span>      </span><span class="hs-comment">--  `debug` (&quot;newName is :&quot; L.++ (show newName)   L.++ render (pprint   step2'))</span><span>
</span><span id="line-1355"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984522"><span class="annot"><span class="annottext">step4 :: FunDef1
</span><a href="#local-6989586621680984522"><span class="hs-identifier hs-var hs-var">step4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDef1 -&gt; (Var, Var, Int, Var) -&gt; FunDef1)
-&gt; FunDef1 -&gt; [(Var, Var, Int, Var)] -&gt; FunDef1
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Var, Var, Int, Var) -&gt; FunDef1 -&gt; FunDef1)
-&gt; FunDef1 -&gt; (Var, Var, Int, Var) -&gt; FunDef1
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var) -&gt; FunDef1 -&gt; FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCallsF"><span class="hs-identifier hs-var">foldFusedCallsF</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984521"><span class="hs-identifier hs-var">step3</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984510"><span class="hs-identifier hs-var">prevFusedFuncs</span></a></span><span>
</span><span id="line-1356"></span><span>        </span><span class="hs-comment">-- `debug`   (&quot;newName is :&quot; L.++ (show newName)   L.++ render (pprint step3))</span><span>
</span><span id="line-1357"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984523"><span class="annot"><span class="annottext">step5 :: FunDef1
</span><a href="#local-6989586621680984523"><span class="hs-identifier hs-var hs-var">step5</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984522"><span class="hs-identifier hs-var">step4</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984522"><span class="hs-identifier hs-var">step4</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-1358"></span><span>                </span><span class="annot"><span class="annottext">FunDef1 -&gt; String -&gt; FunDef1
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newName is :&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984515"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/pretty-1.1.3.6/src/Text.PrettyPrint.HughesPJ.html#render"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Doc
forall e. Pretty e =&gt; e -&gt; Doc
</span><a href="Gibbon.Pretty.html#pprint"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984522"><span class="hs-identifier hs-var">step4</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1359"></span><span>    </span><span class="hs-keyword">if</span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs1 -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984515"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984507"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1360"></span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Bool, Var, FunDefs1) -&gt; PassM (Bool, Var, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984515"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984507"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span class="hs-comment">-- `debug1` (&quot;WE ARE FASTER&quot;)</span><span>
</span><span id="line-1361"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Bool, Var, FunDefs1) -&gt; PassM (Bool, Var, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984515"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984515"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984523"><span class="hs-identifier hs-var">step5</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984507"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1362"></span><span>
</span><span id="line-1363"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#violateRestrictions"><span class="hs-identifier hs-type">violateRestrictions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1364"></span><span id="violateRestrictions"><span class="annot"><span class="annottext">violateRestrictions :: FunDefs1 -&gt; Var -&gt; Var -&gt; Int -&gt; Bool
</span><a href="Gibbon.Passes.Fusion2.html#violateRestrictions"><span class="hs-identifier hs-var hs-var">violateRestrictions</span></a></span></span><span> </span><span id="local-6989586621680984546"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984546"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984547"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984547"><span class="hs-identifier hs-var">inner</span></a></span></span><span> </span><span id="local-6989586621680984548"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984548"><span class="hs-identifier hs-var">outer</span></a></span></span><span> </span><span id="local-6989586621680984549"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984549"><span class="hs-identifier hs-var">depth</span></a></span></span><span class="hs-glyph">=</span><span>
</span><span id="line-1365"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984550"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984550"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984551"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984551"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">String -&gt; (Int, Int)
</span><a href="Gibbon.Passes.Fusion2.html#countFUS"><span class="hs-identifier hs-var">countFUS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984547"><span class="hs-identifier hs-var">inner</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_FUS&quot;</span></span><span>  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984548"><span class="hs-identifier hs-var">outer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1366"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- should be configurable</span><span>
</span><span id="line-1367"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984552"><span class="annot"><span class="annottext">p0 :: Bool
</span><a href="#local-6989586621680984552"><span class="hs-identifier hs-var hs-var">p0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">--False</span><span>
</span><span id="line-1368"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984550"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984551"><span class="hs-identifier hs-var">m</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984549"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span class="hs-special">)</span><span>
</span><span id="line-1369"></span><span>      </span><span class="hs-comment">-- n&gt;1 || depth&gt;10</span><span>
</span><span id="line-1370"></span><span>  </span><span class="hs-comment">-- (depth&gt;6) &amp;&amp;</span><span>
</span><span id="line-1371"></span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span>    </span><span class="hs-comment">--    `debug` ( &quot;n is &quot; L.++ (show n) L.++ &quot;for&quot; L.++ (show inner ) L.++ (show outer))</span><span>
</span><span id="line-1374"></span><span>     </span><span class="hs-keyword">in</span><span>
</span><span id="line-1375"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984554"><span class="annot"><span class="annottext">innerDef :: FunDef1
</span><a href="#local-6989586621680984554"><span class="hs-identifier hs-var hs-var">innerDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1376"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs1 -&gt; Maybe FunDef1
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984547"><span class="hs-identifier hs-var">inner</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984546"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1377"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680984555"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984555"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984555"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1378"></span><span>      </span><span id="local-6989586621680984556"><span class="annot"><span class="annottext">outerDef :: FunDef1
</span><a href="#local-6989586621680984556"><span class="hs-identifier hs-var hs-var">outerDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1379"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs1 -&gt; Maybe FunDef1
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984548"><span class="hs-identifier hs-var">outer</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984546"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1380"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680984557"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984557"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984557"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1381"></span><span>      </span><span id="local-6989586621680984558"><span class="annot"><span class="annottext">p1 :: Bool
</span><a href="#local-6989586621680984558"><span class="hs-identifier hs-var hs-var">p1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1382"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984554"><span class="hs-identifier hs-var">innerDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1383"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Ty1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984554"><span class="hs-identifier hs-var">innerDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1384"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1385"></span><span>                 </span><span id="local-6989586621680984559"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680984559"><span class="hs-identifier hs-var">x</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1386"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1387"></span><span>      </span><span id="local-6989586621680984560"><span class="annot"><span class="annottext">p2 :: Bool
</span><a href="#local-6989586621680984560"><span class="hs-identifier hs-var hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1388"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984554"><span class="hs-identifier hs-var">innerDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1389"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Ty1
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984556"><span class="hs-identifier hs-var">outerDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1390"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1391"></span><span>                 </span><span id="local-6989586621680984561"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680984561"><span class="hs-identifier hs-var">x</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1392"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1393"></span><span>      </span><span id="local-6989586621680984562"><span class="annot"><span class="annottext">p3 :: Bool
</span><a href="#local-6989586621680984562"><span class="hs-identifier hs-var hs-var">p3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1394"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984554"><span class="hs-identifier hs-var">innerDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1395"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680984563"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984563"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1396"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span>
</span><span id="line-1397"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; Bool -&gt; Bool)
-&gt; Bool -&gt; [(String, [(Var, ())], Exp1)] -&gt; Bool
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">L.foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984564"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984564"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984565"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984565"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984565"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Bool
</span><a href="Gibbon.Passes.Fusion2.html#hasConstructorTail"><span class="hs-identifier hs-var">hasConstructorTail</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984564"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984563"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1398"></span><span>          </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1399"></span><span>      </span><span id="local-6989586621680984566"><span class="annot"><span class="annottext">p4 :: Bool
</span><a href="#local-6989586621680984566"><span class="hs-identifier hs-var hs-var">p4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1400"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984556"><span class="hs-identifier hs-var">outerDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1401"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1402"></span><span>          </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1403"></span><span>      </span><span id="local-6989586621680984567"><span class="annot"><span class="annottext">p5 :: Bool
</span><a href="#local-6989586621680984567"><span class="hs-identifier hs-var hs-var">p5</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1404"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984554"><span class="hs-identifier hs-var">innerDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1405"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1406"></span><span>          </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1407"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984552"><span class="hs-identifier hs-var">p0</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984558"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984560"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984566"><span class="hs-identifier hs-var">p4</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984567"><span class="hs-identifier hs-var">p5</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1408"></span><span>
</span><span id="line-1409"></span><span class="hs-keyword">type</span><span> </span><span id="FusedElement"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FusedElement"><span class="hs-identifier hs-var">FusedElement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1410"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- outer fused function</span><span>
</span><span id="line-1411"></span><span>   </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Inner fused function</span><span>
</span><span id="line-1412"></span><span>   </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- position at which inner is consumed</span><span>
</span><span id="line-1413"></span><span>   </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-comment">-- the name of the fused function</span><span>
</span><span id="line-1414"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-1415"></span><span>
</span><span id="line-1416"></span><span class="hs-keyword">type</span><span> </span><span id="TransformReturn"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#TransformReturn"><span class="hs-identifier hs-var">TransformReturn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1417"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">--transformed expression</span><span>
</span><span id="line-1418"></span><span>   </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- updates functions stores</span><span>
</span><span id="line-1419"></span><span>   </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FusedElement"><span class="hs-identifier hs-type">FusedElement</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- list of functions that are fused during the transformation</span><span>
</span><span id="line-1420"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-1421"></span><span>
</span><span id="line-1422"></span><span class="hs-keyword">data</span><span> </span><span id="FusePassParams"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FusePassParams"><span class="hs-identifier hs-var">FusePassParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span id="FusePassParams"><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FusePassParams"><span class="hs-identifier hs-var">FusePassParams</span></a></span></span><span>
</span><span id="line-1423"></span><span> </span><span class="hs-special">{</span><span> </span><span id="exp"><span class="annot"><span class="annottext">FusePassParams -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#exp"><span class="hs-identifier hs-var hs-var">exp</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- expression to transform</span><span>
</span><span id="line-1424"></span><span>   </span><span id="args"><span class="annot"><span class="annottext">FusePassParams -&gt; [Var]
</span><a href="Gibbon.Passes.Fusion2.html#args"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- arguments of the function that the transformed</span><span>
</span><span id="line-1425"></span><span>                            </span><span class="hs-comment">-- expression belongs to</span><span>
</span><span id="line-1426"></span><span>   </span><span id="fusedFunctions"><span class="annot"><span class="annottext">FusePassParams -&gt; [(Var, Var, Int, Var)]
</span><a href="Gibbon.Passes.Fusion2.html#fusedFunctions"><span class="hs-identifier hs-var hs-var">fusedFunctions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FusedElement"><span class="hs-identifier hs-type">FusedElement</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- already fused functions</span><span>
</span><span id="line-1427"></span><span>   </span><span id="skipList"><span class="annot"><span class="annottext">FusePassParams -&gt; [(Var, Var)]
</span><a href="Gibbon.Passes.Fusion2.html#skipList"><span class="hs-identifier hs-var hs-var">skipList</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- functions to skip for fusion purposes</span><span>
</span><span id="line-1428"></span><span>   </span><span id="depth"><span class="annot"><span class="annottext">FusePassParams -&gt; Int
</span><a href="Gibbon.Passes.Fusion2.html#depth"><span class="hs-identifier hs-var hs-var">depth</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-1429"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984576"><span id="local-6989586621680984591"><span id="local-6989586621680984595"><span class="annot"><span class="annottext">Int -&gt; FusePassParams -&gt; String -&gt; String
[FusePassParams] -&gt; String -&gt; String
FusePassParams -&gt; String
(Int -&gt; FusePassParams -&gt; String -&gt; String)
-&gt; (FusePassParams -&gt; String)
-&gt; ([FusePassParams] -&gt; String -&gt; String)
-&gt; Show FusePassParams
forall a.
(Int -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Int -&gt; FusePassParams -&gt; String -&gt; String
showsPrec :: Int -&gt; FusePassParams -&gt; String -&gt; String
$cshow :: FusePassParams -&gt; String
show :: FusePassParams -&gt; String
$cshowList :: [FusePassParams] -&gt; String -&gt; String
showList :: [FusePassParams] -&gt; String -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984599"><span id="local-6989586621680984601"><span class="annot"><span class="annottext">(forall x. FusePassParams -&gt; Rep FusePassParams x)
-&gt; (forall x. Rep FusePassParams x -&gt; FusePassParams)
-&gt; Generic FusePassParams
forall x. Rep FusePassParams x -&gt; FusePassParams
forall x. FusePassParams -&gt; Rep FusePassParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. FusePassParams -&gt; Rep FusePassParams x
from :: forall x. FusePassParams -&gt; Rep FusePassParams x
$cto :: forall x. Rep FusePassParams x -&gt; FusePassParams
to :: forall x. Rep FusePassParams x -&gt; FusePassParams
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1430"></span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#tuple_pass"><span class="hs-identifier hs-type">tuple_pass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1433"></span><span id="tuple_pass"><span class="annot"><span class="annottext">tuple_pass :: DDefs Ty1 -&gt; FunDefs1 -&gt; PassM FunDefs1
</span><a href="Gibbon.Passes.Fusion2.html#tuple_pass"><span class="hs-identifier hs-var hs-var">tuple_pass</span></a></span></span><span> </span><span id="local-6989586621680984619"><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984619"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680984620"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984620"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1434"></span><span>    </span><span class="annot"><span class="annottext">(FunDefs1 -&gt; FunDef1 -&gt; PassM FunDefs1)
-&gt; FunDefs1 -&gt; FunDefs1 -&gt; PassM FunDefs1
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDef1 -&gt; PassM FunDefs1
</span><a href="#local-6989586621680984622"><span class="hs-identifier hs-var">tupleFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984620"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984620"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1435"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1436"></span><span>   </span><span id="local-6989586621680984622"><span class="annot"><span class="annottext">tupleFunction :: FunDefs1 -&gt; FunDef1 -&gt; PassM FunDefs1
</span><a href="#local-6989586621680984622"><span class="hs-identifier hs-var hs-var">tupleFunction</span></a></span></span><span> </span><span id="local-6989586621680984623"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984623"><span class="hs-identifier hs-var">defs'</span></a></span></span><span> </span><span id="local-6989586621680984624"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984624"><span class="hs-identifier hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-1437"></span><span>    </span><span class="hs-keyword">do</span><span>
</span><span id="line-1438"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984625"><span class="annot"><span class="annottext">fName :: Var
</span><a href="#local-6989586621680984625"><span class="hs-identifier hs-var hs-var">fName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984624"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1439"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">L.isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_FUS&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984625"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span>  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">L.isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_TUP&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984625"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1440"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1441"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680984627"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984627"><span class="hs-identifier hs-var">tupledBody</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984628"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984628"><span class="hs-identifier hs-var">tupleDefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; [Var] -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tuple_entry"><span class="hs-identifier hs-var">tuple_entry</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984619"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984620"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984624"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984624"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">PassM (Exp1, FunDefs1) -&gt; String -&gt; PassM (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;run tuple for&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984624"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984629"><span class="annot"><span class="annottext">defs'' :: FunDefs1
</span><a href="#local-6989586621680984629"><span class="hs-identifier hs-var hs-var">defs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984625"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984624"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984627"><span class="hs-identifier hs-var">tupledBody</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984623"><span class="hs-identifier hs-var">defs'</span></a></span><span>
</span><span id="line-1443"></span><span>          </span><span class="annot"><span class="annottext">FunDefs1 -&gt; PassM FunDefs1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984629"><span class="hs-identifier hs-var">defs''</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984628"><span class="hs-identifier hs-var">tupleDefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1446"></span><span>          </span><span class="annot"><span class="annottext">FunDefs1 -&gt; PassM FunDefs1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984623"><span class="hs-identifier hs-var">defs'</span></a></span><span>
</span><span id="line-1447"></span><span>
</span><span id="line-1448"></span><span>
</span><span id="line-1449"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#fuse_pass"><span class="hs-identifier hs-type">fuse_pass</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FusePassParams"><span class="hs-identifier hs-type">FusePassParams</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#TransformReturn"><span class="hs-identifier hs-type">TransformReturn</span></a></span><span>
</span><span id="line-1450"></span><span id="fuse_pass"><span class="annot"><span class="annottext">fuse_pass :: DDefs Ty1 -&gt; FunDefs1 -&gt; FusePassParams -&gt; PassM TransformReturn
</span><a href="Gibbon.Passes.Fusion2.html#fuse_pass"><span class="hs-identifier hs-var hs-var">fuse_pass</span></a></span></span><span> </span><span id="local-6989586621680984648"><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984648"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680984649"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984649"><span class="hs-identifier hs-var">funDefs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#FusePassParams"><span class="hs-identifier hs-type">FusePassParams</span></a></span><span> </span><span id="local-6989586621680984650"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984650"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680984651"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680984651"><span class="hs-identifier hs-var">argsVars</span></a></span></span><span> </span><span id="local-6989586621680984652"><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984652"><span class="hs-identifier hs-var">fusedFunctions</span></a></span></span><span> </span><span id="local-6989586621680984653"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984653"><span class="hs-identifier hs-var">skipList</span></a></span></span><span> </span><span id="local-6989586621680984654"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984654"><span class="hs-identifier hs-var">depth</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1451"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984654"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10000</span></span><span class="hs-comment">-- then first fold before going back</span><span>
</span><span id="line-1452"></span><span>   </span><span class="hs-keyword">then</span><span>  </span><span class="annot"><span class="annottext">TransformReturn -&gt; PassM TransformReturn
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984650"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984649"><span class="hs-identifier hs-var">funDefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984652"><span class="hs-identifier hs-var">fusedFunctions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1453"></span><span>   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp1
-&gt; [(Var, Var)]
-&gt; FunDefs1
-&gt; [(Var, Var, Int, Var)]
-&gt; PassM TransformReturn
</span><a href="#local-6989586621680984655"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984650"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984653"><span class="hs-identifier hs-var">skipList</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984649"><span class="hs-identifier hs-var">funDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984652"><span class="hs-identifier hs-var">fusedFunctions</span></a></span><span>
</span><span id="line-1454"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1455"></span><span>  </span><span id="local-6989586621680984655"><span class="annot"><span class="annottext">go :: Exp1
-&gt; [(Var, Var)]
-&gt; FunDefs1
-&gt; [(Var, Var, Int, Var)]
-&gt; PassM TransformReturn
</span><a href="#local-6989586621680984655"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680984656"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984656"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621680984657"><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984657"><span class="hs-identifier hs-var">processed</span></a></span></span><span> </span><span id="local-6989586621680984658"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984658"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984659"><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984659"><span class="hs-identifier hs-var">prevFusedFuncs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1456"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984660"><span class="annot"><span class="annottext">defTable :: DefTable
</span><a href="#local-6989586621680984660"><span class="hs-identifier hs-var hs-var">defTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; DefTable
</span><a href="Gibbon.Passes.Fusion2.html#buildDefTable"><span class="hs-identifier hs-var">buildDefTable</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984656"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1457"></span><span>        </span><span id="local-6989586621680984661"><span class="annot"><span class="annottext">potential :: Maybe ((Var, Var), Maybe Symbol)
</span><a href="#local-6989586621680984661"><span class="hs-identifier hs-var hs-var">potential</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefTable -&gt; [(Var, Var)] -&gt; Maybe ((Var, Var), Maybe Symbol)
</span><a href="Gibbon.Passes.Fusion2.html#findPotential"><span class="hs-identifier hs-var">findPotential</span></a></span><span> </span><span class="annot"><span class="annottext">DefTable
</span><a href="#local-6989586621680984660"><span class="hs-identifier hs-var">defTable</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984657"><span class="hs-identifier hs-var">processed</span></a></span><span>
</span><span id="line-1458"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ((Var, Var), Maybe Symbol)
</span><a href="#local-6989586621680984661"><span class="hs-identifier hs-var">potential</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1459"></span><span>      </span><span class="annot"><span class="annottext">Maybe ((Var, Var), Maybe Symbol)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1460"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984662"><span class="annot"><span class="annottext">final_clean :: Exp1
</span><a href="#local-6989586621680984662"><span class="hs-identifier hs-var hs-var">final_clean</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984656"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1461"></span><span>        </span><span class="annot"><span class="annottext">TransformReturn -&gt; PassM TransformReturn
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984662"><span class="hs-identifier hs-var">final_clean</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984658"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984659"><span class="hs-identifier hs-var">prevFusedFuncs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1462"></span><span>
</span><span id="line-1463"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680984663"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984663"><span class="hs-identifier hs-var">inner</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680984664"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984664"><span class="hs-identifier hs-var">outer</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984665"><span class="annot"><span class="annottext">Maybe Symbol
</span><a href="#local-6989586621680984665"><span class="hs-identifier hs-var">outerDefVarSymbol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1464"></span><span>       </span><span class="hs-keyword">do</span><span>
</span><span id="line-1465"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; Var -&gt; Int -&gt; Bool
</span><a href="Gibbon.Passes.Fusion2.html#violateRestrictions"><span class="hs-identifier hs-var">violateRestrictions</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984658"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984663"><span class="hs-identifier hs-var">inner</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984664"><span class="hs-identifier hs-var">outer</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984654"><span class="hs-identifier hs-var">depth</span></a></span><span>
</span><span id="line-1466"></span><span>          </span><span class="hs-keyword">then</span><span>
</span><span id="line-1467"></span><span>               </span><span class="annot"><span class="annottext">Exp1
-&gt; [(Var, Var)]
-&gt; FunDefs1
-&gt; [(Var, Var, Int, Var)]
-&gt; PassM TransformReturn
</span><a href="#local-6989586621680984655"><span class="hs-identifier hs-var">go</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984656"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984663"><span class="hs-identifier hs-var">inner</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984664"><span class="hs-identifier hs-var">outer</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Var, Var) -&gt; [(Var, Var)] -&gt; [(Var, Var)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984657"><span class="hs-identifier hs-var">processed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984658"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984659"><span class="hs-identifier hs-var">prevFusedFuncs</span></a></span><span>
</span><span id="line-1468"></span><span>             </span><span class="hs-comment">--   `debug1` (&quot;cant fuse &quot;L.++ (show (inner,outer)))</span><span>
</span><span id="line-1469"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1470"></span><span>             </span><span class="hs-comment">-- fuse</span><span>
</span><span id="line-1471"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680984666"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984666"><span class="hs-identifier hs-var">validFused</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984667"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984667"><span class="hs-identifier hs-var">fNew</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984668"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984668"><span class="hs-identifier hs-var">fusedDefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1472"></span><span>               </span><span class="annot"><span class="annottext">DDefs Ty1
-&gt; FunDefs1
-&gt; Var
-&gt; Var
-&gt; [(Var, Var, Int, Var)]
-&gt; PassM (Bool, Var, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#fuse"><span class="hs-identifier hs-var">fuse</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984648"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984658"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984663"><span class="hs-identifier hs-var">inner</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984664"><span class="hs-identifier hs-var">outer</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984659"><span class="hs-identifier hs-var">prevFusedFuncs</span></a></span><span>
</span><span id="line-1473"></span><span>
</span><span id="line-1474"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984669"><span class="annot"><span class="annottext">fusedFunction :: FunDef1
</span><a href="#local-6989586621680984669"><span class="hs-identifier hs-var hs-var">fusedFunction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984668"><span class="hs-identifier hs-var">fusedDefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984667"><span class="hs-identifier hs-var">fNew</span></a></span><span>
</span><span id="line-1475"></span><span>              </span><span class="hs-comment">--   `debug1` (&quot;new fused function generated at depth &quot; L.++ (show depth) L.++ (render (pprint (fusedDefs M.! fNew ))))</span><span>
</span><span id="line-1476"></span><span>
</span><span id="line-1477"></span><span>             </span><span class="hs-comment">--`debug` (&quot;new fused:&quot; L.++ (</span><span>
</span><span id="line-1478"></span><span>               </span><span class="hs-comment">--  render (pprint ( fusedDefs M.! fNew  ))))</span><span>
</span><span id="line-1479"></span><span>                </span><span id="local-6989586621680984670"><span class="annot"><span class="annottext">newFusedEntry :: (Var, Var, Int, Var)
</span><a href="#local-6989586621680984670"><span class="hs-identifier hs-var hs-var">newFusedEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984664"><span class="hs-identifier hs-var">outer</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984663"><span class="hs-identifier hs-var">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984667"><span class="hs-identifier hs-var">fNew</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1480"></span><span>                </span><span id="local-6989586621680984671"><span class="annot"><span class="annottext">newFusedFunctions :: [(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984671"><span class="hs-identifier hs-var hs-var">newFusedFunctions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(Var, Var, Int, Var)
</span><a href="#local-6989586621680984670"><span class="hs-identifier hs-var">newFusedEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var)
-&gt; [(Var, Var, Int, Var)] -&gt; [(Var, Var, Int, Var)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984659"><span class="hs-identifier hs-var">prevFusedFuncs</span></a></span><span>
</span><span id="line-1481"></span><span>                </span><span id="local-6989586621680984672"><span class="annot"><span class="annottext">newProcessed :: [(Var, Var)]
</span><a href="#local-6989586621680984672"><span class="hs-identifier hs-var hs-var">newProcessed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984663"><span class="hs-identifier hs-var">inner</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984664"><span class="hs-identifier hs-var">outer</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Var, Var) -&gt; [(Var, Var)] -&gt; [(Var, Var)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984657"><span class="hs-identifier hs-var">processed</span></a></span><span>
</span><span id="line-1482"></span><span>
</span><span id="line-1483"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680984673"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984673"><span class="hs-identifier hs-var">retFuncBody</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984674"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984674"><span class="hs-identifier hs-var">retFunDefs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984675"><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984675"><span class="hs-identifier hs-var">retFusedFunctions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty1 -&gt; FunDefs1 -&gt; FusePassParams -&gt; PassM TransformReturn
</span><a href="Gibbon.Passes.Fusion2.html#fuse_pass"><span class="hs-identifier hs-var">fuse_pass</span></a></span><span>  </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984648"><span class="hs-identifier hs-var">ddefs</span></a></span><span>
</span><span id="line-1484"></span><span>              </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984668"><span class="hs-identifier hs-var">fusedDefs</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
-&gt; [Var]
-&gt; [(Var, Var, Int, Var)]
-&gt; [(Var, Var)]
-&gt; Int
-&gt; FusePassParams
</span><a href="Gibbon.Passes.Fusion2.html#FusePassParams"><span class="hs-identifier hs-var">FusePassParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984669"><span class="hs-identifier hs-var">fusedFunction</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984669"><span class="hs-identifier hs-var">fusedFunction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1485"></span><span>                </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984671"><span class="hs-identifier hs-var">newFusedFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984672"><span class="hs-identifier hs-var">newProcessed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984654"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1486"></span><span>
</span><span id="line-1487"></span><span>            </span><span class="hs-comment">--clean</span><span>
</span><span id="line-1488"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984676"><span class="annot"><span class="annottext">newFusedFunctions2 :: [(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984676"><span class="hs-identifier hs-var hs-var">newFusedFunctions2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984675"><span class="hs-identifier hs-var">retFusedFunctions</span></a></span><span>
</span><span id="line-1489"></span><span>              </span><span class="hs-comment">--   (newFusedEntry : prevFusedFuncs) L.++ retFusedFunctions</span><span>
</span><span id="line-1490"></span><span>                </span><span id="local-6989586621680984677"><span class="annot"><span class="annottext">cleanedFunction :: FunDef1
</span><a href="#local-6989586621680984677"><span class="hs-identifier hs-var hs-var">cleanedFunction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1491"></span><span>                    </span><span class="annot"><span class="annottext">FunDef1 -&gt; FunDef1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefs"><span class="hs-identifier hs-var">removeUnusedDefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984669"><span class="hs-identifier hs-var">fusedFunction</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984673"><span class="hs-identifier hs-var">retFuncBody</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1492"></span><span>                </span><span id="local-6989586621680984678"><span class="annot"><span class="annottext">fdefs_tmp2 :: FunDefs1
</span><a href="#local-6989586621680984678"><span class="hs-identifier hs-var hs-var">fdefs_tmp2</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984668"><span class="hs-identifier hs-var">fusedDefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984674"><span class="hs-identifier hs-var">retFunDefs</span></a></span><span>
</span><span id="line-1493"></span><span>                </span><span id="local-6989586621680984679"><span class="annot"><span class="annottext">fdefs_tmp3 :: FunDefs1
</span><a href="#local-6989586621680984679"><span class="hs-identifier hs-var hs-var">fdefs_tmp3</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span>  </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984667"><span class="hs-identifier hs-var">fNew</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984677"><span class="hs-identifier hs-var">cleanedFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984678"><span class="hs-identifier hs-var">fdefs_tmp2</span></a></span><span>
</span><span id="line-1494"></span><span>                </span><span id="local-6989586621680984680"><span class="annot"><span class="annottext">newDefs :: FunDefs1
</span><a href="#local-6989586621680984680"><span class="hs-identifier hs-var hs-var">newDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984658"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984679"><span class="hs-identifier hs-var">fdefs_tmp3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1495"></span><span>
</span><span id="line-1496"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984681"><span class="annot"><span class="annottext">foldedBody :: Exp1
</span><a href="#local-6989586621680984681"><span class="hs-identifier hs-var hs-var">foldedBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, Var, Int, Var) -&gt; Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#foldFusedCalls_Entry"><span class="hs-identifier hs-var">foldFusedCalls_Entry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984664"><span class="hs-identifier hs-var">outer</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984663"><span class="hs-identifier hs-var">inner</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984667"><span class="hs-identifier hs-var">fNew</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984656"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1497"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984666"><span class="hs-identifier hs-var">validFused</span></a></span><span>
</span><span id="line-1498"></span><span>              </span><span class="hs-keyword">then</span><span>
</span><span id="line-1499"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984682"><span class="annot"><span class="annottext">body' :: Exp1
</span><a href="#local-6989586621680984682"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984681"><span class="hs-identifier hs-var">foldedBody</span></a></span><span>
</span><span id="line-1500"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1
-&gt; [(Var, Var)]
-&gt; FunDefs1
-&gt; [(Var, Var, Int, Var)]
-&gt; PassM TransformReturn
</span><a href="#local-6989586621680984655"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984682"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984672"><span class="hs-identifier hs-var">newProcessed</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984680"><span class="hs-identifier hs-var">newDefs</span></a></span><span>  </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984676"><span class="hs-identifier hs-var">newFusedFunctions2</span></a></span><span>
</span><span id="line-1501"></span><span>              </span><span class="hs-keyword">else</span><span>
</span><span id="line-1502"></span><span>                 </span><span class="annot"><span class="annottext">Exp1
-&gt; [(Var, Var)]
-&gt; FunDefs1
-&gt; [(Var, Var, Int, Var)]
-&gt; PassM TransformReturn
</span><a href="#local-6989586621680984655"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984656"><span class="hs-identifier hs-var">body</span></a></span><span>  </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680984672"><span class="hs-identifier hs-var">newProcessed</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984658"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984659"><span class="hs-identifier hs-var">prevFusedFuncs</span></a></span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#tupleAndOptimize"><span class="hs-identifier hs-type">tupleAndOptimize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Ty1"><span class="hs-identifier hs-type">Ty1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1505"></span><span id="tupleAndOptimize"><span class="annot"><span class="annottext">tupleAndOptimize :: DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tupleAndOptimize"><span class="hs-identifier hs-var hs-var">tupleAndOptimize</span></a></span></span><span> </span><span id="local-6989586621680984702"><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984702"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680984703"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984703"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984704"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984704"><span class="hs-identifier hs-var">mainExp</span></a></span></span><span> </span><span id="local-6989586621680984705"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984705"><span class="hs-identifier hs-var">firstTime</span></a></span></span><span>  </span><span id="local-6989586621680984706"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984706"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1506"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1507"></span><span>    </span><span id="local-6989586621680984707"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984707"><span class="hs-identifier hs-var">newDefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty1 -&gt; FunDefs1 -&gt; PassM FunDefs1
</span><a href="Gibbon.Passes.Fusion2.html#tuple_pass"><span class="hs-identifier hs-var">tuple_pass</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984702"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984703"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1508"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984706"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984705"><span class="hs-identifier hs-var">firstTime</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984707"><span class="hs-identifier hs-var">newDefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDefs1 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984703"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1509"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; PassM (Exp1, FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984704"><span class="hs-identifier hs-var">mainExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984707"><span class="hs-identifier hs-var">newDefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1510"></span><span>      </span><span class="hs-keyword">else</span><span>  </span><span class="hs-comment">--return newDefs</span><span>
</span><span id="line-1511"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984708"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984708"><span class="hs-identifier hs-var">mainExp'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984709"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984709"><span class="hs-identifier hs-var">fdefs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; Int -&gt; (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#redundancy_output_pass"><span class="hs-identifier hs-var">redundancy_output_pass</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984707"><span class="hs-identifier hs-var">newDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984704"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984705"><span class="hs-identifier hs-var">firstTime</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1512"></span><span>        </span><span class="annot"><span class="annottext">DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tupleAndOptimize"><span class="hs-identifier hs-var">tupleAndOptimize</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
</span><a href="#local-6989586621680984702"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984709"><span class="hs-identifier hs-var">fdefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984708"><span class="hs-identifier hs-var">mainExp'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984706"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1513"></span><span>              </span><span class="annot"><span class="annottext">PassM (Exp1, FunDefs1) -&gt; String -&gt; PassM (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;run new tuple round&quot;</span></span><span>
</span><span id="line-1514"></span><span>
</span><span id="line-1515"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#fusion2"><span class="hs-identifier hs-type">fusion2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Prog1"><span class="hs-identifier hs-type">Prog1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Prog1"><span class="hs-identifier hs-type">Prog1</span></a></span><span>
</span><span id="line-1516"></span><span id="fusion2"><span class="annot"><span class="annottext">fusion2 :: Prog1 -&gt; PassM Prog1
</span><a href="Gibbon.Passes.Fusion2.html#fusion2"><span class="hs-identifier hs-var hs-var">fusion2</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">L1.Prog</span></a></span><span> </span><span id="local-6989586621680984719"><span class="annot"><span class="annottext">DDefs (TyOf Exp1)
</span><a href="#local-6989586621680984719"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span id="local-6989586621680984720"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984720"><span class="hs-identifier hs-var">funs</span></a></span></span><span> </span><span id="local-6989586621680984721"><span class="annot"><span class="annottext">Maybe (Exp1, TyOf Exp1)
</span><a href="#local-6989586621680984721"><span class="hs-identifier hs-var">main</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1517"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680984722"><span class="annot"><span class="annottext">Maybe (Exp1, Ty1)
</span><a href="#local-6989586621680984722"><span class="hs-identifier hs-var">main'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984723"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984723"><span class="hs-identifier hs-var">funs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1518"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp1, TyOf Exp1)
</span><a href="#local-6989586621680984721"><span class="hs-identifier hs-var">main</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1519"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Exp1, TyOf Exp1)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe (Exp1, Ty1), FunDefs1)
-&gt; PassM (Maybe (Exp1, Ty1), FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Exp1, Ty1)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984720"><span class="hs-identifier hs-var">funs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1520"></span><span>      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984724"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984724"><span class="hs-identifier hs-var">mainBody</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984725"><span class="annot"><span class="annottext">TyOf Exp1
</span><a href="#local-6989586621680984725"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1521"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680984726"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984726"><span class="hs-identifier hs-var">mainBody'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984727"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984727"><span class="hs-identifier hs-var">newDefs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984728"><span class="annot"><span class="annottext">[(Var, Var, Int, Var)]
</span><a href="#local-6989586621680984728"><span class="hs-identifier hs-var">fuseInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1522"></span><span>          </span><span class="annot"><span class="annottext">DDefs Ty1 -&gt; FunDefs1 -&gt; FusePassParams -&gt; PassM TransformReturn
</span><a href="Gibbon.Passes.Fusion2.html#fuse_pass"><span class="hs-identifier hs-var">fuse_pass</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp1)
DDefs Ty1
</span><a href="#local-6989586621680984719"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984720"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
-&gt; [Var]
-&gt; [(Var, Var, Int, Var)]
-&gt; [(Var, Var)]
-&gt; Int
-&gt; FusePassParams
</span><a href="Gibbon.Passes.Fusion2.html#FusePassParams"><span class="hs-identifier hs-var">FusePassParams</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984724"><span class="hs-identifier hs-var">mainBody</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1523"></span><span>        </span><span class="hs-comment">-- let newDefs' = M.map</span><span>
</span><span id="line-1524"></span><span>        </span><span class="hs-comment">--        (\fdef -&gt; if L.isPrefixOf &quot;_FUS&quot; (fromVar (funName fdef))</span><span>
</span><span id="line-1525"></span><span>        </span><span class="hs-comment">--                   then    L.foldl (flip foldFusedCallsF ) fdef fuseInfo</span><span>
</span><span id="line-1526"></span><span>        </span><span class="hs-comment">--                   else fdef</span><span>
</span><span id="line-1527"></span><span>        </span><span class="hs-comment">--        ) newDefs</span><span>
</span><span id="line-1528"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680984729"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984729"><span class="hs-identifier hs-var">mainBody''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984730"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984730"><span class="hs-identifier hs-var">newDefs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty1
-&gt; FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; Int -&gt; PassM (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#tupleAndOptimize"><span class="hs-identifier hs-var">tupleAndOptimize</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp1)
DDefs Ty1
</span><a href="#local-6989586621680984719"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984720"><span class="hs-identifier hs-var">funs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984727"><span class="hs-identifier hs-var">newDefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984726"><span class="hs-identifier hs-var">mainBody'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1529"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984731"><span class="annot"><span class="annottext">newDefs'' :: FunDefs1
</span><a href="#local-6989586621680984731"><span class="hs-identifier hs-var hs-var">newDefs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDef1 -&gt; Bool) -&gt; FunDefs1 -&gt; FunDefs1
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#filter"><span class="hs-identifier hs-var">M.filter</span></a></span><span>
</span><span id="line-1530"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680984733"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984733"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1531"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984733"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1532"></span><span>                      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1533"></span><span>                      </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1534"></span><span>                  </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984730"><span class="hs-identifier hs-var">newDefs'</span></a></span><span>
</span><span id="line-1535"></span><span>        </span><span class="annot"><span class="annottext">(Maybe (Exp1, Ty1), FunDefs1)
-&gt; PassM (Maybe (Exp1, Ty1), FunDefs1)
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp1, Ty1) -&gt; Maybe (Exp1, Ty1)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984729"><span class="hs-identifier hs-var">mainBody''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyOf Exp1
Ty1
</span><a href="#local-6989586621680984725"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984731"><span class="hs-identifier hs-var">newDefs''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1536"></span><span>        </span><span class="hs-comment">-- return (Just (mainBody', ty), newDefs)</span><span>
</span><span id="line-1537"></span><span>  </span><span class="annot"><span class="annottext">Prog1 -&gt; PassM Prog1
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog1 -&gt; PassM Prog1) -&gt; Prog1 -&gt; PassM Prog1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp1) -&gt; FunDefs1 -&gt; Maybe (Exp1, TyOf Exp1) -&gt; Prog1
forall ex.
DDefs (TyOf ex) -&gt; FunDefs ex -&gt; Maybe (ex, TyOf ex) -&gt; Prog ex
</span><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-var">L1.Prog</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp1)
</span><a href="#local-6989586621680984719"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984723"><span class="hs-identifier hs-var">funs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp1, TyOf Exp1)
Maybe (Exp1, Ty1)
</span><a href="#local-6989586621680984722"><span class="hs-identifier hs-var">main'</span></a></span><span>
</span><span id="line-1538"></span><span>
</span><span id="line-1539"></span><span>
</span><span id="line-1540"></span><span class="hs-comment">-- Those  functions are used for the redundancy analysis</span><span>
</span><span id="line-1541"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#redundancy_output_pass"><span class="hs-identifier hs-type">redundancy_output_pass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1542"></span><span id="redundancy_output_pass"><span class="annot"><span class="annottext">redundancy_output_pass :: FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; Int -&gt; (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#redundancy_output_pass"><span class="hs-identifier hs-var hs-var">redundancy_output_pass</span></a></span></span><span> </span><span id="local-6989586621680984746"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984746"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984747"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984747"><span class="hs-identifier hs-var">mainExp</span></a></span></span><span> </span><span id="local-6989586621680984748"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984748"><span class="hs-identifier hs-var">firstTime</span></a></span></span><span> </span><span id="local-6989586621680984749"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984749"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1543"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984750"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984750"><span class="hs-identifier hs-var">fdefs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984751"><span class="annot"><span class="annottext">Map Var (Map Int Int, Map Int Int, Var)
</span><a href="#local-6989586621680984751"><span class="hs-identifier hs-var">rules</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FunDefs1, Map Var (Map Int Int, Map Int Int, Var))
 -&gt; FunDef1 -&gt; (FunDefs1, Map Var (Map Int Int, Map Int Int, Var)))
-&gt; (FunDefs1, Map Var (Map Int Int, Map Int Int, Var))
-&gt; FunDefs1
-&gt; (FunDefs1, Map Var (Map Int Int, Map Int Int, Var))
forall a b k. (a -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldl"><span class="hs-identifier hs-var">M.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
-&gt; (FunDefs1, Map Var (Map Int Int, Map Int Int, Var))
-&gt; FunDef1
-&gt; (FunDefs1, Map Var (Map Int Int, Map Int Int, Var))
</span><a href="#local-6989586621680984753"><span class="hs-identifier hs-var">pass1F</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984746"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984746"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Var (Map Int Int, Map Int Int, Var)
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984746"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1544"></span><span>      </span><span id="local-6989586621680984754"><span class="annot"><span class="annottext">fdefs'' :: FunDefs1
</span><a href="#local-6989586621680984754"><span class="hs-identifier hs-var hs-var">fdefs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDefs1 -&gt; Var -&gt; (Map Int Int, Map Int Int, Var) -&gt; FunDefs1)
-&gt; FunDefs1 -&gt; Map Var (Map Int Int, Map Int Int, Var) -&gt; FunDefs1
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldlWithKey"><span class="hs-identifier hs-var">M.foldlWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; (Map Int Int, Map Int Int, Var) -&gt; FunDefs1
</span><a href="#local-6989586621680984755"><span class="hs-identifier hs-var">pass2F</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984750"><span class="hs-identifier hs-var">fdefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Var (Map Int Int, Map Int Int, Var)
</span><a href="#local-6989586621680984751"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-1545"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span>  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984749"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984748"><span class="hs-identifier hs-var">firstTime</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984754"><span class="hs-identifier hs-var">fdefs''</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDefs1 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984746"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1546"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984747"><span class="hs-identifier hs-var">mainExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984754"><span class="hs-identifier hs-var">fdefs''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1547"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Int -&gt; (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#redundancy_input_pass"><span class="hs-identifier hs-var">redundancy_input_pass</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984754"><span class="hs-identifier hs-var">fdefs''</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984747"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984749"><span class="hs-identifier hs-var">depth</span></a></span><span>
</span><span id="line-1548"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1549"></span><span>    </span><span id="local-6989586621680984755"><span class="annot"><span class="annottext">pass2F :: FunDefs1 -&gt; Var -&gt; (Map Int Int, Map Int Int, Var) -&gt; FunDefs1
</span><a href="#local-6989586621680984755"><span class="hs-identifier hs-var hs-var">pass2F</span></a></span></span><span> </span><span id="local-6989586621680984757"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984757"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984758"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984758"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984759"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984759"><span class="hs-identifier hs-var">redirectMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984760"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984760"><span class="hs-identifier hs-var">outPutFromInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984761"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984761"><span class="hs-identifier hs-var">newName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1550"></span><span>      </span><span class="annot"><span class="annottext">(FunDef1 -&gt; FunDef1) -&gt; FunDefs1 -&gt; FunDefs1
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
-&gt; Var -&gt; (Map Int Int, Map Int Int, Var) -&gt; FunDef1 -&gt; FunDef1
</span><a href="#local-6989586621680984762"><span class="hs-identifier hs-var">pass2Fsub</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984757"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984758"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984759"><span class="hs-identifier hs-var">redirectMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984760"><span class="hs-identifier hs-var">outPutFromInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984761"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984757"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1551"></span><span>
</span><span id="line-1552"></span><span>    </span><span id="local-6989586621680984762"><span class="annot"><span class="annottext">pass2Fsub :: FunDefs1
-&gt; Var -&gt; (Map Int Int, Map Int Int, Var) -&gt; FunDef1 -&gt; FunDef1
</span><a href="#local-6989586621680984762"><span class="hs-identifier hs-var hs-var">pass2Fsub</span></a></span></span><span> </span><span id="local-6989586621680984765"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984765"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984766"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984766"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984767"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984767"><span class="hs-identifier hs-var">redirectMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984768"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984768"><span class="hs-identifier hs-var">outPutFromInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984769"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984769"><span class="hs-identifier hs-var">newName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984770"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984770"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1553"></span><span>      </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984770"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1554"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1555"></span><span>            </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeUnusedDefsExp"><span class="hs-identifier hs-var">removeUnusedDefsExp</span></a></span><span>
</span><span id="line-1556"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#simplifyProjections"><span class="hs-identifier hs-var">simplifyProjections</span></a></span><span>
</span><span id="line-1557"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#removeCommonExpressions"><span class="hs-identifier hs-var">removeCommonExpressions</span></a></span><span>
</span><span id="line-1558"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
-&gt; FunDef1 -&gt; FunDef1 -&gt; Map Int Int -&gt; Map Int Int -&gt; Var -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#fixCalls"><span class="hs-identifier hs-var">fixCalls</span></a></span><span>
</span><span id="line-1559"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984770"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1560"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984765"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984766"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1561"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984765"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984769"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1562"></span><span>                       </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984767"><span class="hs-identifier hs-var">redirectMap</span></a></span><span>
</span><span id="line-1563"></span><span>                       </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984768"><span class="hs-identifier hs-var">outPutFromInput</span></a></span><span>
</span><span id="line-1564"></span><span>                       </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984769"><span class="hs-identifier hs-var">newName</span></a></span><span>
</span><span id="line-1565"></span><span>                       </span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1566"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1567"></span><span>
</span><span id="line-1568"></span><span>    </span><span id="local-6989586621680984753"><span class="annot"><span class="annottext">pass1F :: FunDefs1
-&gt; (FunDefs1, Map Var (Map Int Int, Map Int Int, Var))
-&gt; FunDef1
-&gt; (FunDefs1, Map Var (Map Int Int, Map Int Int, Var))
</span><a href="#local-6989586621680984753"><span class="hs-identifier hs-var hs-var">pass1F</span></a></span></span><span> </span><span id="local-6989586621680984778"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984778"><span class="hs-identifier hs-var">orgFdefs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984779"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984779"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984780"><span class="annot"><span class="annottext">Map Var (Map Int Int, Map Int Int, Var)
</span><a href="#local-6989586621680984780"><span class="hs-identifier hs-var">rules</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984781"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984781"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1569"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984782"><span class="annot"><span class="annottext">fName :: Var
</span><a href="#local-6989586621680984782"><span class="hs-identifier hs-var hs-var">fName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984781"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1570"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">L.isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_TUP&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984782"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1571"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621680984783"><span class="annot"><span class="annottext">testedPositions :: Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984783"><span class="hs-identifier hs-var hs-var">testedPositions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1572"></span><span>                            </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; Map (Var, Int, Int) Bool
</span><a href="Gibbon.Passes.Fusion2.html#testAllOutputPositions"><span class="hs-identifier hs-var">testAllOutputPositions</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984778"><span class="hs-identifier hs-var">orgFdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984782"><span class="hs-identifier hs-var">fName</span></a></span><span>
</span><span id="line-1573"></span><span>
</span><span id="line-1574"></span><span>                      </span><span id="local-6989586621680984785"><span class="annot"><span class="annottext">newName :: Var
</span><a href="#local-6989586621680984785"><span class="hs-identifier hs-var hs-var">newName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984782"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outputFixed&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1575"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs1 -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984785"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984779"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1576"></span><span>                        </span><span class="hs-keyword">then</span><span>
</span><span id="line-1577"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984779"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Var (Map Int Int, Map Int Int, Var)
</span><a href="#local-6989586621680984780"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>                        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1580"></span><span>
</span><span id="line-1581"></span><span>                          </span><span class="hs-keyword">let</span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680984786"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984786"><span class="hs-identifier hs-var">fNew</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984787"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984787"><span class="hs-identifier hs-var">redirectMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984788"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984788"><span class="hs-identifier hs-var">outPutFromInput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1582"></span><span>                                 </span><span class="annot"><span class="annottext">FunDef1
-&gt; Map (Var, Int, Int) Bool -&gt; (FunDef1, Map Int Int, Map Int Int)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantOutput"><span class="hs-identifier hs-var">removeRedundantOutput</span></a></span><span>
</span><span id="line-1583"></span><span>                                 </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984781"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1584"></span><span>                                </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984783"><span class="hs-identifier hs-var">testedPositions</span></a></span><span> </span><span class="hs-comment">--`debug` (&quot;testing&quot; L.++ (show fName))</span><span>
</span><span id="line-1585"></span><span>
</span><span id="line-1586"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984786"><span class="hs-identifier hs-var">fNew</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984786"><span class="hs-identifier hs-var">fNew</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984779"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1587"></span><span>                             </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
-&gt; (Map Int Int, Map Int Int, Var)
-&gt; Map Var (Map Int Int, Map Int Int, Var)
-&gt; Map Var (Map Int Int, Map Int Int, Var)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984782"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984787"><span class="hs-identifier hs-var">redirectMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680984788"><span class="hs-identifier hs-var">outPutFromInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984786"><span class="hs-identifier hs-var">fNew</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Var (Map Int Int, Map Int Int, Var)
</span><a href="#local-6989586621680984780"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>                      </span><span class="hs-comment">--  `debug` ((show fName) L.++ &quot;new things&quot; L.++  (show (getOutputsFromInput f)))</span><span>
</span><span id="line-1589"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984779"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Var (Map Int Int, Map Int Int, Var)
</span><a href="#local-6989586621680984780"><span class="hs-identifier hs-var">rules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1590"></span><span>
</span><span id="line-1591"></span><span>
</span><span id="line-1592"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#testAllOutputPositions"><span class="hs-identifier hs-type">testAllOutputPositions</span></a></span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1593"></span><span id="testAllOutputPositions"><span class="annot"><span class="annottext">testAllOutputPositions :: FunDefs1 -&gt; Var -&gt; Map (Var, Int, Int) Bool
</span><a href="Gibbon.Passes.Fusion2.html#testAllOutputPositions"><span class="hs-identifier hs-var hs-var">testAllOutputPositions</span></a></span></span><span>  </span><span id="local-6989586621680984798"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984798"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680984799"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984799"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1594"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984800"><span class="annot"><span class="annottext">f :: FunDef1
</span><a href="#local-6989586621680984800"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984798"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984799"><span class="hs-identifier hs-var">fName</span></a></span><span>
</span><span id="line-1595"></span><span>       </span><span id="local-6989586621680984801"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621680984801"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680984800"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1596"></span><span>             </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680984802"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680984802"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680984802"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1597"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Int
-&gt; Map (Var, Int, Int) Bool
-&gt; Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984803"><span class="hs-identifier hs-var">loop1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984801"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-1598"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1599"></span><span>    </span><span class="annot"><a href="#local-6989586621680984803"><span class="hs-identifier hs-type">loop1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1600"></span><span>    </span><span id="local-6989586621680984803"><span class="annot"><span class="annottext">loop1 :: Int
-&gt; Int
-&gt; Int
-&gt; Map (Var, Int, Int) Bool
-&gt; Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984803"><span class="hs-identifier hs-var hs-var">loop1</span></a></span></span><span> </span><span id="local-6989586621680984804"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984804"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680984805"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984805"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621680984806"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984806"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680984807"><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984807"><span class="hs-identifier hs-var">testedPositions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1601"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984805"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984806"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1602"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-1603"></span><span>          </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984807"><span class="hs-identifier hs-var">testedPositions</span></a></span><span>
</span><span id="line-1604"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1605"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984804"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984806"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1606"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-1607"></span><span>              </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Int
-&gt; Map (Var, Int, Int) Bool
-&gt; Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984803"><span class="hs-identifier hs-var">loop1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984805"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984806"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984807"><span class="hs-identifier hs-var">testedPositions</span></a></span><span>
</span><span id="line-1608"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-1609"></span><span>               </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Int
-&gt; Map (Var, Int, Int) Bool
-&gt; Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984803"><span class="hs-identifier hs-var">loop1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984804"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984805"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984806"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Bool, Map (Var, Int, Int) Bool) -&gt; Map (Var, Int, Int) Bool
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FunDefs1
-&gt; (Var, Int, Int)
-&gt; Map (Var, Int, Int) Bool
-&gt; (Bool, Map (Var, Int, Int) Bool)
</span><a href="Gibbon.Passes.Fusion2.html#testTwoOutputPositions"><span class="hs-identifier hs-var">testTwoOutputPositions</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984798"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984799"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984804"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984805"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984807"><span class="hs-identifier hs-var">testedPositions</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1610"></span><span>               </span><span class="hs-comment">--  `debug` (show&quot;start&quot; L.++ show((fName, i, j) ))</span><span>
</span><span id="line-1611"></span><span>
</span><span id="line-1612"></span><span>
</span><span id="line-1613"></span><span class="hs-comment">-- For each pair of distinct output positions of a tuple: (0,1), (1,0),</span><span>
</span><span id="line-1614"></span><span class="hs-comment">-- testTwoOutputPositions checks whether a particular function returns</span><span>
</span><span id="line-1615"></span><span class="hs-comment">-- identical values at those positions.</span><span>
</span><span id="line-1616"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#testTwoOutputPositions"><span class="hs-identifier hs-type">testTwoOutputPositions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1617"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1618"></span><span id="testTwoOutputPositions"><span class="annot"><span class="annottext">testTwoOutputPositions :: FunDefs1
-&gt; (Var, Int, Int)
-&gt; Map (Var, Int, Int) Bool
-&gt; (Bool, Map (Var, Int, Int) Bool)
</span><a href="Gibbon.Passes.Fusion2.html#testTwoOutputPositions"><span class="hs-identifier hs-var hs-var">testTwoOutputPositions</span></a></span></span><span> </span><span id="local-6989586621680984832"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984832"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984833"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984833"><span class="hs-identifier hs-var">fName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984834"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984834"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984835"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984835"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984836"><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1619"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984834"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984835"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1620"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-1621"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Var, Int, Int) -&gt; Map (Var, Int, Int) Bool -&gt; Maybe Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984833"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984834"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984835"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1622"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680984837"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984837"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984837"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1623"></span><span>        </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1624"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Var, Int, Int) -&gt; Map (Var, Int, Int) Bool -&gt; Maybe Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984833"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984835"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984834"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1625"></span><span>            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680984838"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984838"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984838"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Var, Int, Int)
-&gt; Bool -&gt; Map (Var, Int, Int) Bool -&gt; Map (Var, Int, Int) Bool
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984833"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984835"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984834"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984838"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1626"></span><span>            </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1627"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984839"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984839"><span class="hs-identifier hs-var">cond</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984840"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984840"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984841"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984841"><span class="hs-identifier hs-var">unresolvedConditions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1628"></span><span>                    </span><span class="annot"><span class="annottext">Var
-&gt; Int -&gt; Int -&gt; (Bool, Set (Var, Int, Int), Set (Var, Int, Int))
</span><a href="#local-6989586621680984842"><span class="hs-identifier hs-var">extractAssumptionAndConditions</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984833"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984834"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984835"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-1629"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984839"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-1630"></span><span>                  </span><span class="hs-keyword">then</span><span>
</span><span id="line-1631"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984843"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984843"><span class="hs-identifier hs-var">cond'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984844"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984844"><span class="hs-identifier hs-var">inductiveAssumption'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1632"></span><span>                          </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
-&gt; Set (Var, Int, Int) -&gt; (Bool, Set (Var, Int, Int))
</span><a href="#local-6989586621680984845"><span class="hs-identifier hs-var">testTwoOutputPositionsRec</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984840"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984841"><span class="hs-identifier hs-var">unresolvedConditions</span></a></span><span>
</span><span id="line-1633"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984843"><span class="hs-identifier hs-var">cond'</span></a></span><span>
</span><span id="line-1634"></span><span>                       </span><span class="hs-keyword">then</span><span>
</span><span id="line-1635"></span><span>                        </span><span class="hs-comment">-- if there are not more conditions to resolve then we</span><span>
</span><span id="line-1636"></span><span>                        </span><span class="hs-comment">--  are done and correct !</span><span>
</span><span id="line-1637"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984846"><span class="annot"><span class="annottext">testedPositions' :: Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984846"><span class="hs-identifier hs-var hs-var">testedPositions'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map (Var, Int, Int) Bool
 -&gt; (Var, Int, Int) -&gt; Map (Var, Int, Int) Bool)
-&gt; Map (Var, Int, Int) Bool
-&gt; Set (Var, Int, Int)
-&gt; Map (Var, Int, Int) Bool
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#foldl"><span class="hs-identifier hs-var">S.foldl</span></a></span><span>
</span><span id="line-1638"></span><span>                                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680984848"><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984848"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984849"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984849"><span class="hs-identifier hs-var">fName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984850"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984850"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984851"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984851"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, Int, Int)
-&gt; Bool -&gt; Map (Var, Int, Int) Bool -&gt; Map (Var, Int, Int) Bool
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984849"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984850"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984851"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984848"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1639"></span><span>                                  </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span><span>   </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984844"><span class="hs-identifier hs-var">inductiveAssumption'</span></a></span><span>
</span><span id="line-1640"></span><span>                          </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984846"><span class="hs-identifier hs-var">testedPositions'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1641"></span><span>                      </span><span class="hs-keyword">else</span><span>
</span><span id="line-1642"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Var, Int, Int)
-&gt; Bool -&gt; Map (Var, Int, Int) Bool -&gt; Map (Var, Int, Int) Bool
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984833"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984834"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984835"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1643"></span><span>
</span><span id="line-1644"></span><span>                  </span><span class="hs-keyword">else</span><span>
</span><span id="line-1645"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Var, Int, Int)
-&gt; Bool -&gt; Map (Var, Int, Int) Bool -&gt; Map (Var, Int, Int) Bool
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984833"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984834"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984835"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680984836"><span class="hs-identifier hs-var">testedPositions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span>
</span><span id="line-1648"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1649"></span><span>  </span><span id="local-6989586621680984845"><span class="annot"><span class="annottext">testTwoOutputPositionsRec :: Set (Var, Int, Int)
-&gt; Set (Var, Int, Int) -&gt; (Bool, Set (Var, Int, Int))
</span><a href="#local-6989586621680984845"><span class="hs-identifier hs-var hs-var">testTwoOutputPositionsRec</span></a></span></span><span> </span><span id="local-6989586621680984859"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984859"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span></span><span> </span><span id="local-6989586621680984860"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984860"><span class="hs-identifier hs-var">unresolvedConditions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1650"></span><span>    </span><span class="hs-comment">-- for each unresolved condition</span><span>
</span><span id="line-1651"></span><span>    </span><span class="hs-comment">-- 1-check if equivalent rules are satisfied</span><span>
</span><span id="line-1652"></span><span>    </span><span class="hs-comment">-- 2-if not return false</span><span>
</span><span id="line-1653"></span><span>    </span><span class="hs-comment">-- 3-if yes move it to inductive assumptions and add the appropriate new</span><span>
</span><span id="line-1654"></span><span>    </span><span class="hs-comment">--  conditions if any</span><span>
</span><span id="line-1655"></span><span>    </span><span class="hs-comment">-- 4-if at the end result is false we are done, otherwise if there is no</span><span>
</span><span id="line-1656"></span><span>    </span><span class="hs-comment">-- unresolvedConditions then proof is done also, otherwise call perform the</span><span>
</span><span id="line-1657"></span><span>    </span><span class="hs-comment">-- call recursively.</span><span>
</span><span id="line-1658"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984861"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984861"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984862"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984862"><span class="hs-identifier hs-var">inductiveAssumption'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984863"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984863"><span class="hs-identifier hs-var">unresolvedConditions'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1659"></span><span>          </span><span class="annot"><span class="annottext">((Bool, Set (Var, Int, Int), Set (Var, Int, Int))
 -&gt; (Var, Int, Int)
 -&gt; (Bool, Set (Var, Int, Int), Set (Var, Int, Int)))
-&gt; (Bool, Set (Var, Int, Int), Set (Var, Int, Int))
-&gt; Set (Var, Int, Int)
-&gt; (Bool, Set (Var, Int, Int), Set (Var, Int, Int))
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#foldl"><span class="hs-identifier hs-var">S.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool, Set (Var, Int, Int), Set (Var, Int, Int))
-&gt; (Var, Int, Int)
-&gt; (Bool, Set (Var, Int, Int), Set (Var, Int, Int))
</span><a href="#local-6989586621680984864"><span class="hs-identifier hs-var">foo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984859"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984860"><span class="hs-identifier hs-var">unresolvedConditions</span></a></span><span>
</span><span id="line-1660"></span><span>        </span><span id="local-6989586621680984865"><span class="annot"><span class="annottext">unresolvedConditions'' :: Set (Var, Int, Int)
</span><a href="#local-6989586621680984865"><span class="hs-identifier hs-var hs-var">unresolvedConditions''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Int, Int) -&gt; Bool)
-&gt; Set (Var, Int, Int) -&gt; Set (Var, Int, Int)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#filter"><span class="hs-identifier hs-var">S.filter</span></a></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680984867"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984867"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984868"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984868"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984869"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984869"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1661"></span><span>            </span><span class="annot"><span class="annottext">(Var, Int, Int) -&gt; Set (Var, Int, Int) -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#notMember"><span class="hs-identifier hs-var">S.notMember</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984867"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984868"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984869"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984862"><span class="hs-identifier hs-var">inductiveAssumption'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-1662"></span><span>              </span><span class="annot"><span class="annottext">(Var, Int, Int) -&gt; Set (Var, Int, Int) -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#notMember"><span class="hs-identifier hs-var">S.notMember</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984867"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984869"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984868"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984862"><span class="hs-identifier hs-var">inductiveAssumption'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984863"><span class="hs-identifier hs-var">unresolvedConditions'</span></a></span><span>
</span><span id="line-1663"></span><span>
</span><span id="line-1664"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984861"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int) -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984865"><span class="hs-identifier hs-var">unresolvedConditions''</span></a></span><span>
</span><span id="line-1665"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984861"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984862"><span class="hs-identifier hs-var">inductiveAssumption'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1666"></span><span>         </span><span class="hs-keyword">else</span><span>
</span><span id="line-1667"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984861"><span class="hs-identifier hs-var">res</span></a></span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1668"></span><span>              </span><span class="hs-keyword">then</span><span>
</span><span id="line-1669"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span>              </span><span class="hs-keyword">else</span><span>
</span><span id="line-1671"></span><span>                </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
-&gt; Set (Var, Int, Int) -&gt; (Bool, Set (Var, Int, Int))
</span><a href="#local-6989586621680984845"><span class="hs-identifier hs-var">testTwoOutputPositionsRec</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984862"><span class="hs-identifier hs-var">inductiveAssumption'</span></a></span><span>  </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984865"><span class="hs-identifier hs-var">unresolvedConditions''</span></a></span><span>
</span><span id="line-1672"></span><span>
</span><span id="line-1673"></span><span>  </span><span class="annot"><a href="#local-6989586621680984864"><span class="hs-identifier hs-type">foo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1674"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1675"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1676"></span><span>  </span><span id="local-6989586621680984864"><span class="annot"><span class="annottext">foo :: (Bool, Set (Var, Int, Int), Set (Var, Int, Int))
-&gt; (Var, Int, Int)
-&gt; (Bool, Set (Var, Int, Int), Set (Var, Int, Int))
</span><a href="#local-6989586621680984864"><span class="hs-identifier hs-var hs-var">foo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984871"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984871"><span class="hs-identifier hs-var">condInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984872"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984872"><span class="hs-identifier hs-var">assumptionsInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984873"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984873"><span class="hs-identifier hs-var">unresolvedInput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984874"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984874"><span class="hs-identifier hs-var">fName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984875"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984875"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984876"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984876"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1677"></span><span>
</span><span id="line-1678"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984877"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984877"><span class="hs-identifier hs-var">cond</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984878"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984878"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984879"><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984879"><span class="hs-identifier hs-var">unresolvedConditions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1679"></span><span>              </span><span class="annot"><span class="annottext">Var
-&gt; Int -&gt; Int -&gt; (Bool, Set (Var, Int, Int), Set (Var, Int, Int))
</span><a href="#local-6989586621680984842"><span class="hs-identifier hs-var">extractAssumptionAndConditions</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984874"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984875"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984876"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-1680"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984877"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984871"><span class="hs-identifier hs-var">condInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int) -&gt; Set (Var, Int, Int) -&gt; Set (Var, Int, Int)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984872"><span class="hs-identifier hs-var">assumptionsInput</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984878"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1681"></span><span>        </span><span class="annot"><span class="annottext">Set (Var, Int, Int) -&gt; Set (Var, Int, Int) -&gt; Set (Var, Int, Int)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984879"><span class="hs-identifier hs-var">unresolvedConditions</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984873"><span class="hs-identifier hs-var">unresolvedInput</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1682"></span><span>
</span><span id="line-1683"></span><span>  </span><span class="hs-comment">-- TODO.</span><span>
</span><span id="line-1684"></span><span>  </span><span class="annot"><a href="#local-6989586621680984842"><span class="hs-identifier hs-type">extractAssumptionAndConditions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1685"></span><span>  </span><span id="local-6989586621680984842"><span class="annot"><span class="annottext">extractAssumptionAndConditions :: Var
-&gt; Int -&gt; Int -&gt; (Bool, Set (Var, Int, Int), Set (Var, Int, Int))
</span><a href="#local-6989586621680984842"><span class="hs-identifier hs-var hs-var">extractAssumptionAndConditions</span></a></span></span><span> </span><span id="local-6989586621680984881"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984881"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680984882"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984882"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680984883"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984883"><span class="hs-identifier hs-var">j</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-1686"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984884"><span class="annot"><span class="annottext">exp :: Exp1
</span><a href="#local-6989586621680984884"><span class="hs-identifier hs-var hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680984832"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984881"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1687"></span><span>        </span><span id="local-6989586621680984885"><span class="annot"><span class="annottext">inlinedContent :: Exp1
</span><a href="#local-6989586621680984885"><span class="hs-identifier hs-var hs-var">inlinedContent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#inlineAllButAppE"><span class="hs-identifier hs-var">inlineAllButAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984884"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-comment">--`debug` (show (fName) L.++ &quot;inlined body\n&quot;L.++ (render (pprint exp)))</span><span>
</span><span id="line-1688"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984885"><span class="hs-identifier hs-var">inlinedContent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1689"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680984887"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984887"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680984888"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984888"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1690"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984889"><span class="annot"><span class="annottext">parametrizedExprsList :: [[(Exp1, [(Int, Var, Var)])]]
</span><a href="#local-6989586621680984889"><span class="hs-identifier hs-var hs-var">parametrizedExprsList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; [(Exp1, [(Int, Var, Var)])])
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [[(Exp1, [(Int, Var, Var)])]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="annot"><span class="annottext">(String, [(Var, ())], Exp1) -&gt; [(Exp1, [(Int, Var, Var)])]
</span><a href="#local-6989586621680984890"><span class="hs-identifier hs-var">parametrizeProdExprs</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680984888"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1691"></span><span>                </span><span id="local-6989586621680984891"><span class="annot"><span class="annottext">cond :: Bool
</span><a href="#local-6989586621680984891"><span class="hs-identifier hs-var hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; [(Exp1, [(Int, Var, Var)])] -&gt; Bool)
-&gt; Bool -&gt; [[(Exp1, [(Int, Var, Var)])]] -&gt; Bool
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool -&gt; [(Exp1, [(Int, Var, Var)])] -&gt; Bool
forall {a} {a} {a} {c}.
(Eq a, Eq a) =&gt;
Int -&gt; Int -&gt; Bool -&gt; [(a, [(a, a, c)])] -&gt; Bool
</span><a href="#local-6989586621680984892"><span class="hs-identifier hs-var">checkExpressions</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984882"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984883"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">[[(Exp1, [(Int, Var, Var)])]]
</span><a href="#local-6989586621680984889"><span class="hs-identifier hs-var">parametrizedExprsList</span></a></span><span>
</span><span id="line-1692"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984891"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-1693"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-1694"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984893"><span class="annot"><span class="annottext">inductiveAssumption :: Set (Var, Int, Int)
</span><a href="#local-6989586621680984893"><span class="hs-identifier hs-var hs-var">inductiveAssumption</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, Int, Int) -&gt; Set (Var, Int, Int) -&gt; Set (Var, Int, Int)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984881"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984882"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984883"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-1695"></span><span>                      </span><span id="local-6989586621680984894"><span class="annot"><span class="annottext">unresolvedConditions :: Set (Var, Int, Int)
</span><a href="#local-6989586621680984894"><span class="hs-identifier hs-var hs-var">unresolvedConditions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set (Var, Int, Int)
 -&gt; [(Exp1, [(Int, Var, Var)])] -&gt; Set (Var, Int, Int))
-&gt; Set (Var, Int, Int)
-&gt; [[(Exp1, [(Int, Var, Var)])]]
-&gt; Set (Var, Int, Int)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Set (Var, Int, Int)
-&gt; [(Exp1, [(Int, Var, Var)])]
-&gt; Set (Var, Int, Int)
forall {c} {c} {a} {b}.
(Ord c, Ord c) =&gt;
Int -&gt; Int -&gt; Set (c, c, c) -&gt; [(a, [(c, b, c)])] -&gt; Set (c, c, c)
</span><a href="#local-6989586621680984895"><span class="hs-identifier hs-var">collectConditions</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984882"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984883"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1696"></span><span>                        </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">[[(Exp1, [(Int, Var, Var)])]]
</span><a href="#local-6989586621680984889"><span class="hs-identifier hs-var">parametrizedExprsList</span></a></span><span>
</span><span id="line-1697"></span><span>
</span><span id="line-1698"></span><span>                      </span><span id="local-6989586621680984896"><span class="annot"><span class="annottext">unresolvedConditions' :: Set (Var, Int, Int)
</span><a href="#local-6989586621680984896"><span class="hs-identifier hs-var hs-var">unresolvedConditions'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Int, Int) -&gt; Bool)
-&gt; Set (Var, Int, Int) -&gt; Set (Var, Int, Int)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#filter"><span class="hs-identifier hs-var">S.filter</span></a></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680984897"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984897"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984898"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984898"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984899"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984899"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1699"></span><span>                        </span><span class="annot"><span class="annottext">(Var, Int, Int) -&gt; Set (Var, Int, Int) -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#notMember"><span class="hs-identifier hs-var">S.notMember</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984897"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984898"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984899"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984893"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-1700"></span><span>                          </span><span class="annot"><span class="annottext">(Var, Int, Int) -&gt; Set (Var, Int, Int) -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#notMember"><span class="hs-identifier hs-var">S.notMember</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984897"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984899"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984898"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984893"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1701"></span><span>                            </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984894"><span class="hs-identifier hs-var">unresolvedConditions</span></a></span><span>
</span><span id="line-1702"></span><span>                  </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984893"><span class="hs-identifier hs-var">inductiveAssumption</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
</span><a href="#local-6989586621680984894"><span class="hs-identifier hs-var">unresolvedConditions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1703"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-1704"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (Var, Int, Int)
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1705"></span><span>
</span><span id="line-1706"></span><span>
</span><span id="line-1707"></span><span>  </span><span class="annot"><a href="#local-6989586621680984890"><span class="hs-identifier hs-type">parametrizeProdExprs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1708"></span><span>  </span><span id="local-6989586621680984890"><span class="annot"><span class="annottext">parametrizeProdExprs :: (String, [(Var, ())], Exp1) -&gt; [(Exp1, [(Int, Var, Var)])]
</span><a href="#local-6989586621680984890"><span class="hs-identifier hs-var hs-var">parametrizeProdExprs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984901"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984901"><span class="hs-identifier hs-var">subExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1709"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984902"><span class="annot"><span class="annottext">vars :: Set Var
</span><a href="#local-6989586621680984902"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
</span><a href="Gibbon.Passes.Fusion2.html#collectVars"><span class="hs-identifier hs-var">collectVars</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984901"><span class="hs-identifier hs-var">subExp</span></a></span><span>
</span><span id="line-1710"></span><span>          </span><span id="local-6989586621680984904"><span class="annot"><span class="annottext">leafProd :: Exp1
</span><a href="#local-6989586621680984904"><span class="hs-identifier hs-var hs-var">leafProd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#getLeafProd"><span class="hs-identifier hs-var">getLeafProd</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984901"><span class="hs-identifier hs-var">subExp</span></a></span><span>
</span><span id="line-1711"></span><span>          </span><span id="local-6989586621680984906"><span class="annot"><span class="annottext">varsToFuncs :: VarEnv
</span><a href="#local-6989586621680984906"><span class="hs-identifier hs-var hs-var">varsToFuncs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; VarEnv
</span><a href="Gibbon.Passes.Fusion2.html#collectVarToFuncs"><span class="hs-identifier hs-var">collectVarToFuncs</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984901"><span class="hs-identifier hs-var">subExp</span></a></span><span>
</span><span id="line-1712"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680984904"><span class="hs-identifier hs-var">leafProd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1713"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680984908"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984908"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">(Exp1 -&gt; (Exp1, [(Int, Var, Var)]))
-&gt; [Exp1] -&gt; [(Exp1, [(Int, Var, Var)])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; VarEnv -&gt; Exp1 -&gt; (Exp1, [(Int, Var, Var)])
</span><a href="Gibbon.Passes.Fusion2.html#parametrizeExp"><span class="hs-identifier hs-var">parametrizeExp</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680984902"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv
</span><a href="#local-6989586621680984906"><span class="hs-identifier hs-var">varsToFuncs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680984908"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1714"></span><span>
</span><span id="line-1715"></span><span>  </span><span id="local-6989586621680984892"><span class="annot"><span class="annottext">checkExpressions :: Int -&gt; Int -&gt; Bool -&gt; [(a, [(a, a, c)])] -&gt; Bool
</span><a href="#local-6989586621680984892"><span class="hs-identifier hs-var hs-var">checkExpressions</span></a></span></span><span> </span><span id="local-6989586621680984918"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984918"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680984919"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984919"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621680984920"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984920"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680984921"><span class="annot"><span class="annottext">[(a, [(a, a, c)])]
</span><a href="#local-6989586621680984921"><span class="hs-identifier hs-var">prodListParametrized</span></a></span></span><span class="hs-glyph">=</span><span>
</span><span id="line-1716"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984922"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984922"><span class="hs-identifier hs-var">expi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984923"><span class="annot"><span class="annottext">[(a, a, c)]
</span><a href="#local-6989586621680984923"><span class="hs-identifier hs-var">pars1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">[(a, [(a, a, c)])]
</span><a href="#local-6989586621680984921"><span class="hs-identifier hs-var">prodListParametrized</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, [(a, a, c)])] -&gt; Int -&gt; (a, [(a, a, c)])
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">L.!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984918"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1717"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680984924"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984924"><span class="hs-identifier hs-var">expj</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984925"><span class="annot"><span class="annottext">[(a, a, c)]
</span><a href="#local-6989586621680984925"><span class="hs-identifier hs-var">pars2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, [(a, a, c)])]
</span><a href="#local-6989586621680984921"><span class="hs-identifier hs-var">prodListParametrized</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, [(a, a, c)])] -&gt; Int -&gt; (a, [(a, a, c)])
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">L.!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984919"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-1718"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680984920"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984922"><span class="hs-identifier hs-var">expi</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984924"><span class="hs-identifier hs-var">expj</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, c)] -&gt; [(a, a, c)] -&gt; Bool
forall {a} {a} {c} {a} {c}.
Eq a =&gt;
[(a, a, c)] -&gt; [(a, a, c)] -&gt; Bool
</span><a href="#local-6989586621680984926"><span class="hs-identifier hs-var">parsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, c)]
</span><a href="#local-6989586621680984923"><span class="hs-identifier hs-var">pars1</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, c)]
</span><a href="#local-6989586621680984925"><span class="hs-identifier hs-var">pars2</span></a></span><span>
</span><span id="line-1719"></span><span>
</span><span id="line-1720"></span><span>  </span><span id="local-6989586621680984926"><span class="annot"><span class="annottext">parsCheck :: [(a, a, c)] -&gt; [(a, a, c)] -&gt; Bool
</span><a href="#local-6989586621680984926"><span class="hs-identifier hs-var hs-var">parsCheck</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1721"></span><span>  </span><span class="annot"><a href="#local-6989586621680984926"><span class="hs-identifier hs-var">parsCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984929"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984929"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680984930"><span class="annot"><span class="annottext">[(a, a, c)]
</span><a href="#local-6989586621680984930"><span class="hs-identifier hs-var">ls1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984931"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984931"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680984932"><span class="annot"><span class="annottext">[(a, a, c)]
</span><a href="#local-6989586621680984932"><span class="hs-identifier hs-var">ls2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1722"></span><span>     </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984929"><span class="hs-identifier hs-var">v1</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984931"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, c)] -&gt; [(a, a, c)] -&gt; Bool
</span><a href="#local-6989586621680984926"><span class="hs-identifier hs-var">parsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, c)]
</span><a href="#local-6989586621680984930"><span class="hs-identifier hs-var">ls1</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, c)]
</span><a href="#local-6989586621680984932"><span class="hs-identifier hs-var">ls2</span></a></span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span>  </span><span id="local-6989586621680984895"><span class="annot"><span class="annottext">collectConditions :: Int -&gt; Int -&gt; Set (c, c, c) -&gt; [(a, [(c, b, c)])] -&gt; Set (c, c, c)
</span><a href="#local-6989586621680984895"><span class="hs-identifier hs-var hs-var">collectConditions</span></a></span></span><span> </span><span id="local-6989586621680984946"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984946"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680984947"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984947"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621680984948"><span class="annot"><span class="annottext">Set (c, c, c)
</span><a href="#local-6989586621680984948"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680984949"><span class="annot"><span class="annottext">[(a, [(c, b, c)])]
</span><a href="#local-6989586621680984949"><span class="hs-identifier hs-var">prodListParametrized</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1725"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984950"><span class="annot"><span class="annottext">[(c, b, c)]
</span><a href="#local-6989586621680984950"><span class="hs-identifier hs-var">ls1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">[(a, [(c, b, c)])]
</span><a href="#local-6989586621680984949"><span class="hs-identifier hs-var">prodListParametrized</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, [(c, b, c)])] -&gt; Int -&gt; (a, [(c, b, c)])
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">L.!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984946"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1726"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984951"><span class="annot"><span class="annottext">[(c, b, c)]
</span><a href="#local-6989586621680984951"><span class="hs-identifier hs-var">ls2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, [(c, b, c)])]
</span><a href="#local-6989586621680984949"><span class="hs-identifier hs-var">prodListParametrized</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, [(c, b, c)])] -&gt; Int -&gt; (a, [(c, b, c)])
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">L.!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680984947"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-1727"></span><span>        </span><span id="local-6989586621680984952"><span class="annot"><span class="annottext">s' :: Set (c, c, c)
</span><a href="#local-6989586621680984952"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(c, b, c)] -&gt; [(c, b, c)] -&gt; Set (c, c, c)
forall {a} {c} {b} {b} {c}.
(Ord a, Ord c) =&gt;
[(c, b, a)] -&gt; [(c, b, c)] -&gt; Set (a, c, c)
</span><a href="#local-6989586621680984953"><span class="hs-identifier hs-var">collectConditionsPars</span></a></span><span>  </span><span class="annot"><span class="annottext">[(c, b, c)]
</span><a href="#local-6989586621680984950"><span class="hs-identifier hs-var">ls1</span></a></span><span> </span><span class="annot"><span class="annottext">[(c, b, c)]
</span><a href="#local-6989586621680984951"><span class="hs-identifier hs-var">ls2</span></a></span><span>
</span><span id="line-1728"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set (c, c, c) -&gt; Set (c, c, c) -&gt; Set (c, c, c)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span> </span><span class="annot"><span class="annottext">Set (c, c, c)
</span><a href="#local-6989586621680984952"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Set (c, c, c)
</span><a href="#local-6989586621680984948"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1729"></span><span>
</span><span id="line-1730"></span><span>  </span><span id="local-6989586621680984953"><span class="annot"><span class="annottext">collectConditionsPars :: [(c, b, a)] -&gt; [(c, b, c)] -&gt; Set (a, c, c)
</span><a href="#local-6989586621680984953"><span class="hs-identifier hs-var hs-var">collectConditionsPars</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (a, c, c)
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-1731"></span><span>  </span><span class="annot"><a href="#local-6989586621680984953"><span class="hs-identifier hs-var">collectConditionsPars</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680984965"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680984965"><span class="hs-identifier hs-var">idx1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984966"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680984966"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984967"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984967"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680984968"><span class="annot"><span class="annottext">[(c, b, a)]
</span><a href="#local-6989586621680984968"><span class="hs-identifier hs-var">ls1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680984969"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680984969"><span class="hs-identifier hs-var">idx2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984970"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680984970"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621680984971"><span class="annot"><span class="annottext">[(c, b, c)]
</span><a href="#local-6989586621680984971"><span class="hs-identifier hs-var">ls2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1732"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680984972"><span class="annot"><span class="annottext">sNext :: Set (a, c, c)
</span><a href="#local-6989586621680984972"><span class="hs-identifier hs-var hs-var">sNext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">[(c, b, a)] -&gt; [(c, b, c)] -&gt; Set (a, c, c)
</span><a href="#local-6989586621680984953"><span class="hs-identifier hs-var">collectConditionsPars</span></a></span><span> </span><span class="annot"><span class="annottext">[(c, b, a)]
</span><a href="#local-6989586621680984968"><span class="hs-identifier hs-var">ls1</span></a></span><span> </span><span class="annot"><span class="annottext">[(c, b, c)]
</span><a href="#local-6989586621680984971"><span class="hs-identifier hs-var">ls2</span></a></span><span>
</span><span id="line-1733"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680984965"><span class="hs-identifier hs-var">idx1</span></a></span><span class="annot"><span class="annottext">c -&gt; c -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680984969"><span class="hs-identifier hs-var">idx2</span></a></span><span>
</span><span id="line-1734"></span><span>          </span><span class="hs-keyword">then</span><span>
</span><span id="line-1735"></span><span>            </span><span class="annot"><span class="annottext">Set (a, c, c)
</span><a href="#local-6989586621680984972"><span class="hs-identifier hs-var">sNext</span></a></span><span>
</span><span id="line-1736"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-1737"></span><span>            </span><span class="annot"><span class="annottext">(a, c, c) -&gt; Set (a, c, c) -&gt; Set (a, c, c)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680984967"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680984965"><span class="hs-identifier hs-var">idx1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680984969"><span class="hs-identifier hs-var">idx2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (a, c, c)
</span><a href="#local-6989586621680984972"><span class="hs-identifier hs-var">sNext</span></a></span><span>
</span><span id="line-1738"></span><span>
</span><span id="line-1739"></span><span>
</span><span id="line-1740"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#getLeafExpr"><span class="hs-identifier hs-type">getLeafExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-1741"></span><span id="getLeafExpr"><span class="annot"><span class="annottext">getLeafExpr :: Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#getLeafExpr"><span class="hs-identifier hs-var hs-var">getLeafExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680984973"><span class="hs-identifier hs-var">recur</span></a></span><span>
</span><span id="line-1742"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1743"></span><span>   </span><span id="local-6989586621680984973"><span class="annot"><span class="annottext">recur :: PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680984973"><span class="hs-identifier hs-var hs-var">recur</span></a></span></span><span> </span><span id="local-6989586621680984974"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984974"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1744"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984974"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1745"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680984975"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984975"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680984973"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984975"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1746"></span><span>       </span><span id="local-6989586621680984976"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984976"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984976"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1747"></span><span>
</span><span id="line-1748"></span><span class="hs-comment">-- fetch the tuple returned at the tail of subExp</span><span>
</span><span id="line-1749"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#getLeafProd"><span class="hs-identifier hs-type">getLeafProd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-1750"></span><span id="getLeafProd"><span class="annot"><span class="annottext">getLeafProd :: Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#getLeafProd"><span class="hs-identifier hs-var hs-var">getLeafProd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
forall {loc} {dec} {ext :: * -&gt; * -&gt; *}.
(Show loc, Show dec, Show (ext loc dec)) =&gt;
PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680984980"><span class="hs-identifier hs-var">recur</span></a></span><span>
</span><span id="line-1751"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1752"></span><span>   </span><span id="local-6989586621680984980"><span class="annot"><span class="annottext">recur :: PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680984980"><span class="hs-identifier hs-var hs-var">recur</span></a></span></span><span> </span><span id="local-6989586621680984990"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984990"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1753"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984990"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1754"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680984991"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680984991"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984992"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680984992"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680984993"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680984993"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680984994"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984994"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680984980"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984994"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1755"></span><span>       </span><span id="local-6989586621680984995"><span class="annot"><span class="annottext">leaf :: PreExp ext loc dec
</span><a href="#local-6989586621680984995"><span class="hs-identifier hs-var">leaf</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984995"><span class="hs-identifier hs-var">leaf</span></a></span><span>
</span><span id="line-1756"></span><span>       </span><span id="local-6989586621680984996"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984996"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; PreExp ext loc dec
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984996"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1757"></span><span>
</span><span id="line-1758"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#hasConstructorTail"><span class="hs-identifier hs-type">hasConstructorTail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-1759"></span><span id="hasConstructorTail"><span class="annot"><span class="annottext">hasConstructorTail :: Exp1 -&gt; Bool
</span><a href="Gibbon.Passes.Fusion2.html#hasConstructorTail"><span class="hs-identifier hs-var hs-var">hasConstructorTail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Bool
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}. PreExp ext loc dec -&gt; Bool
</span><a href="#local-6989586621680984997"><span class="hs-identifier hs-var">rec</span></a></span><span>
</span><span id="line-1760"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1761"></span><span>    </span><span id="local-6989586621680984997"><span class="annot"><span class="annottext">rec :: PreExp ext loc dec -&gt; Bool
</span><a href="#local-6989586621680984997"><span class="hs-identifier hs-var hs-var">rec</span></a></span></span><span> </span><span id="local-6989586621680984998"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984998"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1762"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984998"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1763"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680984999"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984999"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Bool
</span><a href="#local-6989586621680984997"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680984999"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1764"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-1765"></span><span>        </span><span id="local-6989586621680985000"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985000"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-1766"></span><span>
</span><span id="line-1767"></span><span class="hs-comment">-- all variables which are used to bind function applications.</span><span>
</span><span id="line-1768"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#collectVars"><span class="hs-identifier hs-type">collectVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-1769"></span><span id="collectVars"><span class="annot"><span class="annottext">collectVars :: Exp1 -&gt; Set Var
</span><a href="Gibbon.Passes.Fusion2.html#collectVars"><span class="hs-identifier hs-var hs-var">collectVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Set Var
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; Set Var
</span><a href="#local-6989586621680985001"><span class="hs-identifier hs-var">recur</span></a></span><span>
</span><span id="line-1770"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1771"></span><span>   </span><span id="local-6989586621680985001"><span class="annot"><span class="annottext">recur :: PreExp ext loc dec -&gt; Set Var
</span><a href="#local-6989586621680985001"><span class="hs-identifier hs-var hs-var">recur</span></a></span></span><span> </span><span id="local-6989586621680985003"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985003"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985003"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1772"></span><span>     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985004"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985004"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985005"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985005"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985006"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680985006"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985007"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985007"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1773"></span><span>        </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985004"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Set Var
</span><a href="#local-6989586621680985001"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985007"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1774"></span><span>     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-1775"></span><span>
</span><span id="line-1776"></span><span class="hs-comment">-- Map of variable binding to its function call</span><span>
</span><span id="line-1777"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#collectVarToFuncs"><span class="hs-identifier hs-type">collectVarToFuncs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-1778"></span><span id="collectVarToFuncs"><span class="annot"><span class="annottext">collectVarToFuncs :: Exp1 -&gt; VarEnv
</span><a href="Gibbon.Passes.Fusion2.html#collectVarToFuncs"><span class="hs-identifier hs-var hs-var">collectVarToFuncs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; VarEnv
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; VarEnv
</span><a href="#local-6989586621680985008"><span class="hs-identifier hs-var">recur</span></a></span><span>
</span><span id="line-1779"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1780"></span><span>   </span><span id="local-6989586621680985008"><span class="annot"><span class="annottext">recur :: PreExp ext loc dec -&gt; VarEnv
</span><a href="#local-6989586621680985008"><span class="hs-identifier hs-var hs-var">recur</span></a></span></span><span> </span><span id="local-6989586621680985010"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985010"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985010"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1781"></span><span>     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985011"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985011"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985012"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985012"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985013"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680985013"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680985014"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985014"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">[loc]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985015"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985015"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1782"></span><span>       </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; VarEnv -&gt; VarEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985011"><span class="hs-identifier hs-var">v</span></a></span><span>  </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985014"><span class="hs-identifier hs-var">f</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; VarEnv
</span><a href="#local-6989586621680985008"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985015"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1783"></span><span>     </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-1784"></span><span>
</span><span id="line-1785"></span><span class="hs-comment">-- Given a set of variables that represents results of function calls</span><span>
</span><span id="line-1786"></span><span class="hs-comment">-- and a mapping from those variables to the called function</span><span>
</span><span id="line-1787"></span><span class="hs-comment">-- and an expression =&gt; parameterize the expression around those</span><span>
</span><span id="line-1788"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#parametrizeExp"><span class="hs-identifier hs-type">parametrizeExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1789"></span><span id="parametrizeExp"><span class="annot"><span class="annottext">parametrizeExp :: Set Var -&gt; VarEnv -&gt; Exp1 -&gt; (Exp1, [(Int, Var, Var)])
</span><a href="Gibbon.Passes.Fusion2.html#parametrizeExp"><span class="hs-identifier hs-var hs-var">parametrizeExp</span></a></span></span><span> </span><span id="local-6989586621680985031"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680985031"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621680985032"><span class="annot"><span class="annottext">VarEnv
</span><a href="#local-6989586621680985032"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621680985033"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985033"><span class="hs-identifier hs-var">exp</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span>
</span><span id="line-1790"></span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985034"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985034"><span class="hs-identifier hs-var">retExp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985035"><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985035"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(Int, Var)] -&gt; (Exp1, [(Int, Var)])
</span><a href="#local-6989586621680985036"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985033"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1791"></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985034"><span class="hs-identifier hs-var">retExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((Int, Var) -&gt; (Int, Var, Var))
-&gt; [(Int, Var)] -&gt; [(Int, Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680985037"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985037"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985038"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985038"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985037"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985038"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarEnv
</span><a href="#local-6989586621680985032"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv -&gt; Var -&gt; Var
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985038"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985035"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1792"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1793"></span><span>    </span><span id="local-6989586621680985036"><span class="annot"><span class="annottext">recur :: Exp1 -&gt; [(Int, Var)] -&gt; (Exp1, [(Int, Var)])
</span><a href="#local-6989586621680985036"><span class="hs-identifier hs-var hs-var">recur</span></a></span></span><span> </span><span id="local-6989586621680985039"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985039"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span id="local-6989586621680985040"><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985040"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985039"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1794"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Exp1, [(Int, Var)])
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;let not expected in parametrizeExp&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985039"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1795"></span><span>      </span><span class="hs-comment">-- TODO: this is work around (correct not complete)[should be also handled]</span><span>
</span><span id="line-1796"></span><span>      </span><span id="local-6989586621680985041"><span class="annot"><span class="annottext">x :: Exp1
</span><a href="#local-6989586621680985041"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680985042"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985042"><span class="hs-identifier hs-var">caseE</span></a></span></span><span> </span><span id="local-6989586621680985043"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985043"><span class="hs-identifier hs-var">caseLs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985041"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985040"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1797"></span><span>       </span><span class="hs-comment">-- error( &quot;CaseE not expected in parametrizeExp&quot; ++ (render (pprint ex )))</span><span>
</span><span id="line-1798"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680985044"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985044"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680985045"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680985045"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680985046"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985046"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1799"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985047"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985047"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985048"><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985048"><span class="hs-identifier hs-var">pList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([Exp1], [(Int, Var)]) -&gt; Exp1 -&gt; ([Exp1], [(Int, Var)]))
-&gt; ([Exp1], [(Int, Var)]) -&gt; [Exp1] -&gt; ([Exp1], [(Int, Var)])
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1], [(Int, Var)]) -&gt; Exp1 -&gt; ([Exp1], [(Int, Var)])
</span><a href="#local-6989586621680985049"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985040"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985046"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1800"></span><span>             </span><span class="hs-keyword">where</span><span>
</span><span id="line-1801"></span><span>               </span><span id="local-6989586621680985049"><span class="annot"><span class="annottext">f :: ([Exp1], [(Int, Var)]) -&gt; Exp1 -&gt; ([Exp1], [(Int, Var)])
</span><a href="#local-6989586621680985049"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985050"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985050"><span class="hs-identifier hs-var">expList</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985051"><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985051"><span class="hs-identifier hs-var">projList</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985052"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985052"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1802"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985053"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985053"><span class="hs-identifier hs-var">exp'</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985054"><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985054"><span class="hs-identifier hs-var">ls'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(Int, Var)] -&gt; (Exp1, [(Int, Var)])
</span><a href="#local-6989586621680985036"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985052"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985051"><span class="hs-identifier hs-var">projList</span></a></span><span>
</span><span id="line-1803"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985050"><span class="hs-identifier hs-var">expList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985053"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985051"><span class="hs-identifier hs-var">projList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Var)] -&gt; [(Int, Var)] -&gt; [(Int, Var)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985054"><span class="hs-identifier hs-var">ls'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1804"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985044"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680985045"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985047"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985048"><span class="hs-identifier hs-var">pList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1805"></span><span>
</span><span id="line-1806"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680985055"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680985055"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680985056"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985056"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span> </span><span id="local-6989586621680985057"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985057"><span class="hs-identifier hs-var">expList</span></a></span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1807"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985058"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985058"><span class="hs-identifier hs-var">expList'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985059"><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985059"><span class="hs-identifier hs-var">pList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([Exp1], [(Int, Var)]) -&gt; Exp1 -&gt; ([Exp1], [(Int, Var)]))
-&gt; ([Exp1], [(Int, Var)]) -&gt; [Exp1] -&gt; ([Exp1], [(Int, Var)])
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp1], [(Int, Var)]) -&gt; Exp1 -&gt; ([Exp1], [(Int, Var)])
</span><a href="#local-6989586621680985060"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985040"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985057"><span class="hs-identifier hs-var">expList</span></a></span><span>
</span><span id="line-1808"></span><span>             </span><span class="hs-keyword">where</span><span>
</span><span id="line-1809"></span><span>               </span><span id="local-6989586621680985060"><span class="annot"><span class="annottext">f :: ([Exp1], [(Int, Var)]) -&gt; Exp1 -&gt; ([Exp1], [(Int, Var)])
</span><a href="#local-6989586621680985060"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985061"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985061"><span class="hs-identifier hs-var">expList</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985062"><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985062"><span class="hs-identifier hs-var">projList</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985063"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985063"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1810"></span><span>                 </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985064"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985064"><span class="hs-identifier hs-var">exp'</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985065"><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985065"><span class="hs-identifier hs-var">ls'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(Int, Var)] -&gt; (Exp1, [(Int, Var)])
</span><a href="#local-6989586621680985036"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985063"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985062"><span class="hs-identifier hs-var">projList</span></a></span><span>
</span><span id="line-1811"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985061"><span class="hs-identifier hs-var">expList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985064"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985062"><span class="hs-identifier hs-var">projList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Var)] -&gt; [(Int, Var)] -&gt; [(Int, Var)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985065"><span class="hs-identifier hs-var">ls'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1812"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; String -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; String -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680985055"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985056"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985058"><span class="hs-identifier hs-var">expList'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985059"><span class="hs-identifier hs-var">pList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1813"></span><span>
</span><span id="line-1814"></span><span>      </span><span id="local-6989586621680985066"><span class="annot"><span class="annottext">x :: Exp1
</span><a href="#local-6989586621680985066"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680985067"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985067"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680985068"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985068"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1815"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985068"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680985031"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-1816"></span><span>              </span><span class="hs-keyword">then</span><span>
</span><span id="line-1817"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985070"><span class="annot"><span class="annottext">exp' :: Exp1
</span><a href="#local-6989586621680985070"><span class="hs-identifier hs-var hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;par&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Var)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">L.length</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985040"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1818"></span><span>                    </span><span id="local-6989586621680985071"><span class="annot"><span class="annottext">ls' :: [(Int, Var)]
</span><a href="#local-6989586621680985071"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985040"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Var)] -&gt; [(Int, Var)] -&gt; [(Int, Var)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985067"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985068"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1819"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985070"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985071"><span class="hs-identifier hs-var">ls'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1820"></span><span>              </span><span class="hs-keyword">else</span><span>
</span><span id="line-1821"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985066"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985040"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1822"></span><span>      </span><span id="local-6989586621680985072"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985072"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985072"><span class="hs-identifier hs-var">otherwise</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Var)]
</span><a href="#local-6989586621680985040"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1823"></span><span>
</span><span id="line-1824"></span><span class="hs-comment">-- this function inline all expressions except function application</span><span>
</span><span id="line-1825"></span><span class="hs-comment">-- that returns tuples</span><span>
</span><span id="line-1826"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#inlineAllButAppE"><span class="hs-identifier hs-type">inlineAllButAppE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span>
</span><span id="line-1827"></span><span id="inlineAllButAppE"><span class="annot"><span class="annottext">inlineAllButAppE :: Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#inlineAllButAppE"><span class="hs-identifier hs-var hs-var">inlineAllButAppE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {loc}.
(Expression (ext loc (UrTy loc)),
 SubstitutableExt (PreExp ext loc (UrTy loc)) (ext loc (UrTy loc)),
 Eq loc, Eq loc, Eq (ext loc (UrTy loc)), Show loc, Show loc,
 Out loc, Out loc) =&gt;
PreExp ext loc (UrTy loc) -&gt; PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985093"><span class="hs-identifier hs-var">rec</span></a></span><span>
</span><span id="line-1828"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1829"></span><span>  </span><span id="local-6989586621680985093"><span class="annot"><span class="annottext">rec :: PreExp ext loc (UrTy loc) -&gt; PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985093"><span class="hs-identifier hs-var hs-var">rec</span></a></span></span><span> </span><span id="local-6989586621680985129"><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985129"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985129"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1830"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985130"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985130"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985131"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985131"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985132"><span class="annot"><span class="annottext">UrTy loc
</span><a href="#local-6989586621680985132"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985133"><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985133"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985134"><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985134"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1831"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985135"><span class="annot"><span class="annottext">oldExp :: PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985135"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreExp ext loc (UrTy loc)
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985130"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1832"></span><span>         </span><span id="local-6989586621680985136"><span class="annot"><span class="annottext">newExp :: PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985136"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985133"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-1833"></span><span>         </span><span id="local-6989586621680985137"><span class="annot"><span class="annottext">body' :: PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985137"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
-&gt; PreExp ext loc (UrTy loc)
-&gt; PreExp ext loc (UrTy loc)
-&gt; PreExp ext loc (UrTy loc)
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985135"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985136"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985134"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1834"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985133"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1835"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy loc
</span><a href="#local-6989586621680985132"><span class="hs-identifier hs-var">t</span></a></span><span>  </span><span class="hs-keyword">of</span><span>
</span><span id="line-1836"></span><span>               </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">(Var, [loc], UrTy loc, PreExp ext loc (UrTy loc))
-&gt; PreExp ext loc (UrTy loc) -&gt; PreExp ext loc (UrTy loc)
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985130"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985131"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UrTy loc
</span><a href="#local-6989586621680985132"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985133"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc) -&gt; PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985093"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985134"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1837"></span><span>               </span><span class="annot"><span class="annottext">UrTy loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc) -&gt; PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985093"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985137"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-1838"></span><span>          </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc) -&gt; PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985093"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985137"><span class="hs-identifier hs-var">body'</span></a></span><span>
</span><span id="line-1839"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680985138"><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985138"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680985139"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc (UrTy loc))]
</span><a href="#local-6989586621680985139"><span class="hs-identifier hs-var">ls</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1840"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985140"><span class="annot"><span class="annottext">ls' :: [(String, [(Var, loc)], PreExp ext loc (UrTy loc))]
</span><a href="#local-6989586621680985140"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc (UrTy loc))
 -&gt; (String, [(Var, loc)], PreExp ext loc (UrTy loc)))
-&gt; [(String, [(Var, loc)], PreExp ext loc (UrTy loc))]
-&gt; [(String, [(Var, loc)], PreExp ext loc (UrTy loc))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680985141"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985141"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985142"><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680985142"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985143"><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985143"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985141"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680985142"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc) -&gt; PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985093"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985143"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc (UrTy loc))]
</span><a href="#local-6989586621680985139"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1841"></span><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
-&gt; [(String, [(Var, loc)], PreExp ext loc (UrTy loc))]
-&gt; PreExp ext loc (UrTy loc)
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985138"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc (UrTy loc))]
</span><a href="#local-6989586621680985140"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-1842"></span><span>    </span><span id="local-6989586621680985144"><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985144"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc (UrTy loc)
</span><a href="#local-6989586621680985144"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1843"></span><span>
</span><span id="line-1844"></span><span class="hs-comment">-- This function optimizes the tupled function by removing redundant output</span><span>
</span><span id="line-1845"></span><span class="hs-comment">-- parameters and their computation.</span><span>
</span><span id="line-1846"></span><span class="hs-comment">-- redundant positions are pr-computed and stored in testedPositions.</span><span>
</span><span id="line-1847"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#removeRedundantOutput"><span class="hs-identifier hs-type">removeRedundantOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1848"></span><span id="removeRedundantOutput"><span class="annot"><span class="annottext">removeRedundantOutput :: FunDef1
-&gt; Map (Var, Int, Int) Bool -&gt; (FunDef1, Map Int Int, Map Int Int)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantOutput"><span class="hs-identifier hs-var hs-var">removeRedundantOutput</span></a></span></span><span>  </span><span id="local-6989586621680985209"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span id="local-6989586621680985210"><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680985210"><span class="hs-identifier hs-var">testedPositions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1849"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985211"><span class="annot"><span class="annottext">outputsFromInputs :: Map Int Int
</span><a href="#local-6989586621680985211"><span class="hs-identifier hs-var hs-var">outputsFromInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Map Int Int
</span><a href="Gibbon.Passes.Fusion2.html#getOutputsFromInput"><span class="hs-identifier hs-var">getOutputsFromInput</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1850"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985213"><span class="annot"><span class="annottext">outputTuples :: Vector (Vector Exp1)
</span><a href="#local-6989586621680985213"><span class="hs-identifier hs-var hs-var">outputTuples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Exp1] -&gt; Vector (Vector Exp1)
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; [Vector Exp1]
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; [Vector (PreExp ext loc dec)]
</span><a href="#local-6989586621680985214"><span class="hs-identifier hs-var">collectOutputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1851"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985215"><span class="annot"><span class="annottext">firstTuple :: Vector Exp1
</span><a href="#local-6989586621680985215"><span class="hs-identifier hs-var hs-var">firstTuple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Vector Exp1)
</span><a href="#local-6989586621680985213"><span class="hs-identifier hs-var">outputTuples</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Vector Exp1) -&gt; Int -&gt; Vector Exp1
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">--return vector</span><span>
</span><span id="line-1852"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985216"><span class="annot"><span class="annottext">loop :: Int -&gt; Int -&gt; [Int]
</span><a href="#local-6989586621680985216"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621680985217"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985217"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680985218"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985218"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1853"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985218"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Exp1 -&gt; Int
forall a. Vector a -&gt; Int
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#length"><span class="hs-identifier hs-var">V.length</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680985215"><span class="hs-identifier hs-var">firstTuple</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1854"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1855"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-1856"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985219"><span class="annot"><span class="annottext">res :: Bool
</span><a href="#local-6989586621680985219"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1857"></span><span>                 </span><span class="hs-keyword">if</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, Int, Int) -&gt; Map (Var, Int, Int) Bool -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985217"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985218"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680985210"><span class="hs-identifier hs-var">testedPositions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1858"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680985210"><span class="hs-identifier hs-var">testedPositions</span></a></span><span>  </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool -&gt; (Var, Int, Int) -&gt; Bool
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985217"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985218"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1859"></span><span>                  </span><span class="hs-keyword">else</span><span>  </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool
</span><a href="#local-6989586621680985210"><span class="hs-identifier hs-var">testedPositions</span></a></span><span>  </span><span class="annot"><span class="annottext">Map (Var, Int, Int) Bool -&gt; (Var, Int, Int) -&gt; Bool
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985218"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985217"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1860"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985219"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1861"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985218"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; [Int]
</span><a href="#local-6989586621680985216"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985217"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985218"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1862"></span><span>              </span><span class="hs-keyword">else</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; [Int]
</span><a href="#local-6989586621680985216"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985217"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985218"><span class="hs-identifier hs-var">j</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1863"></span><span>
</span><span id="line-1864"></span><span>        </span><span id="local-6989586621680985220"><span class="annot"><span class="annottext">candidates :: [(Int, Int)]
</span><a href="#local-6989586621680985220"><span class="hs-identifier hs-var hs-var">candidates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Int, Int)] -&gt; Int -&gt; Exp1 -&gt; [(Int, Int)])
-&gt; [(Int, Int)] -&gt; Vector Exp1 -&gt; [(Int, Int)]
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-1865"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985221"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621680985221"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680985222"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985222"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1866"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985223"><span class="annot"><span class="annottext">matches :: Vector Int
</span><a href="#local-6989586621680985223"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Vector Int
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; [Int]
</span><a href="#local-6989586621680985216"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985222"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985222"><span class="hs-identifier hs-var">idx</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1867"></span><span>                </span><span id="local-6989586621680985224"><span class="annot"><span class="annottext">cands :: [(Int, Int)]
</span><a href="#local-6989586621680985224"><span class="hs-identifier hs-var hs-var">cands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(Int -&gt; (Int, Int)) -&gt; [Int] -&gt; [(Int, Int)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985222"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int -&gt; [Int]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680985223"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">--`debug` (show matches)</span><span>
</span><span id="line-1868"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621680985221"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; [(Int, Int)] -&gt; [(Int, Int)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621680985224"><span class="hs-identifier hs-var">cands</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1869"></span><span>          </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680985215"><span class="hs-identifier hs-var">firstTuple</span></a></span><span>
</span><span id="line-1870"></span><span>
</span><span id="line-1871"></span><span>        </span><span id="local-6989586621680985225"><span class="annot"><span class="annottext">ncols :: Int
</span><a href="#local-6989586621680985225"><span class="hs-identifier hs-var hs-var">ncols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; Int
forall a. Vector a -&gt; Int
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#length"><span class="hs-identifier hs-var">V.length</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680985215"><span class="hs-identifier hs-var">firstTuple</span></a></span><span>
</span><span id="line-1872"></span><span>        </span><span id="local-6989586621680985226"><span class="annot"><span class="annottext">nrows :: Int
</span><a href="#local-6989586621680985226"><span class="hs-identifier hs-var hs-var">nrows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Vector Exp1) -&gt; Int
forall a. Vector a -&gt; Int
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#length"><span class="hs-identifier hs-var">V.length</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Vector Exp1)
</span><a href="#local-6989586621680985213"><span class="hs-identifier hs-var">outputTuples</span></a></span><span>
</span><span id="line-1873"></span><span>        </span><span id="local-6989586621680985227"><span class="annot"><span class="annottext">initialMap :: Map Int [Int]
</span><a href="#local-6989586621680985227"><span class="hs-identifier hs-var hs-var">initialMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, [Int])] -&gt; Map Int [Int]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; (Int, [Int])) -&gt; [Int] -&gt; [(Int, [Int])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985225"><span class="hs-identifier hs-var">ncols</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1874"></span><span>    </span><span class="hs-comment">--    tricky!</span><span>
</span><span id="line-1875"></span><span>        </span><span id="local-6989586621680985229"><span class="annot"><span class="annottext">finalMap :: Map Int [Int]
</span><a href="#local-6989586621680985229"><span class="hs-identifier hs-var hs-var">finalMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Int [Int] -&gt; (Int, Int) -&gt; Map Int [Int])
-&gt; Map Int [Int] -&gt; [(Int, Int)] -&gt; Map Int [Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span>
</span><span id="line-1876"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985230"><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985230"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985231"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985231"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985232"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985232"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1877"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985233"><span class="annot"><span class="annottext">k :: Int
</span><a href="#local-6989586621680985233"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; [Int] -&gt; Int
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span>
</span><span id="line-1878"></span><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985234"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985234"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680985235"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985235"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985234"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1879"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985234"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1880"></span><span>                       </span><span class="hs-keyword">else</span><span>
</span><span id="line-1881"></span><span>                         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int [Int] -&gt; Maybe [Int]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985235"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985230"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1882"></span><span>                           </span><span class="annot"><span class="annottext">Maybe [Int]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985234"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1883"></span><span>                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680985236"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985236"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1884"></span><span>                             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985231"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985236"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1885"></span><span>                                </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985234"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1886"></span><span>                                </span><span id="local-6989586621680985237"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680985237"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985235"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-1887"></span><span>                    </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985231"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1888"></span><span>                  </span><span id="local-6989586621680985238"><span class="annot"><span class="annottext">mp' :: Map Int [Int]
</span><a href="#local-6989586621680985238"><span class="hs-identifier hs-var hs-var">mp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int [Int] -&gt; Map Int [Int]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985232"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985230"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-1889"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985233"><span class="hs-identifier hs-var">k</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1890"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Map Int [Int] -&gt; Map Int [Int]
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985231"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985238"><span class="hs-identifier hs-var">mp'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int [Int] -&gt; Int -&gt; [Int]
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985231"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985232"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985238"><span class="hs-identifier hs-var">mp'</span></a></span><span>
</span><span id="line-1891"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Map Int [Int] -&gt; Map Int [Int]
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985233"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985238"><span class="hs-identifier hs-var">mp'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int [Int] -&gt; Int -&gt; [Int]
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985233"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985232"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985238"><span class="hs-identifier hs-var">mp'</span></a></span><span>
</span><span id="line-1892"></span><span>            </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985227"><span class="hs-identifier hs-var">initialMap</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621680985220"><span class="hs-identifier hs-var">candidates</span></a></span><span>
</span><span id="line-1893"></span><span>
</span><span id="line-1894"></span><span>        </span><span id="local-6989586621680985240"><span class="annot"><span class="annottext">removedPositions_ :: [Int]
</span><a href="#local-6989586621680985240"><span class="hs-identifier hs-var hs-var">removedPositions_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int -&gt; [Int]) -&gt; [Int] -&gt; [Int] -&gt; [Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span>
</span><span id="line-1895"></span><span>           </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985241"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985241"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680985242"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985242"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1896"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int [Int] -&gt; Maybe [Int]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985242"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985229"><span class="hs-identifier hs-var">finalMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1897"></span><span>              </span><span class="annot"><span class="annottext">Maybe [Int]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985241"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985242"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1898"></span><span>              </span><span id="local-6989586621680985243"><span class="annot"><span class="annottext">Maybe [Int]
</span><a href="#local-6989586621680985243"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985241"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1899"></span><span>          </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985225"><span class="hs-identifier hs-var">ncols</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1900"></span><span>
</span><span id="line-1901"></span><span>        </span><span id="local-6989586621680985244"><span class="annot"><span class="annottext">removedPositions :: [Int]
</span><a href="#local-6989586621680985244"><span class="hs-identifier hs-var hs-var">removedPositions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1902"></span><span>           </span><span class="annot"><span class="annottext">Set Int -&gt; [Int]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Int -&gt; Set Int -&gt; Set Int
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">S.union</span></a></span><span>
</span><span id="line-1903"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Set Int
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985240"><span class="hs-identifier hs-var">removedPositions_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1904"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Set Int
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, Int) -&gt; Int) -&gt; [(Int, Int)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680985246"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985246"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680985247"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985247"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985246"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Int -&gt; [(Int, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985211"><span class="hs-identifier hs-var">outputsFromInputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1905"></span><span>        </span><span id="local-6989586621680985248"><span class="annot"><span class="annottext">newFunType :: ([Ty1], Ty1)
</span><a href="#local-6989586621680985248"><span class="hs-identifier hs-var hs-var">newFunType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1906"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985249"><span class="annot"><span class="annottext">oldOutTypesList :: Vector Ty1
</span><a href="#local-6989586621680985249"><span class="hs-identifier hs-var hs-var">oldOutTypesList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Vector Ty1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1907"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680985250"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680985250"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680985250"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1908"></span><span>              </span><span id="local-6989586621680985251"><span class="annot"><span class="annottext">newOutTypesList :: [Ty1]
</span><a href="#local-6989586621680985251"><span class="hs-identifier hs-var hs-var">newOutTypesList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1] -&gt; Int -&gt; Ty1 -&gt; [Ty1]) -&gt; [Ty1] -&gt; Vector Ty1 -&gt; [Ty1]
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-1909"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985252"><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680985252"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680985253"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985253"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621680985254"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680985254"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1910"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985253"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985244"><span class="hs-identifier hs-var">removedPositions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1911"></span><span>                      </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680985252"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; [Ty1] -&gt; [Ty1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680985254"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1912"></span><span>                      </span><span id="local-6989586621680985255"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680985255"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680985252"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1913"></span><span>                </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Vector Ty1
</span><a href="#local-6989586621680985249"><span class="hs-identifier hs-var">oldOutTypesList</span></a></span><span>
</span><span id="line-1914"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ty1] -&gt; Ty1
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680985251"><span class="hs-identifier hs-var">newOutTypesList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1915"></span><span>
</span><span id="line-1916"></span><span>        </span><span id="local-6989586621680985256"><span class="annot"><span class="annottext">newOutputTuples :: Vector Exp1
</span><a href="#local-6989586621680985256"><span class="hs-identifier hs-var hs-var">newOutputTuples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Vector Exp1 -&gt; Exp1) -&gt; Vector (Vector Exp1) -&gt; Vector Exp1
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#map"><span class="hs-identifier hs-var">V.map</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; Exp1
</span><a href="#local-6989586621680985257"><span class="hs-identifier hs-var">removeDropped</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Vector Exp1)
</span><a href="#local-6989586621680985213"><span class="hs-identifier hs-var">outputTuples</span></a></span><span>
</span><span id="line-1917"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1918"></span><span>            </span><span id="local-6989586621680985257"><span class="annot"><span class="annottext">removeDropped :: Vector Exp1 -&gt; Exp1
</span><a href="#local-6989586621680985257"><span class="hs-identifier hs-var hs-var">removeDropped</span></a></span></span><span> </span><span id="local-6989586621680985258"><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680985258"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Exp1] -&gt; Int -&gt; Exp1 -&gt; [Exp1])
-&gt; [Exp1] -&gt; Vector Exp1 -&gt; [Exp1]
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-1919"></span><span>               </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985259"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985259"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621680985260"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985260"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621680985261"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985261"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1920"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985260"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985244"><span class="hs-identifier hs-var">removedPositions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1921"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985259"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1] -&gt; [Exp1] -&gt; [Exp1]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985261"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1922"></span><span>                    </span><span id="local-6989586621680985262"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680985262"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985259"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1923"></span><span>               </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680985258"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1924"></span><span>
</span><span id="line-1925"></span><span>        </span><span id="local-6989586621680985263"><span class="annot"><span class="annottext">newFunBody :: Exp1
</span><a href="#local-6989586621680985263"><span class="hs-identifier hs-var hs-var">newFunBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1926"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680985264"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985264"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680985265"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985265"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1927"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985266"><span class="annot"><span class="annottext">ls' :: [(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985266"><span class="hs-identifier hs-var hs-var">ls'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (String, [(Var, ())], Exp1) -&gt; [(String, [(Var, ())], Exp1)]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; (String, [(Var, ())], Exp1) -&gt; (String, [(Var, ())], Exp1))
-&gt; Vector (String, [(Var, ())], Exp1)
-&gt; Vector (String, [(Var, ())], Exp1)
forall a b. (Int -&gt; a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#imap"><span class="hs-identifier hs-var">V.imap</span></a></span><span>
</span><span id="line-1928"></span><span>                   </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985267"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985267"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985268"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985268"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985269"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680985269"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985270"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985270"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1929"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985271"><span class="annot"><span class="annottext">exp' :: Exp1
</span><a href="#local-6989586621680985271"><span class="hs-identifier hs-var hs-var">exp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680985272"><span class="hs-identifier hs-var">replaceLeafExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985270"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Exp1
</span><a href="#local-6989586621680985256"><span class="hs-identifier hs-var">newOutputTuples</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Exp1 -&gt; Int -&gt; Exp1
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985267"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1930"></span><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985268"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680985269"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985271"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)] -&gt; Vector (String, [(Var, ())], Exp1)
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985265"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1931"></span><span>              </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985264"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985266"><span class="hs-identifier hs-var">ls'</span></a></span><span>
</span><span id="line-1932"></span><span>        </span><span id="local-6989586621680985273"><span class="annot"><span class="annottext">fdef' :: FunDef1
</span><a href="#local-6989586621680985273"><span class="hs-identifier hs-var hs-var">fdef'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985263"><span class="hs-identifier hs-var">newFunBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funTy :: ArrowTy (TyOf Exp1)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1)
ArrowTy (TyOf Exp1)
</span><a href="#local-6989586621680985248"><span class="hs-identifier hs-var">newFunType</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1933"></span><span>
</span><span id="line-1934"></span><span>        </span><span id="local-6989586621680985274"><span class="annot"><span class="annottext">redirectMap :: Map Int Int
</span><a href="#local-6989586621680985274"><span class="hs-identifier hs-var hs-var">redirectMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Int Int -&gt; Int -&gt; (Int, [Int]) -&gt; Map Int Int)
-&gt; Map Int Int -&gt; Vector (Int, [Int]) -&gt; Map Int Int
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span>
</span><span id="line-1935"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985275"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985275"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621680985276"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985276"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985277"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985277"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985278"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985278"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1936"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985279"><span class="annot"><span class="annottext">mp' :: Map Int Int
</span><a href="#local-6989586621680985279"><span class="hs-identifier hs-var hs-var">mp'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Map Int Int -&gt; Map Int Int
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985277"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985276"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985275"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-1937"></span><span>                    </span><span id="local-6989586621680985280"><span class="annot"><span class="annottext">mp'' :: Map Int Int
</span><a href="#local-6989586621680985280"><span class="hs-identifier hs-var hs-var">mp''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Int Int -&gt; Int -&gt; Map Int Int)
-&gt; Map Int Int -&gt; [Int] -&gt; Map Int Int
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985281"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985281"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680985282"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985282"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Map Int Int -&gt; Map Int Int
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985282"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985276"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985281"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985279"><span class="hs-identifier hs-var">mp'</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985278"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1938"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985280"><span class="hs-identifier hs-var">mp''</span></a></span><span>
</span><span id="line-1939"></span><span>            </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int Int
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, [Int])] -&gt; Vector (Int, [Int])
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int [Int] -&gt; [(Int, [Int])]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621680985229"><span class="hs-identifier hs-var">finalMap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1940"></span><span>
</span><span id="line-1941"></span><span>        </span><span id="local-6989586621680985283"><span class="annot"><span class="annottext">removedUnhandled :: [Int]
</span><a href="#local-6989586621680985283"><span class="hs-identifier hs-var hs-var">removedUnhandled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Int) -&gt; [(Int, Int)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680985284"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985284"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985285"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985285"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985284"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Int -&gt; [(Int, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985211"><span class="hs-identifier hs-var">outputsFromInputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1942"></span><span>        </span><span id="local-6989586621680985286"><span class="annot"><span class="annottext">redirectMap' :: Map Int Int
</span><a href="#local-6989586621680985286"><span class="hs-identifier hs-var hs-var">redirectMap'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Int Int -&gt; Int -&gt; Map Int Int)
-&gt; Map Int Int -&gt; [Int] -&gt; Map Int Int
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985287"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985287"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621680985288"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985288"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-glyph">-&gt;</span><span class="annot"><span class="annottext">Int -&gt; Map Int Int -&gt; Map Int Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985288"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985287"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985274"><span class="hs-identifier hs-var">redirectMap</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985283"><span class="hs-identifier hs-var">removedUnhandled</span></a></span><span>
</span><span id="line-1943"></span><span>        </span><span id="local-6989586621680985289"><span class="annot"><span class="annottext">redirectMap'' :: Map Int Int
</span><a href="#local-6989586621680985289"><span class="hs-identifier hs-var hs-var">redirectMap''</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Map Int Int -&gt; Map Int Int
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985290"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985290"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985290"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621680985291"><span class="hs-identifier hs-var">countLess</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985290"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985286"><span class="hs-identifier hs-var">redirectMap'</span></a></span><span>
</span><span id="line-1944"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1945"></span><span>            </span><span id="local-6989586621680985291"><span class="annot"><span class="annottext">countLess :: Int -&gt; Int
</span><a href="#local-6989586621680985291"><span class="hs-identifier hs-var hs-var">countLess</span></a></span></span><span> </span><span id="local-6989586621680985292"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985292"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; [Int] -&gt; Int
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985293"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985293"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621680985294"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985294"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985294"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985292"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985293"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985293"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1946"></span><span>               </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680985283"><span class="hs-identifier hs-var">removedUnhandled</span></a></span><span>
</span><span id="line-1947"></span><span>
</span><span id="line-1948"></span><span>        </span><span id="local-6989586621680985296"><span class="annot"><span class="annottext">fdef'' :: FunDef1
</span><a href="#local-6989586621680985296"><span class="hs-identifier hs-var hs-var">fdef''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1949"></span><span>          </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985273"><span class="hs-identifier hs-var">fdef'</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">funName :: Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1950"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985263"><span class="hs-identifier hs-var">newFunBody</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985209"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1951"></span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985273"><span class="hs-identifier hs-var">fdef'</span></a></span><span>
</span><span id="line-1952"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985273"><span class="hs-identifier hs-var">fdef'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outputFixed&quot;</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1953"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1954"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985296"><span class="hs-identifier hs-var">fdef''</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985289"><span class="hs-identifier hs-var">redirectMap''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985211"><span class="hs-identifier hs-var">outputsFromInputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">--`debug` (&quot;summer for &quot; L.++ (show (funName fdef')) L.++ (show  outputsFromInputs ))</span><span>
</span><span id="line-1955"></span><span>
</span><span id="line-1956"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1957"></span><span>  </span><span id="local-6989586621680985272"><span class="annot"><span class="annottext">replaceLeafExp :: PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680985272"><span class="hs-identifier hs-var hs-var">replaceLeafExp</span></a></span></span><span> </span><span id="local-6989586621680985297"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985297"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680985298"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985298"><span class="hs-identifier hs-var">replacement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1958"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985297"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1959"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985299"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985299"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985300"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985300"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985301"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680985301"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985302"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985302"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985303"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985303"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1960"></span><span>          </span><span class="annot"><span class="annottext">(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985299"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985300"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680985301"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985302"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="#local-6989586621680985272"><span class="hs-identifier hs-var">replaceLeafExp</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985303"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985298"><span class="hs-identifier hs-var">replacement</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1961"></span><span>      </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680985304"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985304"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985298"><span class="hs-identifier hs-var">replacement</span></a></span><span>
</span><span id="line-1962"></span><span>
</span><span id="line-1963"></span><span>  </span><span id="local-6989586621680985214"><span class="annot"><span class="annottext">collectOutputs :: PreExp ext loc dec -&gt; [Vector (PreExp ext loc dec)]
</span><a href="#local-6989586621680985214"><span class="hs-identifier hs-var hs-var">collectOutputs</span></a></span></span><span> </span><span id="local-6989586621680985307"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985307"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985307"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1964"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680985308"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985308"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680985309"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680985309"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1965"></span><span>         </span><span class="annot"><span class="annottext">((String, [(Var, loc)], PreExp ext loc dec)
 -&gt; Vector (PreExp ext loc dec))
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; [Vector (PreExp ext loc dec)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680985310"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985310"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985311"><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680985311"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985312"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985312"><span class="hs-identifier hs-var">subBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec] -&gt; Vector (PreExp ext loc dec)
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; [PreExp ext loc dec]
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; [PreExp ext loc dec]
</span><a href="#local-6989586621680985313"><span class="hs-identifier hs-var">extractLeafTuple</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985312"><span class="hs-identifier hs-var">subBody</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680985309"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1966"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-1967"></span><span>        </span><span id="local-6989586621680985313"><span class="annot"><span class="annottext">extractLeafTuple :: PreExp ext loc dec -&gt; [PreExp ext loc dec]
</span><a href="#local-6989586621680985313"><span class="hs-identifier hs-var hs-var">extractLeafTuple</span></a></span></span><span> </span><span id="local-6989586621680985316"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985316"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1968"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985316"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1969"></span><span>              </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985317"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985317"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985318"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985318"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985319"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680985319"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985320"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985320"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985321"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985321"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; [PreExp ext loc dec]
</span><a href="#local-6989586621680985313"><span class="hs-identifier hs-var">extractLeafTuple</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985321"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1970"></span><span>              </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680985322"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985322"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985322"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-1971"></span><span>              </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [PreExp ext loc dec]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not expected expression&quot;</span></span><span>
</span><span id="line-1972"></span><span>
</span><span id="line-1973"></span><span>    </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Vector (PreExp ext loc dec)]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;should be case expression&quot;</span></span><span>
</span><span id="line-1974"></span><span>
</span><span id="line-1975"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#eliminateInputArgs"><span class="hs-identifier hs-type">eliminateInputArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1976"></span><span id="eliminateInputArgs"><span class="annot"><span class="annottext">eliminateInputArgs :: FunDefs1 -&gt; Var -&gt; Map Int Int -&gt; (Var, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#eliminateInputArgs"><span class="hs-identifier hs-var hs-var">eliminateInputArgs</span></a></span></span><span> </span><span id="local-6989586621680985355"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985355"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680985356"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985356"><span class="hs-identifier hs-var">fNameOld</span></a></span></span><span> </span><span id="local-6989586621680985357"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985357"><span class="hs-identifier hs-var">syncedArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1977"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985358"><span class="annot"><span class="annottext">newName :: Var
</span><a href="#local-6989586621680985358"><span class="hs-identifier hs-var hs-var">newName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Int -&gt; Int -&gt; String) -&gt; String -&gt; Map Int Int -&gt; String
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldlWithKey"><span class="hs-identifier hs-var">M.foldlWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Int -&gt; String
forall {a} {a}. (Show a, Show a) =&gt; String -&gt; a -&gt; a -&gt; String
</span><a href="#local-6989586621680985359"><span class="hs-identifier hs-var">buildName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985356"><span class="hs-identifier hs-var">fNameOld</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;elimpass_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985357"><span class="hs-identifier hs-var">syncedArgs</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_elimpass&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1978"></span><span>      </span><span id="local-6989586621680985360"><span class="annot"><span class="annottext">fdefs' :: FunDefs1
</span><a href="#local-6989586621680985360"><span class="hs-identifier hs-var hs-var">fdefs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1979"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDefs1 -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985358"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985355"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1980"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985355"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-1981"></span><span>              </span><span class="hs-keyword">else</span><span>
</span><span id="line-1982"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985361"><span class="annot"><span class="annottext">oldFdef :: FunDef1
</span><a href="#local-6989586621680985361"><span class="hs-identifier hs-var hs-var">oldFdef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985355"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985356"><span class="hs-identifier hs-var">fNameOld</span></a></span><span>
</span><span id="line-1983"></span><span>                       </span><span id="local-6989586621680985362"><span class="annot"><span class="annottext">oldInputType :: [Ty1]
</span><a href="#local-6989586621680985362"><span class="hs-identifier hs-var hs-var">oldInputType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; [Ty1]
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985361"><span class="hs-identifier hs-var">oldFdef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1984"></span><span>                       </span><span id="local-6989586621680985363"><span class="annot"><span class="annottext">oldArgs :: [Var]
</span><a href="#local-6989586621680985363"><span class="hs-identifier hs-var hs-var">oldArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985361"><span class="hs-identifier hs-var">oldFdef</span></a></span><span>
</span><span id="line-1985"></span><span>                       </span><span id="local-6989586621680985364"><span class="annot"><span class="annottext">oldBody :: Exp1
</span><a href="#local-6989586621680985364"><span class="hs-identifier hs-var hs-var">oldBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985361"><span class="hs-identifier hs-var">oldFdef</span></a></span><span>
</span><span id="line-1986"></span><span>                       </span><span id="local-6989586621680985365"><span class="annot"><span class="annottext">newInputType :: [Ty1]
</span><a href="#local-6989586621680985365"><span class="hs-identifier hs-var hs-var">newInputType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1987"></span><span>                         </span><span class="annot"><span class="annottext">Vector Ty1 -&gt; [Ty1]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span>
</span><span id="line-1988"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Ty1 -&gt; Bool) -&gt; Vector Ty1 -&gt; Vector Ty1
forall a. (Int -&gt; a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifilter"><span class="hs-identifier hs-var">V.ifilter</span></a></span><span>
</span><span id="line-1989"></span><span>                              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985366"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985366"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int Int -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#notMember"><span class="hs-identifier hs-var">M.notMember</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985366"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985357"><span class="hs-identifier hs-var">syncedArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1990"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1] -&gt; Vector Ty1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680985362"><span class="hs-identifier hs-var">oldInputType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1991"></span><span>                           </span><span class="hs-special">)</span><span>
</span><span id="line-1992"></span><span>                       </span><span id="local-6989586621680985368"><span class="annot"><span class="annottext">newArgs :: [Var]
</span><a href="#local-6989586621680985368"><span class="hs-identifier hs-var hs-var">newArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1993"></span><span>                         </span><span class="annot"><span class="annottext">Vector Var -&gt; [Var]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span>
</span><span id="line-1994"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Var -&gt; Bool) -&gt; Vector Var -&gt; Vector Var
forall a. (Int -&gt; a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifilter"><span class="hs-identifier hs-var">V.ifilter</span></a></span><span>
</span><span id="line-1995"></span><span>                              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985369"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985369"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int Int -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#notMember"><span class="hs-identifier hs-var">M.notMember</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985369"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985357"><span class="hs-identifier hs-var">syncedArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1996"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Vector Var
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680985363"><span class="hs-identifier hs-var">oldArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1997"></span><span>                           </span><span class="hs-special">)</span><span>
</span><span id="line-1998"></span><span>                       </span><span id="local-6989586621680985370"><span class="annot"><span class="annottext">newBody :: Exp1
</span><a href="#local-6989586621680985370"><span class="hs-identifier hs-var hs-var">newBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1999"></span><span>                         </span><span class="annot"><span class="annottext">(Exp1 -&gt; Int -&gt; Int -&gt; Exp1) -&gt; Exp1 -&gt; Map Int Int -&gt; Exp1
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldlWithKey"><span class="hs-identifier hs-var">M.foldlWithKey</span></a></span><span>
</span><span id="line-2000"></span><span>                           </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985371"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985371"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680985372"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985372"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680985373"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985373"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2001"></span><span>                              </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985373"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span>
</span><span id="line-2002"></span><span>                              </span><span class="hs-keyword">then</span><span>
</span><span id="line-2003"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985374"><span class="annot"><span class="annottext">oldExp :: Exp1
</span><a href="#local-6989586621680985374"><span class="hs-identifier hs-var hs-var">oldExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Vector Var
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680985363"><span class="hs-identifier hs-var">oldArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Var -&gt; Int -&gt; Var
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985372"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2004"></span><span>                                    </span><span id="local-6989586621680985375"><span class="annot"><span class="annottext">newExp :: Exp1
</span><a href="#local-6989586621680985375"><span class="hs-identifier hs-var hs-var">newExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec. Var -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Vector Var
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680985363"><span class="hs-identifier hs-var">oldArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Var -&gt; Int -&gt; Var
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985373"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2005"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Exp1 -&gt; Exp1
forall (e :: * -&gt; * -&gt; *) l d.
HasSubstitutable e l d =&gt;
PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d -&gt; PreExp e l d
</span><a href="Gibbon.Language.html#substE"><span class="hs-identifier hs-var">substE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985374"><span class="hs-identifier hs-var">oldExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985375"><span class="hs-identifier hs-var">newExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985371"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-2006"></span><span>                              </span><span class="hs-keyword">else</span><span>
</span><span id="line-2007"></span><span>                                </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985371"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-2008"></span><span>                              </span><span class="hs-special">)</span><span>
</span><span id="line-2009"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985364"><span class="hs-identifier hs-var">oldBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2010"></span><span>                           </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985357"><span class="hs-identifier hs-var">syncedArgs</span></a></span><span>
</span><span id="line-2011"></span><span>                       </span><span id="local-6989586621680985376"><span class="annot"><span class="annottext">newFdef :: FunDef1
</span><a href="#local-6989586621680985376"><span class="hs-identifier hs-var hs-var">newFdef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2012"></span><span>                         </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985361"><span class="hs-identifier hs-var">oldFdef</span></a></span><span>
</span><span id="line-2013"></span><span>                           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1
</span><a href="Gibbon.Passes.Fusion2.html#cleanExp"><span class="hs-identifier hs-var">cleanExp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985370"><span class="hs-identifier hs-var">newBody</span></a></span><span>
</span><span id="line-2014"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funArgs :: [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680985368"><span class="hs-identifier hs-var">newArgs</span></a></span><span>
</span><span id="line-2015"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funTy :: ArrowTy (TyOf Exp1)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ty1]
</span><a href="#local-6989586621680985365"><span class="hs-identifier hs-var">newInputType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">([Ty1], Ty1) -&gt; Ty1
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; ArrowTy (TyOf Exp1)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985361"><span class="hs-identifier hs-var">oldFdef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2016"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">funName :: Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985358"><span class="hs-identifier hs-var">newName</span></a></span><span>
</span><span id="line-2017"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-2018"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985358"><span class="hs-identifier hs-var">newName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985376"><span class="hs-identifier hs-var">newFdef</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985355"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-2019"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985358"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985360"><span class="hs-identifier hs-var">fdefs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2020"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2021"></span><span>    </span><span id="local-6989586621680985359"><span class="annot"><span class="annottext">buildName :: String -&gt; a -&gt; a -&gt; String
</span><a href="#local-6989586621680985359"><span class="hs-identifier hs-var hs-var">buildName</span></a></span></span><span> </span><span id="local-6989586621680985385"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985385"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680985386"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985386"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680985387"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985387"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2022"></span><span>      </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985385"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_sync&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985386"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_fr_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985387"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sync_&quot;</span></span><span>
</span><span id="line-2023"></span><span>
</span><span id="line-2024"></span><span class="hs-comment">-- simplest version for single functions</span><span>
</span><span id="line-2025"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#getOutputsFromInput"><span class="hs-identifier hs-type">getOutputsFromInput</span></a></span><span> </span><span class="hs-glyph">::</span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-2026"></span><span id="getOutputsFromInput"><span class="annot"><span class="annottext">getOutputsFromInput :: FunDef1 -&gt; Map Int Int
</span><a href="Gibbon.Passes.Fusion2.html#getOutputsFromInput"><span class="hs-identifier hs-var hs-var">getOutputsFromInput</span></a></span></span><span> </span><span id="local-6989586621680985396"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985396"><span class="hs-identifier hs-var">func</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-2027"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985397"><span class="annot"><span class="annottext">body :: Exp1
</span><a href="#local-6989586621680985397"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985396"><span class="hs-identifier hs-var">func</span></a></span><span>
</span><span id="line-2028"></span><span>      </span><span id="local-6989586621680985398"><span class="annot"><span class="annottext">leafProducts :: [[Exp1]]
</span><a href="#local-6989586621680985398"><span class="hs-identifier hs-var hs-var">leafProducts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985397"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2029"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680985399"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985399"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680985400"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985400"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2030"></span><span>               </span><span class="annot"><span class="annottext">((String, [(Var, ())], Exp1) -&gt; [Exp1])
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [[Exp1]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680985401"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985401"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [Exp1]
</span><a href="Gibbon.Passes.Fusion2.html#getLeafProdExpressions"><span class="hs-identifier hs-var">getLeafProdExpressions</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985401"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985400"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-2031"></span><span>      </span><span id="local-6989586621680985403"><span class="annot"><span class="annottext">inputVars :: [Var]
</span><a href="#local-6989586621680985403"><span class="hs-identifier hs-var hs-var">inputVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985396"><span class="hs-identifier hs-var">func</span></a></span><span>
</span><span id="line-2032"></span><span>      </span><span id="local-6989586621680985404"><span class="annot"><span class="annottext">candidatesList :: [Map Int Int]
</span><a href="#local-6989586621680985404"><span class="hs-identifier hs-var hs-var">candidatesList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2033"></span><span>
</span><span id="line-2034"></span><span>       </span><span class="annot"><span class="annottext">([Exp1] -&gt; Map Int Int) -&gt; [[Exp1]] -&gt; [Map Int Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985405"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985405"><span class="hs-identifier hs-var">exprList</span></a></span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2035"></span><span>          </span><span class="annot"><span class="annottext">(Map Int Int -&gt; Int -&gt; Exp1 -&gt; Map Int Int)
-&gt; Map Int Int -&gt; Vector Exp1 -&gt; Map Int Int
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int -&gt; Int -&gt; Exp1 -&gt; Map Int Int
</span><a href="#local-6989586621680985406"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985405"><span class="hs-identifier hs-var">exprList</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Exp1]]
</span><a href="#local-6989586621680985398"><span class="hs-identifier hs-var">leafProducts</span></a></span><span>
</span><span id="line-2036"></span><span>         </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680985406"><span class="annot"><span class="annottext">f :: Map Int Int -&gt; Int -&gt; Exp1 -&gt; Map Int Int
</span><a href="#local-6989586621680985406"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680985407"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985407"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span id="local-6989586621680985408"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985408"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621680985409"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985409"><span class="hs-identifier hs-var">outExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2037"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985409"><span class="hs-identifier hs-var">outExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2038"></span><span>                    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680985410"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985410"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2039"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985410"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680985403"><span class="hs-identifier hs-var">inputVars</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2040"></span><span>                        </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985407"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-2041"></span><span>                        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680985411"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985411"><span class="hs-identifier hs-var">argIdx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Map Int Int -&gt; Map Int Int
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985408"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985411"><span class="hs-identifier hs-var">argIdx</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985407"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-2042"></span><span>                    </span><span id="local-6989586621680985412"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985412"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985407"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-2043"></span><span>      </span><span id="local-6989586621680985413"><span class="annot"><span class="annottext">candidatesListSets :: [Set (Int, Int)]
</span><a href="#local-6989586621680985413"><span class="hs-identifier hs-var hs-var">candidatesListSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Int Int -&gt; Set (Int, Int))
-&gt; [Map Int Int] -&gt; [Set (Int, Int)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">L.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985414"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985414"><span class="hs-identifier hs-var">mp</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; Set (Int, Int)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Int -&gt; [(Int, Int)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985414"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Map Int Int]
</span><a href="#local-6989586621680985404"><span class="hs-identifier hs-var">candidatesList</span></a></span><span>
</span><span id="line-2044"></span><span>      </span><span id="local-6989586621680985415"><span class="annot"><span class="annottext">intersectionsSet :: Set (Int, Int)
</span><a href="#local-6989586621680985415"><span class="hs-identifier hs-var hs-var">intersectionsSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set (Int, Int) -&gt; Set (Int, Int) -&gt; Set (Int, Int))
-&gt; Set (Int, Int) -&gt; [Set (Int, Int)] -&gt; Set (Int, Int)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Int, Int) -&gt; Set (Int, Int) -&gt; Set (Int, Int)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">S.intersection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Set (Int, Int)] -&gt; Set (Int, Int)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">L.head</span></a></span><span> </span><span class="annot"><span class="annottext">[Set (Int, Int)]
</span><a href="#local-6989586621680985413"><span class="hs-identifier hs-var">candidatesListSets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Set (Int, Int)]
</span><a href="#local-6989586621680985413"><span class="hs-identifier hs-var">candidatesListSets</span></a></span><span>
</span><span id="line-2045"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; Map Int Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (Int, Int) -&gt; [(Int, Int)]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Int, Int)
</span><a href="#local-6989586621680985415"><span class="hs-identifier hs-var">intersectionsSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2046"></span><span>
</span><span id="line-2047"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#getLeafProdExpressions"><span class="hs-identifier hs-type">getLeafProdExpressions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2048"></span><span id="getLeafProdExpressions"><span class="annot"><span class="annottext">getLeafProdExpressions :: Exp1 -&gt; [Exp1]
</span><a href="Gibbon.Passes.Fusion2.html#getLeafProdExpressions"><span class="hs-identifier hs-var hs-var">getLeafProdExpressions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [Exp1]
forall {ext :: * -&gt; * -&gt; *} {loc} {dec}.
PreExp ext loc dec -&gt; [PreExp ext loc dec]
</span><a href="#local-6989586621680985416"><span class="hs-identifier hs-var">rec</span></a></span><span>
</span><span id="line-2049"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2050"></span><span>   </span><span id="local-6989586621680985416"><span class="annot"><span class="annottext">rec :: PreExp ext loc dec -&gt; [PreExp ext loc dec]
</span><a href="#local-6989586621680985416"><span class="hs-identifier hs-var hs-var">rec</span></a></span></span><span> </span><span id="local-6989586621680985417"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985417"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2051"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985417"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2052"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985418"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985418"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985419"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985419"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985420"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680985420"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985421"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985421"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; [PreExp ext loc dec]
</span><a href="#local-6989586621680985416"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985421"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-2053"></span><span>       </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680985422"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985422"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985422"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-2054"></span><span>       </span><span id="local-6989586621680985423"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985423"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2055"></span><span>
</span><span id="line-2056"></span><span>
</span><span id="line-2057"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-type">removeRedundantInputExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2058"></span><span id="removeRedundantInputExp"><span class="annot"><span class="annottext">removeRedundantInputExp :: FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-var hs-var">removeRedundantInputExp</span></a></span></span><span> </span><span id="local-6989586621680985450"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985450"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680985451"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985451"><span class="hs-identifier hs-var">exp</span></a></span></span><span>  </span><span id="local-6989586621680985452"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985452"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2059"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985451"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2060"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680985453"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985453"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680985454"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985454"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2061"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985455"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985455"><span class="hs-identifier hs-var">fdefs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985456"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985456"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-var">removeRedundantInputExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985450"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985453"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985452"><span class="hs-identifier hs-var">mode</span></a></span><span>
</span><span id="line-2062"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680985457"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985457"><span class="hs-identifier hs-var">fdefs''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985458"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985458"><span class="hs-identifier hs-var">ls'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FunDefs1, [(String, [(Var, ())], Exp1)])
 -&gt; (String, [(Var, ())], Exp1)
 -&gt; (FunDefs1, [(String, [(Var, ())], Exp1)]))
-&gt; (FunDefs1, [(String, [(Var, ())], Exp1)])
-&gt; [(String, [(Var, ())], Exp1)]
-&gt; (FunDefs1, [(String, [(Var, ())], Exp1)])
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDefs1, [(String, [(Var, ())], Exp1)])
-&gt; (String, [(Var, ())], Exp1)
-&gt; (FunDefs1, [(String, [(Var, ())], Exp1)])
</span><a href="#local-6989586621680985459"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985455"><span class="hs-identifier hs-var">fdefs'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985454"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-2063"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-2064"></span><span>              </span><span id="local-6989586621680985459"><span class="annot"><span class="annottext">f :: (FunDefs1, [(String, [(Var, ())], Exp1)])
-&gt; (String, [(Var, ())], Exp1)
-&gt; (FunDefs1, [(String, [(Var, ())], Exp1)])
</span><a href="#local-6989586621680985459"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985460"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985460"><span class="hs-identifier hs-var">fdefsInner</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985461"><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985461"><span class="hs-identifier hs-var">lsInner</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985462"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985462"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985463"><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680985463"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985464"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985464"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2065"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985465"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985465"><span class="hs-identifier hs-var">fdefsInner'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985466"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985466"><span class="hs-identifier hs-var">exp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-var">removeRedundantInputExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985460"><span class="hs-identifier hs-var">fdefsInner</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985464"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985452"><span class="hs-identifier hs-var">mode</span></a></span><span>
</span><span id="line-2066"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985465"><span class="hs-identifier hs-var">fdefsInner'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985461"><span class="hs-identifier hs-var">lsInner</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
-&gt; [(String, [(Var, ())], Exp1)] -&gt; [(String, [(Var, ())], Exp1)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985462"><span class="hs-identifier hs-var">dataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Var, ())]
</span><a href="#local-6989586621680985463"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985466"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2067"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985457"><span class="hs-identifier hs-var">fdefs''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1 -&gt; [(String, [(Var, ())], Exp1)] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(String, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985456"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, ())], Exp1)]
</span><a href="#local-6989586621680985458"><span class="hs-identifier hs-var">ls'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2068"></span><span>
</span><span id="line-2069"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span id="local-6989586621680985467"><span class="annot"><span class="annottext">rhs :: (Var, [()], Ty1, Exp1)
</span><a href="#local-6989586621680985467"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680985468"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985468"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985469"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680985469"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985470"><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680985470"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985471"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985471"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985472"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985472"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2070"></span><span>
</span><span id="line-2071"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985473"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985473"><span class="hs-identifier hs-var">fdefs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985474"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985474"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-var">removeRedundantInputExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985450"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985472"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985452"><span class="hs-identifier hs-var">mode</span></a></span><span>
</span><span id="line-2072"></span><span>          </span><span id="local-6989586621680985475"><span class="annot"><span class="annottext">boringCase :: (FunDefs1, Exp1)
</span><a href="#local-6989586621680985475"><span class="hs-identifier hs-var hs-var">boringCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985473"><span class="hs-identifier hs-var">fdefs'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1)
</span><a href="#local-6989586621680985467"><span class="hs-identifier hs-var">rhs</span></a></span><span>  </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985474"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2073"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985471"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2074"></span><span>          </span><span id="local-6989586621680985476"><span class="annot"><span class="annottext">x :: Exp1
</span><a href="#local-6989586621680985476"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680985477"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985477"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680985478"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680985478"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680985479"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985479"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2075"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">L.isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_TUP&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985477"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span>
</span><span id="line-2076"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">L.isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_FUS&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985477"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2077"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-2078"></span><span>
</span><span id="line-2079"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985480"><span class="annot"><span class="annottext">redundantPositions :: Map Int Int
</span><a href="#local-6989586621680985480"><span class="hs-identifier hs-var hs-var">redundantPositions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2080"></span><span>                       </span><span class="hs-keyword">if</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985452"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2081"></span><span>                        </span><span class="hs-keyword">then</span><span>
</span><span id="line-2082"></span><span>                          </span><span class="annot"><span class="annottext">(Map Exp1 Int, Map Int Int) -&gt; Map Int Int
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">((Map Exp1 Int, Map Int Int)
 -&gt; Int -&gt; Exp1 -&gt; (Map Exp1 Int, Map Int Int))
-&gt; (Map Exp1 Int, Map Int Int)
-&gt; Vector Exp1
-&gt; (Map Exp1 Int, Map Int Int)
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Exp1 Int, Map Int Int)
-&gt; Int -&gt; Exp1 -&gt; (Map Exp1 Int, Map Int Int)
forall {k} {a}.
(Ord k, Ord a) =&gt;
(Map k a, Map a a) -&gt; a -&gt; k -&gt; (Map k a, Map a a)
</span><a href="#local-6989586621680985481"><span class="hs-identifier hs-var">findRedundantPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Exp1 Int
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Int Int
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985479"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2083"></span><span>                        </span><span class="hs-keyword">else</span><span>
</span><span id="line-2084"></span><span>                           </span><span class="annot"><span class="annottext">(Map Int Int -&gt; Int -&gt; Exp1 -&gt; Map Int Int)
-&gt; Map Int Int -&gt; Vector Exp1 -&gt; Map Int Int
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Map Int Int -&gt; Int -&gt; Exp1 -&gt; Map Int Int
</span><a href="#local-6989586621680985482"><span class="hs-identifier hs-var">findRedundantPos_UnusedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985477"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int Int
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985479"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2085"></span><span>                        </span><span class="hs-comment">--        redundantPositions3 = M.union redundantPositions2 redundantPositions `debug`</span><span>
</span><span id="line-2086"></span><span>                        </span><span class="hs-comment">-- (&quot;checking call to :&quot; L.++ (show fName) L.++ &quot;opppaaaa&quot; L.++ show redundantPositions2)</span><span>
</span><span id="line-2087"></span><span>                  </span><span class="hs-keyword">in</span><span>
</span><span id="line-2088"></span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map Int Int -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#null"><span class="hs-identifier hs-var">M.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985480"><span class="hs-identifier hs-var">redundantPositions</span></a></span><span>
</span><span id="line-2089"></span><span>                    </span><span class="hs-keyword">then</span><span>
</span><span id="line-2090"></span><span>                      </span><span class="annot"><span class="annottext">(FunDefs1, Exp1)
</span><a href="#local-6989586621680985475"><span class="hs-identifier hs-var">boringCase</span></a></span><span>
</span><span id="line-2091"></span><span>                    </span><span class="hs-keyword">else</span><span>
</span><span id="line-2092"></span><span>
</span><span id="line-2093"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985484"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985484"><span class="hs-identifier hs-var">fNameNew</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985485"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985485"><span class="hs-identifier hs-var">fdefsNew</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2094"></span><span>                            </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; Map Int Int -&gt; (Var, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#eliminateInputArgs"><span class="hs-identifier hs-var">eliminateInputArgs</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985473"><span class="hs-identifier hs-var">fdefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985477"><span class="hs-identifier hs-var">fName</span></a></span><span>  </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985480"><span class="hs-identifier hs-var">redundantPositions</span></a></span><span>
</span><span id="line-2095"></span><span>                          </span><span id="local-6989586621680985486"><span class="annot"><span class="annottext">newCall :: Exp1
</span><a href="#local-6989586621680985486"><span class="hs-identifier hs-var hs-var">newCall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2096"></span><span>                            </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985484"><span class="hs-identifier hs-var">fNameNew</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680985478"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2097"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Exp1 -&gt; [Exp1]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span>
</span><span id="line-2098"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Exp1 -&gt; Bool) -&gt; Vector Exp1 -&gt; Vector Exp1
forall a. (Int -&gt; a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifilter"><span class="hs-identifier hs-var">V.ifilter</span></a></span><span>
</span><span id="line-2099"></span><span>                                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985487"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985487"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int Int -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#notMember"><span class="hs-identifier hs-var">M.notMember</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985487"><span class="hs-identifier hs-var">idx</span></a></span><span>  </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985480"><span class="hs-identifier hs-var">redundantPositions</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2100"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985479"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2101"></span><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985485"><span class="hs-identifier hs-var">fdefsNew</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [()], Ty1, Exp1) -&gt; Exp1 -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985468"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680985469"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty1
</span><a href="#local-6989586621680985470"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985486"><span class="hs-identifier hs-var">newCall</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985474"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2102"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-2103"></span><span>                  </span><span class="annot"><span class="annottext">(FunDefs1, Exp1)
</span><a href="#local-6989586621680985475"><span class="hs-identifier hs-var">boringCase</span></a></span><span>
</span><span id="line-2104"></span><span>          </span><span id="local-6989586621680985488"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985488"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(FunDefs1, Exp1)
</span><a href="#local-6989586621680985475"><span class="hs-identifier hs-var">boringCase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2105"></span><span>
</span><span id="line-2106"></span><span>    </span><span id="local-6989586621680985489"><span class="annot"><span class="annottext">x :: Exp1
</span><a href="#local-6989586621680985489"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680985490"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985490"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680985491"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680985491"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680985492"><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985492"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2107"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">L.isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_TUP&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985490"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span>
</span><span id="line-2108"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">L.isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_FUS&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; String
</span><a href="Gibbon.Common.html#fromVar"><span class="hs-identifier hs-var">fromVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985490"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2109"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-2110"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985493"><span class="annot"><span class="annottext">redundantPositions :: Map Int Int
</span><a href="#local-6989586621680985493"><span class="hs-identifier hs-var hs-var">redundantPositions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2111"></span><span>                       </span><span class="hs-keyword">if</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985452"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2112"></span><span>                        </span><span class="hs-keyword">then</span><span>
</span><span id="line-2113"></span><span>                          </span><span class="annot"><span class="annottext">(Map Exp1 Int, Map Int Int) -&gt; Map Int Int
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">((Map Exp1 Int, Map Int Int)
 -&gt; Int -&gt; Exp1 -&gt; (Map Exp1 Int, Map Int Int))
-&gt; (Map Exp1 Int, Map Int Int)
-&gt; Vector Exp1
-&gt; (Map Exp1 Int, Map Int Int)
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Exp1 Int, Map Int Int)
-&gt; Int -&gt; Exp1 -&gt; (Map Exp1 Int, Map Int Int)
forall {k} {a}.
(Ord k, Ord a) =&gt;
(Map k a, Map a a) -&gt; a -&gt; k -&gt; (Map k a, Map a a)
</span><a href="#local-6989586621680985481"><span class="hs-identifier hs-var">findRedundantPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Exp1 Int
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Int Int
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985492"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2114"></span><span>                        </span><span class="hs-keyword">else</span><span>
</span><span id="line-2115"></span><span>                           </span><span class="annot"><span class="annottext">(Map Int Int -&gt; Int -&gt; Exp1 -&gt; Map Int Int)
-&gt; Map Int Int -&gt; Vector Exp1 -&gt; Map Int Int
forall a b. (a -&gt; Int -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifoldl"><span class="hs-identifier hs-var">V.ifoldl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Map Int Int -&gt; Int -&gt; Exp1 -&gt; Map Int Int
</span><a href="#local-6989586621680985482"><span class="hs-identifier hs-var">findRedundantPos_UnusedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985490"><span class="hs-identifier hs-var">fName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int Int
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985492"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2116"></span><span>                        </span><span class="hs-comment">--        redundantPositions3 = M.union redundantPositions2 redundantPositions `debug`</span><span>
</span><span id="line-2117"></span><span>                        </span><span class="hs-comment">-- (&quot;checking call to :&quot; L.++ (show fName) L.++ &quot;opppaaaa&quot; L.++ show redundantPositions2)</span><span>
</span><span id="line-2118"></span><span>                  </span><span class="hs-keyword">in</span><span>
</span><span id="line-2119"></span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map Int Int -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#null"><span class="hs-identifier hs-var">M.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985493"><span class="hs-identifier hs-var">redundantPositions</span></a></span><span>
</span><span id="line-2120"></span><span>                    </span><span class="hs-keyword">then</span><span>
</span><span id="line-2121"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985450"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985489"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2122"></span><span>                    </span><span class="hs-keyword">else</span><span>
</span><span id="line-2123"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985494"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985494"><span class="hs-identifier hs-var">fNameNew</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985495"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985495"><span class="hs-identifier hs-var">fdefsNew</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2124"></span><span>                            </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; Map Int Int -&gt; (Var, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#eliminateInputArgs"><span class="hs-identifier hs-var">eliminateInputArgs</span></a></span><span>  </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985450"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985490"><span class="hs-identifier hs-var">fName</span></a></span><span>  </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985493"><span class="hs-identifier hs-var">redundantPositions</span></a></span><span>
</span><span id="line-2125"></span><span>                          </span><span id="local-6989586621680985496"><span class="annot"><span class="annottext">newCall :: Exp1
</span><a href="#local-6989586621680985496"><span class="hs-identifier hs-var hs-var">newCall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2126"></span><span>                            </span><span class="annot"><span class="annottext">Var -&gt; [()] -&gt; [Exp1] -&gt; Exp1
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985494"><span class="hs-identifier hs-var">fNameNew</span></a></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621680985491"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2127"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Exp1 -&gt; [Exp1]
forall a. Vector a -&gt; [a]
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">V.toList</span></a></span><span>
</span><span id="line-2128"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Exp1 -&gt; Bool) -&gt; Vector Exp1 -&gt; Vector Exp1
forall a. (Int -&gt; a -&gt; Bool) -&gt; Vector a -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#ifilter"><span class="hs-identifier hs-var">V.ifilter</span></a></span><span>
</span><span id="line-2129"></span><span>                                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985497"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985497"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int Int -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#notMember"><span class="hs-identifier hs-var">M.notMember</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985497"><span class="hs-identifier hs-var">idx</span></a></span><span>  </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985493"><span class="hs-identifier hs-var">redundantPositions</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2130"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp1] -&gt; Vector Exp1
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp1]
</span><a href="#local-6989586621680985492"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2131"></span><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985495"><span class="hs-identifier hs-var">fdefsNew</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985496"><span class="hs-identifier hs-var">newCall</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2132"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-2133"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985450"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985489"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2134"></span><span>    </span><span id="local-6989586621680985498"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985498"><span class="hs-identifier hs-var">otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985450"><span class="hs-identifier hs-var">fdefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985498"><span class="hs-identifier hs-var">otherwise</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2135"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-2136"></span><span>        </span><span id="local-6989586621680985481"><span class="annot"><span class="annottext">findRedundantPos :: (Map k a, Map a a) -&gt; a -&gt; k -&gt; (Map k a, Map a a)
</span><a href="#local-6989586621680985481"><span class="hs-identifier hs-var hs-var">findRedundantPos</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985509"><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680985509"><span class="hs-identifier hs-var">firstAppear</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985510"><span class="annot"><span class="annottext">Map a a
</span><a href="#local-6989586621680985510"><span class="hs-identifier hs-var">redundant</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985511"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985511"><span class="hs-identifier hs-var">argIdx</span></a></span></span><span> </span><span id="local-6989586621680985512"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680985512"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2137"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k a -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">M.member</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680985512"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680985509"><span class="hs-identifier hs-var">firstAppear</span></a></span><span>
</span><span id="line-2138"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-2139"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680985509"><span class="hs-identifier hs-var">firstAppear</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Map a a -&gt; Map a a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985511"><span class="hs-identifier hs-var">argIdx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680985509"><span class="hs-identifier hs-var">firstAppear</span></a></span><span> </span><span class="annot"><span class="annottext">Map k a -&gt; k -&gt; a
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680985512"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map a a
</span><a href="#local-6989586621680985510"><span class="hs-identifier hs-var">redundant</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2140"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-2141"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; a -&gt; Map k a -&gt; Map k a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680985512"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985511"><span class="hs-identifier hs-var">argIdx</span></a></span><span> </span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680985509"><span class="hs-identifier hs-var">firstAppear</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map a a
</span><a href="#local-6989586621680985510"><span class="hs-identifier hs-var">redundant</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2142"></span><span>
</span><span id="line-2143"></span><span>        </span><span id="local-6989586621680985482"><span class="annot"><span class="annottext">findRedundantPos_UnusedArgs :: Var -&gt; Map Int Int -&gt; Int -&gt; Exp1 -&gt; Map Int Int
</span><a href="#local-6989586621680985482"><span class="hs-identifier hs-var hs-var">findRedundantPos_UnusedArgs</span></a></span></span><span> </span><span id="local-6989586621680985513"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985513"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680985514"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985514"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span id="local-6989586621680985515"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985515"><span class="hs-identifier hs-var">argIdx</span></a></span></span><span> </span><span id="local-6989586621680985516"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985516"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2144"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985517"><span class="annot"><span class="annottext">callee :: FunDef1
</span><a href="#local-6989586621680985517"><span class="hs-identifier hs-var hs-var">callee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985450"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Var -&gt; FunDef1
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985513"><span class="hs-identifier hs-var">fName</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-2145"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1 -&gt; Var -&gt; Bool
forall {loc} {dec} {ext :: * -&gt; * -&gt; *}.
(Show loc, Show dec, Show (ext loc dec)) =&gt;
PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985517"><span class="hs-identifier hs-var">callee</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Vector Var
forall a. [a] -&gt; Vector a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">V.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; [Var]
forall ex. FunDef ex -&gt; [Var]
</span><a href="Gibbon.Language.Syntax.html#funArgs"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985517"><span class="hs-identifier hs-var">callee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Var -&gt; Int -&gt; Var
forall a. Vector a -&gt; Int -&gt; a
</span><a href="file:///home/artem/.cabal/store/ghc-9.4.5/vector-0.13.1.0-b63bdf9d5ef8e93e35f33c6e1a17f6a5ddd3b2d4ae81a0e1b8c018f5d049dc25/share/doc/html/src/Data.Vector.html#%21"><span class="hs-operator hs-var">V.!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985515"><span class="hs-identifier hs-var">argIdx</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2146"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985514"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-2147"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Map Int Int -&gt; Map Int Int
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985515"><span class="hs-identifier hs-var">argIdx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100000</span></span><span> </span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680985514"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-2148"></span><span>
</span><span id="line-2149"></span><span>        </span><span id="local-6989586621680985518"><span class="annot"><span class="annottext">isUsedArg :: PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var hs-var">isUsedArg</span></a></span></span><span> </span><span id="local-6989586621680985534"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985534"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621680985535"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2150"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985534"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2151"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680985536"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985536"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680985537"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985537"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2152"></span><span>              </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985537"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-2153"></span><span>
</span><span id="line-2154"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680985538"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985538"><span class="hs-identifier hs-var">v'</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2155"></span><span>              </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985538"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-2156"></span><span>
</span><span id="line-2157"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680985539"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985539"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680985540"><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680985540"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2158"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985541"><span class="annot"><span class="annottext">b1 :: Bool
</span><a href="#local-6989586621680985541"><span class="hs-identifier hs-var hs-var">b1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985539"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-2159"></span><span>                  </span><span id="local-6989586621680985542"><span class="annot"><span class="annottext">b2 :: Bool
</span><a href="#local-6989586621680985542"><span class="hs-identifier hs-var hs-var">b2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2160"></span><span>                    </span><span class="annot"><span class="annottext">(Bool -&gt; (String, [(Var, loc)], PreExp ext loc dec) -&gt; Bool)
-&gt; Bool -&gt; [(String, [(Var, loc)], PreExp ext loc dec)] -&gt; Bool
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985543"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985543"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985544"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680985544"><span class="hs-identifier hs-var">dataCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985545"><span class="annot"><span class="annottext">[(Var, loc)]
</span><a href="#local-6989586621680985545"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985546"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985546"><span class="hs-identifier hs-var">ex</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2161"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985543"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985546"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span>                            </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(Var, loc)], PreExp ext loc dec)]
</span><a href="#local-6989586621680985540"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-2163"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985541"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985542"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-2164"></span><span>
</span><span id="line-2165"></span><span>
</span><span id="line-2166"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680985547"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985547"><span class="hs-identifier hs-var">fName</span></a></span></span><span> </span><span id="local-6989586621680985548"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985548"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680985549"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985549"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2167"></span><span>                </span><span class="annot"><span class="annottext">(Bool -&gt; PreExp ext loc dec -&gt; Bool)
-&gt; Bool -&gt; [PreExp ext loc dec] -&gt; Bool
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985550"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985550"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621680985551"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985551"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985550"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985551"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985549"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2168"></span><span>
</span><span id="line-2169"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985552"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985552"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985553"><span class="annot"><span class="annottext">[loc]
</span><a href="#local-6989586621680985553"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985554"><span class="annot"><span class="annottext">dec
</span><a href="#local-6989586621680985554"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985555"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985555"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680985556"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985556"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985555"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span>  </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985556"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2170"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680985557"><span class="annot"><span class="annottext">Prim dec
</span><a href="#local-6989586621680985557"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680985558"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985558"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">(Bool -&gt; PreExp ext loc dec -&gt; Bool)
-&gt; Bool -&gt; [PreExp ext loc dec] -&gt; Bool
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985559"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985559"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621680985560"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985560"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985559"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985560"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985558"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-2171"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680985561"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985561"><span class="hs-identifier hs-var">ls</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">(Bool -&gt; PreExp ext loc dec -&gt; Bool)
-&gt; Bool -&gt; [PreExp ext loc dec] -&gt; Bool
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985562"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985562"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621680985563"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985563"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985562"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985563"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985561"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-2172"></span><span>            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680985564"><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985564"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; PreExp ext loc dec -&gt; Bool)
-&gt; Bool -&gt; [PreExp ext loc dec] -&gt; Bool
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">L.foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985565"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985565"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621680985566"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985566"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680985565"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; Var -&gt; Bool
</span><a href="#local-6989586621680985518"><span class="hs-identifier hs-var">isUsedArg</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985566"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680985535"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">[PreExp ext loc dec]
</span><a href="#local-6989586621680985564"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-2173"></span><span>
</span><span id="line-2174"></span><span>            </span><span id="local-6989586621680985567"><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985567"><span class="hs-identifier hs-var">x</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; Bool
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not handled is &quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">L.++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PreExp ext loc dec -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">PreExp ext loc dec
</span><a href="#local-6989586621680985567"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2175"></span><span>
</span><span id="line-2176"></span><span>
</span><span id="line-2177"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputsMainExp"><span class="hs-identifier hs-type">removeRedundantInputsMainExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2178"></span><span id="removeRedundantInputsMainExp"><span class="annot"><span class="annottext">removeRedundantInputsMainExp :: FunDefs1 -&gt; Exp1 -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputsMainExp"><span class="hs-identifier hs-var hs-var">removeRedundantInputsMainExp</span></a></span></span><span> </span><span id="local-6989586621680985569"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985569"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680985570"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985570"><span class="hs-identifier hs-var">expInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2179"></span><span>
</span><span id="line-2180"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985571"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985571"><span class="hs-identifier hs-var">fdefs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985572"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985572"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-var">removeRedundantInputExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985569"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985570"><span class="hs-identifier hs-var">expInput</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-2181"></span><span>    </span><span class="hs-comment">--   `debug` (&quot;Dowing1&quot;L.++ (render (pprint expInput)))</span><span>
</span><span id="line-2182"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680985573"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985573"><span class="hs-identifier hs-var">fdefs''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985574"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985574"><span class="hs-identifier hs-var">exp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-var">removeRedundantInputExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985571"><span class="hs-identifier hs-var">fdefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985572"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-2183"></span><span>
</span><span id="line-2184"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985573"><span class="hs-identifier hs-var">fdefs''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985574"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2185"></span><span>
</span><span id="line-2186"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputFunc"><span class="hs-identifier hs-type">removeRedundantInputFunc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDef1"><span class="hs-identifier hs-type">FunDef1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span>
</span><span id="line-2187"></span><span id="removeRedundantInputFunc"><span class="annot"><span class="annottext">removeRedundantInputFunc :: FunDefs1 -&gt; FunDef1 -&gt; FunDefs1
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputFunc"><span class="hs-identifier hs-var hs-var">removeRedundantInputFunc</span></a></span></span><span> </span><span id="local-6989586621680985578"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985578"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span id="local-6989586621680985579"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985579"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2188"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985580"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985580"><span class="hs-identifier hs-var">fdefs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985581"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985581"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-var">removeRedundantInputExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985578"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Exp1
forall ex. FunDef ex -&gt; ex
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985579"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-2189"></span><span>      </span><span class="hs-comment">--  `debug` (&quot;Dowing1&quot;L.++ (show (funName fdef)))</span><span>
</span><span id="line-2190"></span><span>      </span><span id="local-6989586621680985582"><span class="annot"><span class="annottext">fdef' :: FunDef1
</span><a href="#local-6989586621680985582"><span class="hs-identifier hs-var hs-var">fdef'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985579"><span class="hs-identifier hs-var">fdef</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985581"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2191"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680985583"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985583"><span class="hs-identifier hs-var">fdefs''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985584"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985584"><span class="hs-identifier hs-var">exp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputExp"><span class="hs-identifier hs-var">removeRedundantInputExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985579"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985582"><span class="hs-identifier hs-var">fdef'</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985580"><span class="hs-identifier hs-var">fdefs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2192"></span><span>                          </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985581"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-2193"></span><span>      </span><span id="local-6989586621680985585"><span class="annot"><span class="annottext">fdef'' :: FunDef1
</span><a href="#local-6989586621680985585"><span class="hs-identifier hs-var hs-var">fdef''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985582"><span class="hs-identifier hs-var">fdef'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp1
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985584"><span class="hs-identifier hs-var">exp'</span></a></span><span class="hs-special">}</span><span class="hs-comment">-- `debug` (&quot;Dowing2 &quot;L.++ (render (pprint (fdef' {funBody = exp'}))))</span><span>
</span><span id="line-2194"></span><span>
</span><span id="line-2195"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; FunDef1 -&gt; FunDefs1 -&gt; FunDefs1
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef1 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985579"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985585"><span class="hs-identifier hs-var">fdef''</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985583"><span class="hs-identifier hs-var">fdefs''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2196"></span><span>
</span><span id="line-2197"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#redundancy_input_pass_rec"><span class="hs-identifier hs-type">redundancy_input_pass_rec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2198"></span><span id="redundancy_input_pass_rec"><span class="annot"><span class="annottext">redundancy_input_pass_rec :: FunDefs1 -&gt; Exp1 -&gt; Int -&gt; (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#redundancy_input_pass_rec"><span class="hs-identifier hs-var hs-var">redundancy_input_pass_rec</span></a></span></span><span> </span><span id="local-6989586621680985602"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985602"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span>  </span><span id="local-6989586621680985603"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985603"><span class="hs-identifier hs-var">mainExp</span></a></span></span><span> </span><span id="local-6989586621680985604"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985604"><span class="hs-identifier hs-var">depth</span></a></span></span><span class="hs-glyph">=</span><span>
</span><span id="line-2199"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985605"><span class="annot"><span class="annottext">fdefs' :: FunDefs1
</span><a href="#local-6989586621680985605"><span class="hs-identifier hs-var hs-var">fdefs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2200"></span><span>        </span><span class="annot"><span class="annottext">(FunDefs1 -&gt; FunDef1 -&gt; FunDefs1)
-&gt; FunDefs1 -&gt; FunDefs1 -&gt; FunDefs1
forall a b k. (a -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldl"><span class="hs-identifier hs-var">M.foldl</span></a></span><span>
</span><span id="line-2201"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985606"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985606"><span class="hs-identifier hs-var">fDefsInner</span></a></span></span><span> </span><span id="local-6989586621680985607"><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985607"><span class="hs-identifier hs-var">fdef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDef1 -&gt; FunDefs1
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputFunc"><span class="hs-identifier hs-var">removeRedundantInputFunc</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985606"><span class="hs-identifier hs-var">fDefsInner</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef1
</span><a href="#local-6989586621680985607"><span class="hs-identifier hs-var">fdef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2202"></span><span>          </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985602"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-2203"></span><span>          </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985602"><span class="hs-identifier hs-var">fdefs</span></a></span><span>
</span><span id="line-2204"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985608"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985608"><span class="hs-identifier hs-var">fdefs''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985609"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985609"><span class="hs-identifier hs-var">mainExp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; (FunDefs1, Exp1)
</span><a href="Gibbon.Passes.Fusion2.html#removeRedundantInputsMainExp"><span class="hs-identifier hs-var">removeRedundantInputsMainExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985605"><span class="hs-identifier hs-var">fdefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985603"><span class="hs-identifier hs-var">mainExp</span></a></span><span>
</span><span id="line-2205"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985608"><span class="hs-identifier hs-var">fdefs''</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDefs1 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985602"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985609"><span class="hs-identifier hs-var">mainExp'</span></a></span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985603"><span class="hs-identifier hs-var">mainExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985604"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-2206"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985609"><span class="hs-identifier hs-var">mainExp'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985608"><span class="hs-identifier hs-var">fdefs''</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; String -&gt; (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no repeeat&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2207"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Int -&gt; (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#redundancy_input_pass_rec"><span class="hs-identifier hs-var">redundancy_input_pass_rec</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985608"><span class="hs-identifier hs-var">fdefs''</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985609"><span class="hs-identifier hs-var">mainExp'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985604"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp1, FunDefs1) -&gt; String -&gt; (Exp1, FunDefs1)
forall {c}. c -&gt; String -&gt; c
</span><a href="Gibbon.Passes.Fusion2.html#debug"><span class="hs-operator hs-var">`debug`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;repeeat&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span class="annot"><a href="Gibbon.Passes.Fusion2.html#redundancy_input_pass"><span class="hs-identifier hs-type">redundancy_input_pass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L1.Syntax.html#Exp1"><span class="hs-identifier hs-type">Exp1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.L1.Syntax.html#FunDefs1"><span class="hs-identifier hs-type">FunDefs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2210"></span><span id="redundancy_input_pass"><span class="annot"><span class="annottext">redundancy_input_pass :: FunDefs1 -&gt; Exp1 -&gt; Int -&gt; (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#redundancy_input_pass"><span class="hs-identifier hs-var hs-var">redundancy_input_pass</span></a></span></span><span> </span><span id="local-6989586621680985623"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985623"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span>  </span><span id="local-6989586621680985624"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985624"><span class="hs-identifier hs-var">mainExp</span></a></span></span><span> </span><span id="local-6989586621680985625"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985625"><span class="hs-identifier hs-var">depth</span></a></span></span><span class="hs-glyph">=</span><span>
</span><span id="line-2211"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680985626"><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985626"><span class="hs-identifier hs-var">mainExp'</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985627"><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985627"><span class="hs-identifier hs-var">fdefs''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Int -&gt; (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#redundancy_input_pass_rec"><span class="hs-identifier hs-var">redundancy_input_pass_rec</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985623"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985624"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2212"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985627"><span class="hs-identifier hs-var">fdefs''</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; FunDefs1 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985623"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985626"><span class="hs-identifier hs-var">mainExp'</span></a></span><span class="annot"><span class="annottext">Exp1 -&gt; Exp1 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985624"><span class="hs-identifier hs-var">mainExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2213"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985626"><span class="hs-identifier hs-var">mainExp'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985627"><span class="hs-identifier hs-var">fdefs''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2214"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FunDefs1 -&gt; Exp1 -&gt; Bool -&gt; Int -&gt; (Exp1, FunDefs1)
</span><a href="Gibbon.Passes.Fusion2.html#redundancy_output_pass"><span class="hs-identifier hs-var">redundancy_output_pass</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs1
</span><a href="#local-6989586621680985627"><span class="hs-identifier hs-var">fdefs''</span></a></span><span> </span><span class="annot"><span class="annottext">Exp1
</span><a href="#local-6989586621680985626"><span class="hs-identifier hs-var">mainExp'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985625"><span class="hs-identifier hs-var">depth</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2215"></span></pre></body></html>