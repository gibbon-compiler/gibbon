<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Gibbon.Passes.ThreadRegions</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier">fromJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldrM"><span class="hs-identifier">foldrM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.Common.html"><span class="hs-identifier">Gibbon.Common</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.DynFlags.html"><span class="hs-identifier">Gibbon.DynFlags</span></a></span><span>
</span><span id="line-11"></span><span class="hs-comment">-- import Gibbon.NewL2.Syntax as L2</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html"><span class="hs-identifier">Gibbon.NewL2.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NewL2</span></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">{-

Threading regions
~~~~~~~~~~~~~~~~~

Functions need end-of-regions cursors for various purposes. The output region
cursors are used for bounds checking (See [Infinite regions] in BoundsCheck).
The input region cursors are useful for garbage collection -- if there's an
indirection from R1 to R2 (input), we need to bump R2's refcount and therefore
need R2's cursor. This pass updates all call-sites to also pass region cursors.
They are prepended to the locations that AppE forms accept.
N.B. for output regions, we actually use end-of-chunk cursors, not
end-of-region cursors.

    AppE add1 [lin, lout] arg

becomes

    AppE add1 [regin, regout, lin, lout] arg


Moreover, functions must also return region cursors, at least for the output
regions. Consider this example:

    ...
    let (x, lout1) = AppE add1 [regin1, regout, lin1, lout] a1 in
    let (y, lout2) = AppE add1 [regin2, regout, lin2, lout1] a2 in
    ...

This is not correct. Because of bounds checking, the first call to add1 might
start using a new output chunk. And we shouldn't use regout in the second call
to add1 -- 'regout' is already full! So we have to thread these output regions,
just like we do the output locations.

    ...
    let (x, lout1, regout1) = AppE add1 [regin1, regout, lin1, lout] a1 in
    let (y, lout2, regout2) = AppE add1 [regin2, regout1, lin2, lout1] a2 in
    ...


-}</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- Maps a location to a region</span><span>
</span><span id="line-60"></span><span class="hs-keyword">type</span><span> </span><span id="RegEnv"><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#RegEnv"><span class="hs-identifier hs-var">RegEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#RegVar"><span class="hs-identifier hs-type">RegVar</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- Maps the LHS of a constructor to the region of it's last field. Because of</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- parallelism the last field of constructor may not be in the same region as</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- it's tag. The region of the last field represents the &quot;finished writing</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- output here region&quot;, so that's the region that should be threaded.</span><span>
</span><span id="line-66"></span><span class="hs-keyword">type</span><span> </span><span id="RightmostRegEnv"><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#RightmostRegEnv"><span class="hs-identifier hs-var">RightmostRegEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#RegVar"><span class="hs-identifier hs-type">RegVar</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- Location arguments</span><span>
</span><span id="line-69"></span><span class="hs-keyword">type</span><span> </span><span id="FnLocArgs"><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#FnLocArgs"><span class="hs-identifier hs-var">FnLocArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LREM"><span class="hs-identifier hs-type">LREM</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- Allocation env</span><span>
</span><span id="line-72"></span><span class="hs-keyword">type</span><span> </span><span id="AllocEnv"><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#AllocEnv"><span class="hs-identifier hs-var">AllocEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- Regions of packed values</span><span>
</span><span id="line-75"></span><span class="hs-keyword">type</span><span> </span><span id="PkdEnv"><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#PkdEnv"><span class="hs-identifier hs-var">PkdEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#RegVar"><span class="hs-identifier hs-type">RegVar</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- A ordered list of locations within each region.</span><span>
</span><span id="line-78"></span><span class="hs-keyword">type</span><span> </span><span id="OrderedLocsEnv"><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#OrderedLocsEnv"><span class="hs-identifier hs-var">OrderedLocsEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#RegVar"><span class="hs-identifier hs-type">RegVar</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- Bound variables that map to their corresponding shortcut pointers</span><span>
</span><span id="line-81"></span><span class="hs-keyword">type</span><span> </span><span id="RanEnv"><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#RanEnv"><span class="hs-identifier hs-var">RanEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#threadRegions"><span class="hs-identifier hs-type">threadRegions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Prog2"><span class="hs-identifier hs-type">NewL2.Prog2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Prog2"><span class="hs-identifier hs-type">NewL2.Prog2</span></a></span><span>
</span><span id="line-84"></span><span id="threadRegions"><span class="annot"><span class="annottext">threadRegions :: Prog2 -&gt; PassM Prog2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegions"><span class="hs-identifier hs-var hs-var">threadRegions</span></a></span></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-type">Prog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680977925"><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
ddefs :: DDefs (TyOf Exp2)
ddefs :: forall ex. Prog ex -&gt; DDefs (TyOf ex)
</span><a href="#local-6989586621680977925"><span class="hs-identifier hs-var hs-var">ddefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680977927"><span class="annot"><span class="annottext">FunDefs Exp2
fundefs :: FunDefs Exp2
fundefs :: forall ex. Prog ex -&gt; FunDefs ex
</span><a href="#local-6989586621680977927"><span class="hs-identifier hs-var hs-var">fundefs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680977929"><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
mainExp :: Maybe (Exp2, TyOf Exp2)
mainExp :: forall ex. Prog ex -&gt; Maybe (ex, TyOf ex)
</span><a href="#local-6989586621680977929"><span class="hs-identifier hs-var hs-var">mainExp</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>  </span><span id="local-6989586621680977931"><span class="annot"><span class="annottext">[FunDef2]
</span><a href="#local-6989586621680977931"><span class="hs-identifier hs-var">fds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; PassM FunDef2) -&gt; [FunDef2] -&gt; PassM [FunDef2]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; FunDefs Exp2 -&gt; FunDef2 -&gt; PassM FunDef2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsFn"><span class="hs-identifier hs-var">threadRegionsFn</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680977925"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680977927"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FunDef2] -&gt; PassM [FunDef2]) -&gt; [FunDef2] -&gt; PassM [FunDef2]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; [FunDef2]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680977927"><span class="hs-identifier hs-var">fundefs</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680977935"><span class="annot"><span class="annottext">fundefs' :: FunDefs Exp2
</span><a href="#local-6989586621680977935"><span class="hs-identifier hs-var hs-var">fundefs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, FunDef2)] -&gt; FunDefs Exp2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, FunDef2)] -&gt; FunDefs Exp2)
-&gt; [(Var, FunDef2)] -&gt; FunDefs Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; (Var, FunDef2)) -&gt; [FunDef2] -&gt; [(Var, FunDef2)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680977937"><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680977937"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef2 -&gt; Var
forall ex. FunDef ex -&gt; Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var">funName</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680977937"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680977937"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FunDef2]
</span><a href="#local-6989586621680977931"><span class="hs-identifier hs-var">fds'</span></a></span><span>
</span><span id="line-87"></span><span>      </span><span id="local-6989586621680977939"><span class="annot"><span class="annottext">env2 :: Env2 Ty2
</span><a href="#local-6989586621680977939"><span class="hs-identifier hs-var hs-var">env2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; TyEnv (ArrowTy (TyOf Exp2))
forall a. FunDefs a -&gt; TyEnv (ArrowTy (TyOf a))
</span><a href="Gibbon.Language.Syntax.html#initFunEnv"><span class="hs-identifier hs-var">initFunEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680977927"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>  </span><span id="local-6989586621680977943"><span class="annot"><span class="annottext">Maybe (Exp2, Ty2)
</span><a href="#local-6989586621680977943"><span class="hs-identifier hs-var">mainExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="#local-6989586621680977929"><span class="hs-identifier hs-var">mainExp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-89"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, Ty2) -&gt; PassM (Maybe (Exp2, Ty2))
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, Ty2)
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-90"></span><span>                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680977944"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680977944"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680977945"><span class="annot"><span class="annottext">TyOf Exp2
</span><a href="#local-6989586621680977945"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp2, Ty2) -&gt; Maybe (Exp2, Ty2)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Exp2, Ty2) -&gt; Maybe (Exp2, Ty2))
-&gt; (Exp2 -&gt; (Exp2, Ty2)) -&gt; Exp2 -&gt; Maybe (Exp2, Ty2)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680977945"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Maybe (Exp2, Ty2))
-&gt; PassM Exp2 -&gt; PassM (Maybe (Exp2, Ty2))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-91"></span><span>                  </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680977925"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680977927"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680977939"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680977944"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="annottext">Prog2 -&gt; PassM Prog2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Prog2 -&gt; PassM Prog2) -&gt; Prog2 -&gt; PassM Prog2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
-&gt; FunDefs Exp2 -&gt; Maybe (Exp2, TyOf Exp2) -&gt; Prog2
forall ex.
DDefs (TyOf ex) -&gt; FunDefs ex -&gt; Maybe (ex, TyOf ex) -&gt; Prog ex
</span><a href="Gibbon.Language.Syntax.html#Prog"><span class="hs-identifier hs-var">Prog</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
</span><a href="#local-6989586621680977925"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680977935"><span class="hs-identifier hs-var">fundefs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Exp2, TyOf Exp2)
Maybe (Exp2, Ty2)
</span><a href="#local-6989586621680977943"><span class="hs-identifier hs-var">mainExp'</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsFn"><span class="hs-identifier hs-type">threadRegionsFn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDef2"><span class="hs-identifier hs-type">NewL2.FunDef2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDef2"><span class="hs-identifier hs-type">NewL2.FunDef2</span></a></span><span>
</span><span id="line-95"></span><span id="threadRegionsFn"><span class="annot"><span class="annottext">threadRegionsFn :: DDefs Ty2 -&gt; FunDefs Exp2 -&gt; FunDef2 -&gt; PassM FunDef2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsFn"><span class="hs-identifier hs-var hs-var">threadRegionsFn</span></a></span></span><span> </span><span id="local-6989586621680977983"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680977983"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680977984"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680977984"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680977985"><span class="annot"><span class="annottext">f :: FunDef2
</span><a href="#local-6989586621680977985"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Gibbon.Language.Syntax.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621680977987"><span class="annot"><span class="annottext">Var
funName :: forall ex. FunDef ex -&gt; Var
funName :: Var
</span><a href="Gibbon.Language.Syntax.html#funName"><span class="hs-identifier hs-var hs-var">funName</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680977988"><span class="annot"><span class="annottext">[Var]
funArgs :: [Var]
funArgs :: forall ex. FunDef ex -&gt; [Var]
</span><a href="#local-6989586621680977988"><span class="hs-identifier hs-var hs-var">funArgs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680977990"><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
funTy :: ArrowTy (TyOf Exp2)
funTy :: forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var hs-var">funTy</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680977992"><span class="annot"><span class="annottext">FunMeta
funMeta :: FunMeta
funMeta :: forall ex. FunDef ex -&gt; FunMeta
</span><a href="#local-6989586621680977992"><span class="hs-identifier hs-var hs-var">funMeta</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680977994"><span class="annot"><span class="annottext">Exp2
funBody :: Exp2
funBody :: forall ex. FunDef ex -&gt; ex
</span><a href="#local-6989586621680977994"><span class="hs-identifier hs-var hs-var">funBody</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680977996"><span class="annot"><span class="annottext">initRegEnv :: RegEnv
</span><a href="#local-6989586621680977996"><span class="hs-identifier hs-var hs-var">initRegEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; RegEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Var)] -&gt; RegEnv) -&gt; [(Var, Var)] -&gt; RegEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; (Var, Var)) -&gt; [LRM] -&gt; [(Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span id="local-6989586621680977998"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680977998"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621680977999"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680977999"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Modality
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680977998"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680977999"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>      </span><span id="local-6989586621680978002"><span class="annot"><span class="annottext">initTyEnv :: TyEnv Ty2
</span><a href="#local-6989586621680978002"><span class="hs-identifier hs-var hs-var">initTyEnv</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Ty2)] -&gt; TyEnv Ty2
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; TyEnv Ty2) -&gt; [(Var, Ty2)] -&gt; TyEnv Ty2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680977988"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Ty2]
forall ty2. ArrowTy2 ty2 -&gt; [ty2]
</span><a href="Gibbon.L2.Syntax.html#arrIns"><span class="hs-identifier hs-var">arrIns</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>      </span><span id="local-6989586621680978004"><span class="annot"><span class="annottext">env2 :: Env2 Ty2
</span><a href="#local-6989586621680978004"><span class="hs-identifier hs-var hs-var">env2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; TyEnv (ArrowTy Ty2) -&gt; Env2 Ty2
forall a. TyEnv a -&gt; TyEnv (ArrowTy a) -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-var">Env2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv Ty2
</span><a href="#local-6989586621680978002"><span class="hs-identifier hs-var">initTyEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; TyEnv (ArrowTy (TyOf Exp2))
forall a. FunDefs a -&gt; TyEnv (ArrowTy (TyOf a))
</span><a href="Gibbon.Language.Syntax.html#initFunEnv"><span class="hs-identifier hs-var">initFunEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680977984"><span class="hs-identifier hs-var">fundefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><a href="#local-6989586621680978005"><span class="hs-identifier hs-type">fn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-100"></span><span>      </span><span id="local-6989586621680978005"><span class="annot"><span class="annottext">fn :: Ty2 -&gt; AllocEnv -&gt; AllocEnv
</span><a href="#local-6989586621680978005"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978006"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978006"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680978007"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978007"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978006"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-101"></span><span>                         </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680978010"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978010"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680978011"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978011"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyCon -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978011"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978010"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978007"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-102"></span><span>                         </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680978014"><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680978014"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Ty2 -&gt; AllocEnv -&gt; AllocEnv) -&gt; AllocEnv -&gt; [Ty2] -&gt; AllocEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; AllocEnv -&gt; AllocEnv
</span><a href="#local-6989586621680978005"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978007"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UrTy Var -&gt; Ty2) -&gt; [UrTy Var] -&gt; [Ty2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680978014"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                         </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978007"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>      </span><span id="local-6989586621680978017"><span class="annot"><span class="annottext">rlocs_env :: AllocEnv
</span><a href="#local-6989586621680978017"><span class="hs-identifier hs-var hs-var">rlocs_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ty2 -&gt; AllocEnv -&gt; AllocEnv) -&gt; AllocEnv -&gt; [Ty2] -&gt; AllocEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; AllocEnv -&gt; AllocEnv
</span><a href="#local-6989586621680978005"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Ty2]
forall ty2. ArrowTy2 ty2 -&gt; [ty2]
</span><a href="Gibbon.L2.Syntax.html#arrIns"><span class="hs-identifier hs-var">arrIns</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>      </span><span id="local-6989586621680978018"><span class="annot"><span class="annottext">wlocs_env :: AllocEnv
</span><a href="#local-6989586621680978018"><span class="hs-identifier hs-var hs-var">wlocs_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; AllocEnv -&gt; AllocEnv
</span><a href="#local-6989586621680978005"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; Ty2
forall ty2. ArrowTy2 ty2 -&gt; ty2
</span><a href="Gibbon.L2.Syntax.html#arrOut"><span class="hs-identifier hs-var">arrOut</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span id="local-6989586621680978020"><span class="annot"><span class="annottext">fnlocargs :: [LREM]
</span><a href="#local-6989586621680978020"><span class="hs-identifier hs-var hs-var">fnlocargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; LREM) -&gt; [LRM] -&gt; [LREM]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LRM -&gt; LREM
</span><a href="Gibbon.NewL2.Syntax.html#fromLRM"><span class="hs-identifier hs-var">fromLRM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>      </span><span id="local-6989586621680978022"><span class="annot"><span class="annottext">region_locs :: OrderedLocsEnv
</span><a href="#local-6989586621680978022"><span class="hs-identifier hs-var hs-var">region_locs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, [Var])] -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, [Var])] -&gt; OrderedLocsEnv)
-&gt; [(Var, [Var])] -&gt; OrderedLocsEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; (Var, [Var])) -&gt; [LRM] -&gt; [(Var, [Var])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span id="local-6989586621680978023"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978023"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680978024"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978024"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680978025"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978025"><span class="hs-identifier hs-var">_m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978024"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978023"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>  </span><span id="local-6989586621680978026"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978026"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680977983"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680977984"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978020"><span class="hs-identifier hs-var">fnlocargs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680977996"><span class="hs-identifier hs-var">initRegEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978004"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978017"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978018"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978022"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680977994"><span class="hs-identifier hs-var">funBody</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-comment">-- Boundschecking</span><span>
</span><span id="line-110"></span><span>  </span><span id="local-6989586621680978027"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680978027"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978029"><span class="annot"><span class="annottext">free_wlocs :: Set Var
</span><a href="#local-6989586621680978029"><span class="hs-identifier hs-var hs-var">free_wlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#outLocVars"><span class="hs-identifier hs-var">outLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978032"><span class="annot"><span class="annottext">free_rlocs :: Set Var
</span><a href="#local-6989586621680978032"><span class="hs-identifier hs-var hs-var">free_rlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#inLocVars"><span class="hs-identifier hs-var">inLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978034"><span class="annot"><span class="annottext">free_rlocs' :: Set (Maybe Var, Var)
</span><a href="#local-6989586621680978034"><span class="hs-identifier hs-var hs-var">free_rlocs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978035"><span class="annot"><span class="annottext">tmp :: [(Maybe Var, Var)]
</span><a href="#local-6989586621680978035"><span class="hs-identifier hs-var hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; [(Maybe Var, Var)])
-&gt; [(Var, Ty2)] -&gt; [(Maybe Var, Var)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978037"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978037"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978038"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978038"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978038"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>                                            </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978039"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978039"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Maybe Var
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978037"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978039"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-115"></span><span>                                            </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; [(Maybe Var, Var)])
-&gt; [(Var, Ty2)] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-116"></span><span>                              </span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680977988"><span class="hs-identifier hs-var">funArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Ty2]
forall ty2. ArrowTy2 ty2 -&gt; [ty2]
</span><a href="Gibbon.L2.Syntax.html#arrIns"><span class="hs-identifier hs-var">arrIns</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>                        </span><span id="local-6989586621680978040"><span class="annot"><span class="annottext">tmp2 :: [(Maybe Var, Var)]
</span><a href="#local-6989586621680978040"><span class="hs-identifier hs-var hs-var">tmp2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; (Maybe Var, Var)) -&gt; [Var] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978041"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978041"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978041"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [(Maybe Var, Var)]) -&gt; [Var] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; [Var]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978032"><span class="hs-identifier hs-var">free_rlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#%5C%5C"><span class="hs-operator hs-var">L.\\</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Maybe Var, Var) -&gt; Var) -&gt; [(Maybe Var, Var)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Var, Var) -&gt; Var
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978035"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)] -&gt; Set (Maybe Var, Var)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Maybe Var, Var)] -&gt; Set (Maybe Var, Var))
-&gt; [(Maybe Var, Var)] -&gt; Set (Maybe Var, Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978035"><span class="hs-identifier hs-var">tmp</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)] -&gt; [(Maybe Var, Var)] -&gt; [(Maybe Var, Var)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978040"><span class="hs-identifier hs-var">tmp2</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680978045"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978045"><span class="hs-identifier hs-var">rpush</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978046"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978046"><span class="hs-identifier hs-var">wpush</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978047"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978047"><span class="hs-identifier hs-var">rpop</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978048"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978048"><span class="hs-identifier hs-var">wpop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
-&gt; Set Var
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; PassM
     ([(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)],
      [(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)])
</span><a href="Gibbon.Passes.ThreadRegions.html#ss_ops"><span class="hs-identifier hs-var">ss_ops</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
</span><a href="#local-6989586621680978034"><span class="hs-identifier hs-var">free_rlocs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978029"><span class="hs-identifier hs-var">free_wlocs</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978017"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978018"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680977996"><span class="hs-identifier hs-var">initRegEnv</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978050"><span class="annot"><span class="annottext">no_eager_promote :: Bool
</span><a href="#local-6989586621680978050"><span class="hs-identifier hs-var hs-var">no_eager_promote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_NoEagerPromote"><span class="hs-identifier hs-var">Opt_NoEagerPromote</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680978027"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978053"><span class="annot"><span class="annottext">bod'' :: Exp2
</span><a href="#local-6989586621680978053"><span class="hs-identifier hs-var hs-var">bod''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- This function is always given a BigInfinite region.</span><span>
</span><span id="line-122"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_BigInfiniteRegions"><span class="hs-identifier hs-var">Opt_BigInfiniteRegions</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680978027"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isCopySansPtrsFunName"><span class="hs-identifier hs-var">isCopySansPtrsFunName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680977987"><span class="hs-identifier hs-var">funName</span></a></span><span>
</span><span id="line-123"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978026"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-124"></span><span>              </span><span class="hs-keyword">else</span><span>
</span><span id="line-125"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978057"><span class="annot"><span class="annottext">packed_outs :: [UrTy Var]
</span><a href="#local-6989586621680978057"><span class="hs-identifier hs-var hs-var">packed_outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; [UrTy Var]
forall a. Show a =&gt; UrTy a -&gt; [UrTy a]
</span><a href="Gibbon.Language.html#getPackedTys"><span class="hs-identifier hs-var">getPackedTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; Ty2
forall ty2. ArrowTy2 ty2 -&gt; ty2
</span><a href="Gibbon.L2.Syntax.html#arrOut"><span class="hs-identifier hs-var">arrOut</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>                    </span><span id="local-6989586621680978059"><span class="annot"><span class="annottext">locs_tycons :: AllocEnv
</span><a href="#local-6989586621680978059"><span class="hs-identifier hs-var hs-var">locs_tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; AllocEnv -&gt; AllocEnv)
-&gt; AllocEnv -&gt; [UrTy Var] -&gt; AllocEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span>
</span><span id="line-127"></span><span>                                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978060"><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680978060"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680978061"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978061"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>                                         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="#local-6989586621680978060"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>                                           </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680978062"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978062"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680978063"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978063"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">Var -&gt; TyCon -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978063"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978062"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978061"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-130"></span><span>                                           </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978061"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>                                    </span><span class="annot"><span class="annottext">AllocEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span>
</span><span id="line-132"></span><span>                                    </span><span class="annot"><span class="annottext">[UrTy Var]
</span><a href="#local-6989586621680978057"><span class="hs-identifier hs-var">packed_outs</span></a></span><span>
</span><span id="line-133"></span><span>                    </span><span id="local-6989586621680978064"><span class="annot"><span class="annottext">boundschecks :: [(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978064"><span class="hs-identifier hs-var hs-var">boundschecks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LRM -&gt; [(Var, [LocArg], Ty2, Exp2)])
-&gt; [LRM] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span>
</span><span id="line-134"></span><span>                                     </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#LRM"><span class="hs-identifier hs-type">LRM</span></a></span><span> </span><span id="local-6989586621680978065"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978065"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680978066"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978066"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680978067"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978067"><span class="hs-identifier hs-var">mode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-135"></span><span>                                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978067"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span>
</span><span id="line-136"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978069"><span class="annot"><span class="annottext">rv :: Var
</span><a href="#local-6989586621680978069"><span class="hs-identifier hs-var hs-var">rv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978066"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-137"></span><span>                                                 </span><span id="local-6989586621680978070"><span class="annot"><span class="annottext">end_rv :: Var
</span><a href="#local-6989586621680978070"><span class="hs-identifier hs-var hs-var">end_rv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978069"><span class="hs-identifier hs-var">rv</span></a></span><span>
</span><span id="line-138"></span><span>                                                 </span><span class="hs-comment">-- rv = end_reg</span><span>
</span><span id="line-139"></span><span>                                                 </span><span id="local-6989586621680978072"><span class="annot"><span class="annottext">bc :: Int
</span><a href="#local-6989586621680978072"><span class="hs-identifier hs-var hs-var">bc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; TyCon -&gt; Int
</span><a href="Gibbon.Passes.ThreadRegions.html#boundsCheck"><span class="hs-identifier hs-var">boundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680977983"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978059"><span class="hs-identifier hs-var">locs_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv -&gt; Var -&gt; TyCon
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978065"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>                                                 </span><span id="local-6989586621680978075"><span class="annot"><span class="annottext">locarg :: LocArg
</span><a href="#local-6989586621680978075"><span class="hs-identifier hs-var hs-var">locarg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-var">NewL2.Loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Var -&gt; Modality -&gt; LREM
</span><a href="Gibbon.NewL2.Syntax.html#LREM"><span class="hs-identifier hs-var">LREM</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978065"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978069"><span class="hs-identifier hs-var">rv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978070"><span class="hs-identifier hs-var">end_rv</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978067"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>                                                 </span><span id="local-6989586621680978078"><span class="annot"><span class="annottext">regarg :: LocArg
</span><a href="#local-6989586621680978078"><span class="hs-identifier hs-var hs-var">regarg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978069"><span class="hs-identifier hs-var">rv</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978067"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978070"><span class="hs-identifier hs-var">end_rv</span></a></span><span>
</span><span id="line-142"></span><span>                                             </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- dbgTraceIt (&quot;boundscheck&quot; ++ sdoc ((locs_tycons M.! loc), bc)) $</span><span>
</span><span id="line-143"></span><span>                                                </span><span class="hs-comment">-- maintain shadowstack in no eager promotion mode</span><span>
</span><span id="line-144"></span><span>                                                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocArg -&gt; LocArg -&gt; E2Ext LocArg Ty2
forall loc dec. Int -&gt; loc -&gt; loc -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-var">BoundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978072"><span class="hs-identifier hs-var">bc</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978078"><span class="hs-identifier hs-var">regarg</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978075"><span class="hs-identifier hs-var">locarg</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-145"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [LRM]
forall ty2. ArrowTy2 ty2 -&gt; [LRM]
</span><a href="Gibbon.L2.Syntax.html#locVars"><span class="hs-identifier hs-var">locVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680977990"><span class="hs-identifier hs-var">funTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>                </span><span class="hs-keyword">in</span><span>
</span><span id="line-148"></span><span>                   </span><span class="hs-comment">-- If eager promotion is disabled, growing a region can also trigger a GC.</span><span>
</span><span id="line-149"></span><span>                   </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978050"><span class="hs-identifier hs-var">no_eager_promote</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FunMeta -&gt; Bool
</span><a href="Gibbon.Language.Syntax.html#funCanTriggerGC"><span class="hs-identifier hs-var">funCanTriggerGC</span></a></span><span> </span><span class="annot"><span class="annottext">FunMeta
</span><a href="#local-6989586621680977992"><span class="hs-identifier hs-var">funMeta</span></a></span><span>
</span><span id="line-150"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978045"><span class="hs-identifier hs-var">rpush</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978046"><span class="hs-identifier hs-var">wpush</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978064"><span class="hs-identifier hs-var">boundschecks</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978048"><span class="hs-identifier hs-var">wpop</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978047"><span class="hs-identifier hs-var">rpop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978026"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-151"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978064"><span class="hs-identifier hs-var">boundschecks</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978026"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><span class="annottext">FunDef2 -&gt; PassM FunDef2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(FunDef2 -&gt; PassM FunDef2) -&gt; FunDef2 -&gt; PassM FunDef2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FunDef2
</span><a href="#local-6989586621680977985"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funBody :: Exp2
</span><a href="Gibbon.Language.Syntax.html#funBody"><span class="hs-identifier hs-var">funBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978053"><span class="hs-identifier hs-var">bod''</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-type">threadRegionsExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DDefs"><span class="hs-identifier hs-type">DDefs</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#FunDefs2"><span class="hs-identifier hs-type">FunDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LREM"><span class="hs-identifier hs-type">LREM</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#RegEnv"><span class="hs-identifier hs-type">RegEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span>
</span><span id="line-158"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#RightmostRegEnv"><span class="hs-identifier hs-type">RightmostRegEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#AllocEnv"><span class="hs-identifier hs-type">AllocEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#AllocEnv"><span class="hs-identifier hs-type">AllocEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#PkdEnv"><span class="hs-identifier hs-type">PkdEnv</span></a></span><span>
</span><span id="line-159"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#OrderedLocsEnv"><span class="hs-identifier hs-type">OrderedLocsEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#RanEnv"><span class="hs-identifier hs-type">RanEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span>
</span><span id="line-160"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">NewL2.Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">NewL2.Exp2</span></a></span><span>
</span><span id="line-161"></span><span id="threadRegionsExp"><span class="annot"><span class="annottext">threadRegionsExp :: DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var hs-var">threadRegionsExp</span></a></span></span><span> </span><span id="local-6989586621680978525"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680978526"><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span></span><span> </span><span id="local-6989586621680978527"><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span></span><span> </span><span id="local-6989586621680978528"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span></span><span> </span><span id="local-6989586621680978529"><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span></span><span> </span><span id="local-6989586621680978530"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span></span><span> </span><span id="local-6989586621680978531"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span></span><span> </span><span id="local-6989586621680978532"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span></span><span> </span><span id="local-6989586621680978533"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span></span><span> </span><span id="local-6989586621680978534"><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span></span><span> </span><span id="local-6989586621680978535"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span></span><span> </span><span id="local-6989586621680978536"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span></span><span> </span><span id="local-6989586621680978537"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span></span><span> </span><span id="local-6989586621680978538"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680978540"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978540"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680978541"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978541"><span class="hs-identifier hs-var">applocs</span></a></span></span><span> </span><span id="local-6989586621680978542"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978542"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978543"><span class="annot"><span class="annottext">ty :: TyOf Exp2
</span><a href="#local-6989586621680978543"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (TyOf Exp2)
Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-165"></span><span>          </span><span id="local-6989586621680978545"><span class="annot"><span class="annottext">argtys :: [Ty2]
</span><a href="#local-6989586621680978545"><span class="hs-identifier hs-var hs-var">argtys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Ty2) -&gt; [Exp2] -&gt; [Ty2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (TyOf Exp2)
Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978542"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-166"></span><span>          </span><span id="local-6989586621680978546"><span class="annot"><span class="annottext">argtylocs :: [Var]
</span><a href="#local-6989586621680978546"><span class="hs-identifier hs-var hs-var">argtylocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ty2 -&gt; [Var]) -&gt; [Ty2] -&gt; [Var]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680978545"><span class="hs-identifier hs-var">argtys</span></a></span><span>
</span><span id="line-167"></span><span>          </span><span id="local-6989586621680978548"><span class="annot"><span class="annottext">in_regs :: [LocArg]
</span><a href="#local-6989586621680978548"><span class="hs-identifier hs-var hs-var">in_regs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; [LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [Var] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978549"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978549"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680978550"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978550"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978549"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978549"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span>
</span><span id="line-168"></span><span>                                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg_Tagged"><span class="hs-identifier hs-var">EndOfReg_Tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978549"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; [LocArg] -&gt; [LocArg]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978550"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-169"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RegEnv -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978549"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-170"></span><span>                                            </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978554"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978554"><span class="hs-identifier hs-var">ran</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg_Tagged"><span class="hs-identifier hs-var">EndOfReg_Tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978554"><span class="hs-identifier hs-var">ran</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; [LocArg] -&gt; [LocArg]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978550"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-171"></span><span>                                            </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RegEnv -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978549"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-172"></span><span>                                                         </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978555"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978555"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978555"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978555"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; [LocArg] -&gt; [LocArg]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978550"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-173"></span><span>                                                         </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978550"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978546"><span class="hs-identifier hs-var">argtylocs</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978557"><span class="annot"><span class="annottext">applocs' :: [LocArg]
</span><a href="#local-6989586621680978557"><span class="hs-identifier hs-var hs-var">applocs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocArg -&gt; LocArg) -&gt; [LocArg] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978558"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978558"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978558"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-176"></span><span>                                    </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-type">NewL2.Loc</span></a></span><span> </span><span id="local-6989586621680978559"><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978559"><span class="hs-identifier hs-var">lrem</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>                                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978560"><span class="annot"><span class="annottext">x :: Var
</span><a href="#local-6989586621680978560"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#lremLoc"><span class="hs-identifier hs-var">lremLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978559"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-178"></span><span>                                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978560"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978560"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span>
</span><span id="line-179"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-var">NewL2.Loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978559"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lremEndReg :: Var
</span><a href="Gibbon.NewL2.Syntax.html#lremEndReg"><span class="hs-identifier hs-var">lremEndReg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toEndFromTaggedV"><span class="hs-identifier hs-var">toEndFromTaggedV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978560"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978558"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-181"></span><span>                                    </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978558"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>                         </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978541"><span class="hs-identifier hs-var">applocs</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span class="hs-comment">-- If this function returns a Packed type, it'll have input and output</span><span>
</span><span id="line-184"></span><span>      </span><span class="hs-comment">-- locations and therefore, input and output regions.</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680978543"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978565"><span class="annot"><span class="annottext">out_tylocs :: [Var]
</span><a href="#local-6989586621680978565"><span class="hs-identifier hs-var hs-var">out_tylocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680978543"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978566"><span class="annot"><span class="annottext">out_regs :: [LocArg]
</span><a href="#local-6989586621680978566"><span class="hs-identifier hs-var hs-var">out_regs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; LocArg) -&gt; [Var] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978567"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978567"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978568"><span class="annot"><span class="annottext">r :: Var
</span><a href="#local-6989586621680978568"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978567"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978568"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978568"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978565"><span class="hs-identifier hs-var">out_tylocs</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978570"><span class="annot"><span class="annottext">newapplocs :: [LocArg]
</span><a href="#local-6989586621680978570"><span class="hs-identifier hs-var hs-var">newapplocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978548"><span class="hs-identifier hs-var">in_regs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978566"><span class="hs-identifier hs-var">out_regs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978557"><span class="hs-identifier hs-var">applocs'</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978540"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978570"><span class="hs-identifier hs-var">newapplocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978542"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-comment">-- Otherwise, only input regions.</span><span>
</span><span id="line-192"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978571"><span class="annot"><span class="annottext">newapplocs :: [LocArg]
</span><a href="#local-6989586621680978571"><span class="hs-identifier hs-var hs-var">newapplocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978548"><span class="hs-identifier hs-var">in_regs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978541"><span class="hs-identifier hs-var">applocs</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978540"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978571"><span class="hs-identifier hs-var">newapplocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978542"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978573"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978573"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978574"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978574"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978575"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680978576"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978576"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680978577"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978577"><span class="hs-identifier hs-var">applocs</span></a></span></span><span> </span><span id="local-6989586621680978578"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978578"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978579"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978579"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978580"><span class="annot"><span class="annottext">argtylocs :: [Var]
</span><a href="#local-6989586621680978580"><span class="hs-identifier hs-var hs-var">argtylocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; [Var]) -&gt; [Exp2] -&gt; [Var]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span>
</span><span id="line-198"></span><span>                        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978581"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978581"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-199"></span><span>                             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978582"><span class="annot"><span class="annottext">argty :: TyOf Exp2
</span><a href="#local-6989586621680978582"><span class="hs-identifier hs-var hs-var">argty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (TyOf Exp2)
Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978581"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-200"></span><span>                             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978581"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-201"></span><span>                               </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680978584"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978584"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-202"></span><span>                                 </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680978582"><span class="hs-identifier hs-var">argty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-203"></span><span>                                   </span><span class="hs-comment">-- Indirection or redirection cursor.</span><span>
</span><span id="line-204"></span><span>                                   </span><span class="annot"><span class="annottext">UrTy Var
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978584"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>                                   </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680978582"><span class="hs-identifier hs-var">argty</span></a></span><span>
</span><span id="line-206"></span><span>                               </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680978582"><span class="hs-identifier hs-var">argty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>                        </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978578"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978586"><span class="annot"><span class="annottext">in_regargs :: [LocArg]
</span><a href="#local-6989586621680978586"><span class="hs-identifier hs-var hs-var">in_regargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>              </span><span class="annot"><span class="annottext">(Var -&gt; [LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [Var] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978587"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978587"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680978588"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978588"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978587"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978587"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span>
</span><span id="line-210"></span><span>                               </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg_Tagged"><span class="hs-identifier hs-var">EndOfReg_Tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978587"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; [LocArg] -&gt; [LocArg]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978588"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-211"></span><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RegEnv -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978587"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-212"></span><span>                                      </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978589"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978589"><span class="hs-identifier hs-var">ran</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg_Tagged"><span class="hs-identifier hs-var">EndOfReg_Tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978589"><span class="hs-identifier hs-var">ran</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; [LocArg] -&gt; [LocArg]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978588"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-213"></span><span>                                      </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>                                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RegEnv -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978587"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>                                          </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978590"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978590"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978590"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978590"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; [LocArg] -&gt; [LocArg]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978588"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-216"></span><span>                                          </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978588"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978580"><span class="hs-identifier hs-var">argtylocs</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978591"><span class="annot"><span class="annottext">outretlocs :: [Var]
</span><a href="#local-6989586621680978591"><span class="hs-identifier hs-var hs-var">outretlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-220"></span><span>            </span><span id="local-6989586621680978592"><span class="annot"><span class="annottext">out_regvars :: [Var]
</span><a href="#local-6989586621680978592"><span class="hs-identifier hs-var hs-var">out_regvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978591"><span class="hs-identifier hs-var">outretlocs</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span id="local-6989586621680978593"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978593"><span class="hs-identifier hs-var">out_regvars'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; [Var] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978594"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978594"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978594"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978592"><span class="hs-identifier hs-var">out_regvars</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978596"><span class="annot"><span class="annottext">out_regargs :: [LocArg]
</span><a href="#local-6989586621680978596"><span class="hs-identifier hs-var hs-var">out_regargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; LocArg) -&gt; [Var] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978597"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978597"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978597"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978597"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978592"><span class="hs-identifier hs-var">out_regvars</span></a></span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978598"><span class="annot"><span class="annottext">out_regargs' :: [LocArg]
</span><a href="#local-6989586621680978598"><span class="hs-identifier hs-var hs-var">out_regargs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; LocArg) -&gt; [Var] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978599"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978599"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978599"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978599"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978593"><span class="hs-identifier hs-var">out_regvars'</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-comment">-- Indirections will return end-of-input-region cursor of the region</span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-comment">-- where they're written, and not of their target.</span><span>
</span><span id="line-227"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978600"><span class="annot"><span class="annottext">in_regvars :: [Var]
</span><a href="#local-6989586621680978600"><span class="hs-identifier hs-var hs-var">in_regvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978580"><span class="hs-identifier hs-var">argtylocs</span></a></span><span>
</span><span id="line-228"></span><span>        </span><span id="local-6989586621680978601"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978601"><span class="hs-identifier hs-var">in_regvars'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; PassM Var) -&gt; [Var] -&gt; PassM [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978602"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978602"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978602"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978600"><span class="hs-identifier hs-var">in_regvars</span></a></span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978603"><span class="annot"><span class="annottext">in_regargs' :: [LocArg]
</span><a href="#local-6989586621680978603"><span class="hs-identifier hs-var hs-var">in_regargs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; LocArg) -&gt; [Var] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978604"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978604"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978604"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978604"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978601"><span class="hs-identifier hs-var">in_regvars'</span></a></span><span>
</span><span id="line-230"></span><span>        </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978605"><span class="annot"><span class="annottext">ran_endofregs :: [(Var, Var)]
</span><a href="#local-6989586621680978605"><span class="hs-identifier hs-var hs-var">ran_endofregs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; (Var, Var)) -&gt; [Var] -&gt; [(Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978606"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978606"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978606"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978606"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [(Var, Var)]) -&gt; [Var] -&gt; [(Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-232"></span><span>                            </span><span class="annot"><span class="annottext">(UrTy Var -&gt; Var) -&gt; [UrTy Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978607"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978607"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978607"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([UrTy Var] -&gt; [Var]) -&gt; [UrTy Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-233"></span><span>                            </span><span class="annot"><span class="annottext">UrTy Var -&gt; [UrTy Var]
forall a. Show a =&gt; UrTy a -&gt; [UrTy a]
</span><a href="Gibbon.Language.html#getPackedTys"><span class="hs-identifier hs-var">getPackedTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978608"><span class="annot"><span class="annottext">pkd_env1 :: RegEnv
</span><a href="#local-6989586621680978608"><span class="hs-identifier hs-var hs-var">pkd_env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-operator hs-var">`M.union`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; RegEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680978605"><span class="hs-identifier hs-var">ran_endofregs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-236"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978610"><span class="annot"><span class="annottext">applocs' :: [LocArg]
</span><a href="#local-6989586621680978610"><span class="hs-identifier hs-var hs-var">applocs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocArg -&gt; LocArg) -&gt; [LocArg] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978611"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978611"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978611"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-237"></span><span>                                      </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-type">NewL2.Loc</span></a></span><span> </span><span id="local-6989586621680978612"><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978612"><span class="hs-identifier hs-var">lrem</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>                                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978613"><span class="annot"><span class="annottext">x :: Var
</span><a href="#local-6989586621680978613"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#lremLoc"><span class="hs-identifier hs-var">lremLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978612"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-239"></span><span>                                          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978613"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978613"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span>
</span><span id="line-240"></span><span>                                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-var">NewL2.Loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978612"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lremEndReg :: Var
</span><a href="Gibbon.NewL2.Syntax.html#lremEndReg"><span class="hs-identifier hs-var">lremEndReg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toEndFromTaggedV"><span class="hs-identifier hs-var">toEndFromTaggedV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978613"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>                                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978611"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-242"></span><span>                                      </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978611"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>                           </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978577"><span class="hs-identifier hs-var">applocs</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978614"><span class="annot"><span class="annottext">newapplocs :: [LocArg]
</span><a href="#local-6989586621680978614"><span class="hs-identifier hs-var hs-var">newapplocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978586"><span class="hs-identifier hs-var">in_regargs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978596"><span class="hs-identifier hs-var">out_regargs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978610"><span class="hs-identifier hs-var">applocs'</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978615"><span class="annot"><span class="annottext">newretlocs :: [LocArg]
</span><a href="#local-6989586621680978615"><span class="hs-identifier hs-var hs-var">newretlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978603"><span class="hs-identifier hs-var">in_regargs'</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978598"><span class="hs-identifier hs-var">out_regargs'</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978574"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-comment">-- 'locs' only has end-witnesses up to this pass. Make their regions</span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-comment">-- same as regions of the locations that the function traverses.</span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978616"><span class="annot"><span class="annottext">traversed_indices :: [Int]
</span><a href="#local-6989586621680978616"><span class="hs-identifier hs-var hs-var">traversed_indices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978617"><span class="annot"><span class="annottext">fnty :: ArrowTy (TyOf Exp2)
</span><a href="#local-6989586621680978617"><span class="hs-identifier hs-var hs-var">fnty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunDef2 -&gt; ArrowTy (TyOf Exp2)
forall ex. FunDef ex -&gt; ArrowTy (TyOf ex)
</span><a href="Gibbon.Language.Syntax.html#funTy"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; Var -&gt; FunDef2
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978576"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-250"></span><span>                                      </span><span class="annot"><span class="annottext">((Int, Var) -&gt; Int) -&gt; [(Int, Var)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Var) -&gt; Int
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, Var)] -&gt; [Int]) -&gt; [(Int, Var)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-251"></span><span>                                      </span><span class="annot"><span class="annottext">((Int, Var) -&gt; Bool) -&gt; [(Int, Var)] -&gt; [(Int, Var)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978619"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978619"><span class="hs-identifier hs-var">_i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978620"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978620"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Effect
</span><a href="Gibbon.L2.Syntax.html#Traverse"><span class="hs-identifier hs-var">Traverse</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978620"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Effect -&gt; Set Effect -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; Set Effect
forall ty2. ArrowTy2 ty2 -&gt; Set Effect
</span><a href="Gibbon.L2.Syntax.html#arrEffs"><span class="hs-identifier hs-var">arrEffs</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680978617"><span class="hs-identifier hs-var">fnty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, Var)] -&gt; [(Int, Var)]) -&gt; [(Int, Var)] -&gt; [(Int, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-252"></span><span>                                      </span><span class="annot"><span class="annottext">[Int] -&gt; [Var] -&gt; [(Int, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrowTy2 Ty2 -&gt; [Var]
forall ty2. ArrowTy2 ty2 -&gt; [Var]
</span><a href="Gibbon.L2.Syntax.html#allLocVars"><span class="hs-identifier hs-var">allLocVars</span></a></span><span> </span><span class="annot"><span class="annottext">ArrowTy (TyOf Exp2)
ArrowTy2 Ty2
</span><a href="#local-6989586621680978617"><span class="hs-identifier hs-var">fnty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978624"><span class="annot"><span class="annottext">renv1 :: RegEnv
</span><a href="#local-6989586621680978624"><span class="hs-identifier hs-var hs-var">renv1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; RegEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Var)] -&gt; RegEnv) -&gt; [(Var, Var)] -&gt; RegEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [(Var, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978574"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Var) -&gt; [Int] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978626"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978626"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978627"><span class="annot"><span class="annottext">zipped :: [(Var, Var)]
</span><a href="#local-6989586621680978627"><span class="hs-identifier hs-var hs-var">zipped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [(Var, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978600"><span class="hs-identifier hs-var">in_regvars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978601"><span class="hs-identifier hs-var">in_regvars'</span></a></span><span>
</span><span id="line-255"></span><span>                                                     </span><span id="local-6989586621680978628"><span class="annot"><span class="annottext">r :: Var
</span><a href="#local-6989586621680978628"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978580"><span class="hs-identifier hs-var">argtylocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Int -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978626"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>                                                     </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978630"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978630"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, Var)] -&gt; Maybe Var
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978628"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, Var)]
</span><a href="#local-6989586621680978627"><span class="hs-identifier hs-var">zipped</span></a></span><span>
</span><span id="line-257"></span><span>                                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978630"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                                          </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680978616"><span class="hs-identifier hs-var">traversed_indices</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978632"><span class="annot"><span class="annottext">renv2 :: RegEnv
</span><a href="#local-6989586621680978632"><span class="hs-identifier hs-var hs-var">renv2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">M.union</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978624"><span class="hs-identifier hs-var">renv1</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-comment">-- Update input and returned locations to point to the fresh regions</span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978633"><span class="annot"><span class="annottext">region_locs1 :: OrderedLocsEnv
</span><a href="#local-6989586621680978633"><span class="hs-identifier hs-var hs-var">region_locs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Var) -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv)
-&gt; OrderedLocsEnv -&gt; [(Var, Var)] -&gt; OrderedLocsEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978634"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978634"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978635"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978635"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978636"><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978636"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978635"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978636"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv -&gt; Var -&gt; [Var]
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978634"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978636"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                             </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span>
</span><span id="line-266"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [(Var, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978600"><span class="hs-identifier hs-var">in_regvars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978601"><span class="hs-identifier hs-var">in_regvars'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978637"><span class="annot"><span class="annottext">region_locs2 :: OrderedLocsEnv
</span><a href="#local-6989586621680978637"><span class="hs-identifier hs-var hs-var">region_locs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Var) -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv)
-&gt; OrderedLocsEnv -&gt; [(Var, Var)] -&gt; OrderedLocsEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978638"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978638"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978639"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978639"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978640"><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978640"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978639"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978640"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv -&gt; Var -&gt; [Var]
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978638"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978640"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>                             </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978633"><span class="hs-identifier hs-var">region_locs1</span></a></span><span>
</span><span id="line-269"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [(Var, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978592"><span class="hs-identifier hs-var">out_regvars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978593"><span class="hs-identifier hs-var">out_regvars'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-comment">-- [2022.10.04]: do outregvars need to updated like inregvars below?</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978641"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978641"><span class="hs-identifier hs-var">renv3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680978642"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978642"><span class="hs-identifier hs-var">bod1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>              </span><span class="annot"><span class="annottext">((Var, Var, Var) -&gt; (RegEnv, Exp2) -&gt; (RegEnv, Exp2))
-&gt; (RegEnv, Exp2) -&gt; [(Var, Var, Var)] -&gt; (RegEnv, Exp2)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978643"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978643"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978644"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978644"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978645"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978645"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978646"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978646"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680978647"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978647"><span class="hs-identifier hs-var">bod_acc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>                       </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978643"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978645"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="annot"><span class="annottext">(RegEnv -&gt; RegEnv) -&gt; RegEnv -&gt; RegEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; RegEnv -&gt; RegEnv
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">M.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978649"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978649"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978649"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978644"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978645"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978649"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978646"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>                       </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Either Var Var -&gt; Var -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#substEndReg"><span class="hs-identifier hs-var">substEndReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Either Var Var
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978644"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978645"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978647"><span class="hs-identifier hs-var">bod_acc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978632"><span class="hs-identifier hs-var">renv2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978579"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var] -&gt; [(Var, Var, Var)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip3"><span class="hs-identifier hs-var">L.zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978591"><span class="hs-identifier hs-var">outretlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978592"><span class="hs-identifier hs-var">out_regvars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978593"><span class="hs-identifier hs-var">out_regvars'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978652"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978652"><span class="hs-identifier hs-var">renv4</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680978653"><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978653"><span class="hs-identifier hs-var">region_locs3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680978654"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978654"><span class="hs-identifier hs-var">bod2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>              </span><span class="annot"><span class="annottext">((Var, Var, Var)
 -&gt; (RegEnv, OrderedLocsEnv, Exp2)
 -&gt; (RegEnv, OrderedLocsEnv, Exp2))
-&gt; (RegEnv, OrderedLocsEnv, Exp2)
-&gt; [(Var, Var, Var)]
-&gt; (RegEnv, OrderedLocsEnv, Exp2)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978655"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978655"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978656"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978656"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978657"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978657"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978658"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978658"><span class="hs-identifier hs-var">acc1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978659"><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978659"><span class="hs-identifier hs-var">acc2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978660"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978660"><span class="hs-identifier hs-var">bod_acc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>                       </span><span class="hs-comment">-- Keep the old mapping for lc in renv because at the end of a</span><span>
</span><span id="line-280"></span><span>                       </span><span class="hs-comment">-- branch for indirections we want to return the end-of-input-region</span><span>
</span><span id="line-281"></span><span>                       </span><span class="hs-comment">-- cursor this function was called with, as opposed to what</span><span>
</span><span id="line-282"></span><span>                       </span><span class="hs-comment">-- the function call using the indirection pointer returns.</span><span>
</span><span id="line-283"></span><span>                       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978655"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978658"><span class="hs-identifier hs-var">acc1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978659"><span class="hs-identifier hs-var">acc2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978660"><span class="hs-identifier hs-var">bod_acc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-284"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978661"><span class="annot"><span class="annottext">locs_in_r :: [Var]
</span><a href="#local-6989586621680978661"><span class="hs-identifier hs-var hs-var">locs_in_r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978637"><span class="hs-identifier hs-var">region_locs2</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv -&gt; Var -&gt; [Var]
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978656"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-285"></span><span>                           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; Maybe Int
forall a. Eq a =&gt; a -&gt; [a] -&gt; Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#elemIndex"><span class="hs-identifier hs-var">L.elemIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978655"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978661"><span class="hs-identifier hs-var">locs_in_r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>                             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978663"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978663"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>                               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978663"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978661"><span class="hs-identifier hs-var">locs_in_r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>                               </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978665"><span class="annot"><span class="annottext">fake_last_loc :: Var
</span><a href="#local-6989586621680978665"><span class="hs-identifier hs-var hs-var">fake_last_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Var
</span><a href="Gibbon.Common.html#toVar"><span class="hs-identifier hs-var">toVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;fake_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Var
</span><a href="Gibbon.Common.html#varAppend"><span class="hs-operator hs-var">`varAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978655"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-289"></span><span>                                        </span><span id="local-6989586621680978668"><span class="annot"><span class="annottext">acc1' :: RegEnv
</span><a href="#local-6989586621680978668"><span class="hs-identifier hs-var hs-var">acc1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978665"><span class="hs-identifier hs-var">fake_last_loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978657"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978658"><span class="hs-identifier hs-var">acc1</span></a></span><span>
</span><span id="line-290"></span><span>                                        </span><span id="local-6989586621680978669"><span class="annot"><span class="annottext">acc2' :: OrderedLocsEnv
</span><a href="#local-6989586621680978669"><span class="hs-identifier hs-var hs-var">acc2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; Var -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#adjust"><span class="hs-identifier hs-var">M.adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978671"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978671"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978671"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978665"><span class="hs-identifier hs-var">fake_last_loc</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978656"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978659"><span class="hs-identifier hs-var">acc2</span></a></span><span>
</span><span id="line-291"></span><span>                                        </span><span id="local-6989586621680978672"><span class="annot"><span class="annottext">acc2'' :: OrderedLocsEnv
</span><a href="#local-6989586621680978672"><span class="hs-identifier hs-var hs-var">acc2''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978657"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978669"><span class="hs-identifier hs-var">acc2'</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv -&gt; Var -&gt; [Var]
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978656"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978669"><span class="hs-identifier hs-var">acc2'</span></a></span><span>
</span><span id="line-292"></span><span>                                        </span><span id="local-6989586621680978673"><span class="annot"><span class="annottext">acc2''' :: OrderedLocsEnv
</span><a href="#local-6989586621680978673"><span class="hs-identifier hs-var hs-var">acc2'''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv)
-&gt; OrderedLocsEnv -&gt; [Var] -&gt; OrderedLocsEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978674"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978674"><span class="hs-identifier hs-var">lc2</span></a></span></span><span> </span><span id="local-6989586621680978675"><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978675"><span class="hs-identifier hs-var">acc3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; Var -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#adjust"><span class="hs-identifier hs-var">M.adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978676"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978676"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978676"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978665"><span class="hs-identifier hs-var">fake_last_loc</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978668"><span class="hs-identifier hs-var">acc1'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978674"><span class="hs-identifier hs-var">lc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978675"><span class="hs-identifier hs-var">acc3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978672"><span class="hs-identifier hs-var">acc2''</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978661"><span class="hs-identifier hs-var">locs_in_r</span></a></span><span>
</span><span id="line-293"></span><span>                                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978668"><span class="hs-identifier hs-var">acc1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978673"><span class="hs-identifier hs-var">acc2'''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978660"><span class="hs-identifier hs-var">bod_acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680978677"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978677"><span class="hs-identifier hs-var">to_update</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; ([Var], [Var])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978663"><span class="hs-identifier hs-var">idx</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978661"><span class="hs-identifier hs-var">locs_in_r</span></a></span><span>
</span><span id="line-295"></span><span>                                        </span><span id="local-6989586621680978680"><span class="annot"><span class="annottext">updated :: RegEnv
</span><a href="#local-6989586621680978680"><span class="hs-identifier hs-var hs-var">updated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Var -&gt; Var) -&gt; RegEnv -&gt; RegEnv
forall k a b. (k -&gt; a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#mapWithKey"><span class="hs-identifier hs-var">M.mapWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978682"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978682"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621680978683"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978683"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978682"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978677"><span class="hs-identifier hs-var">to_update</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978657"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978683"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978658"><span class="hs-identifier hs-var">acc1</span></a></span><span>
</span><span id="line-296"></span><span>                                        </span><span id="local-6989586621680978685"><span class="annot"><span class="annottext">bod_acc' :: Exp2
</span><a href="#local-6989586621680978685"><span class="hs-identifier hs-var hs-var">bod_acc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; [Var] -&gt; Exp2
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span>
</span><span id="line-297"></span><span>                                                     </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978686"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978686"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680978687"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978687"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Var Var -&gt; Var -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#substEndReg"><span class="hs-identifier hs-var">substEndReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Either Var Var
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978686"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978657"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978687"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                                                     </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978660"><span class="hs-identifier hs-var">bod_acc</span></a></span><span>
</span><span id="line-299"></span><span>                                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; [Var]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978658"><span class="hs-identifier hs-var">acc1</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`S.intersection`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978677"><span class="hs-identifier hs-var">to_update</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>                                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978680"><span class="hs-identifier hs-var">updated</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978659"><span class="hs-identifier hs-var">acc2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978685"><span class="hs-identifier hs-var">bod_acc'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>                             </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; (RegEnv, OrderedLocsEnv, Exp2)
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; (RegEnv, OrderedLocsEnv, Exp2))
-&gt; TyCon -&gt; (RegEnv, OrderedLocsEnv, Exp2)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;threadRegionsExp: unbound loc &quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [Var], Set Var, OrderedLocsEnv, Var) -&gt; TyCon
forall a. Out a =&gt; a -&gt; TyCon
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978655"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978661"><span class="hs-identifier hs-var">locs_in_r</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978633"><span class="hs-identifier hs-var">region_locs1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978656"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978641"><span class="hs-identifier hs-var">renv3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978637"><span class="hs-identifier hs-var">region_locs2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978642"><span class="hs-identifier hs-var">bod1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var] -&gt; [(Var, Var, Var)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip3"><span class="hs-identifier hs-var">L.zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978580"><span class="hs-identifier hs-var">argtylocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978600"><span class="hs-identifier hs-var">in_regvars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978601"><span class="hs-identifier hs-var">in_regvars'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>        </span><span class="hs-comment">-- TODO: only keep the rightmost end-of-input-region cursor in renv.</span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978692"><span class="annot"><span class="annottext">env2' :: Env2 Ty2
</span><a href="#local-6989586621680978692"><span class="hs-identifier hs-var hs-var">env2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978573"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-307"></span><span>            </span><span id="local-6989586621680978694"><span class="annot"><span class="annottext">rlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978694"><span class="hs-identifier hs-var hs-var">rlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; AllocEnv -&gt; AllocEnv
forall {k}. Ord k =&gt; UrTy k -&gt; Map k TyCon -&gt; Map k TyCon
</span><a href="#local-6989586621680978695"><span class="hs-identifier hs-var">updRLocsEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span>
</span><span id="line-308"></span><span>            </span><span id="local-6989586621680978696"><span class="annot"><span class="annottext">wlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978696"><span class="hs-identifier hs-var hs-var">wlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; AllocEnv -&gt; AllocEnv) -&gt; AllocEnv -&gt; [Var] -&gt; AllocEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978697"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978697"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680978698"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978698"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978697"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978698"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>        </span><span id="local-6989586621680978700"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978700"><span class="hs-identifier hs-var">bod3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978652"><span class="hs-identifier hs-var">renv4</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978692"><span class="hs-identifier hs-var">env2'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978694"><span class="hs-identifier hs-var">rlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978696"><span class="hs-identifier hs-var">wlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978608"><span class="hs-identifier hs-var">pkd_env1</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978653"><span class="hs-identifier hs-var">region_locs3</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978654"><span class="hs-identifier hs-var">bod2</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-comment">-- shadowstack  ops</span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-313"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- free = S.fromList $ freeLocVars bod</span><span>
</span><span id="line-314"></span><span>            </span><span id="local-6989586621680978701"><span class="annot"><span class="annottext">free :: Set Var
</span><a href="#local-6989586621680978701"><span class="hs-identifier hs-var hs-var">free</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Env2 Ty2 -&gt; Exp2 -&gt; Set Var
</span><a href="#local-6989586621680978702"><span class="hs-identifier hs-var">ss_free_locs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978573"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Var]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978574"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978692"><span class="hs-identifier hs-var">env2'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978579"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-315"></span><span>            </span><span id="local-6989586621680978703"><span class="annot"><span class="annottext">free_wlocs :: Set Var
</span><a href="#local-6989586621680978703"><span class="hs-identifier hs-var hs-var">free_wlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978701"><span class="hs-identifier hs-var">free</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`S.intersection`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllocEnv -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978696"><span class="hs-identifier hs-var">wlocs_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>            </span><span id="local-6989586621680978704"><span class="annot"><span class="annottext">free_rlocs :: Set Var
</span><a href="#local-6989586621680978704"><span class="hs-identifier hs-var hs-var">free_rlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978701"><span class="hs-identifier hs-var">free</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`S.intersection`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllocEnv -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978694"><span class="hs-identifier hs-var">rlocs_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>            </span><span id="local-6989586621680978705"><span class="annot"><span class="annottext">free_rlocs' :: Set (Maybe Var, Var)
</span><a href="#local-6989586621680978705"><span class="hs-identifier hs-var hs-var">free_rlocs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978706"><span class="annot"><span class="annottext">tmp :: [(Maybe Var, Var)]
</span><a href="#local-6989586621680978706"><span class="hs-identifier hs-var hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; (Maybe Var, Var))
-&gt; [(Var, Ty2)] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978707"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978707"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978708"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978708"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Maybe Var
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978707"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978708"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; [(Maybe Var, Var)])
-&gt; [(Var, Ty2)] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-318"></span><span>                                    </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; Bool) -&gt; [(Var, Ty2)] -&gt; [(Var, Ty2)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978709"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978709"><span class="hs-identifier hs-var">_x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978710"><span class="annot"><span class="annottext">_y :: Ty2
</span><a href="#local-6989586621680978710"><span class="hs-identifier hs-var">_y</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680978711"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978711"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680978712"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978712"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978712"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978704"><span class="hs-identifier hs-var">free_rlocs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978711"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Gibbon.Passes.ThreadRegions.html#hole_tycon"><span class="hs-identifier hs-var">hole_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; [(Var, Ty2)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(TyEnv Ty2 -&gt; [(Var, Ty2)]) -&gt; TyEnv Ty2 -&gt; [(Var, Ty2)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty2 -&gt; Bool) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#filter"><span class="hs-identifier hs-var">M.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; Bool) -&gt; (Ty2 -&gt; UrTy Var) -&gt; Ty2 -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; TyEnv Ty2
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>                              </span><span id="local-6989586621680978719"><span class="annot"><span class="annottext">tmp2 :: [(Maybe Var, Var)]
</span><a href="#local-6989586621680978719"><span class="hs-identifier hs-var hs-var">tmp2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; (Maybe Var, Var)) -&gt; [Var] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978720"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978720"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978720"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [(Maybe Var, Var)]) -&gt; [Var] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; [Var]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978704"><span class="hs-identifier hs-var">free_rlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#%5C%5C"><span class="hs-operator hs-var">L.\\</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Maybe Var, Var) -&gt; Var) -&gt; [(Maybe Var, Var)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Var, Var) -&gt; Var
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978706"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>                          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)] -&gt; Set (Maybe Var, Var)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Maybe Var, Var)] -&gt; Set (Maybe Var, Var))
-&gt; [(Maybe Var, Var)] -&gt; Set (Maybe Var, Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978706"><span class="hs-identifier hs-var">tmp</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)] -&gt; [(Maybe Var, Var)] -&gt; [(Maybe Var, Var)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978719"><span class="hs-identifier hs-var">tmp2</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680978721"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978721"><span class="hs-identifier hs-var">rpush</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978722"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978722"><span class="hs-identifier hs-var">wpush</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978723"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978723"><span class="hs-identifier hs-var">rpop</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978724"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978724"><span class="hs-identifier hs-var">wpop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
-&gt; Set Var
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; PassM
     ([(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)],
      [(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)])
</span><a href="Gibbon.Passes.ThreadRegions.html#ss_ops"><span class="hs-identifier hs-var">ss_ops</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
</span><a href="#local-6989586621680978705"><span class="hs-identifier hs-var">free_rlocs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978703"><span class="hs-identifier hs-var">free_wlocs</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span>
</span><span id="line-323"></span><span>        </span><span id="local-6989586621680978725"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978725"><span class="hs-identifier hs-var">emit_ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM Bool
</span><a href="#local-6989586621680978726"><span class="hs-identifier hs-var">emit_ss_instrs</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978725"><span class="hs-identifier hs-var">emit_ss</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">FunMeta -&gt; Bool
</span><a href="Gibbon.Language.Syntax.html#funCanTriggerGC"><span class="hs-identifier hs-var">funCanTriggerGC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDef2 -&gt; FunMeta
forall ex. FunDef ex -&gt; FunMeta
</span><a href="Gibbon.Language.Syntax.html#funMeta"><span class="hs-identifier hs-var">funMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2 -&gt; Var -&gt; FunDef2
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978576"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978727"><span class="annot"><span class="annottext">binds :: [(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978727"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978721"><span class="hs-identifier hs-var">rpush</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978722"><span class="hs-identifier hs-var">wpush</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978573"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978615"><span class="hs-identifier hs-var">newretlocs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978576"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978614"><span class="hs-identifier hs-var">newapplocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978578"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978724"><span class="hs-identifier hs-var">wpop</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978723"><span class="hs-identifier hs-var">rpop</span></a></span><span>
</span><span id="line-326"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978727"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978700"><span class="hs-identifier hs-var">bod3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978573"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978615"><span class="hs-identifier hs-var">newretlocs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978575"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978576"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978614"><span class="hs-identifier hs-var">newapplocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978578"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978700"><span class="hs-identifier hs-var">bod3</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978728"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978728"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978729"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978729"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978730"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978730"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span id="local-6989586621680978732"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978732"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680978733"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978733"><span class="hs-identifier hs-var">applocs</span></a></span></span><span> </span><span id="local-6989586621680978734"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978734"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978735"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978735"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978736"><span class="annot"><span class="annottext">e' :: Exp2
</span><a href="#local-6989586621680978736"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978728"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978729"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978730"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978732"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978733"><span class="hs-identifier hs-var">applocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978734"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978735"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-332"></span><span>      </span><span id="local-6989586621680978737"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978737"><span class="hs-identifier hs-var">e''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978736"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Exp2] -&gt; Exp2 -&gt; Exp2
forall loc dec.
(Eq loc, Eq dec) =&gt;
Var
-&gt; [PreExp E2Ext loc dec]
-&gt; PreExp E2Ext loc dec
-&gt; PreExp E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#changeAppToSpawn"><span class="hs-identifier hs-var">changeAppToSpawn</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978732"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978734"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978737"><span class="hs-identifier hs-var">e''</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-comment">-- AUDITME: this causes all all DataConE's to return an additional cursor.</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978739"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978739"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978740"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978740"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978741"><span class="annot"><span class="annottext">ty :: Ty2
</span><a href="#local-6989586621680978741"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978742"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978742"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680978743"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680978743"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978745"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978745"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978746"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978746"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978747"><span class="annot"><span class="annottext">reg_of_tag :: Var
</span><a href="#local-6989586621680978747"><span class="hs-identifier hs-var hs-var">reg_of_tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978742"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-338"></span><span>          </span><span id="local-6989586621680978748"><span class="annot"><span class="annottext">lfenv' :: RegEnv
</span><a href="#local-6989586621680978748"><span class="hs-identifier hs-var hs-var">lfenv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978745"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-339"></span><span>                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span>
</span><span id="line-340"></span><span>                     </span><span class="annot"><span class="annottext">[Exp2]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>                       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978749"><span class="annot"><span class="annottext">last_ty :: TyOf Exp2
</span><a href="#local-6989586621680978749"><span class="hs-identifier hs-var hs-var">last_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2) -&gt; Env2 (TyOf Exp2) -&gt; Exp2 -&gt; TyOf Exp2
forall e.
Typeable e =&gt;
DDefs (TyOf e) -&gt; Env2 (TyOf e) -&gt; e -&gt; TyOf e
</span><a href="Gibbon.Language.Syntax.html#gRecoverType"><span class="hs-identifier hs-var">gRecoverType</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs (TyOf Exp2)
DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 (TyOf Exp2)
Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp2] -&gt; Exp2
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978745"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-342"></span><span>                       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">TyOf Exp2
Ty2
</span><a href="#local-6989586621680978749"><span class="hs-identifier hs-var">last_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-343"></span><span>                          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978751"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978751"><span class="hs-identifier hs-var">last_loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-344"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978752"><span class="annot"><span class="annottext">reg_of_last_arg :: Var
</span><a href="#local-6989586621680978752"><span class="hs-identifier hs-var hs-var">reg_of_last_arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978751"><span class="hs-identifier hs-var">last_loc</span></a></span><span>
</span><span id="line-345"></span><span>                            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978747"><span class="hs-identifier hs-var">reg_of_tag</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978752"><span class="hs-identifier hs-var">reg_of_last_arg</span></a></span><span>
</span><span id="line-346"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978742"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978752"><span class="hs-identifier hs-var">reg_of_last_arg</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span>
</span><span id="line-347"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span>
</span><span id="line-348"></span><span>                          </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978753"><span class="annot"><span class="annottext">pkd_env1 :: RegEnv
</span><a href="#local-6989586621680978753"><span class="hs-identifier hs-var hs-var">pkd_env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978742"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978742"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978754"><span class="annot"><span class="annottext">env2' :: Env2 Ty2
</span><a href="#local-6989586621680978754"><span class="hs-identifier hs-var hs-var">env2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978739"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978741"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-351"></span><span>          </span><span id="local-6989586621680978755"><span class="annot"><span class="annottext">rlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978755"><span class="hs-identifier hs-var hs-var">rlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; AllocEnv -&gt; AllocEnv
forall {k}. Ord k =&gt; UrTy k -&gt; Map k TyCon -&gt; Map k TyCon
</span><a href="#local-6989586621680978695"><span class="hs-identifier hs-var">updRLocsEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978741"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span>
</span><span id="line-352"></span><span>          </span><span id="local-6989586621680978756"><span class="annot"><span class="annottext">wlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978756"><span class="hs-identifier hs-var hs-var">wlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; AllocEnv -&gt; AllocEnv) -&gt; AllocEnv -&gt; [Var] -&gt; AllocEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978757"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978757"><span class="hs-identifier hs-var">loc2</span></a></span></span><span> </span><span id="local-6989586621680978758"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978758"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978757"><span class="hs-identifier hs-var">loc2</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978758"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978741"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>      </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">((Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2)
-&gt; (Exp2 -&gt; (Var, [LocArg], Ty2, Exp2)) -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978739"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978740"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978741"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978743"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978754"><span class="hs-identifier hs-var">env2'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978748"><span class="hs-identifier hs-var">lfenv'</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978755"><span class="hs-identifier hs-var">rlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978756"><span class="hs-identifier hs-var">wlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978753"><span class="hs-identifier hs-var">pkd_env1</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978746"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978760"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978760"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978761"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978761"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978762"><span class="annot"><span class="annottext">ty :: Ty2
</span><a href="#local-6989586621680978762"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978763"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978763"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span> </span><span id="local-6989586621680978765"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978765"><span class="hs-identifier hs-var">tcon</span></a></span></span><span> </span><span id="local-6989586621680978766"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978766"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978767"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978767"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978768"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978768"><span class="hs-identifier hs-var">_b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978769"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978769"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978770"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978770"><span class="hs-identifier hs-var">_d</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978771"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978771"><span class="hs-identifier hs-var">cpy</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978772"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978772"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978773"><span class="annot"><span class="annottext">fn :: Var -&gt; Modality -&gt; LocArg
</span><a href="#local-6989586621680978773"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621680978774"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978774"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680978775"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978775"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978774"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">S.member</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978774"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span>
</span><span id="line-358"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg_Tagged"><span class="hs-identifier hs-var">EndOfReg_Tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978774"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RegEnv -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978774"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>                             </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978776"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978776"><span class="hs-identifier hs-var">ran</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg_Tagged"><span class="hs-identifier hs-var">EndOfReg_Tagged</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978776"><span class="hs-identifier hs-var">ran</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>                             </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RegEnv -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978774"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-362"></span><span>                                          </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978777"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978777"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978777"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978775"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978777"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>                                          </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; LocArg
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; LocArg) -&gt; TyCon -&gt; LocArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;threadRegionsExp: unbound loc &quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyCon
forall a. Out a =&gt; a -&gt; TyCon
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978774"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-364"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978778"><span class="annot"><span class="annottext">b' :: LocArg
</span><a href="#local-6989586621680978778"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; LocArg
</span><a href="#local-6989586621680978773"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978767"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span>
</span><span id="line-365"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978779"><span class="annot"><span class="annottext">d' :: LocArg
</span><a href="#local-6989586621680978779"><span class="hs-identifier hs-var hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; LocArg
</span><a href="#local-6989586621680978773"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978769"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978785"><span class="annot"><span class="annottext">fn2 :: LocArg -&gt; Var -&gt; LocArg
</span><a href="#local-6989586621680978785"><span class="hs-identifier hs-var hs-var">fn2</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-type">Loc</span></a></span><span> </span><span id="local-6989586621680978786"><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978786"><span class="hs-identifier hs-var">lrem</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978787"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978787"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-var">Loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978786"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lremEndReg :: Var
</span><a href="Gibbon.NewL2.Syntax.html#lremEndReg"><span class="hs-identifier hs-var">lremEndReg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978787"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>          </span><span class="annot"><a href="#local-6989586621680978785"><span class="hs-identifier hs-var">fn2</span></a></span><span> </span><span id="local-6989586621680978788"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978788"><span class="hs-identifier hs-var">oth</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; LocArg
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; LocArg) -&gt; TyCon -&gt; LocArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;fn2: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; TyCon
forall a. Out a =&gt; a -&gt; TyCon
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978788"><span class="hs-identifier hs-var">oth</span></a></span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978789"><span class="annot"><span class="annottext">a' :: LocArg
</span><a href="#local-6989586621680978789"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var -&gt; LocArg
</span><a href="#local-6989586621680978785"><span class="hs-identifier hs-var">fn2</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978767"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978778"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>          </span><span id="local-6989586621680978790"><span class="annot"><span class="annottext">c' :: LocArg
</span><a href="#local-6989586621680978790"><span class="hs-identifier hs-var hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var -&gt; LocArg
</span><a href="#local-6989586621680978785"><span class="hs-identifier hs-var">fn2</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978769"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978779"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978791"><span class="annot"><span class="annottext">pkd_env' :: RegEnv
</span><a href="#local-6989586621680978791"><span class="hs-identifier hs-var hs-var">pkd_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978763"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978763"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span>
</span><span id="line-371"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978792"><span class="annot"><span class="annottext">env2' :: Env2 Ty2
</span><a href="#local-6989586621680978792"><span class="hs-identifier hs-var hs-var">env2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978760"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978762"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-372"></span><span>          </span><span id="local-6989586621680978793"><span class="annot"><span class="annottext">rlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978793"><span class="hs-identifier hs-var hs-var">rlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; AllocEnv -&gt; AllocEnv
forall {k}. Ord k =&gt; UrTy k -&gt; Map k TyCon -&gt; Map k TyCon
</span><a href="#local-6989586621680978695"><span class="hs-identifier hs-var">updRLocsEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978762"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span>
</span><span id="line-373"></span><span>          </span><span id="local-6989586621680978794"><span class="annot"><span class="annottext">wlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978794"><span class="hs-identifier hs-var hs-var">wlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; AllocEnv -&gt; AllocEnv) -&gt; AllocEnv -&gt; [Var] -&gt; AllocEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978795"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978795"><span class="hs-identifier hs-var">loc2</span></a></span></span><span> </span><span id="local-6989586621680978796"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978796"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978795"><span class="hs-identifier hs-var">loc2</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978796"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978762"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>      </span><span id="local-6989586621680978797"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978797"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978792"><span class="hs-identifier hs-var">env2'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978793"><span class="hs-identifier hs-var">rlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978794"><span class="hs-identifier hs-var">wlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978791"><span class="hs-identifier hs-var">pkd_env'</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978772"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-375"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978798"><span class="annot"><span class="annottext">boundscheck :: Exp2 -&gt; Exp2
</span><a href="#local-6989586621680978798"><span class="hs-identifier hs-var hs-var">boundscheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978799"><span class="annot"><span class="annottext">locarg :: LocArg
</span><a href="#local-6989586621680978799"><span class="hs-identifier hs-var hs-var">locarg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978789"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-376"></span><span>                            </span><span id="local-6989586621680978800"><span class="annot"><span class="annottext">regarg :: LocArg
</span><a href="#local-6989586621680978800"><span class="hs-identifier hs-var hs-var">regarg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978778"><span class="hs-identifier hs-var">b'</span></a></span><span>
</span><span id="line-377"></span><span>                            </span><span class="hs-comment">-- bc = boundsCheck ddefs tcon</span><span>
</span><span id="line-378"></span><span>                            </span><span id="local-6989586621680978802"><span class="annot"><span class="annottext">bc :: Int
</span><a href="#local-6989586621680978802"><span class="hs-identifier hs-var hs-var">bc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">18</span></span><span>
</span><span id="line-379"></span><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#IntTy"><span class="hs-identifier hs-var">IntTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocArg -&gt; LocArg -&gt; E2Ext LocArg Ty2
forall loc dec. Int -&gt; loc -&gt; loc -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-var">BoundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978802"><span class="hs-identifier hs-var">bc</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978800"><span class="hs-identifier hs-var">regarg</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978799"><span class="hs-identifier hs-var">locarg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680978798"><span class="hs-identifier hs-var">boundscheck</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; Exp2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978760"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978761"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978762"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
-&gt; TyCon
-&gt; (LocArg, LocArg)
-&gt; (LocArg, LocArg)
-&gt; Exp2
-&gt; E2Ext LocArg Ty2
forall loc dec.
TyCon
-&gt; TyCon -&gt; (loc, loc) -&gt; (loc, loc) -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-var">IndirectionE</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978765"><span class="hs-identifier hs-var">tcon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978766"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978789"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978778"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978790"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978779"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978771"><span class="hs-identifier hs-var">cpy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978797"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">StartOfPkdCursor</span></a></span><span> </span><span id="local-6989586621680978804"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978804"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978805"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978805"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Env2 Ty2 -&gt; Ty2
forall a. Out a =&gt; Var -&gt; Env2 a -&gt; a
</span><a href="Gibbon.Language.Syntax.html#lookupVEnv"><span class="hs-identifier hs-var">lookupVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978804"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RegEnv -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978805"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-385"></span><span>        </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978807"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978807"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; E2Ext LocArg Ty2
forall loc dec. Var -&gt; Var -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-var">TagCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978805"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978807"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; PassM Exp2
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; PassM Exp2) -&gt; TyCon -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;threadRegionsExp: unbound &quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, RegEnv) -&gt; TyCon
forall a. Out a =&gt; a -&gt; TyCon
</span><a href="Gibbon.Common.html#sdoc"><span class="hs-identifier hs-var">sdoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978805"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-comment">-- Sometimes, this expression can have RetE forms. We should collect and update</span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-comment">-- the locs here appropriately.</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978809"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978809"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978810"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978810"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978811"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978811"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680978812"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680978812"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978814"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978814"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>       </span><span id="local-6989586621680978815"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978815"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978812"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-392"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978816"><span class="annot"><span class="annottext">retlocs :: [LocArg]
</span><a href="#local-6989586621680978816"><span class="hs-identifier hs-var hs-var">retlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg]
</span><a href="Gibbon.Passes.ThreadRegions.html#findRetLocs"><span class="hs-identifier hs-var">findRetLocs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978815"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-393"></span><span>           </span><span id="local-6989586621680978818"><span class="annot"><span class="annottext">newretlocs :: [LocArg]
</span><a href="#local-6989586621680978818"><span class="hs-identifier hs-var hs-var">newretlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978816"><span class="hs-identifier hs-var">retlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978810"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-394"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978819"><span class="annot"><span class="annottext">env2' :: Env2 Ty2
</span><a href="#local-6989586621680978819"><span class="hs-identifier hs-var hs-var">env2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978809"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978811"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-395"></span><span>           </span><span id="local-6989586621680978820"><span class="annot"><span class="annottext">rlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978820"><span class="hs-identifier hs-var hs-var">rlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; AllocEnv -&gt; AllocEnv
forall {k}. Ord k =&gt; UrTy k -&gt; Map k TyCon -&gt; Map k TyCon
</span><a href="#local-6989586621680978695"><span class="hs-identifier hs-var">updRLocsEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978811"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span>
</span><span id="line-396"></span><span>           </span><span id="local-6989586621680978821"><span class="annot"><span class="annottext">wlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978821"><span class="hs-identifier hs-var hs-var">wlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; AllocEnv -&gt; AllocEnv) -&gt; AllocEnv -&gt; [Var] -&gt; AllocEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978822"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978822"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680978823"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978823"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978822"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978823"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978811"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>       </span><span id="local-6989586621680978824"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978824"><span class="hs-identifier hs-var">bod1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978819"><span class="hs-identifier hs-var">env2'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978820"><span class="hs-identifier hs-var">rlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978821"><span class="hs-identifier hs-var">wlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978814"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>       </span><span class="hs-comment">-- shadowstack  ops</span><span>
</span><span id="line-400"></span><span>       </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-401"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- free = S.fromList $ freeLocVars bod</span><span>
</span><span id="line-402"></span><span>            </span><span id="local-6989586621680978825"><span class="annot"><span class="annottext">free :: Set Var
</span><a href="#local-6989586621680978825"><span class="hs-identifier hs-var hs-var">free</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Env2 Ty2 -&gt; Exp2 -&gt; Set Var
</span><a href="#local-6989586621680978702"><span class="hs-identifier hs-var">ss_free_locs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978809"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Var]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978811"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978810"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978819"><span class="hs-identifier hs-var">env2'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978814"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-403"></span><span>            </span><span id="local-6989586621680978826"><span class="annot"><span class="annottext">free_wlocs :: Set Var
</span><a href="#local-6989586621680978826"><span class="hs-identifier hs-var hs-var">free_wlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978825"><span class="hs-identifier hs-var">free</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`S.intersection`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllocEnv -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978821"><span class="hs-identifier hs-var">wlocs_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>            </span><span id="local-6989586621680978827"><span class="annot"><span class="annottext">free_rlocs :: Set Var
</span><a href="#local-6989586621680978827"><span class="hs-identifier hs-var hs-var">free_rlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978825"><span class="hs-identifier hs-var">free</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`S.intersection`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllocEnv -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978820"><span class="hs-identifier hs-var">rlocs_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>            </span><span id="local-6989586621680978828"><span class="annot"><span class="annottext">free_rlocs' :: Set (Maybe Var, Var)
</span><a href="#local-6989586621680978828"><span class="hs-identifier hs-var hs-var">free_rlocs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978829"><span class="annot"><span class="annottext">tmp :: [(Maybe Var, Var)]
</span><a href="#local-6989586621680978829"><span class="hs-identifier hs-var hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; (Maybe Var, Var))
-&gt; [(Var, Ty2)] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978830"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978830"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978831"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978831"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Maybe Var
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978830"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978831"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; [(Maybe Var, Var)])
-&gt; [(Var, Ty2)] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-406"></span><span>                                    </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; Bool) -&gt; [(Var, Ty2)] -&gt; [(Var, Ty2)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978832"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978832"><span class="hs-identifier hs-var">_x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978833"><span class="annot"><span class="annottext">_y :: Ty2
</span><a href="#local-6989586621680978833"><span class="hs-identifier hs-var">_y</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680978834"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978834"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680978835"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978835"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978835"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978827"><span class="hs-identifier hs-var">free_rlocs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978834"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Gibbon.Passes.ThreadRegions.html#hole_tycon"><span class="hs-identifier hs-var">hole_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; [(Var, Ty2)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(TyEnv Ty2 -&gt; [(Var, Ty2)]) -&gt; TyEnv Ty2 -&gt; [(Var, Ty2)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty2 -&gt; Bool) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#filter"><span class="hs-identifier hs-var">M.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; Bool) -&gt; (Ty2 -&gt; UrTy Var) -&gt; Ty2 -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; TyEnv Ty2
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>                              </span><span id="local-6989586621680978836"><span class="annot"><span class="annottext">tmp2 :: [(Maybe Var, Var)]
</span><a href="#local-6989586621680978836"><span class="hs-identifier hs-var hs-var">tmp2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; (Maybe Var, Var)) -&gt; [Var] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978837"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978837"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978837"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [(Maybe Var, Var)]) -&gt; [Var] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; [Var]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978827"><span class="hs-identifier hs-var">free_rlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#%5C%5C"><span class="hs-operator hs-var">L.\\</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Maybe Var, Var) -&gt; Var) -&gt; [(Maybe Var, Var)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Var, Var) -&gt; Var
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978829"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>                          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)] -&gt; Set (Maybe Var, Var)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Maybe Var, Var)] -&gt; Set (Maybe Var, Var))
-&gt; [(Maybe Var, Var)] -&gt; Set (Maybe Var, Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978829"><span class="hs-identifier hs-var">tmp</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)] -&gt; [(Maybe Var, Var)] -&gt; [(Maybe Var, Var)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978836"><span class="hs-identifier hs-var">tmp2</span></a></span><span>
</span><span id="line-410"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621680978838"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978838"><span class="hs-identifier hs-var">rpush</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978839"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978839"><span class="hs-identifier hs-var">wpush</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978840"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978840"><span class="hs-identifier hs-var">rpop</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978841"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978841"><span class="hs-identifier hs-var">wpop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
-&gt; Set Var
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; PassM
     ([(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)],
      [(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)])
</span><a href="Gibbon.Passes.ThreadRegions.html#ss_ops"><span class="hs-identifier hs-var">ss_ops</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
</span><a href="#local-6989586621680978828"><span class="hs-identifier hs-var">free_rlocs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978826"><span class="hs-identifier hs-var">free_wlocs</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span>
</span><span id="line-411"></span><span>       </span><span id="local-6989586621680978842"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978842"><span class="hs-identifier hs-var">emit_ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM Bool
</span><a href="#local-6989586621680978726"><span class="hs-identifier hs-var">emit_ss_instrs</span></a></span><span>
</span><span id="line-412"></span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978842"><span class="hs-identifier hs-var">emit_ss</span></a></span><span>
</span><span id="line-413"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978843"><span class="annot"><span class="annottext">binds :: [(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978843"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978838"><span class="hs-identifier hs-var">rpush</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978839"><span class="hs-identifier hs-var">wpush</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978809"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978818"><span class="hs-identifier hs-var">newretlocs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978811"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978815"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978841"><span class="hs-identifier hs-var">wpop</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978840"><span class="hs-identifier hs-var">rpop</span></a></span><span>
</span><span id="line-414"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978843"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978824"><span class="hs-identifier hs-var">bod1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978809"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978818"><span class="hs-identifier hs-var">newretlocs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978811"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978815"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978824"><span class="hs-identifier hs-var">bod1</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978844"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978844"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978845"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978845"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978846"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978846"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978847"><span class="annot"><span class="annottext">rhs :: Exp2
</span><a href="#local-6989586621680978847"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span> </span><span id="local-6989586621680978849"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978849"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680978850"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978850"><span class="hs-identifier hs-var">x_tycon</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978851"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978851"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- x_tycon = (wlocs_env # x)</span><span>
</span><span id="line-419"></span><span>          </span><span id="local-6989586621680978852"><span class="annot"><span class="annottext">rlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978852"><span class="hs-identifier hs-var hs-var">rlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyCon -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978849"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978850"><span class="hs-identifier hs-var">x_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span>
</span><span id="line-420"></span><span>          </span><span id="local-6989586621680978853"><span class="annot"><span class="annottext">wlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978853"><span class="hs-identifier hs-var hs-var">wlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">M.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978849"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978844"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978845"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978846"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978847"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-422"></span><span>        </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978844"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978846"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978852"><span class="hs-identifier hs-var">rlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978853"><span class="hs-identifier hs-var">wlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978851"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680978854"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978854"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978855"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978855"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978856"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978856"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680978857"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978857"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680978858"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978858"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-425"></span><span>      </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="annot"><span class="annottext">((Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2)
-&gt; (Exp2 -&gt; (Var, [LocArg], Ty2, Exp2)) -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978854"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978855"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978856"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978857"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978854"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978856"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978858"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680978860"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978860"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680978861"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978861"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-429"></span><span>      </span><span class="annot"><span class="annottext">Var -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-var">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978860"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Ty2 -&gt; Env2 Ty2 -&gt; Env2 Ty2
forall a. Var -&gt; a -&gt; Env2 a -&gt; Env2 a
</span><a href="Gibbon.Language.Syntax.html#extendVEnv"><span class="hs-identifier hs-var">extendVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978860"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ArenaTy"><span class="hs-identifier hs-var">ArenaTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978861"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680978863"><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680978863"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-432"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680978863"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-433"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AddFixed"><span class="hs-identifier hs-type">AddFixed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-434"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680978866"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978866"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="Gibbon.L2.Syntax.html#FreeLE"><span class="hs-identifier hs-var">FreeLE</span></a></span><span> </span><span id="local-6989586621680978868"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978868"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-435"></span><span>          </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext LocArg Ty2) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreLocExp LocArg -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978866"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
forall loc. PreLocExp loc
</span><a href="Gibbon.L2.Syntax.html#FreeLE"><span class="hs-identifier hs-var">FreeLE</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-436"></span><span>            </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978868"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-comment">-- Update renv with a binding for loc</span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680978869"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978869"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680978870"><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680978870"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621680978871"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978871"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-439"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978872"><span class="annot"><span class="annottext">reg :: Var
</span><a href="#local-6989586621680978872"><span class="hs-identifier hs-var hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680978870"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-440"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfRegionLE"><span class="hs-identifier hs-type">StartOfRegionLE</span></a></span><span> </span><span id="local-6989586621680978874"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978874"><span class="hs-identifier hs-var">r</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978874"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-441"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#InRegionLE"><span class="hs-identifier hs-type">InRegionLE</span></a></span><span> </span><span id="local-6989586621680978876"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978876"><span class="hs-identifier hs-var">r</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978876"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-442"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterConstantLE"><span class="hs-identifier hs-type">AfterConstantLE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978878"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978878"><span class="hs-identifier hs-var">lc</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978878"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterVariableLE"><span class="hs-identifier hs-type">AfterVariableLE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978880"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978880"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978880"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>                      </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndLE"><span class="hs-identifier hs-type">FromEndLE</span></a></span><span> </span><span id="local-6989586621680978882"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978882"><span class="hs-identifier hs-var">lc</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978882"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>              </span><span id="local-6989586621680978883"><span class="annot"><span class="annottext">wlocs_env' :: AllocEnv
</span><a href="#local-6989586621680978883"><span class="hs-identifier hs-var hs-var">wlocs_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyCon -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978869"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Gibbon.Passes.ThreadRegions.html#hole_tycon"><span class="hs-identifier hs-var">hole_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span>
</span><span id="line-446"></span><span>              </span><span id="local-6989586621680978884"><span class="annot"><span class="annottext">region_locs1 :: OrderedLocsEnv
</span><a href="#local-6989586621680978884"><span class="hs-identifier hs-var hs-var">region_locs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680978870"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-447"></span><span>                               </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterConstantLE"><span class="hs-identifier hs-type">AfterConstantLE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; Var -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#adjust"><span class="hs-identifier hs-var">M.adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978885"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978885"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978885"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978869"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978872"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span>
</span><span id="line-448"></span><span>                               </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AfterVariableLE"><span class="hs-identifier hs-type">AfterVariableLE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; Var -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#adjust"><span class="hs-identifier hs-var">M.adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978886"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978886"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978886"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978869"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978872"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span>
</span><span id="line-449"></span><span>                               </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfRegionLE"><span class="hs-identifier hs-type">StartOfRegionLE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978872"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978869"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span>
</span><span id="line-450"></span><span>                               </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span>
</span><span id="line-451"></span><span>          </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext LocArg Ty2) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreLocExp LocArg -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978869"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680978870"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-452"></span><span>            </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978869"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978872"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978883"><span class="hs-identifier hs-var">wlocs_env'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978884"><span class="hs-identifier hs-var">region_locs1</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978871"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span> </span><span id="local-6989586621680978888"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978888"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680978889"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978889"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-455"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978890"><span class="annot"><span class="annottext">ty :: Ty2
</span><a href="#local-6989586621680978890"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Env2 Ty2 -&gt; Ty2
forall a. Out a =&gt; Var -&gt; Env2 a -&gt; a
</span><a href="Gibbon.Language.Syntax.html#lookupVEnv"><span class="hs-identifier hs-var">lookupVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978889"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-456"></span><span>              </span><span id="local-6989586621680978891"><span class="annot"><span class="annottext">fn :: Modality -&gt; Var -&gt; LocArg
</span><a href="#local-6989586621680978891"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621680978892"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978892"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978893"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978893"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978893"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621680978892"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978893"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>              </span><span id="local-6989586621680978894"><span class="annot"><span class="annottext">outtylocs :: [Var]
</span><a href="#local-6989586621680978894"><span class="hs-identifier hs-var hs-var">outtylocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; [Var]
</span><a href="Gibbon.NewL2.Syntax.html#locsInTy"><span class="hs-identifier hs-var">locsInTy</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978890"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-458"></span><span>              </span><span id="local-6989586621680978895"><span class="annot"><span class="annottext">outtyregvars :: [Var]
</span><a href="#local-6989586621680978895"><span class="hs-identifier hs-var hs-var">outtyregvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-459"></span><span>                </span><span class="annot"><span class="annottext">(Var -&gt; [Var] -&gt; [Var]) -&gt; [Var] -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978896"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978896"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680978897"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978897"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RegEnv -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978896"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-460"></span><span>                                     </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978896"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Var]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978897"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-461"></span><span>                                     </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680978898"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978898"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978898"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [Var] -&gt; [Var]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978897"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978894"><span class="hs-identifier hs-var">outtylocs</span></a></span><span>
</span><span id="line-463"></span><span>              </span><span id="local-6989586621680978899"><span class="annot"><span class="annottext">outtyregargs :: [LocArg]
</span><a href="#local-6989586621680978899"><span class="hs-identifier hs-var hs-var">outtyregargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; LocArg) -&gt; [Var] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Var -&gt; LocArg
</span><a href="#local-6989586621680978891"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978895"><span class="hs-identifier hs-var">outtyregvars</span></a></span><span>
</span><span id="line-464"></span><span>              </span><span id="local-6989586621680978900"><span class="annot"><span class="annottext">inregvars :: [Var]
</span><a href="#local-6989586621680978900"><span class="hs-identifier hs-var hs-var">inregvars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LREM -&gt; Var) -&gt; [LREM] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978901"><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978901"><span class="hs-identifier hs-var">lrm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978902"><span class="annot"><span class="annottext">r :: Var
</span><a href="#local-6989586621680978902"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LREM -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#lremLoc"><span class="hs-identifier hs-var">lremLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978901"><span class="hs-identifier hs-var">lrm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>                                           </span><span id="local-6989586621680978903"><span class="annot"><span class="annottext">last_loc :: Var
</span><a href="#local-6989586621680978903"><span class="hs-identifier hs-var hs-var">last_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv -&gt; Var -&gt; [Var]
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978902"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                                           </span><span id="local-6989586621680978904"><span class="annot"><span class="annottext">r' :: Var
</span><a href="#local-6989586621680978904"><span class="hs-identifier hs-var hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978903"><span class="hs-identifier hs-var">last_loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>                                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978904"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([LREM] -&gt; [Var]) -&gt; [LREM] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-468"></span><span>                          </span><span class="annot"><span class="annottext">(LREM -&gt; Bool) -&gt; [LREM] -&gt; [LREM]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978905"><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978905"><span class="hs-identifier hs-var">lrm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Modality
</span><a href="Gibbon.NewL2.Syntax.html#lremMode"><span class="hs-identifier hs-var">lremMode</span></a></span><span> </span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680978905"><span class="hs-identifier hs-var">lrm</span></a></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span>
</span><span id="line-469"></span><span>              </span><span id="local-6989586621680978907"><span class="annot"><span class="annottext">inregargs :: [LocArg]
</span><a href="#local-6989586621680978907"><span class="hs-identifier hs-var hs-var">inregargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; LocArg) -&gt; [Var] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Var -&gt; LocArg
</span><a href="#local-6989586621680978891"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978900"><span class="hs-identifier hs-var">inregvars</span></a></span><span>
</span><span id="line-470"></span><span>              </span><span id="local-6989586621680978908"><span class="annot"><span class="annottext">newlocs :: [LocArg]
</span><a href="#local-6989586621680978908"><span class="hs-identifier hs-var hs-var">newlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978907"><span class="hs-identifier hs-var">inregargs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978899"><span class="hs-identifier hs-var">outtyregargs</span></a></span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; Var -&gt; E2Ext LocArg Ty2
forall loc dec. [loc] -&gt; Var -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-var">RetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978908"><span class="hs-identifier hs-var">newlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680978888"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978889"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span> </span><span id="local-6989586621680978909"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978909"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680978910"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978910"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; E2Ext LocArg Ty2
forall loc dec. Var -&gt; Var -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-var">TagCursor</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978909"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978910"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680978912"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978912"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680978913"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680978913"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680978914"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680978914"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680978915"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978915"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-475"></span><span>          </span><span class="hs-comment">-- shadowstack  ops</span><span>
</span><span id="line-476"></span><span>          </span><span class="hs-comment">--------------------</span><span>
</span><span id="line-477"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- free = S.fromList $ freeLocVars bod</span><span>
</span><span id="line-478"></span><span>              </span><span id="local-6989586621680978916"><span class="annot"><span class="annottext">free :: Set Var
</span><a href="#local-6989586621680978916"><span class="hs-identifier hs-var hs-var">free</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Env2 Ty2 -&gt; Exp2 -&gt; Set Var
</span><a href="#local-6989586621680978702"><span class="hs-identifier hs-var">ss_free_locs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Set Var
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978912"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978915"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-479"></span><span>              </span><span id="local-6989586621680978918"><span class="annot"><span class="annottext">free_wlocs :: Set Var
</span><a href="#local-6989586621680978918"><span class="hs-identifier hs-var hs-var">free_wlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978916"><span class="hs-identifier hs-var">free</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`S.intersection`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllocEnv -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>              </span><span id="local-6989586621680978919"><span class="annot"><span class="annottext">free_rlocs :: Set Var
</span><a href="#local-6989586621680978919"><span class="hs-identifier hs-var hs-var">free_rlocs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978916"><span class="hs-identifier hs-var">free</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#intersection"><span class="hs-operator hs-var">`S.intersection`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllocEnv -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>              </span><span id="local-6989586621680978920"><span class="annot"><span class="annottext">free_rlocs' :: Set (Maybe Var, Var)
</span><a href="#local-6989586621680978920"><span class="hs-identifier hs-var hs-var">free_rlocs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978921"><span class="annot"><span class="annottext">tmp :: [(Maybe Var, Var)]
</span><a href="#local-6989586621680978921"><span class="hs-identifier hs-var hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; (Maybe Var, Var))
-&gt; [(Var, Ty2)] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978922"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978922"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978923"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978923"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Maybe Var
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978922"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978923"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Var, Ty2)] -&gt; [(Maybe Var, Var)])
-&gt; [(Var, Ty2)] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-482"></span><span>                                      </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; Bool) -&gt; [(Var, Ty2)] -&gt; [(Var, Ty2)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680978924"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978924"><span class="hs-identifier hs-var">_x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978925"><span class="annot"><span class="annottext">_y :: Ty2
</span><a href="#local-6989586621680978925"><span class="hs-identifier hs-var">_y</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680978926"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978926"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680978927"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978927"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978927"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978919"><span class="hs-identifier hs-var">free_rlocs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680978926"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Gibbon.Passes.ThreadRegions.html#hole_tycon"><span class="hs-identifier hs-var">hole_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; [(Var, Ty2)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(TyEnv Ty2 -&gt; [(Var, Ty2)]) -&gt; TyEnv Ty2 -&gt; [(Var, Ty2)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty2 -&gt; Bool) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#filter"><span class="hs-identifier hs-var">M.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; Bool) -&gt; (Ty2 -&gt; UrTy Var) -&gt; Ty2 -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; TyEnv Ty2
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>                                </span><span id="local-6989586621680978928"><span class="annot"><span class="annottext">tmp2 :: [(Maybe Var, Var)]
</span><a href="#local-6989586621680978928"><span class="hs-identifier hs-var hs-var">tmp2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; (Maybe Var, Var)) -&gt; [Var] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680978929"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978929"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var
forall a. Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978929"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [(Maybe Var, Var)]) -&gt; [Var] -&gt; [(Maybe Var, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var -&gt; [Var]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978919"><span class="hs-identifier hs-var">free_rlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.OldList.html#%5C%5C"><span class="hs-operator hs-var">L.\\</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Maybe Var, Var) -&gt; Var) -&gt; [(Maybe Var, Var)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Var, Var) -&gt; Var
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978921"><span class="hs-identifier hs-var">tmp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>                            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)] -&gt; Set (Maybe Var, Var)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Maybe Var, Var)] -&gt; Set (Maybe Var, Var))
-&gt; [(Maybe Var, Var)] -&gt; Set (Maybe Var, Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978921"><span class="hs-identifier hs-var">tmp</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)] -&gt; [(Maybe Var, Var)] -&gt; [(Maybe Var, Var)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Var, Var)]
</span><a href="#local-6989586621680978928"><span class="hs-identifier hs-var">tmp2</span></a></span><span>
</span><span id="line-486"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621680978930"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978930"><span class="hs-identifier hs-var">rpush</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978931"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978931"><span class="hs-identifier hs-var">wpush</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978932"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978932"><span class="hs-identifier hs-var">rpop</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680978933"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978933"><span class="hs-identifier hs-var">wpop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
-&gt; Set Var
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; PassM
     ([(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)],
      [(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)])
</span><a href="Gibbon.Passes.ThreadRegions.html#ss_ops"><span class="hs-identifier hs-var">ss_ops</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
</span><a href="#local-6989586621680978920"><span class="hs-identifier hs-var">free_rlocs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978918"><span class="hs-identifier hs-var">free_wlocs</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span>
</span><span id="line-487"></span><span>          </span><span id="local-6989586621680978934"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978934"><span class="hs-identifier hs-var">emit_ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM Bool
</span><a href="#local-6989586621680978726"><span class="hs-identifier hs-var">emit_ss_instrs</span></a></span><span>
</span><span id="line-488"></span><span>          </span><span id="local-6989586621680978935"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978935"><span class="hs-identifier hs-var">bod'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978915"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-489"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978934"><span class="hs-identifier hs-var">emit_ss</span></a></span><span>
</span><span id="line-490"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978936"><span class="annot"><span class="annottext">pre :: Exp2 -&gt; Exp2
</span><a href="#local-6989586621680978936"><span class="hs-identifier hs-var hs-var">pre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978930"><span class="hs-identifier hs-var">rpush</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978931"><span class="hs-identifier hs-var">wpush</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>                        </span><span id="local-6989586621680978937"><span class="annot"><span class="annottext">post :: Exp2
</span><a href="#local-6989586621680978937"><span class="hs-identifier hs-var hs-var">post</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; Exp2 -&gt; Exp2
forall loc dec (ext :: * -&gt; * -&gt; *).
[(Var, [loc], dec, PreExp ext loc dec)]
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978933"><span class="hs-identifier hs-var">wpop</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680978932"><span class="hs-identifier hs-var">rpop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978935"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-492"></span><span>                    </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680978936"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-var">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978912"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680978913"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680978914"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978937"><span class="hs-identifier hs-var">post</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-var">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978912"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680978913"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680978914"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978935"><span class="hs-identifier hs-var">bod'</span></a></span><span>
</span><span id="line-494"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680978939"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978939"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680978940"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680978940"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680978941"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680978941"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680978942"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978942"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext LocArg Ty2) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-var">LetParRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680978939"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680978940"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680978941"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978942"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-495"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-type">FromEndE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span> </span><span id="local-6989586621680978944"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978944"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680978945"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978945"><span class="hs-identifier hs-var">_bound</span></a></span></span><span> </span><span id="local-6989586621680978946"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978946"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-497"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680978947"><span class="annot"><span class="annottext">reg :: Var
</span><a href="#local-6989586621680978947"><span class="hs-identifier hs-var hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978946"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>          </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocArg -&gt; LocArg -&gt; E2Ext LocArg Ty2
forall loc dec. Int -&gt; loc -&gt; loc -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-var">BoundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978944"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Modality -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-var">NewL2.EndOfReg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978947"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Gibbon.L2.Syntax.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978947"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680978946"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-499"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-500"></span><span>        </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="Gibbon.L2.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span id="local-6989586621680978950"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978950"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621680978951"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978951"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2)
-&gt; (Exp2 -&gt; E2Ext LocArg Ty2) -&gt; Exp2 -&gt; Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec. [Var] -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-var">LetAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680978950"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978951"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-503"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-504"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-505"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-comment">-- Straightforward recursion</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-515"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-516"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680978961"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978961"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680978962"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978962"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680978961"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978962"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680978964"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978964"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680978965"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978965"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680978966"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978966"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2 -&gt; Exp2 -&gt; Exp2)
-&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2 -&gt; Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978964"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM (Exp2 -&gt; Exp2)
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978965"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">PassM (Exp2 -&gt; Exp2) -&gt; PassM Exp2 -&gt; PassM Exp2
forall a b. PassM (a -&gt; b) -&gt; PassM a -&gt; PassM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978966"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-518"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680978968"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978968"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="annot"><span class="annottext">([Exp2] -&gt; Exp2) -&gt; PassM [Exp2] -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; [Exp2] -&gt; PassM [Exp2]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680978968"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-519"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680978970"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978970"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680978971"><span class="annot"><span class="annottext">[(TyCon, [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680978971"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-520"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span> </span><span id="local-6989586621680978972"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978972"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978970"><span class="hs-identifier hs-var">scrt</span></a></span><span>
</span><span id="line-521"></span><span>          </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680978973"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978973"><span class="hs-identifier hs-var">tyloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Env2 Ty2 -&gt; Ty2
forall a. Out a =&gt; Var -&gt; Env2 a -&gt; a
</span><a href="Gibbon.Language.Syntax.html#lookupVEnv"><span class="hs-identifier hs-var">lookupVEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978972"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>          </span><span id="local-6989586621680978974"><span class="annot"><span class="annottext">reg :: Var
</span><a href="#local-6989586621680978974"><span class="hs-identifier hs-var hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">M.!</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978973"><span class="hs-identifier hs-var">tyloc</span></a></span><span>
</span><span id="line-523"></span><span>      </span><span class="annot"><span class="annottext">Exp2 -&gt; [(TyCon, [(Var, LocArg)], Exp2)] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(TyCon, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978970"><span class="hs-identifier hs-var">scrt</span></a></span><span> </span><span class="annot"><span class="annottext">([(TyCon, [(Var, LocArg)], Exp2)] -&gt; Exp2)
-&gt; PassM [(TyCon, [(Var, LocArg)], Exp2)] -&gt; PassM Exp2
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon, [(Var, LocArg)], Exp2)
 -&gt; PassM (TyCon, [(Var, LocArg)], Exp2))
-&gt; [(TyCon, [(Var, LocArg)], Exp2)]
-&gt; PassM [(TyCon, [(Var, LocArg)], Exp2)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; (TyCon, [(Var, LocArg)], Exp2)
-&gt; PassM (TyCon, [(Var, LocArg)], Exp2)
</span><a href="#local-6989586621680978975"><span class="hs-identifier hs-var">docase</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978974"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680978971"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680978976"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978976"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680978977"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978977"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680978978"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978978"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-525"></span><span>      </span><span id="local-6989586621680978979"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978979"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978976"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; PassM Exp2) -&gt; Exp2 -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Ty2 -&gt; Bool -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978979"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680978977"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680978978"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; PassM Exp2
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;threadRegionsExp: Unbound SpawnE&quot;</span></span><span>
</span><span id="line-528"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-var">SyncE</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; PassM Exp2
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680978538"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; PassM Exp2
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; PassM Exp2) -&gt; TyCon -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;threadRegionsExp: TODO MapE&quot;</span></span><span>
</span><span id="line-530"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; PassM Exp2
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; PassM Exp2) -&gt; TyCon -&gt; PassM Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;threadRegionsExp: TODO FoldE&quot;</span></span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-532"></span><span>    </span><span id="local-6989586621680978726"><span class="annot"><span class="annottext">emit_ss_instrs :: PassM Bool
</span><a href="#local-6989586621680978726"><span class="hs-identifier hs-var hs-var">emit_ss_instrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-533"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680978992"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680978992"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassM DynFlags
forall (m :: * -&gt; *). MonadReader Config m =&gt; m DynFlags
</span><a href="Gibbon.Common.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-534"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; PassM Bool
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; PassM Bool) -&gt; Bool -&gt; PassM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_GenGc"><span class="hs-identifier hs-var">Opt_GenGc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680978992"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="Gibbon.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="Gibbon.DynFlags.html#Opt_DisableGC"><span class="hs-identifier hs-var">Opt_DisableGC</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621680978992"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>    </span><span id="local-6989586621680978759"><span class="annot"><span class="annottext">go :: Exp2 -&gt; PassM Exp2
</span><a href="#local-6989586621680978759"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978528"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978529"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978530"><span class="hs-identifier hs-var">lfenv</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978531"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680978532"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978533"><span class="hs-identifier hs-var">pkd_env</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680978534"><span class="hs-identifier hs-var">region_locs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978535"><span class="hs-identifier hs-var">ran_env</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978536"><span class="hs-identifier hs-var">indirs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680978537"><span class="hs-identifier hs-var">redirs</span></a></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span>    </span><span id="local-6989586621680978975"><span class="annot"><span class="annottext">docase :: Var
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; (TyCon, [(Var, LocArg)], Exp2)
-&gt; PassM (TyCon, [(Var, LocArg)], Exp2)
</span><a href="#local-6989586621680978975"><span class="hs-identifier hs-var hs-var">docase</span></a></span></span><span> </span><span id="local-6989586621680978996"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978996"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680978997"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978997"><span class="hs-identifier hs-var">renv1</span></a></span></span><span> </span><span id="local-6989586621680978998"><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978998"><span class="hs-identifier hs-var">env21</span></a></span></span><span> </span><span id="local-6989586621680978999"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978999"><span class="hs-identifier hs-var">lfenv1</span></a></span></span><span> </span><span id="local-6989586621680979000"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979000"><span class="hs-identifier hs-var">rlocs_env1</span></a></span></span><span> </span><span id="local-6989586621680979001"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979001"><span class="hs-identifier hs-var">wlocs_env1</span></a></span></span><span> </span><span id="local-6989586621680979002"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979002"><span class="hs-identifier hs-var">pkd_env1</span></a></span></span><span> </span><span id="local-6989586621680979003"><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680979003"><span class="hs-identifier hs-var">region_locs1</span></a></span></span><span> </span><span id="local-6989586621680979004"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979004"><span class="hs-identifier hs-var">ran_env1</span></a></span></span><span> </span><span id="local-6989586621680979005"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979005"><span class="hs-identifier hs-var">indirs1</span></a></span></span><span> </span><span id="local-6989586621680979006"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979006"><span class="hs-identifier hs-var">redirs1</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680979007"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979008"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680979008"><span class="hs-identifier hs-var">vlocargs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979009"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979009"><span class="hs-identifier hs-var">bod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-comment">-- Update the envs with bindings for pattern matched variables and locations.</span><span>
</span><span id="line-540"></span><span>      </span><span class="hs-comment">-- The locations point to the same region as the scrutinee.</span><span>
</span><span id="line-541"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680979010"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979010"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979011"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979011"><span class="hs-identifier hs-var">locargs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)] -&gt; ([Var], [LocArg])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680979008"><span class="hs-identifier hs-var">vlocargs</span></a></span><span>
</span><span id="line-542"></span><span>          </span><span id="local-6989586621680979013"><span class="annot"><span class="annottext">dcon_tys :: [Ty2]
</span><a href="#local-6989586621680979013"><span class="hs-identifier hs-var hs-var">dcon_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; TyCon -&gt; [Ty2]
forall a. Out a =&gt; DDefs a -&gt; TyCon -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-543"></span><span>          </span><span id="local-6989586621680979015"><span class="annot"><span class="annottext">locs :: [Var]
</span><a href="#local-6989586621680979015"><span class="hs-identifier hs-var hs-var">locs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979011"><span class="hs-identifier hs-var">locargs</span></a></span><span>
</span><span id="line-544"></span><span>          </span><span id="local-6989586621680979016"><span class="annot"><span class="annottext">renv0 :: RegEnv
</span><a href="#local-6989586621680979016"><span class="hs-identifier hs-var hs-var">renv0</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isIndirectionTag"><span class="hs-identifier hs-var">isIndirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRedirectionTag"><span class="hs-identifier hs-var">isRedirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-545"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; RegEnv -&gt; RegEnv) -&gt; RegEnv -&gt; [Var] -&gt; RegEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680979019"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979019"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621680979020"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979020"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979019"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978996"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979020"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978997"><span class="hs-identifier hs-var">renv1</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979010"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-546"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978997"><span class="hs-identifier hs-var">renv1</span></a></span><span>
</span><span id="line-547"></span><span>          </span><span id="local-6989586621680979021"><span class="annot"><span class="annottext">renv1' :: RegEnv
</span><a href="#local-6989586621680979021"><span class="hs-identifier hs-var hs-var">renv1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; RegEnv -&gt; RegEnv) -&gt; RegEnv -&gt; [Var] -&gt; RegEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680979022"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979022"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621680979023"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979023"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979022"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978996"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979023"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979016"><span class="hs-identifier hs-var">renv0</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979015"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-548"></span><span>          </span><span id="local-6989586621680979024"><span class="annot"><span class="annottext">env21' :: Env2 Ty2
</span><a href="#local-6989586621680979024"><span class="hs-identifier hs-var hs-var">env21'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
TyCon -&gt; DDefs Ty2 -&gt; [Var] -&gt; [Var] -&gt; Env2 Ty2 -&gt; Env2 Ty2
TyCon -&gt; DDefs Ty2 -&gt; [Var] -&gt; [Var] -&gt; Env2 Ty2 -&gt; Env2 Ty2
</span><a href="Gibbon.NewL2.Syntax.html#extendPatternMatchEnv"><span class="hs-identifier hs-var">extendPatternMatchEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979010"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979015"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680978998"><span class="hs-identifier hs-var">env21</span></a></span><span>
</span><span id="line-549"></span><span>          </span><span id="local-6989586621680979026"><span class="annot"><span class="annottext">rlocs_env1' :: AllocEnv
</span><a href="#local-6989586621680979026"><span class="hs-identifier hs-var hs-var">rlocs_env1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; AllocEnv -&gt; AllocEnv)
-&gt; AllocEnv -&gt; [(Var, Ty2)] -&gt; AllocEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680979027"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979027"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979028"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979028"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979029"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979029"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-550"></span><span>                                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979028"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-551"></span><span>                                  </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680979030"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979030"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyCon -&gt; AllocEnv -&gt; AllocEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979027"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979030"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979029"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-552"></span><span>                                  </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979029"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>                              </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979000"><span class="hs-identifier hs-var">rlocs_env1</span></a></span><span>
</span><span id="line-554"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b.
(Show a, Show b, HasCallStack) =&gt;
[a] -&gt; [b] -&gt; [(a, b)]
</span><a href="Gibbon.Common.html#fragileZip"><span class="hs-identifier hs-var">fragileZip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979015"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680979013"><span class="hs-identifier hs-var">dcon_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>          </span><span id="local-6989586621680979032"><span class="annot"><span class="annottext">pkd_env1' :: RegEnv
</span><a href="#local-6989586621680979032"><span class="hs-identifier hs-var hs-var">pkd_env1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Var, Ty2) -&gt; RegEnv -&gt; RegEnv)
-&gt; RegEnv -&gt; [(Var, Ty2)] -&gt; RegEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680979033"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979033"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979034"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979034"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979035"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979035"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-556"></span><span>                                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979034"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-557"></span><span>                                  </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979033"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978996"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979035"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-558"></span><span>                                  </span><span class="annot"><span class="annottext">UrTy Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979035"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>                              </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979002"><span class="hs-identifier hs-var">pkd_env1</span></a></span><span>
</span><span id="line-560"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Ty2] -&gt; [(Var, Ty2)]
forall a b.
(Show a, Show b, HasCallStack) =&gt;
[a] -&gt; [b] -&gt; [(a, b)]
</span><a href="Gibbon.Common.html#fragileZip"><span class="hs-identifier hs-var">fragileZip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979015"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680979013"><span class="hs-identifier hs-var">dcon_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>          </span><span id="local-6989586621680979036"><span class="annot"><span class="annottext">indirs1' :: Set Var
</span><a href="#local-6989586621680979036"><span class="hs-identifier hs-var hs-var">indirs1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isIndirectionTag"><span class="hs-identifier hs-var">isIndirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-562"></span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979010"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979005"><span class="hs-identifier hs-var">indirs1</span></a></span><span>
</span><span id="line-563"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979005"><span class="hs-identifier hs-var">indirs1</span></a></span><span>
</span><span id="line-564"></span><span>          </span><span id="local-6989586621680979039"><span class="annot"><span class="annottext">redirs1' :: Set Var
</span><a href="#local-6989586621680979039"><span class="hs-identifier hs-var hs-var">redirs1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRedirectionTag"><span class="hs-identifier hs-var">isRedirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-565"></span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979010"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979006"><span class="hs-identifier hs-var">redirs1</span></a></span><span>
</span><span id="line-566"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979006"><span class="hs-identifier hs-var">redirs1</span></a></span><span>
</span><span id="line-567"></span><span>          </span><span id="local-6989586621680979040"><span class="annot"><span class="annottext">region_locs1' :: OrderedLocsEnv
</span><a href="#local-6989586621680979040"><span class="hs-identifier hs-var hs-var">region_locs1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isIndirectionTag"><span class="hs-identifier hs-var">isIndirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRedirectionTag"><span class="hs-identifier hs-var">isRedirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span>
</span><span id="line-568"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; Var -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#adjust"><span class="hs-identifier hs-var">M.adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680979041"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979041"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979041"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; [Var]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979010"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978996"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680979003"><span class="hs-identifier hs-var">region_locs1</span></a></span><span>
</span><span id="line-569"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; Var -&gt; OrderedLocsEnv -&gt; OrderedLocsEnv
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#adjust"><span class="hs-identifier hs-var">M.adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680979043"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979043"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979043"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [Var]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979015"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680978996"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680979003"><span class="hs-identifier hs-var">region_locs1</span></a></span><span>
</span><span id="line-570"></span><span>          </span><span id="local-6989586621680979044"><span class="annot"><span class="annottext">num_cursor_tys :: Int
</span><a href="#local-6989586621680979044"><span class="hs-identifier hs-var hs-var">num_cursor_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ty2] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">([Ty2] -&gt; Int) -&gt; [Ty2] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty2 -&gt; Bool) -&gt; [Ty2] -&gt; [Ty2]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrTy Var -&gt; UrTy Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var
forall loc. UrTy loc
</span><a href="Gibbon.Language.Syntax.html#CursorTy"><span class="hs-identifier hs-var">CursorTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; Bool) -&gt; (Ty2 -&gt; UrTy Var) -&gt; Ty2 -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ty2]
</span><a href="#local-6989586621680979013"><span class="hs-identifier hs-var">dcon_tys</span></a></span><span>
</span><span id="line-571"></span><span>          </span><span id="local-6989586621680979045"><span class="annot"><span class="annottext">ran_env1' :: RegEnv
</span><a href="#local-6989586621680979045"><span class="hs-identifier hs-var hs-var">ran_env1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979004"><span class="hs-identifier hs-var">ran_env1</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; RegEnv -&gt; RegEnv
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-operator hs-var">`M.union`</span></a></span><span>
</span><span id="line-572"></span><span>                      </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isIndirectionTag"><span class="hs-identifier hs-var">isIndirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="Gibbon.Language.Constants.html#isRedirectionTag"><span class="hs-identifier hs-var">isRedirectionTag</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">RegEnv
forall k a. Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-573"></span><span>                         </span><span class="annot"><span class="annottext">[(Var, Var)] -&gt; RegEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, Var)] -&gt; RegEnv) -&gt; [(Var, Var)] -&gt; RegEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [(Var, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span>
</span><span id="line-574"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; [Var]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979044"><span class="hs-identifier hs-var">num_cursor_tys</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [Var]) -&gt; [Var] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979015"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Var] -&gt; [Var]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979044"><span class="hs-identifier hs-var">num_cursor_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979010"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979007"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680979008"><span class="hs-identifier hs-var">vlocargs</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; (TyCon, [(Var, LocArg)], Exp2))
-&gt; PassM Exp2 -&gt; PassM (TyCon, [(Var, LocArg)], Exp2)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-577"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2
-&gt; FunDefs Exp2
-&gt; [LREM]
-&gt; RegEnv
-&gt; Env2 Ty2
-&gt; RegEnv
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; OrderedLocsEnv
-&gt; RegEnv
-&gt; Set Var
-&gt; Set Var
-&gt; Exp2
-&gt; PassM Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#threadRegionsExp"><span class="hs-identifier hs-var">threadRegionsExp</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680978525"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">FunDefs Exp2
</span><a href="#local-6989586621680978526"><span class="hs-identifier hs-var">fundefs</span></a></span><span> </span><span class="annot"><span class="annottext">[LREM]
</span><a href="#local-6989586621680978527"><span class="hs-identifier hs-var">fnLocArgs</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979021"><span class="hs-identifier hs-var">renv1'</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680979024"><span class="hs-identifier hs-var">env21'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680978999"><span class="hs-identifier hs-var">lfenv1</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979026"><span class="hs-identifier hs-var">rlocs_env1'</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979001"><span class="hs-identifier hs-var">wlocs_env1</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979032"><span class="hs-identifier hs-var">pkd_env1'</span></a></span><span> </span><span class="annot"><span class="annottext">OrderedLocsEnv
</span><a href="#local-6989586621680979040"><span class="hs-identifier hs-var">region_locs1'</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979045"><span class="hs-identifier hs-var">ran_env1'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979036"><span class="hs-identifier hs-var">indirs1'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979039"><span class="hs-identifier hs-var">redirs1'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979009"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><a href="#local-6989586621680978702"><span class="hs-identifier hs-type">ss_free_locs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Env2"><span class="hs-identifier hs-type">Env2</span></a></span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621680978702"><span class="annot"><span class="annottext">ss_free_locs :: Set Var -&gt; Env2 Ty2 -&gt; Exp2 -&gt; Set Var
</span><a href="#local-6989586621680978702"><span class="hs-identifier hs-var hs-var">ss_free_locs</span></a></span></span><span> </span><span id="local-6989586621680979047"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979047"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621680979048"><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680979048"><span class="hs-identifier hs-var">env20</span></a></span></span><span> </span><span id="local-6989586621680979049"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979049"><span class="hs-identifier hs-var">ex0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-581"></span><span>                     </span><span class="annot"><span class="annottext">(Var -&gt; Var) -&gt; Set Var -&gt; Set Var
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#map"><span class="hs-identifier hs-var">S.map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680979051"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979051"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TyEnv Ty2 -&gt; Maybe Ty2
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979051"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; TyEnv Ty2
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680979048"><span class="hs-identifier hs-var">env20</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-582"></span><span>                                       </span><span class="hs-comment">-- assumption: it's a location</span><span>
</span><span id="line-583"></span><span>                                       </span><span class="annot"><span class="annottext">Maybe Ty2
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979051"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-584"></span><span>                                       </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-type">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979052"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979052"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979052"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-585"></span><span>                                       </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680979053"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979053"><span class="hs-identifier hs-var">wty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Var
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Var) -&gt; TyCon -&gt; Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;threadRegionsExp: unexpected type &quot;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; TyCon
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, Ty2) -&gt; TyCon
forall a. Show a =&gt; a -&gt; TyCon
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979051"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979053"><span class="hs-identifier hs-var">wty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979049"><span class="hs-identifier hs-var">ex0</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`S.difference`</span></a></span><span>
</span><span id="line-587"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979047"><span class="hs-identifier hs-var">bound</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span>
</span><span id="line-588"></span><span>                             </span><span class="annot"><span class="annottext">TyEnv Ty2 -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty2 -&gt; Bool) -&gt; TyEnv Ty2 -&gt; TyEnv Ty2
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#filter"><span class="hs-identifier hs-var">M.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Ty2 -&gt; Bool) -&gt; Ty2 -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#isPackedTy"><span class="hs-identifier hs-var">isPackedTy</span></a></span><span> </span><span class="annot"><span class="annottext">(UrTy Var -&gt; Bool) -&gt; (Ty2 -&gt; UrTy Var) -&gt; Ty2 -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; TyEnv Ty2
forall a. Env2 a -&gt; TyEnv a
</span><a href="Gibbon.Language.Syntax.html#vEnv"><span class="hs-identifier hs-var">vEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680979048"><span class="hs-identifier hs-var">env20</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span>
</span><span id="line-589"></span><span>                             </span><span class="annot"><span class="annottext">Map Var (ArrowTy2 Ty2) -&gt; Set Var
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">M.keysSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env2 Ty2 -&gt; TyEnv (ArrowTy Ty2)
forall a. Env2 a -&gt; TyEnv (ArrowTy a)
</span><a href="Gibbon.Language.Syntax.html#fEnv"><span class="hs-identifier hs-var">fEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env2 Ty2
</span><a href="#local-6989586621680979048"><span class="hs-identifier hs-var">env20</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span>    </span><span id="local-6989586621680978695"><span class="annot"><span class="annottext">updRLocsEnv :: UrTy k -&gt; Map k TyCon -&gt; Map k TyCon
</span><a href="#local-6989586621680978695"><span class="hs-identifier hs-var hs-var">updRLocsEnv</span></a></span></span><span> </span><span id="local-6989586621680979065"><span class="annot"><span class="annottext">UrTy k
</span><a href="#local-6989586621680979065"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680979066"><span class="annot"><span class="annottext">Map k TyCon
</span><a href="#local-6989586621680979066"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-592"></span><span>                 </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UrTy k
</span><a href="#local-6989586621680979065"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-593"></span><span>                   </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PackedTy"><span class="hs-identifier hs-type">PackedTy</span></a></span><span> </span><span id="local-6989586621680979067"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979067"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680979068"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680979068"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">k -&gt; TyCon -&gt; Map k TyCon -&gt; Map k TyCon
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680979068"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979067"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Map k TyCon
</span><a href="#local-6989586621680979066"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-594"></span><span>                   </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-type">ProdTy</span></a></span><span> </span><span id="local-6989586621680979069"><span class="annot"><span class="annottext">[UrTy k]
</span><a href="#local-6989586621680979069"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UrTy k -&gt; Map k TyCon -&gt; Map k TyCon)
-&gt; Map k TyCon -&gt; [UrTy k] -&gt; Map k TyCon
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy k -&gt; Map k TyCon -&gt; Map k TyCon
</span><a href="#local-6989586621680978695"><span class="hs-identifier hs-var">updRLocsEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Map k TyCon
</span><a href="#local-6989586621680979066"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[UrTy k]
</span><a href="#local-6989586621680979069"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-595"></span><span>                   </span><span class="annot"><span class="annottext">UrTy k
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map k TyCon
</span><a href="#local-6989586621680979066"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#hole_tycon"><span class="hs-identifier hs-type">hole_tycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-599"></span><span id="hole_tycon"><span class="annot"><span class="annottext">hole_tycon :: TyCon
</span><a href="Gibbon.Passes.ThreadRegions.html#hole_tycon"><span class="hs-identifier hs-var hs-var">hole_tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;HOLE&quot;</span></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#ss_ops"><span class="hs-identifier hs-type">ss_ops</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#AllocEnv"><span class="hs-identifier hs-type">AllocEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#AllocEnv"><span class="hs-identifier hs-type">AllocEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#RegEnv"><span class="hs-identifier hs-type">RegEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-602"></span><span>          </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span>
</span><span id="line-603"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-604"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span id="ss_ops"><span class="annot"><span class="annottext">ss_ops :: Set (Maybe Var, Var)
-&gt; Set Var
-&gt; AllocEnv
-&gt; AllocEnv
-&gt; RegEnv
-&gt; PassM
     ([(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)],
      [(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)])
</span><a href="Gibbon.Passes.ThreadRegions.html#ss_ops"><span class="hs-identifier hs-var hs-var">ss_ops</span></a></span></span><span> </span><span id="local-6989586621680979130"><span class="annot"><span class="annottext">Set (Maybe Var, Var)
</span><a href="#local-6989586621680979130"><span class="hs-identifier hs-var">free_rlocs</span></a></span></span><span> </span><span id="local-6989586621680979131"><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979131"><span class="hs-identifier hs-var">free_wlocs</span></a></span></span><span> </span><span id="local-6989586621680979132"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979132"><span class="hs-identifier hs-var">rlocs_env</span></a></span></span><span> </span><span id="local-6989586621680979133"><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979133"><span class="hs-identifier hs-var">wlocs_env</span></a></span></span><span> </span><span id="local-6989586621680979134"><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979134"><span class="hs-identifier hs-var">renv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-606"></span><span>      </span><span id="local-6989586621680979135"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979135"><span class="hs-identifier hs-var">rpush</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Maybe Var, Var)
 -&gt; [(Var, [LocArg], Ty2, Exp2)]
 -&gt; PassM [(Var, [LocArg], Ty2, Exp2)])
-&gt; [(Var, [LocArg], Ty2, Exp2)]
-&gt; Set (Maybe Var, Var)
-&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldrM"><span class="hs-identifier hs-var">foldrM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680979136"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680979136"><span class="hs-identifier hs-var">mb_x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979137"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979137"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979138"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979138"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-607"></span><span>                         </span><span id="local-6989586621680979139"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979139"><span class="hs-identifier hs-var">push</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;ss_push&quot;</span></span><span>
</span><span id="line-608"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680979140"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621680979140"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979132"><span class="hs-identifier hs-var">rlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv -&gt; Var -&gt; TyCon
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979137"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-609"></span><span>                         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979140"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Gibbon.Passes.ThreadRegions.html#hole_tycon"><span class="hs-identifier hs-var">hole_tycon</span></a></span><span>
</span><span id="line-610"></span><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979138"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-611"></span><span>                         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680979136"><span class="hs-identifier hs-var">mb_x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-612"></span><span>                                </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979139"><span class="hs-identifier hs-var">push</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality -&gt; Var -&gt; Var -&gt; TyCon -&gt; E2Ext LocArg Ty2
forall loc dec. SSModality -&gt; Var -&gt; Var -&gt; TyCon -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-var">SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="Gibbon.Common.html#Read"><span class="hs-identifier hs-var">Read</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979137"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979134"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979137"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979140"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2)
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979138"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>                                </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680979142"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979142"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979139"><span class="hs-identifier hs-var">push</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality -&gt; Var -&gt; Var -&gt; TyCon -&gt; E2Ext LocArg Ty2
forall loc dec. SSModality -&gt; Var -&gt; Var -&gt; TyCon -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-var">SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="Gibbon.Common.html#Read"><span class="hs-identifier hs-var">Read</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979142"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979134"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979137"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979140"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2)
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979138"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>                       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-615"></span><span>                       </span><span class="annot"><span class="annottext">Set (Maybe Var, Var)
</span><a href="#local-6989586621680979130"><span class="hs-identifier hs-var">free_rlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-616"></span><span>      </span><span id="local-6989586621680979143"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979143"><span class="hs-identifier hs-var">wpush</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var
 -&gt; [(Var, [LocArg], Ty2, Exp2)]
 -&gt; PassM [(Var, [LocArg], Ty2, Exp2)])
-&gt; [(Var, [LocArg], Ty2, Exp2)]
-&gt; Set Var
-&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldrM"><span class="hs-identifier hs-var">foldrM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680979144"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979144"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680979145"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979145"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-617"></span><span>                         </span><span id="local-6989586621680979146"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979146"><span class="hs-identifier hs-var">push</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;ss_push&quot;</span></span><span>
</span><span id="line-618"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680979147"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621680979147"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AllocEnv
</span><a href="#local-6989586621680979133"><span class="hs-identifier hs-var">wlocs_env</span></a></span><span> </span><span class="annot"><span class="annottext">AllocEnv -&gt; Var -&gt; TyCon
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979144"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-619"></span><span>                         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979147"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Gibbon.Passes.ThreadRegions.html#hole_tycon"><span class="hs-identifier hs-var">hole_tycon</span></a></span><span>
</span><span id="line-620"></span><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979145"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-621"></span><span>                         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979146"><span class="hs-identifier hs-var">push</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">UrTy Var -&gt; Ty2
</span><a href="Gibbon.NewL2.Syntax.html#MkTy2"><span class="hs-identifier hs-var">MkTy2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UrTy Var] -&gt; UrTy Var
forall loc. [UrTy loc] -&gt; UrTy loc
</span><a href="Gibbon.Language.Syntax.html#ProdTy"><span class="hs-identifier hs-var">ProdTy</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality -&gt; Var -&gt; Var -&gt; TyCon -&gt; E2Ext LocArg Ty2
forall loc dec. SSModality -&gt; Var -&gt; Var -&gt; TyCon -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-var">SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="Gibbon.Common.html#Write"><span class="hs-identifier hs-var">Write</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979144"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Var
</span><a href="Gibbon.Common.html#toEndV"><span class="hs-identifier hs-var">toEndV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RegEnv
</span><a href="#local-6989586621680979134"><span class="hs-identifier hs-var">renv</span></a></span><span> </span><span class="annot"><span class="annottext">RegEnv -&gt; Var -&gt; Var
forall a b.
(Ord a, Out a, Out b, Show a, HasCallStack) =&gt;
Map a b -&gt; a -&gt; b
</span><a href="Gibbon.Common.html#%23"><span class="hs-operator hs-var">#</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979144"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979147"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2)
-&gt; [(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979145"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>                       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-623"></span><span>                       </span><span class="annot"><span class="annottext">Set Var
</span><a href="#local-6989586621680979131"><span class="hs-identifier hs-var">free_wlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.Common.html#PassM"><span class="hs-identifier hs-type">PassM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Ty2"><span class="hs-identifier hs-type">Ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-624"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680979159"><span class="annot"><span class="annottext">fn :: (a, b, c, PreExp E2Ext loc dec)
-&gt; PassM (Var, b, c, PreExp E2Ext loc dec)
</span><a href="#local-6989586621680979159"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680979160"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680979160"><span class="hs-identifier hs-var">_x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979161"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680979161"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979162"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680979162"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span> </span><span id="local-6989586621680979163"><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680979163"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680979164"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979164"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680979165"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979165"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; PassM Var
forall (m :: * -&gt; *). MonadState Int m =&gt; Var -&gt; m Var
</span><a href="Gibbon.Common.html#gensym"><span class="hs-identifier hs-var">gensym</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-string">&quot;ss_pop&quot;</span></span><span> </span><span class="annot"><span class="annottext">PassM Var
-&gt; (Var -&gt; PassM (Var, b, c, PreExp E2Ext loc dec))
-&gt; PassM (Var, b, c, PreExp E2Ext loc dec)
forall a b. PassM a -&gt; (a -&gt; PassM b) -&gt; PassM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680979166"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979166"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, b, c, PreExp E2Ext loc dec)
-&gt; PassM (Var, b, c, PreExp E2Ext loc dec)
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979166"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680979161"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680979162"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">E2Ext loc dec -&gt; PreExp E2Ext loc dec
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SSModality -&gt; Var -&gt; Var -&gt; E2Ext loc dec
forall loc dec. SSModality -&gt; Var -&gt; Var -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-var">SSPop</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><a href="#local-6989586621680979163"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979164"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979165"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>      </span><span id="local-6989586621680979167"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979167"><span class="hs-identifier hs-var">rpop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Var, [LocArg], Ty2, Exp2) -&gt; PassM (Var, [LocArg], Ty2, Exp2))
-&gt; [(Var, [LocArg], Ty2, Exp2)]
-&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; PassM (Var, [LocArg], Ty2, Exp2)
forall {a} {b} {c} {loc} {dec} {loc} {dec}.
(a, b, c, PreExp E2Ext loc dec)
-&gt; PassM (Var, b, c, PreExp E2Ext loc dec)
</span><a href="#local-6989586621680979159"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979135"><span class="hs-identifier hs-var">rpush</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>      </span><span id="local-6989586621680979168"><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979168"><span class="hs-identifier hs-var">wpop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Var, [LocArg], Ty2, Exp2) -&gt; PassM (Var, [LocArg], Ty2, Exp2))
-&gt; [(Var, [LocArg], Ty2, Exp2)]
-&gt; PassM [(Var, [LocArg], Ty2, Exp2)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; PassM (Var, [LocArg], Ty2, Exp2)
forall {a} {b} {c} {loc} {dec} {loc} {dec}.
(a, b, c, PreExp E2Ext loc dec)
-&gt; PassM (Var, b, c, PreExp E2Ext loc dec)
</span><a href="#local-6989586621680979159"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)] -&gt; [(Var, [LocArg], Ty2, Exp2)]
forall a. [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979143"><span class="hs-identifier hs-var">wpush</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>      </span><span class="annot"><span class="annottext">([(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)],
 [(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)])
-&gt; PassM
     ([(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)],
      [(Var, [LocArg], Ty2, Exp2)], [(Var, [LocArg], Ty2, Exp2)])
forall a. a -&gt; PassM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979135"><span class="hs-identifier hs-var">rpush</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979143"><span class="hs-identifier hs-var">wpush</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979167"><span class="hs-identifier hs-var">rpop</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, [LocArg], Ty2, Exp2)]
</span><a href="#local-6989586621680979168"><span class="hs-identifier hs-var">wpop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span class="hs-comment">-- Inspect an AST and return locations in a RetE form.</span><span>
</span><span id="line-631"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#findRetLocs"><span class="hs-identifier hs-type">findRetLocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-632"></span><span id="findRetLocs"><span class="annot"><span class="annottext">findRetLocs :: Exp2 -&gt; [LocArg]
</span><a href="Gibbon.Passes.ThreadRegions.html#findRetLocs"><span class="hs-identifier hs-var hs-var">findRetLocs</span></a></span></span><span> </span><span id="local-6989586621680979180"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979180"><span class="hs-identifier hs-var">e0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979180"><span class="hs-identifier hs-var">e0</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-634"></span><span>    </span><span class="annot"><a href="#local-6989586621680979181"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-635"></span><span>    </span><span id="local-6989586621680979181"><span class="annot"><span class="annottext">go :: Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680979182"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979182"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span id="local-6989586621680979183"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-636"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979182"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-637"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#VarE"><span class="hs-identifier hs-type">VarE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-638"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitE"><span class="hs-identifier hs-type">LitE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-639"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CharE"><span class="hs-identifier hs-type">CharE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-640"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FloatE"><span class="hs-identifier hs-type">FloatE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-641"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LitSymE"><span class="hs-identifier hs-type">LitSymE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-642"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979184"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979184"><span class="hs-identifier hs-var">args</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; [LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [Exp2] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979184"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-643"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979185"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979185"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; [LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [Exp2] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979185"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-644"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[LocArg]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680979186"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979186"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979187"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979187"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-645"></span><span>          </span><span class="annot"><span class="annottext">(Exp2 -&gt; [LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [Exp2] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979186"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979187"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-646"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680979188"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979188"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680979189"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979189"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680979190"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979190"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; [LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [Exp2] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979188"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979189"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979190"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-647"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680979191"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979191"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; [LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [Exp2] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979191"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-648"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979192"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979192"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979192"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-649"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979193"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979193"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Exp2 -&gt; [LocArg] -&gt; [LocArg]) -&gt; [LocArg] -&gt; [Exp2] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979193"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-650"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979194"><span class="annot"><span class="annottext">[(TyCon, [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680979194"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-651"></span><span>          </span><span class="annot"><span class="annottext">((TyCon, [(Var, LocArg)], Exp2) -&gt; [LocArg] -&gt; [LocArg])
-&gt; [LocArg] -&gt; [(TyCon, [(Var, LocArg)], Exp2)] -&gt; [LocArg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680979195"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979195"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979196"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979196"><span class="hs-identifier hs-var">acc2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979195"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979196"><span class="hs-identifier hs-var">acc2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680979194"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-652"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680979197"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979197"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680979198"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979198"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span id="local-6989586621680979199"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680979199"><span class="hs-identifier hs-var">_b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979197"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-653"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680979200"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979200"><span class="hs-identifier hs-var">_v</span></a></span></span><span> </span><span id="local-6989586621680979201"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979201"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979201"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-654"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SyncE"><span class="hs-identifier hs-type">SyncE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-656"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680979202"><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680979202"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-657"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680979202"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-658"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979203"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979203"><span class="hs-identifier hs-var">bod</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979203"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-659"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979204"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979204"><span class="hs-identifier hs-var">bod</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979204"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-660"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979205"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979205"><span class="hs-identifier hs-var">bod</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979205"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-661"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">StartOfPkdCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-662"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-663"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span> </span><span id="local-6989586621680979206"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979206"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979206"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; [LocArg] -&gt; [LocArg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-664"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-type">FromEndE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-665"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-666"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-667"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AddFixed"><span class="hs-identifier hs-type">AddFixed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-668"></span><span>            </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="Gibbon.L2.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-669"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979207"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979207"><span class="hs-identifier hs-var">bod</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [LocArg] -&gt; [LocArg]
</span><a href="#local-6989586621680979181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979207"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-670"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-671"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-672"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-673"></span><span>            </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979183"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-674"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MapE"><span class="hs-identifier hs-type">MapE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [LocArg]
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;findRetLocs: TODO MapE&quot;</span></span><span>
</span><span id="line-675"></span><span>        </span><span class="annot"><a href="Gibbon.Language.Syntax.html#FoldE"><span class="hs-identifier hs-type">FoldE</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [LocArg]
forall a. HasCallStack =&gt; TyCon -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-string">&quot;findRetLocs: TODO FoldE&quot;</span></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="hs-comment">-- Maximal sum of sizes of scalars before the first packed thing in the</span><span>
</span><span id="line-680"></span><span class="hs-comment">-- constructors of this type. The assumption is that whatever writes</span><span>
</span><span id="line-681"></span><span class="hs-comment">-- that packed value will do a bounds check again. Note that only AppE's</span><span>
</span><span id="line-682"></span><span class="hs-comment">-- do boundschecking, DataConE's dont. We should fix this.</span><span>
</span><span id="line-683"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#boundsCheck"><span class="hs-identifier hs-type">boundsCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#DDefs2"><span class="hs-identifier hs-type">DDefs2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-684"></span><span id="boundsCheck"><span class="annot"><span class="annottext">boundsCheck :: DDefs Ty2 -&gt; TyCon -&gt; Int
</span><a href="Gibbon.Passes.ThreadRegions.html#boundsCheck"><span class="hs-identifier hs-var hs-var">boundsCheck</span></a></span></span><span> </span><span id="local-6989586621680979219"><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680979219"><span class="hs-identifier hs-var">ddefs</span></a></span></span><span> </span><span id="local-6989586621680979220"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979220"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-685"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680979221"><span class="annot"><span class="annottext">dcons :: [TyCon]
</span><a href="#local-6989586621680979221"><span class="hs-identifier hs-var hs-var">dcons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; TyCon -&gt; [TyCon]
forall a. Out a =&gt; DDefs a -&gt; TyCon -&gt; [TyCon]
</span><a href="Gibbon.Language.Syntax.html#getConOrdering"><span class="hs-identifier hs-var">getConOrdering</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680979219"><span class="hs-identifier hs-var">ddefs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979220"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-686"></span><span>      </span><span id="local-6989586621680979230"><span class="annot"><span class="annottext">spaceReqd :: t Ty2 -&gt; (Int, Bool)
</span><a href="#local-6989586621680979230"><span class="hs-identifier hs-var hs-var">spaceReqd</span></a></span></span><span> </span><span id="local-6989586621680979231"><span class="annot"><span class="annottext">t Ty2
</span><a href="#local-6989586621680979231"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Bool) -&gt; Ty2 -&gt; (Int, Bool))
-&gt; (Int, Bool) -&gt; t Ty2 -&gt; (Int, Bool)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680979233"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979233"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680979234"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680979234"><span class="hs-identifier hs-var">seen_packed</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979235"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979235"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-687"></span><span>                               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680979234"><span class="hs-identifier hs-var">seen_packed</span></a></span><span>
</span><span id="line-688"></span><span>                               </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979233"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680979234"><span class="hs-identifier hs-var">seen_packed</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Bool
forall a. Show a =&gt; UrTy a -&gt; Bool
</span><a href="Gibbon.Language.html#hasPacked"><span class="hs-identifier hs-var">hasPacked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979235"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>                               </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979233"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979233"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UrTy Var -&gt; Maybe Int
forall a. UrTy a -&gt; Maybe Int
</span><a href="Gibbon.Language.html#sizeOfTy"><span class="hs-identifier hs-var">sizeOfTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty2 -&gt; UrTy Var
</span><a href="Gibbon.NewL2.Syntax.html#unTy2"><span class="hs-identifier hs-var">unTy2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979235"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>                        </span><span class="annot"><span class="annottext">t Ty2
</span><a href="#local-6989586621680979231"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-694"></span><span>      </span><span id="local-6989586621680979237"><span class="annot"><span class="annottext">tyss :: [[Ty2]]
</span><a href="#local-6989586621680979237"><span class="hs-identifier hs-var hs-var">tyss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; [Ty2]) -&gt; [TyCon] -&gt; [[Ty2]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DDefs Ty2 -&gt; TyCon -&gt; [Ty2]
forall a. Out a =&gt; DDefs a -&gt; TyCon -&gt; [a]
</span><a href="Gibbon.Language.Syntax.html#lookupDataCon"><span class="hs-identifier hs-var">lookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DDefs Ty2
</span><a href="#local-6989586621680979219"><span class="hs-identifier hs-var">ddefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621680979221"><span class="hs-identifier hs-var">dcons</span></a></span><span>
</span><span id="line-695"></span><span>      </span><span id="local-6989586621680979238"><span class="annot"><span class="annottext">vals :: [Int]
</span><a href="#local-6989586621680979238"><span class="hs-identifier hs-var hs-var">vals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Ty2] -&gt; Int) -&gt; [[Ty2]] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Bool) -&gt; Int
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Bool) -&gt; Int) -&gt; ([Ty2] -&gt; (Int, Bool)) -&gt; [Ty2] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Ty2] -&gt; (Int, Bool)
forall {t :: * -&gt; *}. Foldable t =&gt; t Ty2 -&gt; (Int, Bool)
</span><a href="#local-6989586621680979230"><span class="hs-identifier hs-var">spaceReqd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Ty2]]
</span><a href="#local-6989586621680979237"><span class="hs-identifier hs-var">tyss</span></a></span><span>
</span><span id="line-696"></span><span>      </span><span class="hs-comment">-- Add a byte for the tag.</span><span>
</span><span id="line-697"></span><span>      </span><span id="local-6989586621680979239"><span class="annot"><span class="annottext">num_bytes :: Int
</span><a href="#local-6989586621680979239"><span class="hs-identifier hs-var hs-var">num_bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Foldable.html#maximum"><span class="hs-identifier hs-var">maximum</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680979238"><span class="hs-identifier hs-var">vals</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-comment">-- Reserve additional space for a redirection node or a forwarding pointer.</span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979239"><span class="hs-identifier hs-var">num_bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span class="hs-comment">-- gFreeVars ++ locations ++ region variables - (args to datacons)</span><span>
</span><span id="line-704"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-type">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">S.Set</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-705"></span><span id="allFreeVars_sans_datacon_args"><span class="annot"><span class="annottext">allFreeVars_sans_datacon_args :: Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var hs-var">allFreeVars_sans_datacon_args</span></a></span></span><span> </span><span id="local-6989586621680979286"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979286"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979286"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-707"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979287"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979287"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680979288"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979288"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979287"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Set Var) -&gt; [Exp2] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979288"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979290"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979290"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Set Var) -&gt; [Exp2] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979290"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680979291"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979291"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979292"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979292"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680979293"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979293"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979294"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979294"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979292"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979293"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979294"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>                               </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`S.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979291"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-711"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680979295"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979295"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680979296"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979296"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680979297"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979297"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979295"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979296"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979297"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-712"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680979298"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979298"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Set Var) -&gt; [Exp2] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979298"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979299"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979299"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979299"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680979300"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979300"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680979301"><span class="annot"><span class="annottext">[(TyCon, [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680979301"><span class="hs-identifier hs-var">brs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979300"><span class="hs-identifier hs-var">scrt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TyCon, [(Var, LocArg)], Exp2) -&gt; Set Var)
-&gt; [(TyCon, [(Var, LocArg)], Exp2)] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621680979302"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680979302"><span class="hs-identifier hs-var">vlocs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979303"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979303"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979303"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`S.difference`</span></a></span><span>
</span><span id="line-715"></span><span>                                                                                   </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Var, LocArg) -&gt; Var) -&gt; [(Var, LocArg)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, LocArg) -&gt; Var
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680979302"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`S.difference`</span></a></span><span>
</span><span id="line-716"></span><span>                                                                                   </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Var, LocArg) -&gt; Var) -&gt; [(Var, LocArg)] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">(LocArg -&gt; Var)
-&gt; ((Var, LocArg) -&gt; LocArg) -&gt; (Var, LocArg) -&gt; Var
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Var, LocArg) -&gt; LocArg
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680979302"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>                                                                  </span><span class="annot"><span class="annottext">[(TyCon, [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680979301"><span class="hs-identifier hs-var">brs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680979304"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979304"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979305"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979305"><span class="hs-identifier hs-var">_args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979304"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680979306"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979306"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979306"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-720"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979307"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979307"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979307"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-721"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979308"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979308"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680979309"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979309"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979308"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Set Var] -&gt; Set Var
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">S.unions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Set Var) -&gt; [Exp2] -&gt; [Set Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979309"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680979310"><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680979310"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-723"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680979310"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-724"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680979311"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680979311"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680979312"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680979312"><span class="hs-identifier hs-var">_sz</span></a></span></span><span> </span><span id="local-6989586621680979313"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680979313"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span id="local-6989586621680979314"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979314"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#delete"><span class="hs-identifier hs-var">S.delete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680979311"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979314"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680979316"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680979316"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680979317"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680979317"><span class="hs-identifier hs-var">_sz</span></a></span></span><span> </span><span id="local-6989586621680979318"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680979318"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span id="local-6989586621680979319"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979319"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#delete"><span class="hs-identifier hs-var">S.delete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region -&gt; Var
</span><a href="Gibbon.L2.Syntax.html#regionToVar"><span class="hs-identifier hs-var">regionToVar</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680979316"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979319"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680979320"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979320"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680979321"><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680979321"><span class="hs-identifier hs-var">locexp</span></a></span></span><span> </span><span id="local-6989586621680979322"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979322"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#delete"><span class="hs-identifier hs-var">S.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979320"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
</span><a href="Gibbon.Passes.ThreadRegions.html#allFreeVars_sans_datacon_args"><span class="hs-identifier hs-var">allFreeVars_sans_datacon_args</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979322"><span class="hs-identifier hs-var">bod</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg -&gt; Set Var
forall a. FreeVars a =&gt; a -&gt; Set Var
</span><a href="Gibbon.Language.Syntax.html#gFreeVars"><span class="hs-identifier hs-var">gFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680979321"><span class="hs-identifier hs-var">locexp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">StartOfPkdCursor</span></a></span><span> </span><span id="local-6989586621680979324"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979324"><span class="hs-identifier hs-var">cur</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979324"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-728"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span> </span><span id="local-6989586621680979325"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979325"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680979326"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979326"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979325"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979326"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-729"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span> </span><span id="local-6989586621680979327"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979327"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680979328"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979328"><span class="hs-identifier hs-var">v</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979328"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; Var) -&gt; [LocArg] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979327"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-type">FromEndE</span></a></span><span> </span><span id="local-6989586621680979329"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979329"><span class="hs-identifier hs-var">loc</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979329"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979330"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979330"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680979331"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979331"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979330"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979331"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-732"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680979332"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979332"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979333"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979333"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680979334"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979334"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979335"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979335"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; Set Var) -&gt; [Var] -&gt; Set Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979332"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979333"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979334"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#toLocVar"><span class="hs-identifier hs-var">toLocVar</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979335"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-733"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AddFixed"><span class="hs-identifier hs-type">AddFixed</span></a></span><span> </span><span id="local-6989586621680979336"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979336"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979336"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-734"></span><span>        </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="Gibbon.L2.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Var
forall a. Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-735"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span id="local-6989586621680979337"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979337"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621680979338"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979338"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979337"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Var -&gt; Set Var -&gt; Set Var
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
forall a. FreeVars a =&gt; a -&gt; Set Var
</span><a href="Gibbon.Language.Syntax.html#gFreeVars"><span class="hs-identifier hs-var">gFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979338"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-736"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span> </span><span id="local-6989586621680979339"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979339"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979339"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-737"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span> </span><span id="local-6989586621680979340"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979340"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Set Var
forall a. a -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979340"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-738"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979341"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979341"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680979342"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979342"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979341"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979342"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-739"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span> </span><span class="annot"><span class="annottext">SSModality
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680979343"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979343"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680979344"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979344"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Set Var
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979343"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979344"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-740"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Set Var
forall a. FreeVars a =&gt; a -&gt; Set Var
</span><a href="Gibbon.Language.Syntax.html#gFreeVars"><span class="hs-identifier hs-var">gFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979286"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#substEndReg"><span class="hs-identifier hs-type">substEndReg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#RegVar"><span class="hs-identifier hs-type">RegVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#RegVar"><span class="hs-identifier hs-type">RegVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Exp2"><span class="hs-identifier hs-type">Exp2</span></a></span><span>
</span><span id="line-746"></span><span id="substEndReg"><span class="annot"><span class="annottext">substEndReg :: Either Var Var -&gt; Var -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#substEndReg"><span class="hs-identifier hs-var hs-var">substEndReg</span></a></span></span><span> </span><span id="local-6989586621680979345"><span class="annot"><span class="annottext">Either Var Var
</span><a href="#local-6989586621680979345"><span class="hs-identifier hs-var">loc_or_reg</span></a></span></span><span> </span><span id="local-6989586621680979346"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979346"><span class="hs-identifier hs-var">end_reg</span></a></span></span><span> </span><span id="local-6989586621680979347"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-748"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-type">AppE</span></a></span><span> </span><span id="local-6989586621680979348"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979348"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680979349"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979349"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680979350"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979350"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#AppE"><span class="hs-identifier hs-var">AppE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979348"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; LocArg) -&gt; [LocArg] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979349"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979350"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-type">PrimAppE</span></a></span><span> </span><span id="local-6989586621680979353"><span class="annot"><span class="annottext">Prim Ty2
</span><a href="#local-6989586621680979353"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span id="local-6989586621680979354"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979354"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Prim Ty2 -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Prim dec -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#PrimAppE"><span class="hs-identifier hs-var">PrimAppE</span></a></span><span> </span><span class="annot"><span class="annottext">Prim Ty2
</span><a href="#local-6989586621680979353"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979354"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-750"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-type">LetE</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680979355"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979355"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979356"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979356"><span class="hs-identifier hs-var">locs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979357"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979357"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979358"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979358"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979359"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979359"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Var, [LocArg], Ty2, Exp2) -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
(Var, [loc], dec, PreExp ext loc dec)
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#LetE"><span class="hs-identifier hs-var">LetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979355"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(LocArg -&gt; LocArg) -&gt; [LocArg] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979356"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979357"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979358"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979359"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-type">IfE</span></a></span><span> </span><span id="local-6989586621680979360"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979360"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680979361"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979361"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680979362"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979362"><span class="hs-identifier hs-var">c</span></a></span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2 -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; PreExp ext loc dec -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#IfE"><span class="hs-identifier hs-var">IfE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979360"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979361"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979362"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-752"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-type">MkProdE</span></a></span><span> </span><span id="local-6989586621680979363"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979363"><span class="hs-identifier hs-var">args</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
[PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#MkProdE"><span class="hs-identifier hs-var">MkProdE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979363"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-type">ProjE</span></a></span><span> </span><span id="local-6989586621680979364"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979364"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680979365"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979365"><span class="hs-identifier hs-var">bod</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Int -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#ProjE"><span class="hs-identifier hs-var">ProjE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979364"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979365"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-type">CaseE</span></a></span><span> </span><span id="local-6989586621680979366"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979366"><span class="hs-identifier hs-var">scrt</span></a></span></span><span> </span><span id="local-6989586621680979367"><span class="annot"><span class="annottext">[(TyCon, [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680979367"><span class="hs-identifier hs-var">brs</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; [(TyCon, [(Var, LocArg)], Exp2)] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec
-&gt; [(TyCon, [(Var, loc)], PreExp ext loc dec)]
-&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#CaseE"><span class="hs-identifier hs-var">CaseE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979366"><span class="hs-identifier hs-var">scrt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TyCon, [(Var, LocArg)], Exp2) -&gt; (TyCon, [(Var, LocArg)], Exp2))
-&gt; [(TyCon, [(Var, LocArg)], Exp2)]
-&gt; [(TyCon, [(Var, LocArg)], Exp2)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680979368"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979368"><span class="hs-identifier hs-var">dcon</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979369"><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680979369"><span class="hs-identifier hs-var">vlocs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979370"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979370"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979368"><span class="hs-identifier hs-var">dcon</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Var, LocArg)]
</span><a href="#local-6989586621680979369"><span class="hs-identifier hs-var">vlocs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979370"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Var, LocArg)], Exp2)]
</span><a href="#local-6989586621680979367"><span class="hs-identifier hs-var">brs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-type">DataConE</span></a></span><span> </span><span id="local-6989586621680979371"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979371"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680979372"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979372"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span id="local-6989586621680979373"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979373"><span class="hs-identifier hs-var">args</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; TyCon -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
loc -&gt; TyCon -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#DataConE"><span class="hs-identifier hs-var">DataConE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979371"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979372"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979373"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-type">TimeIt</span></a></span><span> </span><span id="local-6989586621680979374"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979374"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680979375"><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979375"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680979376"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680979376"><span class="hs-identifier hs-var">b</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Ty2 -&gt; Bool -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
PreExp ext loc dec -&gt; dec -&gt; Bool -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#TimeIt"><span class="hs-identifier hs-var">TimeIt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979374"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty2
</span><a href="#local-6989586621680979375"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680979376"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-757"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-type">WithArenaE</span></a></span><span> </span><span id="local-6989586621680979377"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979377"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680979378"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979378"><span class="hs-identifier hs-var">e</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Exp2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; PreExp ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#WithArenaE"><span class="hs-identifier hs-var">WithArenaE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979377"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979378"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-type">SpawnE</span></a></span><span> </span><span id="local-6989586621680979379"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979379"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680979380"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979380"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680979381"><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979381"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; [LocArg] -&gt; [Exp2] -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
Var -&gt; [loc] -&gt; [PreExp ext loc dec] -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#SpawnE"><span class="hs-identifier hs-var">SpawnE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979379"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; LocArg) -&gt; [LocArg] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979380"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp2 -&gt; Exp2) -&gt; [Exp2] -&gt; [Exp2]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp2]
</span><a href="#local-6989586621680979381"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>    </span><span class="annot"><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-type">Ext</span></a></span><span> </span><span id="local-6989586621680979382"><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680979382"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-760"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="#local-6989586621680979382"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-761"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-type">LetRegionE</span></a></span><span> </span><span id="local-6989586621680979383"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680979383"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680979384"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680979384"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680979385"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680979385"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680979386"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979386"><span class="hs-identifier hs-var">bod</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetRegionE"><span class="hs-identifier hs-var">LetRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680979383"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680979384"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680979385"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979386"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-type">LetParRegionE</span></a></span><span> </span><span id="local-6989586621680979387"><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680979387"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680979388"><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680979388"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680979389"><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680979389"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621680979390"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979390"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec.
Region
-&gt; RegionSize -&gt; Maybe RegionType -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetParRegionE"><span class="hs-identifier hs-var">LetParRegionE</span></a></span><span> </span><span class="annot"><span class="annottext">Region
</span><a href="#local-6989586621680979387"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RegionSize
</span><a href="#local-6989586621680979388"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RegionType
</span><a href="#local-6989586621680979389"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979390"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-type">LetLocE</span></a></span><span> </span><span id="local-6989586621680979391"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979391"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680979392"><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680979392"><span class="hs-identifier hs-var">locexp</span></a></span></span><span> </span><span id="local-6989586621680979393"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979393"><span class="hs-identifier hs-var">bod</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; PreLocExp LocArg -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec. Var -&gt; PreLocExp loc -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetLocE"><span class="hs-identifier hs-var">LetLocE</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979391"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PreLocExp LocArg
</span><a href="#local-6989586621680979392"><span class="hs-identifier hs-var">locexp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979393"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-type">RetE</span></a></span><span> </span><span id="local-6989586621680979394"><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979394"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621680979395"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979395"><span class="hs-identifier hs-var">v</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg] -&gt; Var -&gt; E2Ext LocArg Ty2
forall loc dec. [loc] -&gt; Var -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#RetE"><span class="hs-identifier hs-var">RetE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocArg -&gt; LocArg) -&gt; [LocArg] -&gt; [LocArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">[LocArg]
</span><a href="#local-6989586621680979394"><span class="hs-identifier hs-var">locs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979395"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-765"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-type">FromEndE</span></a></span><span> </span><span id="local-6989586621680979396"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979396"><span class="hs-identifier hs-var">loc</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; E2Ext LocArg Ty2
forall loc dec. loc -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#FromEndE"><span class="hs-identifier hs-var">FromEndE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979396"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-type">BoundsCheck</span></a></span><span> </span><span id="local-6989586621680979397"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979397"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680979398"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979398"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621680979399"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979399"><span class="hs-identifier hs-var">cur</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocArg -&gt; LocArg -&gt; E2Ext LocArg Ty2
forall loc dec. Int -&gt; loc -&gt; loc -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#BoundsCheck"><span class="hs-identifier hs-var">BoundsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680979397"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979398"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979399"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-type">IndirectionE</span></a></span><span> </span><span id="local-6989586621680979400"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979400"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680979401"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979401"><span class="hs-identifier hs-var">dcon</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680979402"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979402"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979403"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979403"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680979404"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979404"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680979405"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979405"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680979406"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979406"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-768"></span><span>          </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
-&gt; TyCon
-&gt; (LocArg, LocArg)
-&gt; (LocArg, LocArg)
-&gt; Exp2
-&gt; E2Ext LocArg Ty2
forall loc dec.
TyCon
-&gt; TyCon -&gt; (loc, loc) -&gt; (loc, loc) -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#IndirectionE"><span class="hs-identifier hs-var">IndirectionE</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979400"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680979401"><span class="hs-identifier hs-var">dcon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979402"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979403"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979404"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var">gosubst</span></a></span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979405"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979406"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-769"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-type">LetAvail</span></a></span><span> </span><span id="local-6989586621680979407"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979407"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621680979408"><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979408"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2 -&gt; Exp2
forall (ext :: * -&gt; * -&gt; *) loc dec.
ext loc dec -&gt; PreExp ext loc dec
</span><a href="Gibbon.Language.Syntax.html#Ext"><span class="hs-identifier hs-var">Ext</span></a></span><span> </span><span class="annot"><span class="annottext">(E2Ext LocArg Ty2 -&gt; Exp2) -&gt; E2Ext LocArg Ty2 -&gt; Exp2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Exp2 -&gt; E2Ext LocArg Ty2
forall loc dec. [Var] -&gt; E2 loc dec -&gt; E2Ext loc dec
</span><a href="Gibbon.L2.Syntax.html#LetAvail"><span class="hs-identifier hs-var">LetAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680979407"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979408"><span class="hs-identifier hs-var">bod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#StartOfPkdCursor"><span class="hs-identifier hs-type">StartOfPkdCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-771"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#TagCursor"><span class="hs-identifier hs-type">TagCursor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-772"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AddFixed"><span class="hs-identifier hs-type">AddFixed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-773"></span><span>        </span><span class="annot"><span class="annottext">E2Ext LocArg Ty2
</span><a href="Gibbon.L2.Syntax.html#GetCilkWorkerNum"><span class="hs-identifier hs-var">GetCilkWorkerNum</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-774"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateTagHere"><span class="hs-identifier hs-type">AllocateTagHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-775"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#AllocateScalarsHere"><span class="hs-identifier hs-type">AllocateScalarsHere</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-776"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPush"><span class="hs-identifier hs-type">SSPush</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-777"></span><span>        </span><span class="annot"><a href="Gibbon.L2.Syntax.html#SSPop"><span class="hs-identifier hs-type">SSPop</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-778"></span><span>    </span><span class="annot"><span class="annottext">Exp2
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp2
</span><a href="#local-6989586621680979347"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-779"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-780"></span><span>  </span><span id="local-6989586621680979352"><span class="annot"><span class="annottext">go :: Exp2 -&gt; Exp2
</span><a href="#local-6989586621680979352"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Var Var -&gt; Var -&gt; Exp2 -&gt; Exp2
</span><a href="Gibbon.Passes.ThreadRegions.html#substEndReg"><span class="hs-identifier hs-var">substEndReg</span></a></span><span> </span><span class="annot"><span class="annottext">Either Var Var
</span><a href="#local-6989586621680979345"><span class="hs-identifier hs-var">loc_or_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979346"><span class="hs-identifier hs-var">end_reg</span></a></span><span>
</span><span id="line-781"></span><span>  </span><span id="local-6989586621680979351"><span class="annot"><span class="annottext">gosubst :: LocArg -&gt; LocArg
</span><a href="#local-6989586621680979351"><span class="hs-identifier hs-var hs-var">gosubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Var Var -&gt; Var -&gt; LocArg -&gt; LocArg
</span><a href="Gibbon.Passes.ThreadRegions.html#substEndReg_locarg"><span class="hs-identifier hs-var">substEndReg_locarg</span></a></span><span> </span><span class="annot"><span class="annottext">Either Var Var
</span><a href="#local-6989586621680979345"><span class="hs-identifier hs-var">loc_or_reg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979346"><span class="hs-identifier hs-var">end_reg</span></a></span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span class="annot"><a href="Gibbon.Passes.ThreadRegions.html#substEndReg_locarg"><span class="hs-identifier hs-type">substEndReg_locarg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#LocVar"><span class="hs-identifier hs-type">LocVar</span></a></span><span> </span><span class="annot"><a href="Gibbon.Common.html#RegVar"><span class="hs-identifier hs-type">RegVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.Common.html#RegVar"><span class="hs-identifier hs-type">RegVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#LocArg"><span class="hs-identifier hs-type">LocArg</span></a></span><span>
</span><span id="line-784"></span><span id="substEndReg_locarg"><span class="annot"><span class="annottext">substEndReg_locarg :: Either Var Var -&gt; Var -&gt; LocArg -&gt; LocArg
</span><a href="Gibbon.Passes.ThreadRegions.html#substEndReg_locarg"><span class="hs-identifier hs-var hs-var">substEndReg_locarg</span></a></span></span><span> </span><span id="local-6989586621680979414"><span class="annot"><span class="annottext">Either Var Var
</span><a href="#local-6989586621680979414"><span class="hs-identifier hs-var">loc_or_reg</span></a></span></span><span> </span><span id="local-6989586621680979415"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979415"><span class="hs-identifier hs-var">end_reg</span></a></span></span><span> </span><span id="local-6989586621680979416"><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-786"></span><span>    </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-type">Loc</span></a></span><span> </span><span id="local-6989586621680979417"><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979417"><span class="hs-identifier hs-var">lrem</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Var Var
</span><a href="#local-6989586621680979414"><span class="hs-identifier hs-var">loc_or_reg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-787"></span><span>                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680979418"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979418"><span class="hs-identifier hs-var">loc0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#lremLoc"><span class="hs-identifier hs-var">lremLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979417"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979418"><span class="hs-identifier hs-var">loc0</span></a></span><span>
</span><span id="line-788"></span><span>                                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-var">Loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979417"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lremEndReg :: Var
</span><a href="Gibbon.NewL2.Syntax.html#lremEndReg"><span class="hs-identifier hs-var">lremEndReg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979415"><span class="hs-identifier hs-var">end_reg</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>                                         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span><span>
</span><span id="line-790"></span><span>                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680979419"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979419"><span class="hs-identifier hs-var">reg0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#lremReg"><span class="hs-identifier hs-var">lremReg</span></a></span><span> </span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979417"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979419"><span class="hs-identifier hs-var">reg0</span></a></span><span>
</span><span id="line-791"></span><span>                                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#Loc"><span class="hs-identifier hs-var">Loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979417"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lremEndReg :: Var
</span><a href="Gibbon.NewL2.Syntax.html#lremEndReg"><span class="hs-identifier hs-var">lremEndReg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979415"><span class="hs-identifier hs-var">end_reg</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-792"></span><span>                                         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span><span>
</span><span id="line-793"></span><span>    </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#EndWitness"><span class="hs-identifier hs-type">EndWitness</span></a></span><span> </span><span id="local-6989586621680979422"><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979422"><span class="hs-identifier hs-var">lrem</span></a></span></span><span> </span><span id="local-6989586621680979423"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979423"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Var Var
</span><a href="#local-6989586621680979414"><span class="hs-identifier hs-var">loc_or_reg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-794"></span><span>                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680979424"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979424"><span class="hs-identifier hs-var">loc0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#lremLoc"><span class="hs-identifier hs-var">lremLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979422"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979424"><span class="hs-identifier hs-var">loc0</span></a></span><span>
</span><span id="line-795"></span><span>                                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndWitness"><span class="hs-identifier hs-var">EndWitness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979422"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lremEndReg :: Var
</span><a href="Gibbon.NewL2.Syntax.html#lremEndReg"><span class="hs-identifier hs-var">lremEndReg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979415"><span class="hs-identifier hs-var">end_reg</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979423"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-796"></span><span>                                         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span><span>
</span><span id="line-797"></span><span>                           </span><span class="annot"><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/base-4.17.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680979425"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979425"><span class="hs-identifier hs-var">reg0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Var
</span><a href="Gibbon.NewL2.Syntax.html#lremReg"><span class="hs-identifier hs-var">lremReg</span></a></span><span> </span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979422"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Var -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/8l12vmymy3adw2m02pf73xq5xjf6mfwp-ghc-9.4.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.9.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979425"><span class="hs-identifier hs-var">reg0</span></a></span><span>
</span><span id="line-798"></span><span>                                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LREM -&gt; Var -&gt; LocArg
</span><a href="Gibbon.NewL2.Syntax.html#EndWitness"><span class="hs-identifier hs-var">EndWitness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LREM
</span><a href="#local-6989586621680979422"><span class="hs-identifier hs-var">lrem</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lremEndReg :: Var
</span><a href="Gibbon.NewL2.Syntax.html#lremEndReg"><span class="hs-identifier hs-var">lremEndReg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979415"><span class="hs-identifier hs-var">end_reg</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680979423"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-799"></span><span>                                         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span><span>
</span><span id="line-800"></span><span>    </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#EndOfReg"><span class="hs-identifier hs-type">EndOfReg</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span><span>
</span><span id="line-802"></span><span>    </span><span class="annot"><a href="Gibbon.NewL2.Syntax.html#EndOfReg_Tagged"><span class="hs-identifier hs-type">EndOfReg_Tagged</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocArg
</span><a href="#local-6989586621680979416"><span class="hs-identifier hs-var">locarg</span></a></span><span>
</span><span id="line-803"></span></pre></body></html>